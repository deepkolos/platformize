"use strict";var e=require("./three.js"),t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t}function a(e){var t={exports:{}};return e(t,t.exports),t.exports}var s=class{constructor(e,t){this.parts=e,this.options=t}},o=Object.defineProperty({default:s},"__esModule",{value:!0}),i=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.encode=void 0;for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),a=0;a<r.length;a++)n[r.charCodeAt(a)]=a;t.encode=function(e){for(var t,n="",a=new Uint8Array(e),s=a.byteLength,o=s%3,i=s-o,c=0;c<i;c+=3)t=a[c]<<16|a[c+1]<<8|a[c+2],n+=r[(16515072&t)>>18]+r[(258048&t)>>12]+r[(4032&t)>>6]+r[63&t];return 1==o?(t=a[i],n+=r[(252&t)>>2]+r[(3&t)<<4]+"=="):2==o&&(t=a[i]<<8|a[i+1],n+=r[(64512&t)>>10]+r[(1008&t)>>4]+r[(15&t)<<2]+"="),n},t.decode=function(e){var t,r,a,s,o,i=.75*e.length,c=e.length,l=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var u=new ArrayBuffer(i),h=new Uint8Array(u);for(t=0;t<c;t+=4)r=n[e.charCodeAt(t)],a=n[e.charCodeAt(t+1)],s=n[e.charCodeAt(t+2)],o=n[e.charCodeAt(t+3)],h[l++]=r<<2|a>>4,h[l++]=(15&a)<<4|s>>2,h[l++]=(3&s)<<6|63&o;return u}}));const c=(t&&t.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(o);var l=class{createObjectURL(e){if(e instanceof c.default){const t=(0,i.encode)(e.parts[0]);return`data:${e.options.type};base64,${t}`}return""}revokeObjectURL(){}},u=Object.defineProperty({default:l},"__esModule",{value:!0});function h(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e);return t<0?void 0:t}var p=function(e){if((e=(e=`${e}`).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+/0-9A-Za-z]/.test(e))return"";let t="",r=0,n=0;for(let a=0;a<e.length;a++)r<<=6,r|=h(e[a]),n+=6,24===n&&(t+=String.fromCharCode((16711680&r)>>16),t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r),r=n=0);return 12===n?(r>>=4,t+=String.fromCharCode(r)):18===n&&(r>>=2,t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r)),t},d=Object.defineProperty({default:p},"__esModule",{value:!0}),f=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Touch=void 0;const r=new WeakMap;t.Touch=class{constructor(e){this.identifier=e.identifier,this.force=void 0===e.force?1:e.force,this.pageX=void 0===e.pageX?e.x:e.pageX,this.pageY=void 0===e.pageY?e.y:e.pageY,this.clientX=void 0===e.clientX?e.x:e.clientX,this.clientY=void 0===e.clientY?e.y:e.clientY,this.screenX=this.pageX,this.screenY=this.pageY}};t.default=class{constructor(){r.set(this,{})}addEventListener(e,t){let n=r.get(this);n||(n={},r.set(this,n)),n[e]||(n[e]=[]),n[e].push(t)}removeEventListener(e,t){const n=r.get(this);if(n){const r=n[e];if(r&&r.length>0)for(let e=r.length;e--;e>0)if(r[e]===t){r.splice(e,1);break}}}dispatchEvent(e={type:""}){"function"!=typeof e.preventDefault&&(e.preventDefault=()=>{}),"function"!=typeof e.stopPropagation&&(e.stopPropagation=()=>{});const t=r.get(this);if(t){const r=t[e.type];if(r)for(let t=0;t<r.length;t++)r[t](e)}}releasePointerCapture(){}setPointerCapture(){}}}));const g=(t&&t.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(f),m=new WeakMap,v=new WeakMap,y=new WeakMap;function b(e,t={}){t.target=t.target||this,"function"==typeof this[`on${e}`]&&this[`on${e}`].call(this,t)}function x(e,t={}){this.readyState=e,t.readyState=e,b.call(this,"readystatechange",t)}const{platform:w}=wx.getSystemInfoSync();class S extends g.default{constructor(){super(),this.onabort=null,this.onerror=null,this.onload=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.onloadend=null,this.onreadystatechange=null,this.readyState=0,this.response=null,this.responseText=null,this.responseType="text",this.dataType="string",this.responseXML=null,this.status=0,this.statusText="",this.upload={},this.withCredentials=!1,m.set(this,{"content-type":"application/x-www-form-urlencoded"}),v.set(this,{})}abort(){const e=y.get(this);e&&e.abort()}getAllResponseHeaders(){const e=v.get(this);return Object.keys(e).map((t=>`${t}: ${e[t]}`)).join("\n")}getResponseHeader(e){return v.get(this)[e]}open(e,t){this._method=e,this._url=t,x.call(this,S.OPENED)}overrideMimeType(){}send(e=""){if(this.readyState!==S.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");{const r=this._url,n=m.get(this),a=this.responseType,s=this.dataType,o=function(e){return!/^(http|https|ftp|wxfile):\/\/.*/i.test(e)}(r);let i;"arraybuffer"===a||(i="utf8"),delete this.response,this.response=null;let c=!1;const l=({data:e,statusCode:t,header:r})=>{if(!c){if(c=!0,t=void 0===t?200:t,"string"!=typeof e&&!(e instanceof ArrayBuffer))try{e=JSON.stringify(e)}catch(e){}this.status=t,r&&v.set(this,r),b.call(this,"loadstart"),x.call(this,S.HEADERS_RECEIVED),x.call(this,S.LOADING),this.response=e,e instanceof ArrayBuffer?Object.defineProperty(this,"responseText",{enumerable:!0,configurable:!0,get:function(){throw"InvalidStateError : responseType is "+this.responseType}}):this.responseText=e,x.call(this,S.DONE),b.call(this,"load"),b.call(this,"loadend")}},u=({errMsg:e})=>{c||(c=!0,-1!==e.indexOf("abort")?b.call(this,"abort"):b.call(this,"error",{message:e}),b.call(this,"loadend"),o&&console.warn(e))};if(o){const e=wx.getFileSystemManager();var t={filePath:r,success:l,fail:u};return i&&(t.encoding=i),void e.readFile(t)}const h="arraybuffer"===a&&"ios"===w&&S.useFetchPatch;wx.request({data:e,url:r,method:this._method,header:n,dataType:s,responseType:a,enableCache:!1,success:l,fail:u}),h&&setTimeout((function(){wx.request({data:e,url:r,method:this._method,header:n,dataType:s,responseType:a,enableCache:!0,success:l,fail:u})}),S.fetchPatchDelay)}}setRequestHeader(e,t){const r=m.get(this);r[e]=t,m.set(this,r)}addEventListener(e,t){"function"==typeof t&&(this["on"+e]=(e={})=>{e.target=e.target||this,t.call(this,e)})}removeEventListener(e,t){this["on"+e]===t&&(this["on"+e]=null)}}var T=S;S.UNSEND=0,S.OPENED=1,S.HEADERS_RECEIVED=2,S.LOADING=3,S.DONE=4,S.useFetchPatch=!1,S.fetchPatchDelay=200;var F=Object.defineProperty({default:T},"__esModule",{value:!0});var A=function(e,t){for(let r of Object.getOwnPropertyNames(t))if("constructor"!==r&&"prototype"!==r&&"name"!==r){let n=Object.getOwnPropertyDescriptor(t,r);n&&Object.defineProperty(e,r,n)}},k=Object.defineProperty({default:A},"__esModule",{value:!0});var E=function(e){return e=(e=e.trim()).replace(/<!--[\s\S]*?-->/g,""),{declaration:t(),root:r()};function t(){if(!a(/^<\?xml\s*/))return;const e={attributes:{},children:[]};for(;!s()&&!o("?>");){const t=n();if(!t)return e;e.attributes[t.name]=t.value}return a(/\?>\s*/),a(/<!DOCTYPE[^>]*>\s/),e}function r(){const e=a(/^<([\w-:.]+)\s*/);if(!e)return;const t={name:e[1],attributes:{},children:[]};for(;!(s()||o(">")||o("?>")||o("/>"));){const e=n();if(!e)return t;t.attributes[e.name]=e.value}if(a(/^\s*\/>\s*/))return t;let i;for(a(/\??>\s*/),t.content=function(){const e=a(/^([^<]*)/);return e?e[1]:""}();i=r();)t.children.push(i);return a(/^<\/[\w-:.]+>\s*/),t}function n(){const e=a(/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/);var t;if(e)return{name:e[1],value:(t=e[2],t.replace(/^['"]|['"]$/g,""))}}function a(t){const r=e.match(t);if(r)return e=e.slice(r[0].length),r}function s(){return 0==e.length}function o(t){return 0==e.indexOf(t)}},I=Object.defineProperty({default:E},"__esModule",{value:!0});const M=(t&&t.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(I);function L(e,t){t(e),e.children.forEach((e=>L(e,t)))}var C=class{parseFromString(e){const t=(0,M.default)(e),r={hasAttribute(e){return void 0!==this.attributes[e]},getAttribute(e){return this.attributes[e]},getElementsByTagName(e){const t=[];return this.childNodes.forEach((r=>L(r,(r=>e===r.name&&t.push(r))))),t}};t.root&&L(t.root,(e=>{e.nodeType=1,e.nodeName=e.name,e.style=new Proxy((e.attributes.style||"").split(";").reduce(((e,t)=>{if(t){let[r,n]=t.split(":");e[r.trim()]=n.trim()}return e}),{}),{get:(e,t)=>e[t]||""}),e.textContent=e.content,e.childNodes=e.children,e.__proto__=r}));const n={documentElement:t.root,childNodes:[t.root]};return n.__proto__=r,n}},O=Object.defineProperty({default:C},"__esModule",{value:!0});var R=class{decode(e){const t=e instanceof ArrayBuffer?new Uint8Array(e):e;let r="";for(let e=0,n=t.length;e<n;e++)r+=String.fromCharCode(t[e]);try{return decodeURIComponent(escape(r))}catch(e){return r}}},N=Object.defineProperty({default:R},"__esModule",{value:!0}),U=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Platform=void 0;t.Platform=class{}})),P=a((function(e,r){var n=t&&t.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=t&&t.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=t&&t.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return a(t,e),t},i=t&&t.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.WechatPlatform=void 0;const c=i(u),l=i(o),h=i(d),p=s(f),g=i(F),m=i(k),v=i(O),y=i(N);function b(){return wx.createOffscreenCanvas()}class x extends U.Platform{constructor(e,t,r){super(),this.enabledDeviceMotion=!1;const n=wx.getSystemInfoSync(),a="android"===n.platform;this.canvas=e,this.canvasW=void 0===t?e.width:t,this.canvasH=void 0===r?e.height:r;const s={createElementNS:(t,r)=>"canvas"===r?e:"img"===r?e.createImage():void 0},o=new c.default,i={innerWidth:n.windowWidth,innerHeight:n.windowHeight,devicePixelRatio:n.pixelRatio,AudioContext:function(){},requestAnimationFrame:this.canvas.requestAnimationFrame,cancelAnimationFrame:this.canvas.cancelAnimationFrame,DeviceOrientationEvent:{requestPermission:()=>Promise.resolve("granted")},URL:o,DOMParser:v.default,TextDecoder:y.default};[e,s,i].forEach((e=>{const t=e.__proto__;e.__proto__={},e.__proto__.__proto__=t,(0,m.default)(e.__proto__,p.default.prototype)})),this.polyfill={Blob:l.default,window:i,document:s,DOMParser:v.default,TextDecoder:y.default,XMLHttpRequest:g.default,OffscreenCanvas:b,URL:o,atob:h.default,createImageBitmap:void 0,cancelAnimationFrame:i.cancelAnimationFrame,requestAnimationFrame:i.requestAnimationFrame},this.patchCanvas(),this.onDeviceMotionChange=e=>{e.type="deviceorientation",a&&(e.alpha*=-1,e.beta*=-1,e.gamma*=-1),i.dispatchEvent(e)}}patchCanvas(){const{canvasH:e,canvasW:t}=this;Object.defineProperty(this.canvas,"style",{get(){return{width:this.width+"px",height:this.height+"px"}}}),Object.defineProperty(this.canvas,"clientHeight",{get(){return e||this.height}}),Object.defineProperty(this.canvas,"clientWidth",{get(){return t||this.width}}),this.canvas.ownerDocument=this.document}patchXHR(){return g.default.useFetchPatch=!0,this}enableDeviceOrientation(e){return new Promise(((t,r)=>{wx.onDeviceMotionChange(this.onDeviceMotionChange),wx.startDeviceMotionListening({interval:e,success:e=>{t(e),this.enabledDeviceMotion=!0},fail:r})}))}disableDeviceOrientation(){return new Promise(((e,t)=>{wx.offDeviceMotionChange(this.onDeviceMotionChange),this.enabledDeviceMotion&&wx.stopDeviceMotionListening({success:()=>{e(!0),this.enabledDeviceMotion=!1},fail:t})}))}dispatchTouchEvent(e={touches:[],changedTouches:[],timeStamp:0,type:""}){const t=Object.assign({},this),r=e.changedTouches.map((e=>new p.Touch(e))),n={changedTouches:r,touches:e.touches.map((e=>new p.Touch(e))),targetTouches:Array.prototype.slice.call(e.touches.map((e=>new p.Touch(e)))),timeStamp:e.timeStamp,target:t,currentTarget:t,type:e.type,cancelBubble:!1,cancelable:!1};if(this.canvas.dispatchEvent(n),r.length){const t=r[0],n={pageX:t.pageX,pageY:t.pageY,pointerId:t.identifier,type:{touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup"}[e.type]||"",pointerType:"touch"};this.canvas.dispatchEvent(n)}}dispose(){this.disableDeviceOrientation(),this.canvas.width=0,this.canvas.height=0,this.canvas&&(this.canvas.ownerDocument=null),this.onDeviceMotionChange=null,this.canvas=null}}r.WechatPlatform=x}));class D extends e.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new V(e)})),this.register((function(e){return new q(e)})),this.register((function(e){return new Y(e)})),this.register((function(e){return new z(e)})),this.register((function(e){return new j(e)})),this.register((function(e){return new W(e)})),this.register((function(e){return new X(e)})),this.register((function(e){return new G(e)})),this.register((function(e){return new K(e)}))}load(t,r,n,a){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:e.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);const i=function(e){a?a(e):console.error(e),s.manager.itemError(t),s.manager.itemEnd(t)},c=new e.FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,(function(e){try{s.parse(e,o,(function(e){r(e),s.manager.itemEnd(t)}),i)}catch(e){i(e)}}),n,i)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(t,r,n,a){let s;const o={},i={};if("string"==typeof t)s=t;else{if(e.LoaderUtils.decodeText(new Uint8Array(t,0,4))===Z){try{o[_.KHR_BINARY_GLTF]=new $(t)}catch(e){return void(a&&a(e))}s=o[_.KHR_BINARY_GLTF].content}else s=e.LoaderUtils.decodeText(new Uint8Array(t))}const c=JSON.parse(s);if(void 0===c.asset||c.asset.version[0]<2)return void(a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new Oe(c,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](l);i[t.name]=t,o[t.name]=!0}if(c.extensionsUsed)for(let e=0;e<c.extensionsUsed.length;++e){const t=c.extensionsUsed[e],r=c.extensionsRequired||[];switch(t){case _.KHR_MATERIALS_UNLIT:o[t]=new H;break;case _.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[t]=new ne;break;case _.KHR_DRACO_MESH_COMPRESSION:o[t]=new ee(c,this.dracoLoader);break;case _.KHR_TEXTURE_TRANSFORM:o[t]=new te;break;case _.KHR_MESH_QUANTIZATION:o[t]=new ae;break;default:r.indexOf(t)>=0&&void 0===i[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(o),l.setPlugins(i),l.parse(n,a)}}function B(){let e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const _={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class G{constructor(e){this.parser=e,this.name=_.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,n=t.length;r<n;r++){const n=t[r];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(t){const r=this.parser,n="light:"+t;let a=r.cache.get(n);if(a)return a;const s=r.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t];let i;const c=new e.Color(16777215);void 0!==o.color&&c.fromArray(o.color);const l=void 0!==o.range?o.range:0;switch(o.type){case"directional":i=new e.DirectionalLight(c),i.target.position.set(0,0,-1),i.add(i.target);break;case"point":i=new e.PointLight(c),i.distance=l;break;case"spot":i=new e.SpotLight(c),i.distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,i.angle=o.spot.outerConeAngle,i.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return i.position.set(0,0,0),i.decay=2,void 0!==o.intensity&&(i.intensity=o.intensity),i.name=r.createUniqueName(o.name||"light_"+t),a=Promise.resolve(i),r.cache.add(n,a),a}createNodeAttachment(e){const t=this,r=this.parser,n=r.json.nodes[e],a=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then((function(e){return r._getNodeRef(t.cache,a,e)}))}}class H{constructor(){this.name=_.KHR_MATERIALS_UNLIT}getMaterialType(){return e.MeshBasicMaterial}extendParams(t,r,n){const a=[];t.color=new e.Color(1,1,1),t.opacity=1;const s=r.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==s.baseColorTexture&&a.push(n.assignTexture(t,"map",s.baseColorTexture))}return Promise.all(a)}}class V{constructor(e){this.parser=e,this.name=_.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const r=this.parser.json.materials[t];return r.extensions&&r.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,r){const n=this.parser,a=n.json.materials[t];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const s=[],o=a.extensions[this.name];if(void 0!==o.clearcoatFactor&&(r.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(n.assignTexture(r,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(r.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(n.assignTexture(r,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(n.assignTexture(r,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const t=o.clearcoatNormalTexture.scale;r.clearcoatNormalScale=new e.Vector2(t,t)}return Promise.all(s)}}class z{constructor(e){this.parser=e,this.name=_.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const r=this.parser.json.materials[t];return r.extensions&&r.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],s=n.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&a.push(r.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(a)}}class j{constructor(e){this.parser=e,this.name=_.KHR_MATERIALS_VOLUME}getMaterialType(t){const r=this.parser.json.materials[t];return r.extensions&&r.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,r){const n=this.parser,a=n.json.materials[t];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const s=[],o=a.extensions[this.name];r.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(n.assignTexture(r,"thicknessMap",o.thicknessTexture)),r.attenuationDistance=o.attenuationDistance||0;const i=o.attenuationColor||[1,1,1];return r.attenuationTint=new e.Color(i[0],i[1],i[2]),Promise.all(s)}}class W{constructor(e){this.parser=e,this.name=_.KHR_MATERIALS_IOR}getMaterialType(t){const r=this.parser.json.materials[t];return r.extensions&&r.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=r.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class X{constructor(e){this.parser=e,this.name=_.KHR_MATERIALS_SPECULAR}getMaterialType(t){const r=this.parser.json.materials[t];return r.extensions&&r.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,r){const n=this.parser,a=n.json.materials[t];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const s=[],o=a.extensions[this.name];r.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(n.assignTexture(r,"specularIntensityMap",o.specularTexture));const i=o.specularColorFactor||[1,1,1];return r.specularTint=new e.Color(i[0],i[1],i[2]),void 0!==o.specularColorTexture&&s.push(n.assignTexture(r,"specularTintMap",o.specularColorTexture).then((function(t){t.encoding=e.sRGBEncoding}))),Promise.all(s)}}class q{constructor(e){this.parser=e,this.name=_.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const a=n.extensions[this.name],s=r.images[a.source],o=t.options.ktx2Loader;if(!o){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s,o)}}class Y{constructor(e){this.parser=e,this.name=_.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,n=r.json,a=n.textures[e];if(!a.extensions||!a.extensions[t])return null;const s=a.extensions[t],o=n.images[s.source];let i=r.textureLoader;if(o.uri){const e=r.options.manager.getHandler(o.uri);null!==e&&(i=e)}return this.detectSupport().then((function(a){if(a)return r.loadTextureImage(e,o,i);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class K{constructor(e){this.name=_.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const e=r.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,a.ready]).then((function(t){const r=e.byteOffset||0,n=e.byteLength||0,s=e.count,o=e.byteStride,i=new ArrayBuffer(s*o),c=new Uint8Array(t[0],r,n);return a.decodeGltfBuffer(new Uint8Array(i),s,o,c,e.mode,e.filter),i}))}return null}}const Z="glTF",Q=1313821514,J=5130562;class ${constructor(t){this.name=_.KHR_BINARY_GLTF,this.content=null,this.body=null;const r=new DataView(t,0,12);if(this.header={magic:e.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==Z)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,a=new DataView(t,12);let s=0;for(;s<n;){const r=a.getUint32(s,!0);s+=4;const n=a.getUint32(s,!0);if(s+=4,n===Q){const n=new Uint8Array(t,12+s,r);this.content=e.LoaderUtils.decodeText(n)}else if(n===J){const e=12+s;this.body=t.slice(e,e+r)}s+=r}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ee{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=_.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,n=this.dracoLoader,a=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},i={},c={};for(const e in s){const t=be[e]||e.toLowerCase();o[t]=s[e]}for(const t in e.attributes){const n=be[t]||t.toLowerCase();if(void 0!==s[t]){const a=r.accessors[e.attributes[t]],s=ge[a.componentType];c[n]=s,i[n]=!0===a.normalized}}return t.getDependency("bufferView",a).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const r=e.attributes[t],n=i[t];void 0!==n&&(r.normalized=n)}t(e)}),o,c)}))}))}}class te{constructor(){this.name=_.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class re extends e.MeshStandardMaterial{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;const r=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),a=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),i={specular:{value:(new e.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=i,this.onBeforeCompile=function(e){for(const t in i)e.uniforms[t]=i[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",r).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",a).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return i.specular.value},set:function(e){i.specular.value=e}},specularMap:{get:function(){return i.specularMap.value},set:function(e){i.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return i.glossiness.value},set:function(e){i.glossiness.value=e}},glossinessMap:{get:function(){return i.glossinessMap.value},set:function(e){i.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class ne{constructor(){this.name=_.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return re}extendParams(t,r,n){const a=r.extensions[this.name];t.color=new e.Color(1,1,1),t.opacity=1;const s=[];if(Array.isArray(a.diffuseFactor)){const e=a.diffuseFactor;t.color.fromArray(e),t.opacity=e[3]}if(void 0!==a.diffuseTexture&&s.push(n.assignTexture(t,"map",a.diffuseTexture)),t.emissive=new e.Color(0,0,0),t.glossiness=void 0!==a.glossinessFactor?a.glossinessFactor:1,t.specular=new e.Color(1,1,1),Array.isArray(a.specularFactor)&&t.specular.fromArray(a.specularFactor),void 0!==a.specularGlossinessTexture){const e=a.specularGlossinessTexture;s.push(n.assignTexture(t,"glossinessMap",e)),s.push(n.assignTexture(t,"specularMap",e))}return Promise.all(s)}createMaterial(t){const r=new re(t);return r.fog=!0,r.color=t.color,r.map=void 0===t.map?null:t.map,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=void 0===t.aoMap?null:t.aoMap,r.aoMapIntensity=1,r.emissive=t.emissive,r.emissiveIntensity=1,r.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,r.bumpMap=void 0===t.bumpMap?null:t.bumpMap,r.bumpScale=1,r.normalMap=void 0===t.normalMap?null:t.normalMap,r.normalMapType=e.TangentSpaceNormalMap,t.normalScale&&(r.normalScale=t.normalScale),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=void 0===t.specularMap?null:t.specularMap,r.specular=t.specular,r.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,r.glossiness=t.glossiness,r.alphaMap=null,r.envMap=void 0===t.envMap?null:t.envMap,r.envMapIntensity=1,r.refractionRatio=.98,r}}class ae{constructor(){this.name=_.KHR_MESH_QUANTIZATION}}class se extends e.Interpolant{constructor(e,t,r,n){super(e,t,r,n)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,a=e*n*3+n;for(let e=0;e!==n;e++)t[e]=r[a+e];return t}}se.prototype.beforeStart_=se.prototype.copySampleValue_,se.prototype.afterEnd_=se.prototype.copySampleValue_,se.prototype.interpolate_=function(e,t,r,n){const a=this.resultBuffer,s=this.sampleValues,o=this.valueSize,i=2*o,c=3*o,l=n-t,u=(r-t)/l,h=u*u,p=h*u,d=e*c,f=d-c,g=-2*p+3*h,m=p-h,v=1-g,y=m-h+u;for(let e=0;e!==o;e++){const t=s[f+e+o],r=s[f+e+i]*l,n=s[d+e+o],c=s[d+e]*l;a[e]=v*t+y*r+g*n+m*c}return a};const oe=new e.Quaternion;class ie extends se{interpolate_(e,t,r,n){const a=super.interpolate_(e,t,r,n);return oe.fromArray(a).normalize().toArray(a),a}}const ce=0,le=1,ue=2,he=3,pe=4,de=5,fe=6,ge={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},me={9728:e.NearestFilter,9729:e.LinearFilter,9984:e.NearestMipmapNearestFilter,9985:e.LinearMipmapNearestFilter,9986:e.NearestMipmapLinearFilter,9987:e.LinearMipmapLinearFilter},ve={33071:e.ClampToEdgeWrapping,33648:e.MirroredRepeatWrapping,10497:e.RepeatWrapping},ye={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},be={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},xe={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},we={CUBICSPLINE:void 0,LINEAR:e.InterpolateLinear,STEP:e.InterpolateDiscrete},Se="OPAQUE",Te="MASK",Fe="BLEND";function Ae(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function ke(e,t,r){for(const n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function Ee(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Ie(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){const r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let t=0,n=r.length;t<n;t++)e.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Me(e){const t=e.extensions&&e.extensions[_.KHR_DRACO_MESH_COMPRESSION];let r;return r=t?"draco:"+t.bufferView+":"+t.indices+":"+Le(t.attributes):e.indices+":"+Le(e.attributes)+":"+e.mode,r}function Le(e){let t="";const r=Object.keys(e).sort();for(let n=0,a=r.length;n<a;n++)t+=r[n]+":"+e[r[n]]+";";return t}function Ce(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class Oe{constructor(t={},r={}){this.json=t,this.extensions={},this.plugins={},this.options=r,this.cache=new B,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},void 0!==e._default.polyfill.createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new e.ImageBitmapLoader(this.options.manager):this.textureLoader=new e.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new e.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,n=this.json,a=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])})).then((function(t){const s={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};ke(a,s,n),Ee(s,n),Promise.all(r._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){e(s)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let r=0,n=t.length;r<n;r++){const n=t[r].joints;for(let t=0,r=n.length;t<r;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(r[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const n=r.clone(),a=(e,t)=>{const r=this.associations.get(e);null!=r&&this.associations.set(t,r);for(const[r,n]of e.children.entries())a(n,t.children[r])};return a(r,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const n=e(t[r]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let n=0;n<t.length;n++){const a=e(t[n]);a&&r.push(a)}return r}getDependency(e,t){const r=e+":"+t;let n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return r.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[_.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,a){r.load(Ae(t.uri,n.path),e,void 0,(function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)}))}loadAccessor(t){const r=this,n=this.json,a=this.json.accessors[t];if(void 0===a.bufferView&&void 0===a.sparse)return Promise.resolve(null);const s=[];return void 0!==a.bufferView?s.push(this.getDependency("bufferView",a.bufferView)):s.push(null),void 0!==a.sparse&&(s.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(s).then((function(t){const s=t[0],o=ye[a.type],i=ge[a.componentType],c=i.BYTES_PER_ELEMENT,l=c*o,u=a.byteOffset||0,h=void 0!==a.bufferView?n.bufferViews[a.bufferView].byteStride:void 0,p=!0===a.normalized;let d,f;if(h&&h!==l){const t=Math.floor(u/h),n="InterleavedBuffer:"+a.bufferView+":"+a.componentType+":"+t+":"+a.count;let l=r.cache.get(n);l||(d=new i(s,t*h,a.count*h/c),l=new e.InterleavedBuffer(d,h/c),r.cache.add(n,l)),f=new e.InterleavedBufferAttribute(l,o,u%h/c,p)}else d=null===s?new i(a.count*o):new i(s,u,a.count*o),f=new e.BufferAttribute(d,o,p);if(void 0!==a.sparse){const r=ye.SCALAR,n=ge[a.sparse.indices.componentType],c=a.sparse.indices.byteOffset||0,l=a.sparse.values.byteOffset||0,u=new n(t[1],c,a.sparse.count*r),h=new i(t[2],l,a.sparse.count*o);null!==s&&(f=new e.BufferAttribute(f.array.slice(),f.itemSize,f.normalized));for(let e=0,t=u.length;e<t;e++){const t=u[e];if(f.setX(t,h[e*o]),o>=2&&f.setY(t,h[e*o+1]),o>=3&&f.setZ(t,h[e*o+2]),o>=4&&f.setW(t,h[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f}))}loadTexture(e){const t=this.json,r=this.options,n=t.textures[e],a=t.images[n.source];let s=this.textureLoader;if(a.uri){const e=r.manager.getHandler(a.uri);null!==e&&(s=e)}return this.loadTextureImage(e,a,s)}loadTextureImage(t,r,n){const a=this,s=this.json,o=this.options,i=s.textures[t],c=(r.uri||r.bufferView)+":"+i.sampler;if(this.textureCache[c])return this.textureCache[c];const l=e._default.polyfill.URL||self.webkitURL;let u=r.uri||"",h=!1;if(void 0!==r.bufferView)u=a.getDependency("bufferView",r.bufferView).then((function(t){h=!0;const n=new e._default.polyfill.Blob([t],{type:r.mimeType});return u=l.createObjectURL(n),u}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const p=Promise.resolve(u).then((function(t){return new Promise((function(r,a){let s=r;!0===n.isImageBitmapLoader&&(s=function(t){const n=new e.Texture(t);n.needsUpdate=!0,r(n)}),n.load(Ae(t,o.path),s,void 0,a)}))})).then((function(r){!0===h&&l.revokeObjectURL(u),r.flipY=!1,i.name&&(r.name=i.name);const n=(s.samplers||{})[i.sampler]||{};return r.magFilter=me[n.magFilter]||e.LinearFilter,r.minFilter=me[n.minFilter]||e.LinearMipmapLinearFilter,r.wrapS=ve[n.wrapS]||e.RepeatWrapping,r.wrapT=ve[n.wrapT]||e.RepeatWrapping,a.associations.set(r,{textures:t}),r})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",u),null}));return this.textureCache[c]=p,p}assignTexture(e,t,r){const n=this;return this.getDependency("texture",r.index).then((function(a){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),n.extensions[_.KHR_TEXTURE_TRANSFORM]){const e=void 0!==r.extensions?r.extensions[_.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=n.associations.get(a);a=n.extensions[_.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),n.associations.set(a,t)}}return e[t]=a,a}))}assignFinalMaterial(t){const r=t.geometry;let n=t.material;const a=void 0===r.attributes.tangent,s=void 0!==r.attributes.color,o=void 0===r.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+n.uuid;let r=this.cache.get(t);r||(r=new e.PointsMaterial,e.Material.prototype.copy.call(r,n),r.color.copy(n.color),r.map=n.map,r.sizeAttenuation=!1,this.cache.add(t,r)),n=r}else if(t.isLine){const t="LineBasicMaterial:"+n.uuid;let r=this.cache.get(t);r||(r=new e.LineBasicMaterial,e.Material.prototype.copy.call(r,n),r.color.copy(n.color),this.cache.add(t,r)),n=r}if(a||s||o){let e="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),a&&(e+="derivative-tangents:"),s&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),s&&(t.vertexColors=!0),o&&(t.flatShading=!0),a&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}n.aoMap&&void 0===r.attributes.uv2&&void 0!==r.attributes.uv&&r.setAttribute("uv2",r.attributes.uv),t.material=n}getMaterialType(){return e.MeshStandardMaterial}loadMaterial(t){const r=this,n=this.json,a=this.extensions,s=n.materials[t];let o;const i={},c=s.extensions||{},l=[];if(c[_.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=a[_.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=e.getMaterialType(),l.push(e.extendParams(i,s,r))}else if(c[_.KHR_MATERIALS_UNLIT]){const e=a[_.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),l.push(e.extendParams(i,s,r))}else{const n=s.pbrMetallicRoughness||{};if(i.color=new e.Color(1,1,1),i.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;i.color.fromArray(e),i.opacity=e[3]}void 0!==n.baseColorTexture&&l.push(r.assignTexture(i,"map",n.baseColorTexture)),i.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,i.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(l.push(r.assignTexture(i,"metalnessMap",n.metallicRoughnessTexture)),l.push(r.assignTexture(i,"roughnessMap",n.metallicRoughnessTexture))),o=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),l.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,i)}))))}!0===s.doubleSided&&(i.side=e.DoubleSide);const u=s.alphaMode||Se;if(u===Fe?(i.transparent=!0,i.depthWrite=!1):(i.format=e.RGBFormat,i.transparent=!1,u===Te&&(i.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&o!==e.MeshBasicMaterial&&(l.push(r.assignTexture(i,"normalMap",s.normalTexture)),i.normalScale=new e.Vector2(1,1),void 0!==s.normalTexture.scale)){const e=s.normalTexture.scale;i.normalScale.set(e,e)}return void 0!==s.occlusionTexture&&o!==e.MeshBasicMaterial&&(l.push(r.assignTexture(i,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(i.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&o!==e.MeshBasicMaterial&&(i.emissive=(new e.Color).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&o!==e.MeshBasicMaterial&&l.push(r.assignTexture(i,"emissiveMap",s.emissiveTexture)),Promise.all(l).then((function(){let n;return n=o===re?a[_.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(i):new o(i),s.name&&(n.name=s.name),n.map&&(n.map.encoding=e.sRGBEncoding),n.emissiveMap&&(n.emissiveMap.encoding=e.sRGBEncoding),Ee(n,s),r.associations.set(n,{materials:t}),s.extensions&&ke(a,n,s),n}))}createUniqueName(t){const r=e.PropertyBinding.sanitizeNodeName(t||"");let n=r;for(let e=1;this.nodeNamesUsed[n];++e)n=r+"_"+e;return this.nodeNamesUsed[n]=!0,n}loadGeometries(t){const r=this,n=this.extensions,a=this.primitiveCache;function s(e){return n[_.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,r).then((function(t){return Ne(t,e,r)}))}const o=[];for(let n=0,i=t.length;n<i;n++){const i=t[n],c=Me(i),l=a[c];if(l)o.push(l.promise);else{let t;t=i.extensions&&i.extensions[_.KHR_DRACO_MESH_COMPRESSION]?s(i):Ne(new e.BufferGeometry,i,r),a[c]={primitive:i,promise:t},o.push(t)}}return Promise.all(o)}loadMesh(t){const r=this,n=this.json,a=this.extensions,s=n.meshes[t],o=s.primitives,i=[];for(let t=0,r=o.length;t<r;t++){const r=void 0===o[t].material?(void 0===(c=this.cache).DefaultMaterial&&(c.DefaultMaterial=new e.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:e.FrontSide})),c.DefaultMaterial):this.getDependency("material",o[t].material);i.push(r)}var c;return i.push(r.loadGeometries(o)),Promise.all(i).then((function(n){const i=n.slice(0,n.length-1),c=n[n.length-1],l=[];for(let n=0,u=c.length;n<u;n++){const u=c[n],h=o[n];let p;const d=i[n];if(h.mode===pe||h.mode===de||h.mode===fe||void 0===h.mode)p=!0===s.isSkinnedMesh?new e.SkinnedMesh(u,d):new e.Mesh(u,d),!0!==p.isSkinnedMesh||p.geometry.attributes.skinWeight.normalized||p.normalizeSkinWeights(),h.mode===de?p.geometry=Ue(p.geometry,e.TriangleStripDrawMode):h.mode===fe&&(p.geometry=Ue(p.geometry,e.TriangleFanDrawMode));else if(h.mode===le)p=new e.LineSegments(u,d);else if(h.mode===he)p=new e.Line(u,d);else if(h.mode===ue)p=new e.LineLoop(u,d);else{if(h.mode!==ce)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);p=new e.Points(u,d)}Object.keys(p.geometry.morphAttributes).length>0&&Ie(p,s),p.name=r.createUniqueName(s.name||"mesh_"+t),Ee(p,s),h.extensions&&ke(a,p,h),r.assignFinalMaterial(p),l.push(p)}for(let e=0,n=l.length;e<n;e++)r.associations.set(l[e],{meshes:t,primitives:e});if(1===l.length)return l[0];const u=new e.Group;r.associations.set(u,{meshes:t});for(let e=0,t=l.length;e<t;e++)u.add(l[e]);return u}))}loadCamera(t){let r;const n=this.json.cameras[t],a=n[n.type];if(a)return"perspective"===n.type?r=new e.PerspectiveCamera(e.MathUtils.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):"orthographic"===n.type&&(r=new e.OrthographicCamera(-a.xmag,a.xmag,a.ymag,-a.ymag,a.znear,a.zfar)),n.name&&(r.name=this.createUniqueName(n.name)),Ee(r,n),Promise.resolve(r);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return r.inverseBindMatrices=e,r}))}loadAnimation(t){const r=this.json.animations[t],n=[],a=[],s=[],o=[],i=[];for(let e=0,t=r.channels.length;e<t;e++){const t=r.channels[e],c=r.samplers[t.sampler],l=t.target,u=void 0!==l.node?l.node:l.id,h=void 0!==r.parameters?r.parameters[c.input]:c.input,p=void 0!==r.parameters?r.parameters[c.output]:c.output;n.push(this.getDependency("node",u)),a.push(this.getDependency("accessor",h)),s.push(this.getDependency("accessor",p)),o.push(c),i.push(l)}return Promise.all([Promise.all(n),Promise.all(a),Promise.all(s),Promise.all(o),Promise.all(i)]).then((function(n){const a=n[0],s=n[1],o=n[2],i=n[3],c=n[4],l=[];for(let t=0,r=a.length;t<r;t++){const r=a[t],n=s[t],u=o[t],h=i[t],p=c[t];if(void 0===r)continue;let d;switch(r.updateMatrix(),r.matrixAutoUpdate=!0,xe[p.path]){case xe.weights:d=e.NumberKeyframeTrack;break;case xe.rotation:d=e.QuaternionKeyframeTrack;break;default:d=e.VectorKeyframeTrack}const f=r.name?r.name:r.uuid,g=void 0!==h.interpolation?we[h.interpolation]:e.InterpolateLinear,m=[];xe[p.path]===xe.weights?r.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&m.push(e.name?e.name:e.uuid)})):m.push(f);let v=u.array;if(u.normalized){const e=Ce(v.constructor),t=new Float32Array(v.length);for(let r=0,n=v.length;r<n;r++)t[r]=v[r]*e;v=t}for(let t=0,r=m.length;t<r;t++){const r=new d(m[t]+"."+xe[p.path],n.array,v,g);"CUBICSPLINE"===h.interpolation&&(r.createInterpolant=function(t){return new(this instanceof e.QuaternionKeyframeTrack?ie:se)(this.times,this.values,this.getValueSize()/3,t)},r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(r)}}const u=r.name?r.name:"animation_"+t;return new e.AnimationClip(u,void 0,l)}))}createNodeMesh(e){const t=this.json,r=this,n=t.nodes[e];return void 0===n.mesh?null:r.getDependency("mesh",n.mesh).then((function(e){const t=r._getNodeRef(r.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,r=n.weights.length;t<r;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}loadNode(t){const r=this.json,n=this.extensions,a=this,s=r.nodes[t],o=s.name?a.createUniqueName(s.name):"";return function(){const e=[],r=a._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return r&&e.push(r),void 0!==s.camera&&e.push(a.getDependency("camera",s.camera).then((function(e){return a._getNodeRef(a.cameraCache,s.camera,e)}))),a._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){e.push(t)})),Promise.all(e)}().then((function(r){let i;if(i=!0===s.isBone?new e.Bone:r.length>1?new e.Group:1===r.length?r[0]:new e.Object3D,i!==r[0])for(let e=0,t=r.length;e<t;e++)i.add(r[e]);if(s.name&&(i.userData.name=s.name,i.name=o),Ee(i,s),s.extensions&&ke(n,i,s),void 0!==s.matrix){const t=new e.Matrix4;t.fromArray(s.matrix),i.applyMatrix4(t)}else void 0!==s.translation&&i.position.fromArray(s.translation),void 0!==s.rotation&&i.quaternion.fromArray(s.rotation),void 0!==s.scale&&i.scale.fromArray(s.scale);return a.associations.has(i)||a.associations.set(i,{}),a.associations.get(i).nodes=t,i}))}loadScene(t){const r=this.json,n=this.extensions,a=this.json.scenes[t],s=this,o=new e.Group;a.name&&(o.name=s.createUniqueName(a.name)),Ee(o,a),a.extensions&&ke(n,o,a);const i=a.nodes||[],c=[];for(let e=0,t=i.length;e<t;e++)c.push(Re(i[e],o,r,s));return Promise.all(c).then((function(){return s.associations=(t=>{const r=new Map;for(const[t,n]of s.associations)(t instanceof e.Material||t instanceof e.Texture)&&r.set(t,n);return t.traverse((e=>{const t=s.associations.get(e);null!=t&&r.set(e,t)})),r})(o),o}))}}function Re(t,r,n,a){const s=n.nodes[t];return a.getDependency("node",t).then((function(t){if(void 0===s.skin)return t;let r;return a.getDependency("skin",s.skin).then((function(e){r=e;const t=[];for(let e=0,n=r.joints.length;e<n;e++)t.push(a.getDependency("node",r.joints[e]));return Promise.all(t)})).then((function(n){return t.traverse((function(t){if(!t.isMesh)return;const a=[],s=[];for(let t=0,o=n.length;t<o;t++){const o=n[t];if(o){a.push(o);const n=new e.Matrix4;void 0!==r.inverseBindMatrices&&n.fromArray(r.inverseBindMatrices.array,16*t),s.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[t])}t.bind(new e.Skeleton(a,s),t.matrixWorld)})),t}))})).then((function(e){r.add(e);const t=[];if(s.children){const r=s.children;for(let s=0,o=r.length;s<o;s++){const o=r[s];t.push(Re(o,e,n,a))}}return Promise.all(t)}))}function Ne(t,r,n){const a=r.attributes,s=[];function o(e,r){return n.getDependency("accessor",e).then((function(e){t.setAttribute(r,e)}))}for(const e in a){const r=be[e]||e.toLowerCase();r in t.attributes||s.push(o(a[e],r))}if(void 0!==r.indices&&!t.index){const e=n.getDependency("accessor",r.indices).then((function(e){t.setIndex(e)}));s.push(e)}return Ee(t,r),function(t,r,n){const a=r.attributes,s=new e.Box3;if(void 0===a.POSITION)return;{const t=n.json.accessors[a.POSITION],r=t.min,o=t.max;if(void 0===r||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new e.Vector3(r[0],r[1],r[2]),new e.Vector3(o[0],o[1],o[2])),t.normalized){const e=Ce(ge[t.componentType]);s.min.multiplyScalar(e),s.max.multiplyScalar(e)}}const o=r.targets;if(void 0!==o){const t=new e.Vector3,r=new e.Vector3;for(let e=0,a=o.length;e<a;e++){const a=o[e];if(void 0!==a.POSITION){const e=n.json.accessors[a.POSITION],s=e.min,o=e.max;if(void 0!==s&&void 0!==o){if(r.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),r.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),r.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),e.normalized){const t=Ce(ge[e.componentType]);r.multiplyScalar(t)}t.max(r)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(t)}t.boundingBox=s;const i=new e.Sphere;s.getCenter(i.center),i.radius=s.min.distanceTo(s.max)/2,t.boundingSphere=i}(t,r,n),Promise.all(s).then((function(){return void 0!==r.targets?function(e,t,r){let n=!1,a=!1;for(let e=0,r=t.length;e<r;e++){const r=t[e];if(void 0!==r.POSITION&&(n=!0),void 0!==r.NORMAL&&(a=!0),n&&a)break}if(!n&&!a)return Promise.resolve(e);const s=[],o=[];for(let i=0,c=t.length;i<c;i++){const c=t[i];if(n){const t=void 0!==c.POSITION?r.getDependency("accessor",c.POSITION):e.attributes.position;s.push(t)}if(a){const t=void 0!==c.NORMAL?r.getDependency("accessor",c.NORMAL):e.attributes.normal;o.push(t)}}return Promise.all([Promise.all(s),Promise.all(o)]).then((function(t){const r=t[0],s=t[1];return n&&(e.morphAttributes.position=r),a&&(e.morphAttributes.normal=s),e.morphTargetsRelative=!0,e}))}(t,r.targets,n):t}))}function Ue(t,r){let n=t.getIndex();if(null===n){const e=[],r=t.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<r.count;t++)e.push(t);t.setIndex(e),n=t.getIndex()}const a=n.count-2,s=[];if(r===e.TriangleFanDrawMode)for(let e=1;e<=a;e++)s.push(n.getX(0)),s.push(n.getX(e)),s.push(n.getX(e+1));else for(let e=0;e<a;e++)e%2==0?(s.push(n.getX(e)),s.push(n.getX(e+1)),s.push(n.getX(e+2))):(s.push(n.getX(e+2)),s.push(n.getX(e+1)),s.push(n.getX(e)));s.length/3!==a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=t.clone();return o.setIndex(s),o}const Pe={type:"change"},De={type:"start"},Be={type:"end"};class _e extends e.EventDispatcher{constructor(t,r){super(),void 0===r&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),r===e._default.polyfill.document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=r,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new e.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:e.MOUSE.ROTATE,MIDDLE:e.MOUSE.DOLLY,RIGHT:e.MOUSE.PAN},this.touches={ONE:e.TOUCH.ROTATE,TWO:e.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return i.phi},this.getAzimuthalAngle=function(){return i.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",j),this._domElementKeyEvents=e},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Pe),n.update(),s=a.NONE},this.update=function(){const r=new e.Vector3,p=(new e.Quaternion).setFromUnitVectors(t.up,new e.Vector3(0,1,0)),d=p.clone().invert(),f=new e.Vector3,g=new e.Quaternion,m=2*Math.PI;return function(){const e=n.object.position;r.copy(e).sub(n.target),r.applyQuaternion(p),i.setFromVector3(r),n.autoRotate&&s===a.NONE&&F(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(i.theta+=c.theta*n.dampingFactor,i.phi+=c.phi*n.dampingFactor):(i.theta+=c.theta,i.phi+=c.phi);let t=n.minAzimuthAngle,v=n.maxAzimuthAngle;return isFinite(t)&&isFinite(v)&&(t<-Math.PI?t+=m:t>Math.PI&&(t-=m),v<-Math.PI?v+=m:v>Math.PI&&(v-=m),i.theta=t<=v?Math.max(t,Math.min(v,i.theta)):i.theta>(t+v)/2?Math.max(t,i.theta):Math.min(v,i.theta)),i.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,i.phi)),i.makeSafe(),i.radius*=l,i.radius=Math.max(n.minDistance,Math.min(n.maxDistance,i.radius)),!0===n.enableDamping?n.target.addScaledVector(u,n.dampingFactor):n.target.add(u),r.setFromSpherical(i),r.applyQuaternion(d),e.copy(n.target).add(r),n.object.lookAt(n.target),!0===n.enableDamping?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,u.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),u.set(0,0,0)),l=1,!!(h||f.distanceToSquared(n.object.position)>o||8*(1-g.dot(n.object.quaternion))>o)&&(n.dispatchEvent(Pe),f.copy(n.object.position),g.copy(n.object.quaternion),h=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",W),n.domElement.removeEventListener("pointerdown",_),n.domElement.removeEventListener("pointercancel",V),n.domElement.removeEventListener("wheel",z),n.domElement.removeEventListener("pointermove",G),n.domElement.removeEventListener("pointerup",H),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",j)};const n=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=a.NONE;const o=1e-6,i=new e.Spherical,c=new e.Spherical;let l=1;const u=new e.Vector3;let h=!1;const p=new e.Vector2,d=new e.Vector2,f=new e.Vector2,g=new e.Vector2,m=new e.Vector2,v=new e.Vector2,y=new e.Vector2,b=new e.Vector2,x=new e.Vector2,w=[],S={};function T(){return Math.pow(.95,n.zoomSpeed)}function F(e){c.theta-=e}function A(e){c.phi-=e}const k=function(){const t=new e.Vector3;return function(e,r){t.setFromMatrixColumn(r,0),t.multiplyScalar(-e),u.add(t)}}(),E=function(){const t=new e.Vector3;return function(e,r){!0===n.screenSpacePanning?t.setFromMatrixColumn(r,1):(t.setFromMatrixColumn(r,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),u.add(t)}}(),I=function(){const t=new e.Vector3;return function(e,r){const a=n.domElement;if(n.object.isPerspectiveCamera){const s=n.object.position;t.copy(s).sub(n.target);let o=t.length();o*=Math.tan(n.object.fov/2*Math.PI/180),k(2*e*o/a.clientHeight,n.object.matrix),E(2*r*o/a.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(k(e*(n.object.right-n.object.left)/n.object.zoom/a.clientWidth,n.object.matrix),E(r*(n.object.top-n.object.bottom)/n.object.zoom/a.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function M(e){n.object.isPerspectiveCamera?l/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function L(e){n.object.isPerspectiveCamera?l*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function C(e){p.set(e.clientX,e.clientY)}function O(e){g.set(e.clientX,e.clientY)}function R(){if(1===w.length)p.set(w[0].pageX,w[0].pageY);else{const e=.5*(w[0].pageX+w[1].pageX),t=.5*(w[0].pageY+w[1].pageY);p.set(e,t)}}function N(){if(1===w.length)g.set(w[0].pageX,w[0].pageY);else{const e=.5*(w[0].pageX+w[1].pageX),t=.5*(w[0].pageY+w[1].pageY);g.set(e,t)}}function U(){const e=w[0].pageX-w[1].pageX,t=w[0].pageY-w[1].pageY,r=Math.sqrt(e*e+t*t);y.set(0,r)}function P(e){if(1==w.length)d.set(e.pageX,e.pageY);else{const t=Y(e),r=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);d.set(r,n)}f.subVectors(d,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;F(2*Math.PI*f.x/t.clientHeight),A(2*Math.PI*f.y/t.clientHeight),p.copy(d)}function D(e){if(1===w.length)m.set(e.pageX,e.pageY);else{const t=Y(e),r=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);m.set(r,n)}v.subVectors(m,g).multiplyScalar(n.panSpeed),I(v.x,v.y),g.copy(m)}function B(e){const t=Y(e),r=e.pageX-t.x,a=e.pageY-t.y,s=Math.sqrt(r*r+a*a);b.set(0,s),x.set(0,Math.pow(b.y/y.y,n.zoomSpeed)),M(x.y),y.copy(b)}function _(t){!1!==n.enabled&&(0===w.length&&(n.domElement.setPointerCapture(t.pointerId),n.domElement.addEventListener("pointermove",G),n.domElement.addEventListener("pointerup",H)),function(e){w.push(e)}(t),"touch"===t.pointerType?function(t){switch(q(t),w.length){case 1:switch(n.touches.ONE){case e.TOUCH.ROTATE:if(!1===n.enableRotate)return;R(),s=a.TOUCH_ROTATE;break;case e.TOUCH.PAN:if(!1===n.enablePan)return;N(),s=a.TOUCH_PAN;break;default:s=a.NONE}break;case 2:switch(n.touches.TWO){case e.TOUCH.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&U(),n.enablePan&&N(),s=a.TOUCH_DOLLY_PAN;break;case e.TOUCH.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&U(),n.enableRotate&&R(),s=a.TOUCH_DOLLY_ROTATE;break;default:s=a.NONE}break;default:s=a.NONE}s!==a.NONE&&n.dispatchEvent(De)}(t):function(t){let r;switch(t.button){case 0:r=n.mouseButtons.LEFT;break;case 1:r=n.mouseButtons.MIDDLE;break;case 2:r=n.mouseButtons.RIGHT;break;default:r=-1}switch(r){case e.MOUSE.DOLLY:if(!1===n.enableZoom)return;!function(e){y.set(e.clientX,e.clientY)}(t),s=a.DOLLY;break;case e.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;O(t),s=a.PAN}else{if(!1===n.enableRotate)return;C(t),s=a.ROTATE}break;case e.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;C(t),s=a.ROTATE}else{if(!1===n.enablePan)return;O(t),s=a.PAN}break;default:s=a.NONE}s!==a.NONE&&n.dispatchEvent(De)}(t))}function G(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(q(e),s){case a.TOUCH_ROTATE:if(!1===n.enableRotate)return;P(e),n.update();break;case a.TOUCH_PAN:if(!1===n.enablePan)return;D(e),n.update();break;case a.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&B(e),n.enablePan&&D(e)}(e),n.update();break;case a.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&B(e),n.enableRotate&&P(e)}(e),n.update();break;default:s=a.NONE}}(e):function(e){if(!1===n.enabled)return;switch(s){case a.ROTATE:if(!1===n.enableRotate)return;!function(e){d.set(e.clientX,e.clientY),f.subVectors(d,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;F(2*Math.PI*f.x/t.clientHeight),A(2*Math.PI*f.y/t.clientHeight),p.copy(d),n.update()}(e);break;case a.DOLLY:if(!1===n.enableZoom)return;!function(e){b.set(e.clientX,e.clientY),x.subVectors(b,y),x.y>0?M(T()):x.y<0&&L(T()),y.copy(b),n.update()}(e);break;case a.PAN:if(!1===n.enablePan)return;!function(e){m.set(e.clientX,e.clientY),v.subVectors(m,g).multiplyScalar(n.panSpeed),I(v.x,v.y),g.copy(m),n.update()}(e)}}(e))}function H(e){!1!==n.enabled&&(e.pointerType,n.dispatchEvent(Be),s=a.NONE,X(e),0===w.length&&(n.domElement.releasePointerCapture(e.pointerId),n.domElement.removeEventListener("pointermove",G),n.domElement.removeEventListener("pointerup",H)))}function V(e){X(e)}function z(e){!1===n.enabled||!1===n.enableZoom||s!==a.NONE&&s!==a.ROTATE||(e.preventDefault(),n.dispatchEvent(De),function(e){e.deltaY<0?L(T()):e.deltaY>0&&M(T()),n.update()}(e),n.dispatchEvent(Be))}function j(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:I(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:I(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:I(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:I(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function W(e){!1!==n.enabled&&e.preventDefault()}function X(e){delete S[e.pointerId];for(let t=0;t<w.length;t++)if(w[t].pointerId==e.pointerId)return void w.splice(t,1)}function q(t){let r=S[t.pointerId];void 0===r&&(r=new e.Vector2,S[t.pointerId]=r),r.set(t.pageX,t.pageY)}function Y(e){const t=e.pointerId===w[0].pointerId?w[1]:w[0];return S[t.pointerId]}n.domElement.addEventListener("contextmenu",W),n.domElement.addEventListener("pointerdown",_),n.domElement.addEventListener("pointercancel",V),n.domElement.addEventListener("wheel",z,{passive:!1}),this.update()}}var Ge=a((function(e,t){function r(e){if(e.isMesh){if(e.geometry&&e.geometry.dispose(),e.material){(Array.isArray(e.material)?e.material:[e.material]).forEach((e=>{Object.keys(e).forEach((t=>{const r=e[t];r&&r.dispose instanceof Function&&r.dispose()}))}))}}else e.isScene&&(e.background&&e.background.dispose&&e.background.dispose(),e.environment&&e.environment.dispose&&e.environment.dispose())}Object.defineProperty(t,"__esModule",{value:!0}),t.disposeHierarchy=t.disposeNode=void 0,t.disposeNode=r,t.disposeHierarchy=function e(t,n=r){for(var a=t.children.length-1;a>=0;a--){var s=t.children[a];e(s,n),n(s)}n(t)}}));function He(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}return r}const Ve="https://techbrood.com/threejs/examples/";class ze{__init(){this._objects=[]}__init2(){this._cameraObjects=[]}constructor(e){ze.prototype.__init.call(this),ze.prototype.__init2.call(this),this.deps=e}add(e){this._objects.push(e),this.deps.scene.add(e)}addCamera(e){this._cameraObjects.push(e),this.deps.camera.add(e)}addControl(){const{camera:e,renderer:t}=this.deps;this.orbitControl=new _e(e,t.domElement),this.orbitControl.enableDamping=!0,this.orbitControl.dampingFactor=.05}reset(t=!0){const{camera:r,scene:n,renderer:a}=this.deps;r.position.set(0,0,0),r.quaternion.set(0,0,0,1),He([n.background,"optionalAccess",e=>e.dispose,"optionalCall",e=>e()]),n.background=new e.Color(16777215),n.fog=null,n.position.z=-3,a.shadowMap.enabled=!1,a.physicallyCorrectLights=!1,a.outputEncoding=e.sRGBEncoding,Ge.disposeHierarchy(this.deps.scene),this._objects.forEach((e=>He([e,"access",e=>e.material,"optionalAccess",e=>e.dispose,"optionalCall",e=>e()]))),this._cameraObjects.forEach((e=>He([e,"access",e=>e.material,"optionalAccess",e=>e.dispose,"optionalCall",e=>e()]))),n.remove(...this._objects),r.remove(...this._cameraObjects),this._objects.length=0,this._cameraObjects.length=0,He([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.dispose,"call",e=>e()]),t&&(this.orbitControl=null,this.deps=null)}}var je=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MeshoptDecoder=void 0;var r=function(e){if("object"!=typeof WXWebAssembly)return{supported:!1};var t,r,n=new Promise((e=>{r=e}));function a(e,r,n,a,s,o){var i=t.exports.sbrk,c=n+3&-4,l=i(c*a),u=i(s.length),h=new Uint8Array(t.exports.memory.buffer);h.set(s,u);var p=e(l,n,a,u,s.length);if(0==p&&o&&o(l,c,a),r.set(h.subarray(l,l+n*a)),i(l-i(0)),0!=p)throw new Error("Malformed buffer data: "+p)}var s={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},o={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{setWasmPath:function(e){WXWebAssembly.instantiate(e,{}).then((function(e){(t=e.instance).exports.__wasm_call_ctors(),r()}))},ready:n,supported:!0,decodeVertexBuffer:function(e,r,n,o,i){a(t.exports.meshopt_decodeVertexBuffer,e,r,n,o,t.exports[s[i]])},decodeIndexBuffer:function(e,r,n,s){a(t.exports.meshopt_decodeIndexBuffer,e,r,n,s)},decodeIndexSequence:function(e,r,n,s){a(t.exports.meshopt_decodeIndexSequence,e,r,n,s)},decodeGltfBuffer:function(e,r,n,i,c,l){a(t.exports[o[c]],e,r,n,i,t.exports[s[l]])}}}();t.MeshoptDecoder=r}));class We extends e.DataTextureLoader{constructor(e){super(e)}parse(t){const r=0,n=1,a=2,s=3,o=9,i=10,c=11,l=48,u=4,h=0,p=1,d=2,f=3;t.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");let g=0;const m=new Uint8Array(t),v={id_length:m[g++],colormap_type:m[g++],image_type:m[g++],colormap_index:m[g++]|m[g++]<<8,colormap_length:m[g++]|m[g++]<<8,colormap_size:m[g++],origin:[m[g++]|m[g++]<<8,m[g++]|m[g++]<<8],width:m[g++]|m[g++]<<8,height:m[g++]|m[g++]<<8,pixel_size:m[g++],flags:m[g++]};!function(e){switch(e.image_type){case n:case o:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case a:case s:case i:case c:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case r:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(v),v.id_length+g>t.length&&console.error("THREE.TGALoader: No data."),g+=v.id_length;let y=!1,b=!1,x=!1;switch(v.image_type){case o:y=!0,b=!0;break;case n:b=!0;break;case i:y=!0;break;case a:break;case c:y=!0,x=!0;break;case s:x=!0}const w=new Uint8Array(v.width*v.height*4),S=function(e,t,r,n,a){let s,o;const i=r.pixel_size>>3,c=r.width*r.height*i;if(t&&(o=a.subarray(n,n+=r.colormap_length*(r.colormap_size>>3))),e){let e,t,r;s=new Uint8Array(c);let o=0;const l=new Uint8Array(i);for(;o<c;)if(e=a[n++],t=1+(127&e),128&e){for(r=0;r<i;++r)l[r]=a[n++];for(r=0;r<t;++r)s.set(l,o+r*i);o+=i*t}else{for(t*=i,r=0;r<t;++r)s[o+r]=a[n++];o+=t}}else s=a.subarray(n,n+=t?r.width*r.height:c);return{pixel_data:s,palettes:o}}(y,b,v,g,m);return function(e,t,r,n,a){let s,o,i,c,g,m;switch((v.flags&l)>>u){default:case d:s=0,i=1,g=t,o=0,c=1,m=r;break;case h:s=0,i=1,g=t,o=r-1,c=-1,m=-1;break;case f:s=t-1,i=-1,g=-1,o=0,c=1,m=r;break;case p:s=t-1,i=-1,g=-1,o=r-1,c=-1,m=-1}if(x)switch(v.pixel_size){case 8:!function(e,t,r,n,a,s,o,i){let c,l,u,h=0;const p=v.width;for(u=t;u!==n;u+=r)for(l=a;l!==o;l+=s,h++)c=i[h],e[4*(l+p*u)+0]=c,e[4*(l+p*u)+1]=c,e[4*(l+p*u)+2]=c,e[4*(l+p*u)+3]=255}(e,o,c,m,s,i,g,n);break;case 16:!function(e,t,r,n,a,s,o,i){let c,l,u=0;const h=v.width;for(l=t;l!==n;l+=r)for(c=a;c!==o;c+=s,u+=2)e[4*(c+h*l)+0]=i[u+0],e[4*(c+h*l)+1]=i[u+0],e[4*(c+h*l)+2]=i[u+0],e[4*(c+h*l)+3]=i[u+1]}(e,o,c,m,s,i,g,n);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(v.pixel_size){case 8:!function(e,t,r,n,a,s,o,i,c){const l=c;let u,h,p,d=0;const f=v.width;for(p=t;p!==n;p+=r)for(h=a;h!==o;h+=s,d++)u=i[d],e[4*(h+f*p)+3]=255,e[4*(h+f*p)+2]=l[3*u+0],e[4*(h+f*p)+1]=l[3*u+1],e[4*(h+f*p)+0]=l[3*u+2]}(e,o,c,m,s,i,g,n,a);break;case 16:!function(e,t,r,n,a,s,o,i){let c,l,u,h=0;const p=v.width;for(u=t;u!==n;u+=r)for(l=a;l!==o;l+=s,h+=2)c=i[h+0]+(i[h+1]<<8),e[4*(l+p*u)+0]=(31744&c)>>7,e[4*(l+p*u)+1]=(992&c)>>2,e[4*(l+p*u)+2]=(31&c)<<3,e[4*(l+p*u)+3]=32768&c?0:255}(e,o,c,m,s,i,g,n);break;case 24:!function(e,t,r,n,a,s,o,i){let c,l,u=0;const h=v.width;for(l=t;l!==n;l+=r)for(c=a;c!==o;c+=s,u+=3)e[4*(c+h*l)+3]=255,e[4*(c+h*l)+2]=i[u+0],e[4*(c+h*l)+1]=i[u+1],e[4*(c+h*l)+0]=i[u+2]}(e,o,c,m,s,i,g,n);break;case 32:!function(e,t,r,n,a,s,o,i){let c,l,u=0;const h=v.width;for(l=t;l!==n;l+=r)for(c=a;c!==o;c+=s,u+=4)e[4*(c+h*l)+2]=i[u+0],e[4*(c+h*l)+1]=i[u+1],e[4*(c+h*l)+0]=i[u+2],e[4*(c+h*l)+3]=i[u+3]}(e,o,c,m,s,i,g,n);break;default:console.error("THREE.TGALoader: Format not supported.")}}(w,v.width,v.height,S.pixel_data,S.palettes),{data:w,width:v.width,height:v.height,flipY:!0,generateMipmaps:!0,minFilter:e.LinearMipmapLinearFilter}}}class Xe extends e.Loader{constructor(e){super(e)}load(t,r,n,a){const s=this,o=new e.FileLoader(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(t,(function(e){try{r(s.parse(e))}catch(e){a?a(e):console.error(e),s.manager.itemError(t)}}),n,a)}parse(t){function r(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function n(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}function a(e,t,r,n){const a=parseInt(u[n].substr(e,t));if(a){const e=(s=r,o=a,"s"+Math.min(s,o)+"e"+Math.max(s,o));void 0===c[e]&&(i.push([r-1,a-1,1]),c[e]=i.length-1)}var s,o}const s={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},o=[],i=[],c={},l={},u=t.split("\n");for(let e=0,t=u.length;e<t;e++)if("ATOM"===u[e].substr(0,4)||"HETATM"===u[e].substr(0,6)){const t=parseFloat(u[e].substr(30,7)),a=parseFloat(u[e].substr(38,7)),i=parseFloat(u[e].substr(46,7)),c=parseInt(u[e].substr(6,5))-1;let h=r(u[e].substr(76,2)).toLowerCase();""===h&&(h=r(u[e].substr(12,2)).toLowerCase());const p=[t,a,i,s[h],n(h)];o.push(p),l[c]=p}else if("CONECT"===u[e].substr(0,6)){const t=parseInt(u[e].substr(6,5));a(11,5,t,e),a(16,5,t,e),a(21,5,t,e),a(26,5,t,e)}return function(){const t={geometryAtoms:new e.BufferGeometry,geometryBonds:new e.BufferGeometry,json:{atoms:o}},r=t.geometryAtoms,n=t.geometryBonds,a=[],s=[],c=[];for(let e=0,t=o.length;e<t;e++){const t=o[e],r=t[0],n=t[1],i=t[2];a.push(r,n,i);const c=t[3][0]/255,l=t[3][1]/255,u=t[3][2]/255;s.push(c,l,u)}for(let e=0,t=i.length;e<t;e++){const t=i[e],r=t[0],n=t[1],a=l[r],s=l[n];let o=a[0],u=a[1],h=a[2];c.push(o,u,h),o=s[0],u=s[1],h=s[2],c.push(o,u,h)}return r.setAttribute("position",new e.Float32BufferAttribute(a,3)),r.setAttribute("color",new e.Float32BufferAttribute(s,3)),n.setAttribute("position",new e.Float32BufferAttribute(c,3)),t}()}}class qe extends e.Loader{constructor(e){super(e)}load(t,r,n,a){const s=this,o=new e.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(e){try{r(s.parse(e))}catch(e){a?a(e):console.error(e),s.manager.itemError(t)}}),n,a)}parse(t){function r(e,t,r){for(let n=0,a=e.length;n<a;n++)if(e[n]!==t.getUint8(r+n,!1))return!1;return!0}const n=function(e){if("string"==typeof e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(t);return function(e){const t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;const n=[115,111,108,105,100];for(let e=0;e<5;e++)if(r(n,t,e))return!1;return!0}(n)?function(t){const r=new DataView(t),n=r.getUint32(80,!0);let a,s,o,i,c,l,u,h,p=!1;for(let e=0;e<70;e++)1129270351==r.getUint32(e,!1)&&82==r.getUint8(e+4)&&61==r.getUint8(e+5)&&(p=!0,i=new Float32Array(3*n*3),c=r.getUint8(e+6)/255,l=r.getUint8(e+7)/255,u=r.getUint8(e+8)/255,h=r.getUint8(e+9)/255);const d=new e.BufferGeometry,f=new Float32Array(3*n*3),g=new Float32Array(3*n*3);for(let e=0;e<n;e++){const t=84+50*e,n=r.getFloat32(t,!0),h=r.getFloat32(t+4,!0),d=r.getFloat32(t+8,!0);if(p){const e=r.getUint16(t+48,!0);0==(32768&e)?(a=(31&e)/31,s=(e>>5&31)/31,o=(e>>10&31)/31):(a=c,s=l,o=u)}for(let c=1;c<=3;c++){const l=t+12*c,u=3*e*3+3*(c-1);f[u]=r.getFloat32(l,!0),f[u+1]=r.getFloat32(l+4,!0),f[u+2]=r.getFloat32(l+8,!0),g[u]=n,g[u+1]=h,g[u+2]=d,p&&(i[u]=a,i[u+1]=s,i[u+2]=o)}}return d.setAttribute("position",new e.BufferAttribute(f,3)),d.setAttribute("normal",new e.BufferAttribute(g,3)),p&&(d.setAttribute("color",new e.BufferAttribute(i,3)),d.hasColors=!0,d.alpha=h),d}(n):function(t){const r=new e.BufferGeometry,n=/solid([\s\S]*?)endsolid/g,a=/facet([\s\S]*?)endfacet/g;let s=0;const o=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,i=new RegExp("vertex"+o+o+o,"g"),c=new RegExp("normal"+o+o+o,"g"),l=[],u=[],h=new e.Vector3;let p,d=0,f=0,g=0;for(;null!==(p=n.exec(t));){f=g;const e=p[0];for(;null!==(p=a.exec(e));){let e=0,t=0;const r=p[0];for(;null!==(p=c.exec(r));)h.x=parseFloat(p[1]),h.y=parseFloat(p[2]),h.z=parseFloat(p[3]),t++;for(;null!==(p=i.exec(r));)l.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),u.push(h.x,h.y,h.z),e++,g++;1!==t&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+s),3!==e&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+s),s++}const t=f,n=g-f;r.addGroup(t,n,d),d++}return r.setAttribute("position",new e.Float32BufferAttribute(l,3)),r.setAttribute("normal",new e.Float32BufferAttribute(u,3)),r}("string"!=typeof(a=t)?e.LoaderUtils.decodeText(new Uint8Array(a)):a);var a}}var Ye=n(Object.freeze({__proto__:null,default:{}})),Ke=a((function(t,r){var n,a;Object.defineProperty(r,"__esModule",{value:!0}),r.parse=r.loadSync=r.load=r._parse=r.Path=r.Glyph=r.Font=r.BoundingBox=void 0,String.prototype.codePointAt||(n=function(){try{var e={},t=Object.defineProperty,r=t(e,e,e)&&t}catch(e){}return r}(),a=function(e){if(null==this)throw TypeError();var t=String(this),r=t.length,n=e?Number(e):0;if(n!=n&&(n=0),!(n<0||n>=r)){var a,s=t.charCodeAt(n);return s>=55296&&s<=56319&&r>n+1&&(a=t.charCodeAt(n+1))>=56320&&a<=57343?1024*(s-55296)+a-56320+65536:s}},n?n(String.prototype,"codePointAt",{value:a,configurable:!0,writable:!0}):String.prototype.codePointAt=a);function s(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function o(e,t){this.source=e,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=t,this.destLen=0,this.ltree=new s,this.dtree=new s}var i=new s,c=new s,l=new Uint8Array(30),u=new Uint16Array(30),h=new Uint8Array(30),p=new Uint16Array(30),d=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=new s,g=new Uint8Array(320);function m(e,t,r,n){var a,s;for(a=0;a<r;++a)e[a]=0;for(a=0;a<30-r;++a)e[a+r]=a/r|0;for(s=n,a=0;a<30;++a)t[a]=s,s+=1<<e[a]}var v=new Uint16Array(16);function y(e,t,r,n){var a,s;for(a=0;a<16;++a)e.table[a]=0;for(a=0;a<n;++a)e.table[t[r+a]]++;for(e.table[0]=0,s=0,a=0;a<16;++a)v[a]=s,s+=e.table[a];for(a=0;a<n;++a)t[r+a]&&(e.trans[v[t[r+a]]++]=a)}function b(e){e.bitcount--||(e.tag=e.source[e.sourceIndex++],e.bitcount=7);var t=1&e.tag;return e.tag>>>=1,t}function x(e,t,r){if(!t)return r;for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var n=e.tag&65535>>>16-t;return e.tag>>>=t,e.bitcount-=t,n+r}function w(e,t){for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var r=0,n=0,a=0,s=e.tag;do{n=2*n+(1&s),s>>>=1,++a,r+=t.table[a],n-=t.table[a]}while(n>=0);return e.tag=s,e.bitcount-=a,t.trans[r+n]}function S(e,t,r){var n,a,s,o,i,c;for(n=x(e,5,257),a=x(e,5,1),s=x(e,4,4),o=0;o<19;++o)g[o]=0;for(o=0;o<s;++o){var l=x(e,3,0);g[d[o]]=l}for(y(f,g,0,19),i=0;i<n+a;){var u=w(e,f);switch(u){case 16:var h=g[i-1];for(c=x(e,2,3);c;--c)g[i++]=h;break;case 17:for(c=x(e,3,3);c;--c)g[i++]=0;break;case 18:for(c=x(e,7,11);c;--c)g[i++]=0;break;default:g[i++]=u}}y(t,g,0,n),y(r,g,n,a)}function T(e,t,r){for(;;){var n,a,s,o,i=w(e,t);if(256===i)return 0;if(i<256)e.dest[e.destLen++]=i;else for(n=x(e,l[i-=257],u[i]),a=w(e,r),o=s=e.destLen-x(e,h[a],p[a]);o<s+n;++o)e.dest[e.destLen++]=e.dest[o]}}function F(e){for(var t,r;e.bitcount>8;)e.sourceIndex--,e.bitcount-=8;if((t=256*(t=e.source[e.sourceIndex+1])+e.source[e.sourceIndex])!==(65535&~(256*e.source[e.sourceIndex+3]+e.source[e.sourceIndex+2])))return-3;for(e.sourceIndex+=4,r=t;r;--r)e.dest[e.destLen++]=e.source[e.sourceIndex++];return e.bitcount=0,0}!function(e,t){var r;for(r=0;r<7;++r)e.table[r]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,r=0;r<24;++r)e.trans[r]=256+r;for(r=0;r<144;++r)e.trans[24+r]=r;for(r=0;r<8;++r)e.trans[168+r]=280+r;for(r=0;r<112;++r)e.trans[176+r]=144+r;for(r=0;r<5;++r)t.table[r]=0;for(t.table[5]=32,r=0;r<32;++r)t.trans[r]=r}(i,c),m(l,u,4,3),m(h,p,2,1),l[28]=0,u[28]=258;var A=function(e,t){var r,n,a=new o(e,t);do{switch(r=b(a),x(a,2,0)){case 0:n=F(a);break;case 1:n=T(a,i,c);break;case 2:S(a,a.ltree,a.dtree),n=T(a,a.ltree,a.dtree);break;default:n=-3}if(0!==n)throw new Error("Data error")}while(!r);return a.destLen<a.dest.length?"function"==typeof a.dest.slice?a.dest.slice(0,a.destLen):a.dest.subarray(0,a.destLen):a.dest};function k(e,t,r,n,a){return Math.pow(1-a,3)*e+3*Math.pow(1-a,2)*a*t+3*(1-a)*Math.pow(a,2)*r+Math.pow(a,3)*n}function E(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}function I(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}function M(e){throw new Error(e)}function L(e,t){e||M(t)}r.BoundingBox=E,E.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},E.prototype.addPoint=function(e,t){"number"==typeof e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),"number"==typeof t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},E.prototype.addX=function(e){this.addPoint(e,null)},E.prototype.addY=function(e){this.addPoint(null,e)},E.prototype.addBezier=function(e,t,r,n,a,s,o,i){var c=[e,t],l=[r,n],u=[a,s],h=[o,i];this.addPoint(e,t),this.addPoint(o,i);for(var p=0;p<=1;p++){var d=6*c[p]-12*l[p]+6*u[p],f=-3*c[p]+9*l[p]-9*u[p]+3*h[p],g=3*l[p]-3*c[p];if(0!==f){var m=Math.pow(d,2)-4*g*f;if(!(m<0)){var v=(-d+Math.sqrt(m))/(2*f);0<v&&v<1&&(0===p&&this.addX(k(c[p],l[p],u[p],h[p],v)),1===p&&this.addY(k(c[p],l[p],u[p],h[p],v)));var y=(-d-Math.sqrt(m))/(2*f);0<y&&y<1&&(0===p&&this.addX(k(c[p],l[p],u[p],h[p],y)),1===p&&this.addY(k(c[p],l[p],u[p],h[p],y)))}}else{if(0===d)continue;var b=-g/d;0<b&&b<1&&(0===p&&this.addX(k(c[p],l[p],u[p],h[p],b)),1===p&&this.addY(k(c[p],l[p],u[p],h[p],b)))}}},E.prototype.addQuad=function(e,t,r,n,a,s){var o=e+2/3*(r-e),i=t+2/3*(n-t),c=o+1/3*(a-e),l=i+1/3*(s-t);this.addBezier(e,t,o,i,c,l,a,s)},r.Path=I,I.prototype.moveTo=function(e,t){this.commands.push({type:"M",x:e,y:t})},I.prototype.lineTo=function(e,t){this.commands.push({type:"L",x:e,y:t})},I.prototype.curveTo=I.prototype.bezierCurveTo=function(e,t,r,n,a,s){this.commands.push({type:"C",x1:e,y1:t,x2:r,y2:n,x:a,y:s})},I.prototype.quadTo=I.prototype.quadraticCurveTo=function(e,t,r,n){this.commands.push({type:"Q",x1:e,y1:t,x:r,y:n})},I.prototype.close=I.prototype.closePath=function(){this.commands.push({type:"Z"})},I.prototype.extend=function(e){if(e.commands)e=e.commands;else if(e instanceof E){var t=e;return this.moveTo(t.x1,t.y1),this.lineTo(t.x2,t.y1),this.lineTo(t.x2,t.y2),this.lineTo(t.x1,t.y2),void this.close()}Array.prototype.push.apply(this.commands,e)},I.prototype.getBoundingBox=function(){for(var e=new E,t=0,r=0,n=0,a=0,s=0;s<this.commands.length;s++){var o=this.commands[s];switch(o.type){case"M":e.addPoint(o.x,o.y),t=n=o.x,r=a=o.y;break;case"L":e.addPoint(o.x,o.y),n=o.x,a=o.y;break;case"Q":e.addQuad(n,a,o.x1,o.y1,o.x,o.y),n=o.x,a=o.y;break;case"C":e.addBezier(n,a,o.x1,o.y1,o.x2,o.y2,o.x,o.y),n=o.x,a=o.y;break;case"Z":n=t,a=r;break;default:throw new Error("Unexpected path command "+o.type)}}return e.isEmpty()&&e.addPoint(0,0),e},I.prototype.draw=function(e){e.beginPath();for(var t=0;t<this.commands.length;t+=1){var r=this.commands[t];"M"===r.type?e.moveTo(r.x,r.y):"L"===r.type?e.lineTo(r.x,r.y):"C"===r.type?e.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):"Q"===r.type?e.quadraticCurveTo(r.x1,r.y1,r.x,r.y):"Z"===r.type&&e.closePath()}this.fill&&(e.fillStyle=this.fill,e.fill()),this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.stroke())},I.prototype.toPathData=function(e){function t(t){return Math.round(t)===t?""+Math.round(t):t.toFixed(e)}function r(){for(var e=arguments,r="",n=0;n<arguments.length;n+=1){var a=e[n];a>=0&&n>0&&(r+=" "),r+=t(a)}return r}e=void 0!==e?e:2;for(var n="",a=0;a<this.commands.length;a+=1){var s=this.commands[a];"M"===s.type?n+="M"+r(s.x,s.y):"L"===s.type?n+="L"+r(s.x,s.y):"C"===s.type?n+="C"+r(s.x1,s.y1,s.x2,s.y2,s.x,s.y):"Q"===s.type?n+="Q"+r(s.x1,s.y1,s.x,s.y):"Z"===s.type&&(n+="Z")}return n},I.prototype.toSVG=function(e){var t='<path d="';return t+=this.toPathData(e),t+='"',this.fill&&"black"!==this.fill&&(null===this.fill?t+=' fill="none"':t+=' fill="'+this.fill+'"'),this.stroke&&(t+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),t+="/>"},I.prototype.toDOMElement=function(t){var r=this.toPathData(t),n=e._default.polyfill.document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",r),n};var C={fail:M,argument:L,assert:L},O=2147483648,R={},N={},U={};function P(e){return function(){return e}}N.BYTE=function(e){return C.argument(e>=0&&e<=255,"Byte value should be between 0 and 255."),[e]},U.BYTE=P(1),N.CHAR=function(e){return[e.charCodeAt(0)]},U.CHAR=P(1),N.CHARARRAY=function(e){for(var t=[],r=0;r<e.length;r+=1)t[r]=e.charCodeAt(r);return t},U.CHARARRAY=function(e){return e.length},N.USHORT=function(e){return[e>>8&255,255&e]},U.USHORT=P(2),N.SHORT=function(e){return e>=32768&&(e=-(65536-e)),[e>>8&255,255&e]},U.SHORT=P(2),N.UINT24=function(e){return[e>>16&255,e>>8&255,255&e]},U.UINT24=P(3),N.ULONG=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},U.ULONG=P(4),N.LONG=function(e){return e>=O&&(e=-(2*O-e)),[e>>24&255,e>>16&255,e>>8&255,255&e]},U.LONG=P(4),N.FIXED=N.ULONG,U.FIXED=U.ULONG,N.FWORD=N.SHORT,U.FWORD=U.SHORT,N.UFWORD=N.USHORT,U.UFWORD=U.USHORT,N.LONGDATETIME=function(e){return[0,0,0,0,e>>24&255,e>>16&255,e>>8&255,255&e]},U.LONGDATETIME=P(8),N.TAG=function(e){return C.argument(4===e.length,"Tag should be exactly 4 ASCII characters."),[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]},U.TAG=P(4),N.Card8=N.BYTE,U.Card8=U.BYTE,N.Card16=N.USHORT,U.Card16=U.USHORT,N.OffSize=N.BYTE,U.OffSize=U.BYTE,N.SID=N.USHORT,U.SID=U.USHORT,N.NUMBER=function(e){return e>=-107&&e<=107?[e+139]:e>=108&&e<=1131?[247+((e-=108)>>8),255&e]:e>=-1131&&e<=-108?[251+((e=-e-108)>>8),255&e]:e>=-32768&&e<=32767?N.NUMBER16(e):N.NUMBER32(e)},U.NUMBER=function(e){return N.NUMBER(e).length},N.NUMBER16=function(e){return[28,e>>8&255,255&e]},U.NUMBER16=P(3),N.NUMBER32=function(e){return[29,e>>24&255,e>>16&255,e>>8&255,255&e]},U.NUMBER32=P(5),N.REAL=function(e){var t=e.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(t);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));t=(Math.round(e*n)/n).toString()}for(var a="",s=0,o=t.length;s<o;s+=1){var i=t[s];a+="e"===i?"-"===t[++s]?"c":"b":"."===i?"a":"-"===i?"e":i}for(var c=[30],l=0,u=(a+=1&a.length?"f":"ff").length;l<u;l+=2)c.push(parseInt(a.substr(l,2),16));return c},U.REAL=function(e){return N.REAL(e).length},N.NAME=N.CHARARRAY,U.NAME=U.CHARARRAY,N.STRING=N.CHARARRAY,U.STRING=U.CHARARRAY,R.UTF8=function(e,t,r){for(var n=[],a=r,s=0;s<a;s++,t+=1)n[s]=e.getUint8(t);return String.fromCharCode.apply(null,n)},R.UTF16=function(e,t,r){for(var n=[],a=r/2,s=0;s<a;s++,t+=2)n[s]=e.getUint16(t);return String.fromCharCode.apply(null,n)},N.UTF16=function(e){for(var t=[],r=0;r<e.length;r+=1){var n=e.charCodeAt(r);t[t.length]=n>>8&255,t[t.length]=255&n}return t},U.UTF16=function(e){return 2*e.length};var D={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};R.MACSTRING=function(e,t,r,n){var a=D[n];if(void 0!==a){for(var s="",o=0;o<r;o++){var i=e.getUint8(t+o);s+=i<=127?String.fromCharCode(i):a[127&i]}return s}};var B,_="function"==typeof WeakMap&&new WeakMap;function G(e){return e>=-128&&e<=127}function H(e,t,r){for(var n=0,a=e.length;t<a&&n<64&&0===e[t];)++t,++n;return r.push(128|n-1),t}function V(e,t,r){for(var n=0,a=e.length,s=t;s<a&&n<64;){var o=e[s];if(!G(o))break;if(0===o&&s+1<a&&0===e[s+1])break;++s,++n}r.push(n-1);for(var i=t;i<s;++i)r.push(e[i]+256&255);return s}function z(e,t,r){for(var n=0,a=e.length,s=t;s<a&&n<64;){var o=e[s];if(0===o)break;if(G(o)&&s+1<a&&G(e[s+1]))break;++s,++n}r.push(64|n-1);for(var i=t;i<s;++i){var c=e[i];r.push(c+65536>>8&255,c+256&255)}return s}N.MACSTRING=function(e,t){var r=function(e){if(!B)for(var t in B={},D)B[t]=new String(t);var r=B[e];if(void 0!==r){if(_){var n=_.get(r);if(void 0!==n)return n}var a=D[e];if(void 0!==a){for(var s={},o=0;o<a.length;o++)s[a.charCodeAt(o)]=o+128;return _&&_.set(r,s),s}}}(t);if(void 0!==r){for(var n=[],a=0;a<e.length;a++){var s=e.charCodeAt(a);if(s>=128&&void 0===(s=r[s]))return;n[a]=s}return n}},U.MACSTRING=function(e,t){var r=N.MACSTRING(e,t);return void 0!==r?r.length:0},N.VARDELTAS=function(e){for(var t=0,r=[];t<e.length;){var n=e[t];t=0===n?H(e,t,r):n>=-128&&n<=127?V(e,t,r):z(e,t,r)}return r},N.INDEX=function(e){for(var t=1,r=[t],n=[],a=0;a<e.length;a+=1){var s=N.OBJECT(e[a]);Array.prototype.push.apply(n,s),t+=s.length,r.push(t)}if(0===n.length)return[0,0];for(var o=[],i=1+Math.floor(Math.log(t)/Math.log(2))/8|0,c=[void 0,N.BYTE,N.USHORT,N.UINT24,N.ULONG][i],l=0;l<r.length;l+=1){var u=c(r[l]);Array.prototype.push.apply(o,u)}return Array.prototype.concat(N.Card16(e.length),N.OffSize(i),o,n)},U.INDEX=function(e){return N.INDEX(e).length},N.DICT=function(e){for(var t=[],r=Object.keys(e),n=r.length,a=0;a<n;a+=1){var s=parseInt(r[a],0),o=e[s];t=(t=t.concat(N.OPERAND(o.value,o.type))).concat(N.OPERATOR(s))}return t},U.DICT=function(e){return N.DICT(e).length},N.OPERATOR=function(e){return e<1200?[e]:[12,e-1200]},N.OPERAND=function(e,t){var r=[];if(Array.isArray(t))for(var n=0;n<t.length;n+=1)C.argument(e.length===t.length,"Not enough arguments given for type"+t),r=r.concat(N.OPERAND(e[n],t[n]));else if("SID"===t)r=r.concat(N.NUMBER(e));else if("offset"===t)r=r.concat(N.NUMBER32(e));else if("number"===t)r=r.concat(N.NUMBER(e));else{if("real"!==t)throw new Error("Unknown operand type "+t);r=r.concat(N.REAL(e))}return r},N.OP=N.BYTE,U.OP=U.BYTE;var j="function"==typeof WeakMap&&new WeakMap;function W(e,t,r){for(var n=0;n<t.length;n+=1){var a=t[n];this[a.name]=a.value}if(this.tableName=e,this.fields=t,r)for(var s=Object.keys(r),o=0;o<s.length;o+=1){var i=s[o],c=r[i];void 0!==this[i]&&(this[i]=c)}}function X(e,t,r){void 0===r&&(r=t.length);var n=new Array(t.length+1);n[0]={name:e+"Count",type:"USHORT",value:r};for(var a=0;a<t.length;a++)n[a+1]={name:e+a,type:"USHORT",value:t[a]};return n}function q(e,t,r){var n=t.length,a=new Array(n+1);a[0]={name:e+"Count",type:"USHORT",value:n};for(var s=0;s<n;s++)a[s+1]={name:e+s,type:"TABLE",value:r(t[s],s)};return a}function Y(e,t,r){var n=t.length,a=[];a[0]={name:e+"Count",type:"USHORT",value:n};for(var s=0;s<n;s++)a=a.concat(r(t[s],s));return a}function K(e){1===e.format?W.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(X("glyph",e.glyphs))):C.assert(!1,"Can't create coverage table format 2 yet.")}function Z(e){W.call(this,"scriptListTable",Y("scriptRecord",e,(function(e,t){var r=e.script,n=r.defaultLangSys;return C.assert(!!n,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+t,type:"TAG",value:e.tag},{name:"script"+t,type:"TABLE",value:new W("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new W("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:n.reqFeatureIndex}].concat(X("featureIndex",n.featureIndexes)))}].concat(Y("langSys",r.langSysRecords,(function(e,t){var r=e.langSys;return[{name:"langSysTag"+t,type:"TAG",value:e.tag},{name:"langSys"+t,type:"TABLE",value:new W("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:r.reqFeatureIndex}].concat(X("featureIndex",r.featureIndexes)))}]}))))}]})))}function Q(e){W.call(this,"featureListTable",Y("featureRecord",e,(function(e,t){var r=e.feature;return[{name:"featureTag"+t,type:"TAG",value:e.tag},{name:"feature"+t,type:"TABLE",value:new W("featureTable",[{name:"featureParams",type:"USHORT",value:r.featureParams}].concat(X("lookupListIndex",r.lookupListIndexes)))}]})))}function J(e,t){W.call(this,"lookupListTable",q("lookup",e,(function(e){var r=t[e.lookupType];return C.assert(!!r,"Unable to write GSUB lookup type "+e.lookupType+" tables."),new W("lookupTable",[{name:"lookupType",type:"USHORT",value:e.lookupType},{name:"lookupFlag",type:"USHORT",value:e.lookupFlag}].concat(q("subtable",e.subtables,r)))})))}N.CHARSTRING=function(e){if(j){var t=j.get(e);if(void 0!==t)return t}for(var r=[],n=e.length,a=0;a<n;a+=1){var s=e[a];r=r.concat(N[s.type](s.value))}return j&&j.set(e,r),r},U.CHARSTRING=function(e){return N.CHARSTRING(e).length},N.OBJECT=function(e){var t=N[e.type];return C.argument(void 0!==t,"No encoding function for type "+e.type),t(e.value)},U.OBJECT=function(e){var t=U[e.type];return C.argument(void 0!==t,"No sizeOf function for type "+e.type),t(e.value)},N.TABLE=function(e){for(var t=[],r=e.fields.length,n=[],a=[],s=0;s<r;s+=1){var o=e.fields[s],i=N[o.type];C.argument(void 0!==i,"No encoding function for field type "+o.type+" ("+o.name+")");var c=e[o.name];void 0===c&&(c=o.value);var l=i(c);"TABLE"===o.type?(a.push(t.length),t=t.concat([0,0]),n.push(l)):t=t.concat(l)}for(var u=0;u<n.length;u+=1){var h=a[u],p=t.length;C.argument(p<65536,"Table "+e.tableName+" too big."),t[h]=p>>8,t[h+1]=255&p,t=t.concat(n[u])}return t},U.TABLE=function(e){for(var t=0,r=e.fields.length,n=0;n<r;n+=1){var a=e.fields[n],s=U[a.type];C.argument(void 0!==s,"No sizeOf function for field type "+a.type+" ("+a.name+")");var o=e[a.name];void 0===o&&(o=a.value),t+=s(o),"TABLE"===a.type&&(t+=2)}return t},N.RECORD=N.TABLE,U.RECORD=U.TABLE,N.LITERAL=function(e){return e},U.LITERAL=function(e){return e.length},W.prototype.encode=function(){return N.TABLE(this)},W.prototype.sizeOf=function(){return U.TABLE(this)},K.prototype=Object.create(W.prototype),K.prototype.constructor=K,Z.prototype=Object.create(W.prototype),Z.prototype.constructor=Z,Q.prototype=Object.create(W.prototype),Q.prototype.constructor=Q,J.prototype=Object.create(W.prototype),J.prototype.constructor=J;var $={Table:W,Record:W,Coverage:K,ScriptList:Z,FeatureList:Q,LookupList:J,ushortList:X,tableList:q,recordList:Y};function ee(e,t){return e.getUint8(t)}function te(e,t){return e.getUint16(t,!1)}function re(e,t){return e.getUint32(t,!1)}function ne(e,t){return e.getInt16(t,!1)+e.getUint16(t+2,!1)/65535}var ae={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function se(e,t){this.data=e,this.offset=t,this.relativeOffset=0}se.prototype.parseByte=function(){var e=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},se.prototype.parseChar=function(){var e=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},se.prototype.parseCard8=se.prototype.parseByte,se.prototype.parseUShort=function(){var e=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},se.prototype.parseCard16=se.prototype.parseUShort,se.prototype.parseSID=se.prototype.parseUShort,se.prototype.parseOffset16=se.prototype.parseUShort,se.prototype.parseShort=function(){var e=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},se.prototype.parseF2Dot14=function(){var e=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,e},se.prototype.parseULong=function(){var e=re(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},se.prototype.parseOffset32=se.prototype.parseULong,se.prototype.parseFixed=function(){var e=ne(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},se.prototype.parseString=function(e){var t=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=e;for(var a=0;a<e;a++)n+=String.fromCharCode(t.getUint8(r+a));return n},se.prototype.parseTag=function(){return this.parseString(4)},se.prototype.parseLongDateTime=function(){var e=re(this.data,this.offset+this.relativeOffset+4);return e-=2082844800,this.relativeOffset+=8,e},se.prototype.parseVersion=function(e){var t=te(this.data,this.offset+this.relativeOffset),r=te(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,void 0===e&&(e=4096),t+r/e/10},se.prototype.skip=function(e,t){void 0===t&&(t=1),this.relativeOffset+=ae[e]*t},se.prototype.parseULongList=function(e){void 0===e&&(e=this.parseULong());for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,a=0;a<e;a++)t[a]=r.getUint32(n),n+=4;return this.relativeOffset+=4*e,t},se.prototype.parseOffset16List=se.prototype.parseUShortList=function(e){void 0===e&&(e=this.parseUShort());for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,a=0;a<e;a++)t[a]=r.getUint16(n),n+=2;return this.relativeOffset+=2*e,t},se.prototype.parseShortList=function(e){for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,a=0;a<e;a++)t[a]=r.getInt16(n),n+=2;return this.relativeOffset+=2*e,t},se.prototype.parseByteList=function(e){for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,a=0;a<e;a++)t[a]=r.getUint8(n++);return this.relativeOffset+=e,t},se.prototype.parseList=function(e,t){t||(t=e,e=this.parseUShort());for(var r=new Array(e),n=0;n<e;n++)r[n]=t.call(this);return r},se.prototype.parseList32=function(e,t){t||(t=e,e=this.parseULong());for(var r=new Array(e),n=0;n<e;n++)r[n]=t.call(this);return r},se.prototype.parseRecordList=function(e,t){t||(t=e,e=this.parseUShort());for(var r=new Array(e),n=Object.keys(t),a=0;a<e;a++){for(var s={},o=0;o<n.length;o++){var i=n[o],c=t[i];s[i]=c.call(this)}r[a]=s}return r},se.prototype.parseRecordList32=function(e,t){t||(t=e,e=this.parseULong());for(var r=new Array(e),n=Object.keys(t),a=0;a<e;a++){for(var s={},o=0;o<n.length;o++){var i=n[o],c=t[i];s[i]=c.call(this)}r[a]=s}return r},se.prototype.parseStruct=function(e){if("function"==typeof e)return e.call(this);for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var a=t[n],s=e[a];r[a]=s.call(this)}return r},se.prototype.parseValueRecord=function(e){if(void 0===e&&(e=this.parseUShort()),0!==e){var t={};return 1&e&&(t.xPlacement=this.parseShort()),2&e&&(t.yPlacement=this.parseShort()),4&e&&(t.xAdvance=this.parseShort()),8&e&&(t.yAdvance=this.parseShort()),16&e&&(t.xPlaDevice=void 0,this.parseShort()),32&e&&(t.yPlaDevice=void 0,this.parseShort()),64&e&&(t.xAdvDevice=void 0,this.parseShort()),128&e&&(t.yAdvDevice=void 0,this.parseShort()),t}},se.prototype.parseValueRecordList=function(){for(var e=this.parseUShort(),t=this.parseUShort(),r=new Array(t),n=0;n<t;n++)r[n]=this.parseValueRecord(e);return r},se.prototype.parsePointer=function(e){var t=this.parseOffset16();if(t>0)return new se(this.data,this.offset+t).parseStruct(e)},se.prototype.parsePointer32=function(e){var t=this.parseOffset32();if(t>0)return new se(this.data,this.offset+t).parseStruct(e)},se.prototype.parseListOfLists=function(e){for(var t=this.parseOffset16List(),r=t.length,n=this.relativeOffset,a=new Array(r),s=0;s<r;s++){var o=t[s];if(0!==o)if(this.relativeOffset=o,e){for(var i=this.parseOffset16List(),c=new Array(i.length),l=0;l<i.length;l++)this.relativeOffset=o+i[l],c[l]=e.call(this);a[s]=c}else a[s]=this.parseUShortList();else a[s]=void 0}return this.relativeOffset=n,a},se.prototype.parseCoverage=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort(),r=this.parseUShort();if(1===t)return{format:1,glyphs:this.parseUShortList(r)};if(2===t){for(var n=new Array(r),a=0;a<r;a++)n[a]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+e.toString(16)+": Coverage format must be 1 or 2.")},se.prototype.parseClassDef=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(2===t)return{format:2,ranges:this.parseRecordList({start:se.uShort,end:se.uShort,classId:se.uShort})};throw new Error("0x"+e.toString(16)+": ClassDef format must be 1 or 2.")},se.list=function(e,t){return function(){return this.parseList(e,t)}},se.list32=function(e,t){return function(){return this.parseList32(e,t)}},se.recordList=function(e,t){return function(){return this.parseRecordList(e,t)}},se.recordList32=function(e,t){return function(){return this.parseRecordList32(e,t)}},se.pointer=function(e){return function(){return this.parsePointer(e)}},se.pointer32=function(e){return function(){return this.parsePointer32(e)}},se.tag=se.prototype.parseTag,se.byte=se.prototype.parseByte,se.uShort=se.offset16=se.prototype.parseUShort,se.uShortList=se.prototype.parseUShortList,se.uLong=se.offset32=se.prototype.parseULong,se.uLongList=se.prototype.parseULongList,se.struct=se.prototype.parseStruct,se.coverage=se.prototype.parseCoverage,se.classDef=se.prototype.parseClassDef;var oe={reserved:se.uShort,reqFeatureIndex:se.uShort,featureIndexes:se.uShortList};se.prototype.parseScriptList=function(){return this.parsePointer(se.recordList({tag:se.tag,script:se.pointer({defaultLangSys:se.pointer(oe),langSysRecords:se.recordList({tag:se.tag,langSys:se.pointer(oe)})})}))||[]},se.prototype.parseFeatureList=function(){return this.parsePointer(se.recordList({tag:se.tag,feature:se.pointer({featureParams:se.offset16,lookupListIndexes:se.uShortList})}))||[]},se.prototype.parseLookupList=function(e){return this.parsePointer(se.list(se.pointer((function(){var t=this.parseUShort();C.argument(1<=t&&t<=9,"GPOS/GSUB lookup type "+t+" unknown.");var r=this.parseUShort(),n=16&r;return{lookupType:t,lookupFlag:r,subtables:this.parseList(se.pointer(e[t])),markFilteringSet:n?this.parseUShort():void 0}}))))||[]},se.prototype.parseFeatureVariationsList=function(){return this.parsePointer32((function(){var e=this.parseUShort(),t=this.parseUShort();return C.argument(1===e&&t<1,"GPOS/GSUB feature variations table unknown."),this.parseRecordList32({conditionSetOffset:se.offset32,featureTableSubstitutionOffset:se.offset32})}))||[]};var ie={getByte:ee,getCard8:ee,getUShort:te,getCard16:te,getShort:function(e,t){return e.getInt16(t,!1)},getULong:re,getFixed:ne,getTag:function(e,t){for(var r="",n=t;n<t+4;n+=1)r+=String.fromCharCode(e.getInt8(n));return r},getOffset:function(e,t,r){for(var n=0,a=0;a<r;a+=1)n<<=8,n+=e.getUint8(t+a);return n},getBytes:function(e,t,r){for(var n=[],a=t;a<r;a+=1)n.push(e.getUint8(a));return n},bytesToString:function(e){for(var t="",r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return t},Parser:se};function ce(e,t,r){e.segments.push({end:t,start:t,delta:-(t-r),offset:0,glyphIndex:r})}r._parse=ie;var le={parse:function(e,t){var r={};r.version=ie.getUShort(e,t),C.argument(0===r.version,"cmap table version should be 0."),r.numTables=ie.getUShort(e,t+2);for(var n=-1,a=r.numTables-1;a>=0;a-=1){var s=ie.getUShort(e,t+4+8*a),o=ie.getUShort(e,t+4+8*a+2);if(3===s&&(0===o||1===o||10===o)||0===s&&(0===o||1===o||2===o||3===o||4===o)){n=ie.getULong(e,t+4+8*a+4);break}}if(-1===n)throw new Error("No valid cmap sub-tables found.");var i=new ie.Parser(e,t+n);if(r.format=i.parseUShort(),12===r.format)!function(e,t){var r;t.parseUShort(),e.length=t.parseULong(),e.language=t.parseULong(),e.groupCount=r=t.parseULong(),e.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var a=t.parseULong(),s=t.parseULong(),o=t.parseULong(),i=a;i<=s;i+=1)e.glyphIndexMap[i]=o,o++}(r,i);else{if(4!==r.format)throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");!function(e,t,r,n,a){var s;e.length=t.parseUShort(),e.language=t.parseUShort(),e.segCount=s=t.parseUShort()>>1,t.skip("uShort",3),e.glyphIndexMap={};for(var o=new ie.Parser(r,n+a+14),i=new ie.Parser(r,n+a+16+2*s),c=new ie.Parser(r,n+a+16+4*s),l=new ie.Parser(r,n+a+16+6*s),u=n+a+16+8*s,h=0;h<s-1;h+=1)for(var p=void 0,d=o.parseUShort(),f=i.parseUShort(),g=c.parseShort(),m=l.parseUShort(),v=f;v<=d;v+=1)0!==m?(u=l.offset+l.relativeOffset-2,u+=m,u+=2*(v-f),0!==(p=ie.getUShort(r,u))&&(p=p+g&65535)):p=v+g&65535,e.glyphIndexMap[v]=p}(r,i,e,t,n)}return r},make:function(e){var t,r=!0;for(t=e.length-1;t>0;t-=1){if(e.get(t).unicode>65535){console.log("Adding CMAP format 12 (needed!)"),r=!1;break}}var n=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:r?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:r?12:20}];r||(n=n.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),n=n.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var a=new $.Table("cmap",n);for(a.segments=[],t=0;t<e.length;t+=1){for(var s=e.get(t),o=0;o<s.unicodes.length;o+=1)ce(a,s.unicodes[o],t);a.segments=a.segments.sort((function(e,t){return e.start-t.start}))}!function(e){e.segments.push({end:65535,start:65535,delta:1,offset:0})}(a);var i=a.segments.length,c=0,l=[],u=[],h=[],p=[],d=[],f=[];for(t=0;t<i;t+=1){var g=a.segments[t];g.end<=65535&&g.start<=65535?(l=l.concat({name:"end_"+t,type:"USHORT",value:g.end}),u=u.concat({name:"start_"+t,type:"USHORT",value:g.start}),h=h.concat({name:"idDelta_"+t,type:"SHORT",value:g.delta}),p=p.concat({name:"idRangeOffset_"+t,type:"USHORT",value:g.offset}),void 0!==g.glyphId&&(d=d.concat({name:"glyph_"+t,type:"USHORT",value:g.glyphId}))):c+=1,r||void 0===g.glyphIndex||(f=(f=(f=f.concat({name:"cmap12Start_"+t,type:"ULONG",value:g.start})).concat({name:"cmap12End_"+t,type:"ULONG",value:g.end})).concat({name:"cmap12Glyph_"+t,type:"ULONG",value:g.glyphIndex}))}if(a.segCountX2=2*(i-c),a.searchRange=2*Math.pow(2,Math.floor(Math.log(i-c)/Math.log(2))),a.entrySelector=Math.log(a.searchRange/2)/Math.log(2),a.rangeShift=a.segCountX2-a.searchRange,a.fields=a.fields.concat(l),a.fields.push({name:"reservedPad",type:"USHORT",value:0}),a.fields=a.fields.concat(u),a.fields=a.fields.concat(h),a.fields=a.fields.concat(p),a.fields=a.fields.concat(d),a.cmap4Length=14+2*l.length+2+2*u.length+2*h.length+2*p.length+2*d.length,!r){var m=16+4*f.length;a.cmap12Offset=20+a.cmap4Length,a.fields=a.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:m},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:f.length/3}]),a.fields=a.fields.concat(f)}return a}},ue=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],he=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],pe=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],de=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function fe(e){this.font=e}function ge(e){this.cmap=e}function me(e,t){this.encoding=e,this.charset=t}function ve(e){switch(e.version){case 1:this.names=de.slice();break;case 2:this.names=new Array(e.numberOfGlyphs);for(var t=0;t<e.numberOfGlyphs;t++)e.glyphNameIndex[t]<de.length?this.names[t]=de[e.glyphNameIndex[t]]:this.names[t]=e.names[e.glyphNameIndex[t]-de.length];break;case 2.5:this.names=new Array(e.numberOfGlyphs);for(var r=0;r<e.numberOfGlyphs;r++)this.names[r]=de[r+e.glyphNameIndex[r]];break;default:this.names=[]}}function ye(e,t){t.lowMemory?function(e){e._IndexToUnicodeMap={};for(var t=e.tables.cmap.glyphIndexMap,r=Object.keys(t),n=0;n<r.length;n+=1){var a=r[n],s=t[a];void 0===e._IndexToUnicodeMap[s]?e._IndexToUnicodeMap[s]={unicodes:[parseInt(a)]}:e._IndexToUnicodeMap[s].unicodes.push(parseInt(a))}}(e):function(e){for(var t,r=e.tables.cmap.glyphIndexMap,n=Object.keys(r),a=0;a<n.length;a+=1){var s=n[a],o=r[s];(t=e.glyphs.get(o)).addUnicode(parseInt(s))}for(var i=0;i<e.glyphs.length;i+=1)t=e.glyphs.get(i),e.cffEncoding?e.isCIDFont?t.name="gid"+i:t.name=e.cffEncoding.charset[i]:e.glyphNames.names&&(t.name=e.glyphNames.glyphIndexToName(i))}(e)}fe.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),r=this.font.glyphs;if(r)for(var n=0;n<r.length;n+=1)for(var a=r.get(n),s=0;s<a.unicodes.length;s+=1)if(a.unicodes[s]===t)return n;return null},ge.prototype.charToGlyphIndex=function(e){return this.cmap.glyphIndexMap[e.codePointAt(0)]||0},me.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),r=this.encoding[t];return this.charset.indexOf(r)},ve.prototype.nameToGlyphIndex=function(e){return this.names.indexOf(e)},ve.prototype.glyphIndexToName=function(e){return this.names[e]};var be={line:function(e,t,r,n,a){e.beginPath(),e.moveTo(t,r),e.lineTo(n,a),e.stroke()}};function xe(e){this.bindConstructorValues(e)}function we(e,t,r){Object.defineProperty(e,t,{get:function(){return e.path,e[r]},set:function(t){e[r]=t},enumerable:!0,configurable:!0})}function Se(e,t){if(this.font=e,this.glyphs={},Array.isArray(t))for(var r=0;r<t.length;r++){var n=t[r];n.path.unitsPerEm=e.unitsPerEm,this.glyphs[r]=n}this.length=t&&t.length||0}r.Glyph=xe,xe.prototype.bindConstructorValues=function(e){var t,r;this.index=e.index||0,this.name=e.name||null,this.unicode=e.unicode||void 0,this.unicodes=e.unicodes||void 0!==e.unicode?[e.unicode]:[],"xMin"in e&&(this.xMin=e.xMin),"yMin"in e&&(this.yMin=e.yMin),"xMax"in e&&(this.xMax=e.xMax),"yMax"in e&&(this.yMax=e.yMax),"advanceWidth"in e&&(this.advanceWidth=e.advanceWidth),Object.defineProperty(this,"path",(t=e.path,r=t||new I,{configurable:!0,get:function(){return"function"==typeof r&&(r=r()),r},set:function(e){r=e}}))},xe.prototype.addUnicode=function(e){0===this.unicodes.length&&(this.unicode=e),this.unicodes.push(e)},xe.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},xe.prototype.getPath=function(e,t,r,n,a){var s,o;e=void 0!==e?e:0,t=void 0!==t?t:0,r=void 0!==r?r:72,n||(n={});var i=n.xScale,c=n.yScale;if(n.hinting&&a&&a.hinting&&(o=this.path&&a.hinting.exec(this,r)),o)s=a.hinting.getCommands(o),e=Math.round(e),t=Math.round(t),i=c=1;else{s=this.path.commands;var l=1/(this.path.unitsPerEm||1e3)*r;void 0===i&&(i=l),void 0===c&&(c=l)}for(var u=new I,h=0;h<s.length;h+=1){var p=s[h];"M"===p.type?u.moveTo(e+p.x*i,t+-p.y*c):"L"===p.type?u.lineTo(e+p.x*i,t+-p.y*c):"Q"===p.type?u.quadraticCurveTo(e+p.x1*i,t+-p.y1*c,e+p.x*i,t+-p.y*c):"C"===p.type?u.curveTo(e+p.x1*i,t+-p.y1*c,e+p.x2*i,t+-p.y2*c,e+p.x*i,t+-p.y*c):"Z"===p.type&&u.closePath()}return u},xe.prototype.getContours=function(){if(void 0===this.points)return[];for(var e=[],t=[],r=0;r<this.points.length;r+=1){var n=this.points[r];t.push(n),n.lastPointOfContour&&(e.push(t),t=[])}return C.argument(0===t.length,"There are still points left in the current contour."),e},xe.prototype.getMetrics=function(){for(var e=this.path.commands,t=[],r=[],n=0;n<e.length;n+=1){var a=e[n];"Z"!==a.type&&(t.push(a.x),r.push(a.y)),"Q"!==a.type&&"C"!==a.type||(t.push(a.x1),r.push(a.y1)),"C"===a.type&&(t.push(a.x2),r.push(a.y2))}var s={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,t),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(s.xMin)||(s.xMin=0),isFinite(s.xMax)||(s.xMax=this.advanceWidth),isFinite(s.yMin)||(s.yMin=0),isFinite(s.yMax)||(s.yMax=0),s.rightSideBearing=this.advanceWidth-s.leftSideBearing-(s.xMax-s.xMin),s},xe.prototype.draw=function(e,t,r,n,a){this.getPath(t,r,n,a).draw(e)},xe.prototype.drawPoints=function(e,t,r,n){function a(t,r,n,a){e.beginPath();for(var s=0;s<t.length;s+=1)e.moveTo(r+t[s].x*a,n+t[s].y*a),e.arc(r+t[s].x*a,n+t[s].y*a,2,0,2*Math.PI,!1);e.closePath(),e.fill()}t=void 0!==t?t:0,r=void 0!==r?r:0,n=void 0!==n?n:24;for(var s=1/this.path.unitsPerEm*n,o=[],i=[],c=this.path,l=0;l<c.commands.length;l+=1){var u=c.commands[l];void 0!==u.x&&o.push({x:u.x,y:-u.y}),void 0!==u.x1&&i.push({x:u.x1,y:-u.y1}),void 0!==u.x2&&i.push({x:u.x2,y:-u.y2})}e.fillStyle="blue",a(o,t,r,s),e.fillStyle="red",a(i,t,r,s)},xe.prototype.drawMetrics=function(e,t,r,n){var a;t=void 0!==t?t:0,r=void 0!==r?r:0,n=void 0!==n?n:24,a=1/this.path.unitsPerEm*n,e.lineWidth=1,e.strokeStyle="black",be.line(e,t,-1e4,t,1e4),be.line(e,-1e4,r,1e4,r);var s=this.xMin||0,o=this.yMin||0,i=this.xMax||0,c=this.yMax||0,l=this.advanceWidth||0;e.strokeStyle="blue",be.line(e,t+s*a,-1e4,t+s*a,1e4),be.line(e,t+i*a,-1e4,t+i*a,1e4),be.line(e,-1e4,r+-o*a,1e4,r+-o*a),be.line(e,-1e4,r+-c*a,1e4,r+-c*a),e.strokeStyle="green",be.line(e,t+l*a,-1e4,t+l*a,1e4)},Se.prototype.get=function(e){if(void 0===this.glyphs[e]){this.font._push(e),"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]());var t=this.glyphs[e],r=this.font._IndexToUnicodeMap[e];if(r)for(var n=0;n<r.unicodes.length;n++)t.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?t.name="gid"+e:t.name=this.font.cffEncoding.charset[e]:this.font.glyphNames.names&&(t.name=this.font.glyphNames.glyphIndexToName(e)),this.glyphs[e].advanceWidth=this.font._hmtxTableData[e].advanceWidth,this.glyphs[e].leftSideBearing=this.font._hmtxTableData[e].leftSideBearing}else"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]());return this.glyphs[e]},Se.prototype.push=function(e,t){this.glyphs[e]=t,this.length++};var Te={GlyphSet:Se,glyphLoader:function(e,t){return new xe({index:t,font:e})},ttfGlyphLoader:function(e,t,r,n,a,s){return function(){var o=new xe({index:t,font:e});return o.path=function(){r(o,n,a);var t=s(e.glyphs,o);return t.unitsPerEm=e.unitsPerEm,t},we(o,"xMin","_xMin"),we(o,"xMax","_xMax"),we(o,"yMin","_yMin"),we(o,"yMax","_yMax"),o}},cffGlyphLoader:function(e,t,r,n){return function(){var a=new xe({index:t,font:e});return a.path=function(){var t=r(e,a,n);return t.unitsPerEm=e.unitsPerEm,t},a}}};function Fe(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r+=1)if(!Fe(e[r],t[r]))return!1;return!0}return!1}function Ae(e){return e.length<1240?107:e.length<33900?1131:32768}function ke(e,t,r){var n,a,s=[],o=[],i=ie.getCard16(e,t);if(0!==i){var c=ie.getByte(e,t+2);n=t+(i+1)*c+2;for(var l=t+3,u=0;u<i+1;u+=1)s.push(ie.getOffset(e,l,c)),l+=c;a=n+s[i]}else a=t+2;for(var h=0;h<s.length-1;h+=1){var p=ie.getBytes(e,n+s[h],n+s[h+1]);r&&(p=r(p)),o.push(p)}return{objects:o,startOffset:t,endOffset:a}}function Ee(e,t){if(28===t)return e.parseByte()<<8|e.parseByte();if(29===t)return e.parseByte()<<24|e.parseByte()<<16|e.parseByte()<<8|e.parseByte();if(30===t)return function(e){for(var t="",r=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var n=e.parseByte(),a=n>>4,s=15&n;if(15===a)break;if(t+=r[a],15===s)break;t+=r[s]}return parseFloat(t)}(e);if(t>=32&&t<=246)return t-139;if(t>=247&&t<=250)return 256*(t-247)+e.parseByte()+108;if(t>=251&&t<=254)return 256*-(t-251)-e.parseByte()-108;throw new Error("Invalid b0 "+t)}function Ie(e,t,r){t=void 0!==t?t:0;var n=new ie.Parser(e,t),a=[],s=[];for(r=void 0!==r?r:e.length;n.relativeOffset<r;){var o=n.parseByte();o<=21?(12===o&&(o=1200+n.parseByte()),a.push([o,s]),s=[]):s.push(Ee(n,o))}return function(e){for(var t={},r=0;r<e.length;r+=1){var n=e[r][0],a=e[r][1],s=void 0;if(s=1===a.length?a[0]:a,t.hasOwnProperty(n)&&!isNaN(t[n]))throw new Error("Object "+t+" already has key "+n);t[n]=s}return t}(a)}function Me(e,t){return t=t<=390?ue[t]:e[t-391]}function Le(e,t,r){for(var n,a={},s=0;s<t.length;s+=1){var o=t[s];if(Array.isArray(o.type)){var i=[];i.length=o.type.length;for(var c=0;c<o.type.length;c++)void 0===(n=void 0!==e[o.op]?e[o.op][c]:void 0)&&(n=void 0!==o.value&&void 0!==o.value[c]?o.value[c]:null),"SID"===o.type[c]&&(n=Me(r,n)),i[c]=n;a[o.name]=i}else void 0===(n=e[o.op])&&(n=void 0!==o.value?o.value:null),"SID"===o.type&&(n=Me(r,n)),a[o.name]=n}return a}var Ce=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],Oe=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function Re(e,t){return Le(Ie(e,0,e.byteLength),Ce,t)}function Ne(e,t,r,n){return Le(Ie(e,t,r),Oe,n)}function Ue(e,t,r,n){for(var a=[],s=0;s<r.length;s+=1){var o=Re(new DataView(new Uint8Array(r[s]).buffer),n);o._subrs=[],o._subrsBias=0;var i=o.private[0],c=o.private[1];if(0!==i&&0!==c){var l=Ne(e,c+t,i,n);if(o._defaultWidthX=l.defaultWidthX,o._nominalWidthX=l.nominalWidthX,0!==l.subrs){var u=ke(e,c+l.subrs+t);o._subrs=u.objects,o._subrsBias=Ae(o._subrs)}o._privateDict=l}a.push(o)}return a}function Pe(e,t,r){var n,a,s,o,i,c,l,u,h=new I,p=[],d=0,f=!1,g=!1,m=0,v=0;if(e.isCIDFont){var y=e.tables.cff.topDict._fdSelect[t.index],b=e.tables.cff.topDict._fdArray[y];i=b._subrs,c=b._subrsBias,l=b._defaultWidthX,u=b._nominalWidthX}else i=e.tables.cff.topDict._subrs,c=e.tables.cff.topDict._subrsBias,l=e.tables.cff.topDict._defaultWidthX,u=e.tables.cff.topDict._nominalWidthX;var x=l;function w(e,t){g&&h.closePath(),h.moveTo(e,t),g=!0}function S(){p.length%2!=0&&!f&&(x=p.shift()+u),d+=p.length>>1,p.length=0,f=!0}return function r(l){for(var y,b,T,F,A,k,E,I,M,L,C,O,R=0;R<l.length;){var N=l[R];switch(R+=1,N){case 1:case 3:case 18:case 23:S();break;case 4:p.length>1&&!f&&(x=p.shift()+u,f=!0),v+=p.pop(),w(m,v);break;case 5:for(;p.length>0;)m+=p.shift(),v+=p.shift(),h.lineTo(m,v);break;case 6:for(;p.length>0&&(m+=p.shift(),h.lineTo(m,v),0!==p.length);)v+=p.shift(),h.lineTo(m,v);break;case 7:for(;p.length>0&&(v+=p.shift(),h.lineTo(m,v),0!==p.length);)m+=p.shift(),h.lineTo(m,v);break;case 8:for(;p.length>0;)n=m+p.shift(),a=v+p.shift(),s=n+p.shift(),o=a+p.shift(),m=s+p.shift(),v=o+p.shift(),h.curveTo(n,a,s,o,m,v);break;case 10:A=p.pop()+c,(k=i[A])&&r(k);break;case 11:return;case 12:switch(N=l[R],R+=1,N){case 35:n=m+p.shift(),a=v+p.shift(),s=n+p.shift(),o=a+p.shift(),E=s+p.shift(),I=o+p.shift(),M=E+p.shift(),L=I+p.shift(),C=M+p.shift(),O=L+p.shift(),m=C+p.shift(),v=O+p.shift(),p.shift(),h.curveTo(n,a,s,o,E,I),h.curveTo(M,L,C,O,m,v);break;case 34:n=m+p.shift(),a=v,s=n+p.shift(),o=a+p.shift(),E=s+p.shift(),I=o,M=E+p.shift(),L=o,C=M+p.shift(),O=v,m=C+p.shift(),h.curveTo(n,a,s,o,E,I),h.curveTo(M,L,C,O,m,v);break;case 36:n=m+p.shift(),a=v+p.shift(),s=n+p.shift(),o=a+p.shift(),E=s+p.shift(),I=o,M=E+p.shift(),L=o,C=M+p.shift(),O=L+p.shift(),m=C+p.shift(),h.curveTo(n,a,s,o,E,I),h.curveTo(M,L,C,O,m,v);break;case 37:n=m+p.shift(),a=v+p.shift(),s=n+p.shift(),o=a+p.shift(),E=s+p.shift(),I=o+p.shift(),M=E+p.shift(),L=I+p.shift(),C=M+p.shift(),O=L+p.shift(),Math.abs(C-m)>Math.abs(O-v)?m=C+p.shift():v=O+p.shift(),h.curveTo(n,a,s,o,E,I),h.curveTo(M,L,C,O,m,v);break;default:console.log("Glyph "+t.index+": unknown operator 1200"+N),p.length=0}break;case 14:p.length>0&&!f&&(x=p.shift()+u,f=!0),g&&(h.closePath(),g=!1);break;case 19:case 20:S(),R+=d+7>>3;break;case 21:p.length>2&&!f&&(x=p.shift()+u,f=!0),v+=p.pop(),w(m+=p.pop(),v);break;case 22:p.length>1&&!f&&(x=p.shift()+u,f=!0),w(m+=p.pop(),v);break;case 24:for(;p.length>2;)n=m+p.shift(),a=v+p.shift(),s=n+p.shift(),o=a+p.shift(),m=s+p.shift(),v=o+p.shift(),h.curveTo(n,a,s,o,m,v);m+=p.shift(),v+=p.shift(),h.lineTo(m,v);break;case 25:for(;p.length>6;)m+=p.shift(),v+=p.shift(),h.lineTo(m,v);n=m+p.shift(),a=v+p.shift(),s=n+p.shift(),o=a+p.shift(),m=s+p.shift(),v=o+p.shift(),h.curveTo(n,a,s,o,m,v);break;case 26:for(p.length%2&&(m+=p.shift());p.length>0;)n=m,a=v+p.shift(),s=n+p.shift(),o=a+p.shift(),m=s,v=o+p.shift(),h.curveTo(n,a,s,o,m,v);break;case 27:for(p.length%2&&(v+=p.shift());p.length>0;)n=m+p.shift(),a=v,s=n+p.shift(),o=a+p.shift(),m=s+p.shift(),v=o,h.curveTo(n,a,s,o,m,v);break;case 28:y=l[R],b=l[R+1],p.push((y<<24|b<<16)>>16),R+=2;break;case 29:A=p.pop()+e.gsubrsBias,(k=e.gsubrs[A])&&r(k);break;case 30:for(;p.length>0&&(n=m,a=v+p.shift(),s=n+p.shift(),o=a+p.shift(),m=s+p.shift(),v=o+(1===p.length?p.shift():0),h.curveTo(n,a,s,o,m,v),0!==p.length);)n=m+p.shift(),a=v,s=n+p.shift(),o=a+p.shift(),v=o+p.shift(),m=s+(1===p.length?p.shift():0),h.curveTo(n,a,s,o,m,v);break;case 31:for(;p.length>0&&(n=m+p.shift(),a=v,s=n+p.shift(),o=a+p.shift(),v=o+p.shift(),m=s+(1===p.length?p.shift():0),h.curveTo(n,a,s,o,m,v),0!==p.length);)n=m,a=v+p.shift(),s=n+p.shift(),o=a+p.shift(),m=s+p.shift(),v=o+(1===p.length?p.shift():0),h.curveTo(n,a,s,o,m,v);break;default:N<32?console.log("Glyph "+t.index+": unknown operator "+N):N<247?p.push(N-139):N<251?(y=l[R],R+=1,p.push(256*(N-247)+y+108)):N<255?(y=l[R],R+=1,p.push(256*-(N-251)-y-108)):(y=l[R],b=l[R+1],T=l[R+2],F=l[R+3],R+=4,p.push((y<<24|b<<16|T<<8|F)/65536))}}}(r),t.advanceWidth=x,h}function De(e,t){var r,n=ue.indexOf(e);return n>=0&&(r=n),(n=t.indexOf(e))>=0?r=n+ue.length:(r=ue.length+t.length,t.push(e)),r}function Be(e,t,r){for(var n={},a=0;a<e.length;a+=1){var s=e[a],o=t[s.name];void 0===o||Fe(o,s.value)||("SID"===s.type&&(o=De(o,r)),n[s.op]={name:s.name,type:s.type,value:o})}return n}function _e(e,t){var r=new $.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=Be(Ce,e,t),r}function Ge(e){var t=new $.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return t.topDicts=[{name:"topDict_0",type:"TABLE",value:e}],t}function He(e){var t=[],r=e.path;t.push({name:"width",type:"NUMBER",value:e.advanceWidth});for(var n=0,a=0,s=0;s<r.commands.length;s+=1){var o=void 0,i=void 0,c=r.commands[s];if("Q"===c.type){var l=1/3,u=2/3;c={type:"C",x:c.x,y:c.y,x1:l*n+u*c.x1,y1:l*a+u*c.y1,x2:l*c.x+u*c.x1,y2:l*c.y+u*c.y1}}if("M"===c.type)o=Math.round(c.x-n),i=Math.round(c.y-a),t.push({name:"dx",type:"NUMBER",value:o}),t.push({name:"dy",type:"NUMBER",value:i}),t.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(c.x),a=Math.round(c.y);else if("L"===c.type)o=Math.round(c.x-n),i=Math.round(c.y-a),t.push({name:"dx",type:"NUMBER",value:o}),t.push({name:"dy",type:"NUMBER",value:i}),t.push({name:"rlineto",type:"OP",value:5}),n=Math.round(c.x),a=Math.round(c.y);else if("C"===c.type){var h=Math.round(c.x1-n),p=Math.round(c.y1-a),d=Math.round(c.x2-c.x1),f=Math.round(c.y2-c.y1);o=Math.round(c.x-c.x2),i=Math.round(c.y-c.y2),t.push({name:"dx1",type:"NUMBER",value:h}),t.push({name:"dy1",type:"NUMBER",value:p}),t.push({name:"dx2",type:"NUMBER",value:d}),t.push({name:"dy2",type:"NUMBER",value:f}),t.push({name:"dx",type:"NUMBER",value:o}),t.push({name:"dy",type:"NUMBER",value:i}),t.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(c.x),a=Math.round(c.y)}}return t.push({name:"endchar",type:"OP",value:14}),t}var Ve={parse:function(e,t,r,n){r.tables.cff={};var a=function(e,t){var r={};return r.formatMajor=ie.getCard8(e,t),r.formatMinor=ie.getCard8(e,t+1),r.size=ie.getCard8(e,t+2),r.offsetSize=ie.getCard8(e,t+3),r.startOffset=t,r.endOffset=t+4,r}(e,t),s=ke(e,a.endOffset,ie.bytesToString),o=ke(e,s.endOffset),i=ke(e,o.endOffset,ie.bytesToString),c=ke(e,i.endOffset);r.gsubrs=c.objects,r.gsubrsBias=Ae(r.gsubrs);var l=Ue(e,t,o.objects,i.objects);if(1!==l.length)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+l.length);var u=l[0];if(r.tables.cff.topDict=u,u._privateDict&&(r.defaultWidthX=u._privateDict.defaultWidthX,r.nominalWidthX=u._privateDict.nominalWidthX),void 0!==u.ros[0]&&void 0!==u.ros[1]&&(r.isCIDFont=!0),r.isCIDFont){var h=u.fdArray,p=u.fdSelect;if(0===h||0===p)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");var d=ke(e,h+=t),f=Ue(e,t,d.objects,i.objects);u._fdArray=f,p+=t,u._fdSelect=function(e,t,r,n){var a,s=[],o=new ie.Parser(e,t),i=o.parseCard8();if(0===i)for(var c=0;c<r;c++){if((a=o.parseCard8())>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+a+" (FD count "+n+")");s.push(a)}else{if(3!==i)throw new Error("CFF Table CID Font FDSelect table has unsupported format "+i);var l,u=o.parseCard16(),h=o.parseCard16();if(0!==h)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+h);for(var p=0;p<u;p++){if(a=o.parseCard8(),l=o.parseCard16(),a>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+a+" (FD count "+n+")");if(l>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+l);for(;h<l;h++)s.push(a);h=l}if(l!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+l)}return s}(e,p,r.numGlyphs,f.length)}var g,m=t+u.private[1],v=Ne(e,m,u.private[0],i.objects);if(r.defaultWidthX=v.defaultWidthX,r.nominalWidthX=v.nominalWidthX,0!==v.subrs){var y=m+v.subrs,b=ke(e,y);r.subrs=b.objects,r.subrsBias=Ae(r.subrs)}else r.subrs=[],r.subrsBias=0;n.lowMemory?(g=function(e,t){var r,n,a=[],s=ie.getCard16(e,t);if(0!==s){var o=ie.getByte(e,t+2);r=t+(s+1)*o+2;for(var i=t+3,c=0;c<s+1;c+=1)a.push(ie.getOffset(e,i,o)),i+=o;n=r+a[s]}else n=t+2;return{offsets:a,startOffset:t,endOffset:n}}(e,t+u.charStrings),r.nGlyphs=g.offsets.length):(g=ke(e,t+u.charStrings),r.nGlyphs=g.objects.length);var x=function(e,t,r,n){var a,s,o=new ie.Parser(e,t);r-=1;var i=[".notdef"],c=o.parseCard8();if(0===c)for(var l=0;l<r;l+=1)a=o.parseSID(),i.push(Me(n,a));else if(1===c)for(;i.length<=r;){a=o.parseSID(),s=o.parseCard8();for(var u=0;u<=s;u+=1)i.push(Me(n,a)),a+=1}else{if(2!==c)throw new Error("Unknown charset format "+c);for(;i.length<=r;){a=o.parseSID(),s=o.parseCard16();for(var h=0;h<=s;h+=1)i.push(Me(n,a)),a+=1}}return i}(e,t+u.charset,r.nGlyphs,i.objects);if(0===u.encoding?r.cffEncoding=new me(he,x):1===u.encoding?r.cffEncoding=new me(pe,x):r.cffEncoding=function(e,t,r){var n,a={},s=new ie.Parser(e,t),o=s.parseCard8();if(0===o)for(var i=s.parseCard8(),c=0;c<i;c+=1)a[n=s.parseCard8()]=c;else{if(1!==o)throw new Error("Unknown encoding format "+o);var l=s.parseCard8();n=1;for(var u=0;u<l;u+=1)for(var h=s.parseCard8(),p=s.parseCard8(),d=h;d<=h+p;d+=1)a[d]=n,n+=1}return new me(a,r)}(e,t+u.encoding,x),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new Te.GlyphSet(r),n.lowMemory)r._push=function(n){var a=function(e,t,r,n,a){var s=ie.getCard16(r,n),o=0;0!==s&&(o=n+(s+1)*ie.getByte(r,n+2)+2);var i=ie.getBytes(r,o+t[e],o+t[e+1]);return a&&(i=a(i)),i}(n,g.offsets,e,t+u.charStrings);r.glyphs.push(n,Te.cffGlyphLoader(r,n,Pe,a))};else for(var w=0;w<r.nGlyphs;w+=1){var S=g.objects[w];r.glyphs.push(w,Te.cffGlyphLoader(r,w,Pe,S))}},make:function(e,t){for(var r,n=new $.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),a=1/t.unitsPerEm,s={version:t.version,fullName:t.fullName,familyName:t.familyName,weight:t.weightName,fontBBox:t.fontBBox||[0,0,0,0],fontMatrix:[a,0,0,a,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},o=[],i=1;i<e.length;i+=1)r=e.get(i),o.push(r.name);var c=[];n.header=new $.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}]),n.nameIndex=function(e){var t=new $.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var r=0;r<e.length;r+=1)t.names.push({name:"name_"+r,type:"NAME",value:e[r]});return t}([t.postScriptName]);var l=_e(s,c);n.topDictIndex=Ge(l),n.globalSubrIndex=new $.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}]),n.charsets=function(e,t){for(var r=new $.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<e.length;n+=1){var a=De(e[n],t);r.fields.push({name:"glyph_"+n,type:"SID",value:a})}return r}(o,c),n.charStringsIndex=function(e){for(var t=new $.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<e.length;r+=1){var n=e.get(r),a=He(n);t.charStrings.push({name:n.name,type:"CHARSTRING",value:a})}return t}(e),n.privateDict=function(e,t){var r=new $.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=Be(Oe,e,t),r}({},c),n.stringIndex=function(e){var t=new $.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var r=0;r<e.length;r+=1)t.strings.push({name:"string_"+r,type:"STRING",value:e[r]});return t}(c);var u=n.header.sizeOf()+n.nameIndex.sizeOf()+n.topDictIndex.sizeOf()+n.stringIndex.sizeOf()+n.globalSubrIndex.sizeOf();return s.charset=u,s.encoding=0,s.charStrings=s.charset+n.charsets.sizeOf(),s.private[1]=s.charStrings+n.charStringsIndex.sizeOf(),l=_e(s,c),n.topDictIndex=Ge(l),n}};var ze={parse:function(e,t){var r={},n=new ie.Parser(e,t);return r.version=n.parseVersion(),r.fontRevision=Math.round(1e3*n.parseFixed())/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),C.argument(1594834165===r.magicNumber,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r},make:function(e){var t=Math.round((new Date).getTime()/1e3)+2082844800,r=t;return e.createdTimestamp&&(r=e.createdTimestamp+2082844800),new $.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:t},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],e)}};var je={parse:function(e,t){var r={},n=new ie.Parser(e,t);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r},make:function(e){return new $.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],e)}};var We={parse:function(e,t,r,n,a,s,o){o.lowMemory?function(e,t,r,n,a){var s,o;e._hmtxTableData={};for(var i=new ie.Parser(t,r),c=0;c<a;c+=1)c<n&&(s=i.parseUShort(),o=i.parseShort()),e._hmtxTableData[c]={advanceWidth:s,leftSideBearing:o}}(e,t,r,n,a):function(e,t,r,n,a){for(var s,o,i=new ie.Parser(e,t),c=0;c<n;c+=1){c<r&&(s=i.parseUShort(),o=i.parseShort());var l=a.get(c);l.advanceWidth=s,l.leftSideBearing=o}}(t,r,n,a,s)},make:function(e){for(var t=new $.Table("hmtx",[]),r=0;r<e.length;r+=1){var n=e.get(r),a=n.advanceWidth||0,s=n.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:a}),t.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:s})}return t}};var Xe={make:function(e){for(var t=new $.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:e.length}]),r="",n=12+4*e.length,a=0;a<e.length;++a){var s=r.indexOf(e[a]);s<0&&(s=r.length,r+=e[a]),t.fields.push({name:"offset "+a,type:"USHORT",value:n+s}),t.fields.push({name:"length "+a,type:"USHORT",value:e[a].length})}return t.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),t},parse:function(e,t){var r=new ie.Parser(e,t),n=r.parseULong();C.argument(1===n,"Unsupported ltag table version."),r.skip("uLong",1);for(var a=r.parseULong(),s=[],o=0;o<a;o++){for(var i="",c=t+r.parseUShort(),l=r.parseUShort(),u=c;u<c+l;++u)i+=String.fromCharCode(e.getInt8(u));s.push(i)}return s}};var qe={parse:function(e,t){var r={},n=new ie.Parser(e,t);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),1===r.version&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r},make:function(e){return new $.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:e}])}},Ke=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Ze={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Qe={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Je={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function $e(e,t,r){switch(e){case 0:if(65535===t)return"und";if(r)return r[t];break;case 1:return Ze[t];case 3:return Je[t]}}var et="utf-16",tt={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},rt={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function nt(e,t,r){switch(e){case 0:return et;case 1:return rt[r]||tt[t];case 3:if(1===t||10===t)return et}}function at(e){var t={};for(var r in e)t[e[r]]=parseInt(r);return t}function st(e,t,r,n,a,s){return new $.Record("NameRecord",[{name:"platformID",type:"USHORT",value:e},{name:"encodingID",type:"USHORT",value:t},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:a},{name:"offset",type:"USHORT",value:s}])}function ot(e,t){var r=function(e,t){var r=e.length,n=t.length-r+1;e:for(var a=0;a<n;a++)for(;a<n;a++){for(var s=0;s<r;s++)if(t[a+s]!==e[s])continue e;return a}return-1}(e,t);if(r<0){r=t.length;for(var n=0,a=e.length;n<a;++n)t.push(e[n])}return r}var it={parse:function(e,t,r){for(var n={},a=new ie.Parser(e,t),s=a.parseUShort(),o=a.parseUShort(),i=a.offset+a.parseUShort(),c=0;c<o;c++){var l=a.parseUShort(),u=a.parseUShort(),h=a.parseUShort(),p=a.parseUShort(),d=Ke[p]||p,f=a.parseUShort(),g=a.parseUShort(),m=$e(l,h,r),v=nt(l,u,h);if(void 0!==v&&void 0!==m){var y=void 0;if(y=v===et?R.UTF16(e,i+g,f):R.MACSTRING(e,i+g,f,v)){var b=n[d];void 0===b&&(b=n[d]={}),b[m]=y}}}return 1===s&&a.parseUShort(),n},make:function(e,t){var r,n=[],a={},s=at(Ke);for(var o in e){var i=s[o];if(void 0===i&&(i=o),r=parseInt(i),isNaN(r))throw new Error('Name table entry "'+o+'" does not exist, see nameTableNames for complete list.');a[r]=e[o],n.push(r)}for(var c=at(Ze),l=at(Je),u=[],h=[],p=0;p<n.length;p++){var d=a[r=n[p]];for(var f in d){var g=d[f],m=1,v=c[f],y=Qe[v],b=nt(m,y,v),x=N.MACSTRING(g,b);void 0===x&&(m=0,(v=t.indexOf(f))<0&&(v=t.length,t.push(f)),y=4,x=N.UTF16(g));var w=ot(x,h);u.push(st(m,y,v,r,x.length,w));var S=l[f];if(void 0!==S){var T=N.UTF16(g),F=ot(T,h);u.push(st(3,1,S,r,T.length,F))}}}u.sort((function(e,t){return e.platformID-t.platformID||e.encodingID-t.encodingID||e.languageID-t.languageID||e.nameID-t.nameID}));for(var A=new $.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:u.length},{name:"stringOffset",type:"USHORT",value:6+12*u.length}]),k=0;k<u.length;k++)A.fields.push({name:"record_"+k,type:"RECORD",value:u[k]});return A.fields.push({name:"strings",type:"LITERAL",value:h}),A}},ct=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];var lt={parse:function(e,t){var r={},n=new ie.Parser(e,t);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var a=0;a<10;a++)r.panose[a]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r},make:function(e){return new $.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],e)},unicodeRanges:ct,getUnicodeRange:function(e){for(var t=0;t<ct.length;t+=1){var r=ct[t];if(e>=r.begin&&e<r.end)return t}return-1}};var ut={parse:function(e,t){var r={},n=new ie.Parser(e,t);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=de.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var a=0;a<r.numberOfGlyphs;a++)r.glyphNameIndex[a]=n.parseUShort();r.names=[];for(var s=0;s<r.numberOfGlyphs;s++)if(r.glyphNameIndex[s]>=de.length){var o=n.parseChar();r.names.push(n.parseString(o))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var i=0;i<r.numberOfGlyphs;i++)r.offset[i]=n.parseChar()}return r},make:function(){return new $.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}},ht=new Array(9);ht[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(se.coverage),deltaGlyphId:this.parseUShort()}:2===t?{substFormat:2,coverage:this.parsePointer(se.coverage),substitute:this.parseOffset16List()}:void C.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},ht[2]=function(){var e=this.parseUShort();return C.argument(1===e,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(se.coverage),sequences:this.parseListOfLists()}},ht[3]=function(){var e=this.parseUShort();return C.argument(1===e,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(se.coverage),alternateSets:this.parseListOfLists()}},ht[4]=function(){var e=this.parseUShort();return C.argument(1===e,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(se.coverage),ligatureSets:this.parseListOfLists((function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}}))}};var pt={sequenceIndex:se.uShort,lookupListIndex:se.uShort};ht[5]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{substFormat:t,coverage:this.parsePointer(se.coverage),ruleSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{input:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,pt)}}))};if(2===t)return{substFormat:t,coverage:this.parsePointer(se.coverage),classDef:this.parsePointer(se.classDef),classSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{classes:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,pt)}}))};if(3===t){var r=this.parseUShort(),n=this.parseUShort();return{substFormat:t,coverages:this.parseList(r,se.pointer(se.coverage)),lookupRecords:this.parseRecordList(n,pt)}}C.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},ht[6]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(se.coverage),chainRuleSets:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(pt)}}))}:2===t?{substFormat:2,coverage:this.parsePointer(se.coverage),backtrackClassDef:this.parsePointer(se.classDef),inputClassDef:this.parsePointer(se.classDef),lookaheadClassDef:this.parsePointer(se.classDef),chainClassSet:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(pt)}}))}:3===t?{substFormat:3,backtrackCoverage:this.parseList(se.pointer(se.coverage)),inputCoverage:this.parseList(se.pointer(se.coverage)),lookaheadCoverage:this.parseList(se.pointer(se.coverage)),lookupRecords:this.parseRecordList(pt)}:void C.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},ht[7]=function(){var e=this.parseUShort();C.argument(1===e,"GSUB Extension Substitution subtable identifier-format must be 1");var t=this.parseUShort(),r=new se(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:t,extension:ht[t].call(r)}},ht[8]=function(){var e=this.parseUShort();return C.argument(1===e,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(se.coverage),backtrackCoverage:this.parseList(se.pointer(se.coverage)),lookaheadCoverage:this.parseList(se.pointer(se.coverage)),substitutes:this.parseUShortList()}};var dt=new Array(9);dt[1]=function(e){return 1===e.substFormat?new $.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new $.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)}].concat($.ushortList("substitute",e.substitute)))},dt[3]=function(e){return C.assert(1===e.substFormat,"Lookup type 3 substFormat must be 1."),new $.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)}].concat($.tableList("altSet",e.alternateSets,(function(e){return new $.Table("alternateSetTable",$.ushortList("alternate",e))}))))},dt[4]=function(e){return C.assert(1===e.substFormat,"Lookup type 4 substFormat must be 1."),new $.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)}].concat($.tableList("ligSet",e.ligatureSets,(function(e){return new $.Table("ligatureSetTable",$.tableList("ligature",e,(function(e){return new $.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:e.ligGlyph}].concat($.ushortList("component",e.components,e.components.length+1)))})))}))))};var ft={parse:function(e,t){var r=new se(e,t=t||0),n=r.parseVersion(1);return C.argument(1===n||1.1===n,"Unsupported GSUB table version."),1===n?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(ht)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(ht),variations:r.parseFeatureVariationsList()}},make:function(e){return new $.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new $.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new $.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new $.LookupList(e.lookups,dt)}])}};var gt={parse:function(e,t){var r=new ie.Parser(e,t),n=r.parseULong();C.argument(1===n,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var a=r.parseULong(),s={},o=0;o<a;o++){var i=r.parseTag(),c=r.parseULong(),l=r.parseULong(),u=R.UTF8(e,t+c,l);s[i]=u}return s},make:function(e){var t=Object.keys(e).length,r="",n=16+12*t,a=new $.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:t}]);for(var s in e){var o=r.length;r+=e[s],a.fields.push({name:"tag "+s,type:"TAG",value:s}),a.fields.push({name:"offset "+s,type:"ULONG",value:n+o}),a.fields.push({name:"length "+s,type:"ULONG",value:e[s].length})}return a.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),a}};function mt(e){return Math.log(e)/Math.log(2)|0}function vt(e){for(;e.length%4!=0;)e.push(0);for(var t=0,r=0;r<e.length;r+=4)t+=(e[r]<<24)+(e[r+1]<<16)+(e[r+2]<<8)+e[r+3];return t%=Math.pow(2,32)}function yt(e,t,r,n){return new $.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==e?e:""},{name:"checkSum",type:"ULONG",value:void 0!==t?t:0},{name:"offset",type:"ULONG",value:void 0!==r?r:0},{name:"length",type:"ULONG",value:void 0!==n?n:0}])}function bt(e){var t=new $.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.tables=e,t.numTables=e.length;var r=Math.pow(2,mt(t.numTables));t.searchRange=16*r,t.entrySelector=mt(r),t.rangeShift=16*t.numTables-t.searchRange;for(var n=[],a=[],s=t.sizeOf()+yt().sizeOf()*t.numTables;s%4!=0;)s+=1,a.push({name:"padding",type:"BYTE",value:0});for(var o=0;o<e.length;o+=1){var i=e[o];C.argument(4===i.tableName.length,"Table name"+i.tableName+" is invalid.");var c=i.sizeOf(),l=yt(i.tableName,vt(i.encode()),s,c);for(n.push({name:l.tag+" Table Record",type:"RECORD",value:l}),a.push({name:i.tableName+" table",type:"RECORD",value:i}),s+=c,C.argument(!isNaN(s),"Something went wrong calculating the offset.");s%4!=0;)s+=1,a.push({name:"padding",type:"BYTE",value:0})}return n.sort((function(e,t){return e.value.tag>t.value.tag?1:-1})),t.fields=t.fields.concat(n),t.fields=t.fields.concat(a),t}function xt(e,t,r){for(var n=0;n<t.length;n+=1){var a=e.charToGlyphIndex(t[n]);if(a>0)return e.glyphs.get(a).getMetrics()}return r}function wt(e){for(var t=0,r=0;r<e.length;r+=1)t+=e[r];return t/e.length}var St={make:bt,fontToTable:function(e){for(var t,r=[],n=[],a=[],s=[],o=[],i=[],c=[],l=0,u=0,h=0,p=0,d=0,f=0;f<e.glyphs.length;f+=1){var g=e.glyphs.get(f),m=0|g.unicode;if(isNaN(g.advanceWidth))throw new Error("Glyph "+g.name+" ("+f+"): advanceWidth is not a number.");(t>m||void 0===t)&&m>0&&(t=m),l<m&&(l=m);var v=lt.getUnicodeRange(m);if(v<32)u|=1<<v;else if(v<64)h|=1<<v-32;else if(v<96)p|=1<<v-64;else{if(!(v<123))throw new Error("Unicode ranges bits > 123 are reserved for internal usage");d|=1<<v-96}if(".notdef"!==g.name){var y=g.getMetrics();r.push(y.xMin),n.push(y.yMin),a.push(y.xMax),s.push(y.yMax),i.push(y.leftSideBearing),c.push(y.rightSideBearing),o.push(g.advanceWidth)}}var b={xMin:Math.min.apply(null,r),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,a),yMax:Math.max.apply(null,s),advanceWidthMax:Math.max.apply(null,o),advanceWidthAvg:wt(o),minLeftSideBearing:Math.min.apply(null,i),maxLeftSideBearing:Math.max.apply(null,i),minRightSideBearing:Math.min.apply(null,c)};b.ascender=e.ascender,b.descender=e.descender;var x=ze.make({flags:3,unitsPerEm:e.unitsPerEm,xMin:b.xMin,yMin:b.yMin,xMax:b.xMax,yMax:b.yMax,lowestRecPPEM:3,createdTimestamp:e.createdTimestamp}),w=je.make({ascender:b.ascender,descender:b.descender,advanceWidthMax:b.advanceWidthMax,minLeftSideBearing:b.minLeftSideBearing,minRightSideBearing:b.minRightSideBearing,xMaxExtent:b.maxLeftSideBearing+(b.xMax-b.xMin),numberOfHMetrics:e.glyphs.length}),S=qe.make(e.glyphs.length),T=lt.make(Object.assign({xAvgCharWidth:Math.round(b.advanceWidthAvg),usFirstCharIndex:t,usLastCharIndex:l,ulUnicodeRange1:u,ulUnicodeRange2:h,ulUnicodeRange3:p,ulUnicodeRange4:d,sTypoAscender:b.ascender,sTypoDescender:b.descender,sTypoLineGap:0,usWinAscent:b.yMax,usWinDescent:Math.abs(b.yMin),ulCodePageRange1:1,sxHeight:xt(e,"xyvw",{yMax:Math.round(b.ascender/2)}).yMax,sCapHeight:xt(e,"HIKLEFJMNTZBDPRAGOQSUVWXY",b).yMax,usDefaultChar:e.hasChar(" ")?32:0,usBreakChar:e.hasChar(" ")?32:0},e.tables.os2)),F=We.make(e.glyphs),A=le.make(e.glyphs),k=e.getEnglishName("fontFamily"),E=e.getEnglishName("fontSubfamily"),I=k+" "+E,M=e.getEnglishName("postScriptName");M||(M=k.replace(/\s/g,"")+"-"+E);var L={};for(var C in e.names)L[C]=e.names[C];L.uniqueID||(L.uniqueID={en:e.getEnglishName("manufacturer")+":"+I}),L.postScriptName||(L.postScriptName={en:M}),L.preferredFamily||(L.preferredFamily=e.names.fontFamily),L.preferredSubfamily||(L.preferredSubfamily=e.names.fontSubfamily);var O=[],R=it.make(L,O),N=O.length>0?Xe.make(O):void 0,U=ut.make(),P=Ve.make(e.glyphs,{version:e.getEnglishName("version"),fullName:I,familyName:k,weightName:E,postScriptName:M,unitsPerEm:e.unitsPerEm,fontBBox:[0,b.yMin,b.ascender,b.advanceWidthMax]}),D=e.metas&&Object.keys(e.metas).length>0?gt.make(e.metas):void 0,B=[x,w,S,T,R,A,U,P,F];N&&B.push(N),e.tables.gsub&&B.push(ft.make(e.tables.gsub)),D&&B.push(D);for(var _=bt(B),G=vt(_.encode()),H=_.fields,V=!1,z=0;z<H.length;z+=1)if("head table"===H[z].name){H[z].value.checkSumAdjustment=2981146554-G,V=!0;break}if(!V)throw new Error("Could not find head table with checkSum to adjust.");return _},computeCheckSum:vt};function Tt(e,t){for(var r=0,n=e.length-1;r<=n;){var a=r+n>>>1,s=e[a].tag;if(s===t)return a;s<t?r=a+1:n=a-1}return-r-1}function Ft(e,t){for(var r=0,n=e.length-1;r<=n;){var a=r+n>>>1,s=e[a];if(s===t)return a;s<t?r=a+1:n=a-1}return-r-1}function At(e,t){for(var r,n=0,a=e.length-1;n<=a;){var s=n+a>>>1,o=(r=e[s]).start;if(o===t)return r;o<t?n=s+1:a=s-1}if(n>0)return t>(r=e[n-1]).end?0:r}function kt(e,t){this.font=e,this.tableName=t}function Et(e){kt.call(this,e,"gpos")}function It(e){kt.call(this,e,"gsub")}function Mt(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Lt(e,t,r){for(var n=e.subtables,a=0;a<n.length;a++){var s=n[a];if(s.substFormat===t)return s}if(r)return n.push(r),r}function Ct(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;++n)r[n]=e[n];return t}function Ot(e,t){if(!e)throw t}function Rt(e,t,r,n,a){var s;return(t&n)>0?(s=e.parseByte(),0==(t&a)&&(s=-s),s=r+s):s=(t&a)>0?r:r+e.parseShort(),s}function Nt(e,t,r){var n,a,s=new ie.Parser(t,r);if(e.numberOfContours=s.parseShort(),e._xMin=s.parseShort(),e._yMin=s.parseShort(),e._xMax=s.parseShort(),e._yMax=s.parseShort(),e.numberOfContours>0){for(var o=e.endPointIndices=[],i=0;i<e.numberOfContours;i+=1)o.push(s.parseUShort());e.instructionLength=s.parseUShort(),e.instructions=[];for(var c=0;c<e.instructionLength;c+=1)e.instructions.push(s.parseByte());var l=o[o.length-1]+1;n=[];for(var u=0;u<l;u+=1)if(a=s.parseByte(),n.push(a),(8&a)>0)for(var h=s.parseByte(),p=0;p<h;p+=1)n.push(a),u+=1;if(C.argument(n.length===l,"Bad flags."),o.length>0){var d,f=[];if(l>0){for(var g=0;g<l;g+=1)a=n[g],(d={}).onCurve=!!(1&a),d.lastPointOfContour=o.indexOf(g)>=0,f.push(d);for(var m=0,v=0;v<l;v+=1)a=n[v],(d=f[v]).x=Rt(s,a,m,2,16),m=d.x;for(var y=0,b=0;b<l;b+=1)a=n[b],(d=f[b]).y=Rt(s,a,y,4,32),y=d.y}e.points=f}else e.points=[]}else if(0===e.numberOfContours)e.points=[];else{e.isComposite=!0,e.points=[],e.components=[];for(var x=!0;x;){n=s.parseUShort();var w={glyphIndex:s.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(1&n)>0?(2&n)>0?(w.dx=s.parseShort(),w.dy=s.parseShort()):w.matchedPoints=[s.parseUShort(),s.parseUShort()]:(2&n)>0?(w.dx=s.parseChar(),w.dy=s.parseChar()):w.matchedPoints=[s.parseByte(),s.parseByte()],(8&n)>0?w.xScale=w.yScale=s.parseF2Dot14():(64&n)>0?(w.xScale=s.parseF2Dot14(),w.yScale=s.parseF2Dot14()):(128&n)>0&&(w.xScale=s.parseF2Dot14(),w.scale01=s.parseF2Dot14(),w.scale10=s.parseF2Dot14(),w.yScale=s.parseF2Dot14()),e.components.push(w),x=!!(32&n)}if(256&n){e.instructionLength=s.parseUShort(),e.instructions=[];for(var S=0;S<e.instructionLength;S+=1)e.instructions.push(s.parseByte())}}}function Ut(e,t){for(var r=[],n=0;n<e.length;n+=1){var a=e[n],s={x:t.xScale*a.x+t.scale01*a.y+t.dx,y:t.scale10*a.x+t.yScale*a.y+t.dy,onCurve:a.onCurve,lastPointOfContour:a.lastPointOfContour};r.push(s)}return r}function Pt(e){var t=new I;if(!e)return t;for(var r=function(e){for(var t=[],r=[],n=0;n<e.length;n+=1){var a=e[n];r.push(a),a.lastPointOfContour&&(t.push(r),r=[])}return C.argument(0===r.length,"There are still points left in the current contour."),t}(e),n=0;n<r.length;++n){var a=r[n],s=null,o=a[a.length-1],i=a[0];if(o.onCurve)t.moveTo(o.x,o.y);else if(i.onCurve)t.moveTo(i.x,i.y);else{var c={x:.5*(o.x+i.x),y:.5*(o.y+i.y)};t.moveTo(c.x,c.y)}for(var l=0;l<a.length;++l)if(s=o,o=i,i=a[(l+1)%a.length],o.onCurve)t.lineTo(o.x,o.y);else{var u=i;s.onCurve||(o.x,s.x,o.y,s.y),i.onCurve||(u={x:.5*(o.x+i.x),y:.5*(o.y+i.y)}),t.quadraticCurveTo(o.x,o.y,u.x,u.y)}t.closePath()}return t}function Dt(e,t){if(t.isComposite)for(var r=0;r<t.components.length;r+=1){var n=t.components[r],a=e.get(n.glyphIndex);if(a.getPath(),a.points){var s=void 0;if(void 0===n.matchedPoints)s=Ut(a.points,n);else{if(n.matchedPoints[0]>t.points.length-1||n.matchedPoints[1]>a.points.length-1)throw Error("Matched points out of range in "+t.name);var o=t.points[n.matchedPoints[0]],i=a.points[n.matchedPoints[1]],c={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};i=Ut([i],c)[0],c.dx=o.x-i.x,c.dy=o.y-i.y,s=Ut(a.points,c)}t.points=t.points.concat(s)}}return Pt(t.points)}kt.prototype={searchTag:Tt,binSearch:Ft,getTable:function(e){var t=this.font.tables[this.tableName];return!t&&e&&(t=this.font.tables[this.tableName]=this.createDefaultTable()),t},getScriptNames:function(){var e=this.getTable();return e?e.scripts.map((function(e){return e.tag})):[]},getDefaultScriptName:function(){var e=this.getTable();if(e){for(var t=!1,r=0;r<e.scripts.length;r++){var n=e.scripts[r].tag;if("DFLT"===n)return n;"latn"===n&&(t=!0)}return t?"latn":void 0}},getScriptTable:function(e,t){var r=this.getTable(t);if(r){e=e||"DFLT";var n=r.scripts,a=Tt(r.scripts,e);if(a>=0)return n[a].script;if(t){var s={tag:e,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-a,0,s),s.script}}},getLangSysTable:function(e,t,r){var n=this.getScriptTable(e,r);if(n){if(!t||"dflt"===t||"DFLT"===t)return n.defaultLangSys;var a=Tt(n.langSysRecords,t);if(a>=0)return n.langSysRecords[a].langSys;if(r){var s={tag:t,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-a,0,s),s.langSys}}},getFeatureTable:function(e,t,r,n){var a=this.getLangSysTable(e,t,n);if(a){for(var s,o=a.featureIndexes,i=this.font.tables[this.tableName].features,c=0;c<o.length;c++)if((s=i[o[c]]).tag===r)return s.feature;if(n){var l=i.length;return C.assert(0===l||r>=i[l-1].tag,"Features must be added in alphabetical order."),s={tag:r,feature:{params:0,lookupListIndexes:[]}},i.push(s),o.push(l),s.feature}}},getLookupTables:function(e,t,r,n,a){var s=this.getFeatureTable(e,t,r,a),o=[];if(s){for(var i,c=s.lookupListIndexes,l=this.font.tables[this.tableName].lookups,u=0;u<c.length;u++)(i=l[c[u]]).lookupType===n&&o.push(i);if(0===o.length&&a){i={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var h=l.length;return l.push(i),c.push(h),[i]}}return o},getGlyphClass:function(e,t){switch(e.format){case 1:return e.startGlyph<=t&&t<e.startGlyph+e.classes.length?e.classes[t-e.startGlyph]:0;case 2:var r=At(e.ranges,t);return r?r.classId:0}},getCoverageIndex:function(e,t){switch(e.format){case 1:var r=Ft(e.glyphs,t);return r>=0?r:-1;case 2:var n=At(e.ranges,t);return n?n.index+t-n.start:-1}},expandCoverage:function(e){if(1===e.format)return e.glyphs;for(var t=[],r=e.ranges,n=0;n<r.length;n++)for(var a=r[n],s=a.start,o=a.end,i=s;i<=o;i++)t.push(i);return t}},Et.prototype=kt.prototype,Et.prototype.init=function(){var e=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(e)},Et.prototype.getKerningValue=function(e,t,r){for(var n=0;n<e.length;n++)for(var a=e[n].subtables,s=0;s<a.length;s++){var o=a[s],i=this.getCoverageIndex(o.coverage,t);if(!(i<0))switch(o.posFormat){case 1:for(var c=o.pairSets[i],l=0;l<c.length;l++){var u=c[l];if(u.secondGlyph===r)return u.value1&&u.value1.xAdvance||0}break;case 2:var h=this.getGlyphClass(o.classDef1,t),p=this.getGlyphClass(o.classDef2,r),d=o.classRecords[h][p];return d.value1&&d.value1.xAdvance||0}}return 0},Et.prototype.getKerningTables=function(e,t){if(this.font.tables.gpos)return this.getLookupTables(e,t,"kern",2)},It.prototype=kt.prototype,It.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},It.prototype.getSingle=function(e,t,r){for(var n=[],a=this.getLookupTables(t,r,e,1),s=0;s<a.length;s++)for(var o=a[s].subtables,i=0;i<o.length;i++){var c=o[i],l=this.expandCoverage(c.coverage),u=void 0;if(1===c.substFormat){var h=c.deltaGlyphId;for(u=0;u<l.length;u++){var p=l[u];n.push({sub:p,by:p+h})}}else{var d=c.substitute;for(u=0;u<l.length;u++)n.push({sub:l[u],by:d[u]})}}return n},It.prototype.getAlternates=function(e,t,r){for(var n=[],a=this.getLookupTables(t,r,e,3),s=0;s<a.length;s++)for(var o=a[s].subtables,i=0;i<o.length;i++)for(var c=o[i],l=this.expandCoverage(c.coverage),u=c.alternateSets,h=0;h<l.length;h++)n.push({sub:l[h],by:u[h]});return n},It.prototype.getLigatures=function(e,t,r){for(var n=[],a=this.getLookupTables(t,r,e,4),s=0;s<a.length;s++)for(var o=a[s].subtables,i=0;i<o.length;i++)for(var c=o[i],l=this.expandCoverage(c.coverage),u=c.ligatureSets,h=0;h<l.length;h++)for(var p=l[h],d=u[h],f=0;f<d.length;f++){var g=d[f];n.push({sub:[p].concat(g.components),by:g.ligGlyph})}return n},It.prototype.addSingle=function(e,t,r,n){var a=Lt(this.getLookupTables(r,n,e,1,!0)[0],2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});C.assert(1===a.coverage.format,"Ligature: unable to modify coverage table format "+a.coverage.format);var s=t.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.substitute.splice(o,0,0)),a.substitute[o]=t.by},It.prototype.addAlternate=function(e,t,r,n){var a=Lt(this.getLookupTables(r,n,e,3,!0)[0],1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});C.assert(1===a.coverage.format,"Ligature: unable to modify coverage table format "+a.coverage.format);var s=t.sub,o=this.binSearch(a.coverage.glyphs,s);o<0&&(o=-1-o,a.coverage.glyphs.splice(o,0,s),a.alternateSets.splice(o,0,0)),a.alternateSets[o]=t.by},It.prototype.addLigature=function(e,t,r,n){var a=this.getLookupTables(r,n,e,4,!0)[0],s=a.subtables[0];s||(s={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},a.subtables[0]=s),C.assert(1===s.coverage.format,"Ligature: unable to modify coverage table format "+s.coverage.format);var o=t.sub[0],i=t.sub.slice(1),c={ligGlyph:t.by,components:i},l=this.binSearch(s.coverage.glyphs,o);if(l>=0){for(var u=s.ligatureSets[l],h=0;h<u.length;h++)if(Mt(u[h].components,i))return;u.push(c)}else l=-1-l,s.coverage.glyphs.splice(l,0,o),s.ligatureSets.splice(l,0,[c])},It.prototype.getFeature=function(e,t,r){if(/ss\d\d/.test(e))return this.getSingle(e,t,r);switch(e){case"aalt":case"salt":return this.getSingle(e,t,r).concat(this.getAlternates(e,t,r));case"dlig":case"liga":case"rlig":return this.getLigatures(e,t,r)}},It.prototype.add=function(e,t,r,n){if(/ss\d\d/.test(e))return this.addSingle(e,t,r,n);switch(e){case"aalt":case"salt":return"number"==typeof t.by?this.addSingle(e,t,r,n):this.addAlternate(e,t,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(e,t,r,n)}};var Bt,_t,Gt,Ht,Vt={getPath:Pt,parse:function(e,t,r,n,a){return a.lowMemory?function(e,t,r,n){var a=new Te.GlyphSet(n);return n._push=function(s){var o=r[s];o!==r[s+1]?a.push(s,Te.ttfGlyphLoader(n,s,Nt,e,t+o,Dt)):a.push(s,Te.glyphLoader(n,s))},a}(e,t,r,n):function(e,t,r,n){for(var a=new Te.GlyphSet(n),s=0;s<r.length-1;s+=1){var o=r[s];o!==r[s+1]?a.push(s,Te.ttfGlyphLoader(n,s,Nt,e,t+o,Dt)):a.push(s,Te.glyphLoader(n,s))}return a}(e,t,r,n)}};function zt(e){this.font=e,this.getCommands=function(e){return Vt.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function jt(e){return e}function Wt(e){return Math.sign(e)*Math.round(Math.abs(e))}function Xt(e){return Math.sign(e)*Math.round(Math.abs(2*e))/2}function qt(e){return Math.sign(e)*(Math.round(Math.abs(e)+.5)-.5)}function Yt(e){return Math.sign(e)*Math.ceil(Math.abs(e))}function Kt(e){return Math.sign(e)*Math.floor(Math.abs(e))}var Zt=function(e){var t=this.srPeriod,r=this.srPhase,n=1;return e<0&&(e=-e,n=-1),e+=this.srThreshold-r,e=Math.trunc(e/t)*t,(e+=r)<0?r*n:e*n},Qt={x:1,y:0,axis:"x",distance:function(e,t,r,n){return(r?e.xo:e.x)-(n?t.xo:t.x)},interpolate:function(e,t,r,n){var a,s,o,i,c,l,u;if(!n||n===this)return a=e.xo-t.xo,s=e.xo-r.xo,c=t.x-t.xo,l=r.x-r.xo,0===(u=(o=Math.abs(a))+(i=Math.abs(s)))?void(e.x=e.xo+(c+l)/2):void(e.x=e.xo+(c*i+l*o)/u);a=n.distance(e,t,!0,!0),s=n.distance(e,r,!0,!0),c=n.distance(t,t,!1,!0),l=n.distance(r,r,!1,!0),0!==(u=(o=Math.abs(a))+(i=Math.abs(s)))?Qt.setRelative(e,e,(c*i+l*o)/u,n,!0):Qt.setRelative(e,e,(c+l)/2,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(e,t,r,n,a){if(n&&n!==this){var s=a?t.xo:t.x,o=a?t.yo:t.y,i=s+r*n.x,c=o+r*n.y;e.x=i+(e.y-c)/n.normalSlope}else e.x=(a?t.xo:t.x)+r},slope:0,touch:function(e){e.xTouched=!0},touched:function(e){return e.xTouched},untouch:function(e){e.xTouched=!1}},Jt={x:0,y:1,axis:"y",distance:function(e,t,r,n){return(r?e.yo:e.y)-(n?t.yo:t.y)},interpolate:function(e,t,r,n){var a,s,o,i,c,l,u;if(!n||n===this)return a=e.yo-t.yo,s=e.yo-r.yo,c=t.y-t.yo,l=r.y-r.yo,0===(u=(o=Math.abs(a))+(i=Math.abs(s)))?void(e.y=e.yo+(c+l)/2):void(e.y=e.yo+(c*i+l*o)/u);a=n.distance(e,t,!0,!0),s=n.distance(e,r,!0,!0),c=n.distance(t,t,!1,!0),l=n.distance(r,r,!1,!0),0!==(u=(o=Math.abs(a))+(i=Math.abs(s)))?Jt.setRelative(e,e,(c*i+l*o)/u,n,!0):Jt.setRelative(e,e,(c+l)/2,n,!0)},normalSlope:0,setRelative:function(e,t,r,n,a){if(n&&n!==this){var s=a?t.xo:t.x,o=a?t.yo:t.y,i=s+r*n.x,c=o+r*n.y;e.y=c+n.normalSlope*(e.x-i)}else e.y=(a?t.yo:t.y)+r},slope:Number.POSITIVE_INFINITY,touch:function(e){e.yTouched=!0},touched:function(e){return e.yTouched},untouch:function(e){e.yTouched=!1}};function $t(e,t){this.x=e,this.y=t,this.axis=void 0,this.slope=t/e,this.normalSlope=-e/t,Object.freeze(this)}function er(e,t){var r=Math.sqrt(e*e+t*t);return t/=r,1===(e/=r)&&0===t?Qt:0===e&&1===t?Jt:new $t(e,t)}function tr(e,t,r,n){this.x=this.xo=Math.round(64*e)/64,this.y=this.yo=Math.round(64*t)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Object.freeze(Qt),Object.freeze(Jt),$t.prototype.distance=function(e,t,r,n){return this.x*Qt.distance(e,t,r,n)+this.y*Jt.distance(e,t,r,n)},$t.prototype.interpolate=function(e,t,r,n){var a,s,o,i,c,l,u;o=n.distance(e,t,!0,!0),i=n.distance(e,r,!0,!0),a=n.distance(t,t,!1,!0),s=n.distance(r,r,!1,!0),0!==(u=(c=Math.abs(o))+(l=Math.abs(i)))?this.setRelative(e,e,(a*l+s*c)/u,n,!0):this.setRelative(e,e,(a+s)/2,n,!0)},$t.prototype.setRelative=function(e,t,r,n,a){n=n||this;var s=a?t.xo:t.x,o=a?t.yo:t.y,i=s+r*n.x,c=o+r*n.y,l=n.normalSlope,u=this.slope,h=e.x,p=e.y;e.x=(u*h-l*i+c-p)/(u-l),e.y=u*(e.x-h)+p},$t.prototype.touch=function(e){e.xTouched=!0,e.yTouched=!0},tr.prototype.nextTouched=function(e){for(var t=this.nextPointOnContour;!e.touched(t)&&t!==this;)t=t.nextPointOnContour;return t},tr.prototype.prevTouched=function(e){for(var t=this.prevPointOnContour;!e.touched(t)&&t!==this;)t=t.prevPointOnContour;return t};var rr=Object.freeze(new tr(0,0)),nr={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function ar(e,t){switch(this.env=e,this.stack=[],this.prog=t,e){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=Qt,this.round=Wt}}function sr(e){for(var t=e.tZone=new Array(e.gZone.length),r=0;r<t.length;r++)t[r]=new tr(0,0)}function or(e,t){var r,n=e.prog,a=e.ip,s=1;do{if(88===(r=n[++a]))s++;else if(89===r)s--;else if(64===r)a+=n[a+1]+1;else if(65===r)a+=2*n[a+1]+1;else if(r>=176&&r<=183)a+=r-176+1;else if(r>=184&&r<=191)a+=2*(r-184+1);else if(t&&1===s&&27===r)break}while(s>0);e.ip=a}function ir(e,t){r.DEBUG&&console.log(t.step,"SVTCA["+e.axis+"]"),t.fv=t.pv=t.dpv=e}function cr(e,t){r.DEBUG&&console.log(t.step,"SPVTCA["+e.axis+"]"),t.pv=t.dpv=e}function lr(e,t){r.DEBUG&&console.log(t.step,"SFVTCA["+e.axis+"]"),t.fv=e}function ur(e,t){var n,a,s=t.stack,o=s.pop(),i=s.pop(),c=t.z2[o],l=t.z1[i];r.DEBUG&&console.log("SPVTL["+e+"]",o,i),e?(n=c.y-l.y,a=l.x-c.x):(n=l.x-c.x,a=l.y-c.y),t.pv=t.dpv=er(n,a)}function hr(e,t){var n,a,s=t.stack,o=s.pop(),i=s.pop(),c=t.z2[o],l=t.z1[i];r.DEBUG&&console.log("SFVTL["+e+"]",o,i),e?(n=c.y-l.y,a=l.x-c.x):(n=l.x-c.x,a=l.y-c.y),t.fv=er(n,a)}function pr(e){r.DEBUG&&console.log(e.step,"POP[]"),e.stack.pop()}function dr(e,t){var n=t.stack.pop(),a=t.z0[n],s=t.fv,o=t.pv;r.DEBUG&&console.log(t.step,"MDAP["+e+"]",n);var i=o.distance(a,rr);e&&(i=t.round(i)),s.setRelative(a,rr,i,o),s.touch(a),t.rp0=t.rp1=n}function fr(e,t){var n,a,s,o=t.z2,i=o.length-2;r.DEBUG&&console.log(t.step,"IUP["+e.axis+"]");for(var c=0;c<i;c++)n=o[c],e.touched(n)||(a=n.prevTouched(e))!==n&&(a===(s=n.nextTouched(e))&&e.setRelative(n,n,e.distance(a,a,!1,!0),e,!0),e.interpolate(n,a,s,e))}function gr(e,t){for(var n=t.stack,a=e?t.rp1:t.rp2,s=(e?t.z0:t.z1)[a],o=t.fv,i=t.pv,c=t.loop,l=t.z2;c--;){var u=n.pop(),h=l[u],p=i.distance(s,s,!1,!0);o.setRelative(h,h,p,i),o.touch(h),r.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-c)+": ":"")+"SHP["+(e?"rp1":"rp2")+"]",u)}t.loop=1}function mr(e,t){var n=t.stack,a=e?t.rp1:t.rp2,s=(e?t.z0:t.z1)[a],o=t.fv,i=t.pv,c=n.pop(),l=t.z2[t.contours[c]],u=l;r.DEBUG&&console.log(t.step,"SHC["+e+"]",c);var h=i.distance(s,s,!1,!0);do{u!==s&&o.setRelative(u,u,h,i),u=u.nextPointOnContour}while(u!==l)}function vr(e,t){var n,a,s=t.stack,o=e?t.rp1:t.rp2,i=(e?t.z0:t.z1)[o],c=t.fv,l=t.pv,u=s.pop();switch(r.DEBUG&&console.log(t.step,"SHZ["+e+"]",u),u){case 0:n=t.tZone;break;case 1:n=t.gZone;break;default:throw new Error("Invalid zone")}for(var h=l.distance(i,i,!1,!0),p=n.length-2,d=0;d<p;d++)a=n[d],c.setRelative(a,a,h,l)}function yr(e,t){var n=t.stack,a=n.pop()/64,s=n.pop(),o=t.z1[s],i=t.z0[t.rp0],c=t.fv,l=t.pv;c.setRelative(o,i,a,l),c.touch(o),r.DEBUG&&console.log(t.step,"MSIRP["+e+"]",a,s),t.rp1=t.rp0,t.rp2=s,e&&(t.rp0=s)}function br(e,t){var n=t.stack,a=n.pop(),s=n.pop(),o=t.z0[s],i=t.fv,c=t.pv,l=t.cvt[a];r.DEBUG&&console.log(t.step,"MIAP["+e+"]",a,"(",l,")",s);var u=c.distance(o,rr);e&&(Math.abs(u-l)<t.cvCutIn&&(u=l),u=t.round(u)),i.setRelative(o,rr,u,c),0===t.zp0&&(o.xo=o.x,o.yo=o.y),i.touch(o),t.rp0=t.rp1=s}function xr(e,t){var n=t.stack,a=n.pop(),s=t.z2[a];r.DEBUG&&console.log(t.step,"GC["+e+"]",a),n.push(64*t.dpv.distance(s,rr,e,!1))}function wr(e,t){var n=t.stack,a=n.pop(),s=n.pop(),o=t.z1[a],i=t.z0[s],c=t.dpv.distance(i,o,e,e);r.DEBUG&&console.log(t.step,"MD["+e+"]",a,s,"->",c),t.stack.push(Math.round(64*c))}function Sr(e,t){var n=t.stack,a=n.pop(),s=t.fv,o=t.pv,i=t.ppem,c=t.deltaBase+16*(e-1),l=t.deltaShift,u=t.z0;r.DEBUG&&console.log(t.step,"DELTAP["+e+"]",a,n);for(var h=0;h<a;h++){var p=n.pop(),d=n.pop();if(c+((240&d)>>4)===i){var f=(15&d)-8;f>=0&&f++,r.DEBUG&&console.log(t.step,"DELTAPFIX",p,"by",f*l);var g=u[p];s.setRelative(g,g,f*l,o)}}}function Tr(e,t){var n=t.stack,a=n.pop();r.DEBUG&&console.log(t.step,"ROUND[]"),n.push(64*t.round(a/64))}function Fr(e,t){var n=t.stack,a=n.pop(),s=t.ppem,o=t.deltaBase+16*(e-1),i=t.deltaShift;r.DEBUG&&console.log(t.step,"DELTAC["+e+"]",a,n);for(var c=0;c<a;c++){var l=n.pop(),u=n.pop();if(o+((240&u)>>4)===s){var h=(15&u)-8;h>=0&&h++;var p=h*i;r.DEBUG&&console.log(t.step,"DELTACFIX",l,"by",p),t.cvt[l]+=p}}}function Ar(e,t){var n,a,s=t.stack,o=s.pop(),i=s.pop(),c=t.z2[o],l=t.z1[i];r.DEBUG&&console.log(t.step,"SDPVTL["+e+"]",o,i),e?(n=c.y-l.y,a=l.x-c.x):(n=l.x-c.x,a=l.y-c.y),t.dpv=er(n,a)}function kr(e,t){var n=t.stack,a=t.prog,s=t.ip;r.DEBUG&&console.log(t.step,"PUSHB["+e+"]");for(var o=0;o<e;o++)n.push(a[++s]);t.ip=s}function Er(e,t){var n=t.ip,a=t.prog,s=t.stack;r.DEBUG&&console.log(t.ip,"PUSHW["+e+"]");for(var o=0;o<e;o++){var i=a[++n]<<8|a[++n];32768&i&&(i=-(1+(65535^i))),s.push(i)}t.ip=n}function Ir(e,t,n,a,s,o){var i,c,l,u,h=o.stack,p=e&&h.pop(),d=h.pop(),f=o.rp0,g=o.z0[f],m=o.z1[d],v=o.minDis,y=o.fv,b=o.dpv;l=(c=i=b.distance(m,g,!0,!0))>=0?1:-1,c=Math.abs(c),e&&(u=o.cvt[p],a&&Math.abs(c-u)<o.cvCutIn&&(c=u)),n&&c<v&&(c=v),a&&(c=o.round(c)),y.setRelative(m,g,l*c,b),y.touch(m),r.DEBUG&&console.log(o.step,(e?"MIRP[":"MDRP[")+(t?"M":"m")+(n?">":"_")+(a?"R":"_")+(0===s?"Gr":1===s?"Bl":2===s?"Wh":"")+"]",e?p+"("+o.cvt[p]+","+u+")":"",d,"(d =",i,"->",l*c,")"),o.rp1=o.rp0,o.rp2=d,t&&(o.rp0=d)}function Mr(e){this.char=e,this.state={},this.activeState=null}function Lr(e,t,r){this.contextName=r,this.startIndex=e,this.endOffset=t}function Cr(e,t,r){this.contextName=e,this.openRange=null,this.ranges=[],this.checkStart=t,this.checkEnd=r}function Or(e,t){this.context=e,this.index=t,this.length=e.length,this.current=e[t],this.backtrack=e.slice(0,t),this.lookahead=e.slice(t+1)}function Rr(e){this.eventId=e,this.subscribers=[]}function Nr(e){var t=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach((function(e){Object.defineProperty(t.events,e,{value:new Rr(e)})})),e&&r.forEach((function(r){var n=e[r];"function"==typeof n&&t.events[r].subscribe(n)}));["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"].forEach((function(e){t.events[e].subscribe(t.updateContextsRanges)}))}function Ur(e){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],Nr.call(this,e)}function Pr(e){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(e)}function Dr(e){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(e)}function Br(e){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(e)}function _r(e){return/[A-z]/.test(e)}function Gr(e){this.font=e,this.features={}}function Hr(e){this.id=e.id,this.tag=e.tag,this.substitution=e.substitution}function Vr(e,t){if(!e)return-1;switch(t.format){case 1:return t.glyphs.indexOf(e);case 2:for(var r=t.ranges,n=0;n<r.length;n++){var a=r[n];if(e>=a.start&&e<=a.end){var s=e-a.start;return a.index+s}}break;default:return-1}return-1}function zr(e,t){return-1===Vr(e,t.coverage)?null:e+t.deltaGlyphId}function jr(e,t){var r=Vr(e,t.coverage);return-1===r?null:t.substitute[r]}function Wr(e,t){for(var r=[],n=0;n<e.length;n++){var a=e[n],s=t.current,o=Vr(s=Array.isArray(s)?s[0]:s,a);-1!==o&&r.push(o)}return r.length!==e.length?-1:r}function Xr(e,t){var r=t.inputCoverage.length+t.lookaheadCoverage.length+t.backtrackCoverage.length;if(e.context.length<r)return[];var n=Wr(t.inputCoverage,e);if(-1===n)return[];var a=t.inputCoverage.length-1;if(e.lookahead.length<t.lookaheadCoverage.length)return[];for(var s=e.lookahead.slice(a);s.length&&Br(s[0].char);)s.shift();var o=new Or(s,0),i=Wr(t.lookaheadCoverage,o),c=[].concat(e.backtrack);for(c.reverse();c.length&&Br(c[0].char);)c.shift();if(c.length<t.backtrackCoverage.length)return[];var l=new Or(c,0),u=Wr(t.backtrackCoverage,l),h=[];if(n.length===t.inputCoverage.length&&i.length===t.lookaheadCoverage.length&&u.length===t.backtrackCoverage.length)for(var p=0;p<t.lookupRecords.length;p++)for(var d=t.lookupRecords[p].lookupListIndex,f=this.getLookupByIndex(d),g=0;g<f.subtables.length;g++){var m=f.subtables[g],v=this.getLookupMethod(f,m);if("12"===this.getSubstitutionType(f,m))for(var y=0;y<n.length;y++){var b=v(e.get(y));b&&h.push(b)}}return h}function qr(e,t){var r,n=Vr(e.current,t.coverage);if(-1===n)return null;for(var a=t.ligatureSets[n],s=0;s<a.length;s++){r=a[s];for(var o=0;o<r.components.length;o++){if(e.lookahead[o]!==r.components[o])break;if(o===r.components.length-1)return r}}return null}function Yr(e,t){var r=Vr(e,t.coverage);return-1===r?null:t.sequences[r]}zt.prototype.exec=function(e,t){if("number"!=typeof t)throw new Error("Point size is not a number!");if(!(this._errorState>2)){var n=this.font,a=this._prepState;if(!a||a.ppem!==t){var s=this._fpgmState;if(!s){ar.prototype=nr,(s=this._fpgmState=new ar("fpgm",n.tables.fpgm)).funcs=[],s.font=n,r.DEBUG&&(console.log("---EXEC FPGM---"),s.step=-1);try{_t(s)}catch(e){return console.log("Hinting error in FPGM:"+e),void(this._errorState=3)}}ar.prototype=s,(a=this._prepState=new ar("prep",n.tables.prep)).ppem=t;var o=n.tables.cvt;if(o)for(var i=a.cvt=new Array(o.length),c=t/n.unitsPerEm,l=0;l<o.length;l++)i[l]=o[l]*c;else a.cvt=[];r.DEBUG&&(console.log("---EXEC PREP---"),a.step=-1);try{_t(a)}catch(e){this._errorState<2&&console.log("Hinting error in PREP:"+e),this._errorState=2}}if(!(this._errorState>1))try{return Gt(e,a)}catch(e){return this._errorState<1&&(console.log("Hinting error:"+e),console.log("Note: further hinting errors are silenced")),void(this._errorState=1)}}},Gt=function(e,t){var n,a,s,o=t.ppem/t.font.unitsPerEm,i=o,c=e.components;if(ar.prototype=t,c){var l=t.font;a=[],n=[];for(var u=0;u<c.length;u++){var h=c[u],p=l.glyphs.get(h.glyphIndex);s=new ar("glyf",p.instructions),r.DEBUG&&(console.log("---EXEC COMP "+u+"---"),s.step=-1),Ht(p,s,o,i);for(var d=Math.round(h.dx*o),f=Math.round(h.dy*i),g=s.gZone,m=s.contours,v=0;v<g.length;v++){var y=g[v];y.xTouched=y.yTouched=!1,y.xo=y.x=y.x+d,y.yo=y.y=y.y+f}var b=a.length;a.push.apply(a,g);for(var x=0;x<m.length;x++)n.push(m[x]+b)}e.instructions&&!s.inhibitGridFit&&((s=new ar("glyf",e.instructions)).gZone=s.z0=s.z1=s.z2=a,s.contours=n,a.push(new tr(0,0),new tr(Math.round(e.advanceWidth*o),0)),r.DEBUG&&(console.log("---EXEC COMPOSITE---"),s.step=-1),_t(s),a.length-=2)}else s=new ar("glyf",e.instructions),r.DEBUG&&(console.log("---EXEC GLYPH---"),s.step=-1),Ht(e,s,o,i),a=s.gZone;return a},Ht=function(e,t,n,a){for(var s,o,i,c=e.points||[],l=c.length,u=t.gZone=t.z0=t.z1=t.z2=[],h=t.contours=[],p=0;p<l;p++)s=c[p],u[p]=new tr(s.x*n,s.y*a,s.lastPointOfContour,s.onCurve);for(var d=0;d<l;d++)s=u[d],o||(o=s,h.push(d)),s.lastPointOfContour?(s.nextPointOnContour=o,o.prevPointOnContour=s,o=void 0):(i=u[d+1],s.nextPointOnContour=i,i.prevPointOnContour=s);if(!t.inhibitGridFit){if(r.DEBUG){console.log("PROCESSING GLYPH",t.stack);for(var f=0;f<l;f++)console.log(f,u[f].x,u[f].y)}if(u.push(new tr(0,0),new tr(Math.round(e.advanceWidth*n),0)),_t(t),u.length-=2,r.DEBUG){console.log("FINISHED GLYPH",t.stack);for(var g=0;g<l;g++)console.log(g,u[g].x,u[g].y)}}},_t=function(e){var t=e.prog;if(t){var n,a=t.length;for(e.ip=0;e.ip<a;e.ip++){if(r.DEBUG&&e.step++,!(n=Bt[t[e.ip]]))throw new Error("unknown instruction: 0x"+Number(t[e.ip]).toString(16));n(e)}}},Bt=[ir.bind(void 0,Jt),ir.bind(void 0,Qt),cr.bind(void 0,Jt),cr.bind(void 0,Qt),lr.bind(void 0,Jt),lr.bind(void 0,Qt),ur.bind(void 0,0),ur.bind(void 0,1),hr.bind(void 0,0),hr.bind(void 0,1),function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"SPVFS[]",n,a),e.pv=e.dpv=er(a,n)},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"SPVFS[]",n,a),e.fv=er(a,n)},function(e){var t=e.stack,n=e.pv;r.DEBUG&&console.log(e.step,"GPV[]"),t.push(16384*n.x),t.push(16384*n.y)},function(e){var t=e.stack,n=e.fv;r.DEBUG&&console.log(e.step,"GFV[]"),t.push(16384*n.x),t.push(16384*n.y)},function(e){e.fv=e.pv,r.DEBUG&&console.log(e.step,"SFVTPV[]")},function(e){var t=e.stack,n=t.pop(),a=t.pop(),s=t.pop(),o=t.pop(),i=t.pop(),c=e.z0,l=e.z1,u=c[n],h=c[a],p=l[s],d=l[o],f=e.z2[i];r.DEBUG&&console.log("ISECT[], ",n,a,s,o,i);var g=u.x,m=u.y,v=h.x,y=h.y,b=p.x,x=p.y,w=d.x,S=d.y,T=(g-v)*(x-S)-(m-y)*(b-w),F=g*y-m*v,A=b*S-x*w;f.x=(F*(b-w)-A*(g-v))/T,f.y=(F*(x-S)-A*(m-y))/T},function(e){e.rp0=e.stack.pop(),r.DEBUG&&console.log(e.step,"SRP0[]",e.rp0)},function(e){e.rp1=e.stack.pop(),r.DEBUG&&console.log(e.step,"SRP1[]",e.rp1)},function(e){e.rp2=e.stack.pop(),r.DEBUG&&console.log(e.step,"SRP2[]",e.rp2)},function(e){var t=e.stack.pop();switch(r.DEBUG&&console.log(e.step,"SZP0[]",t),e.zp0=t,t){case 0:e.tZone||sr(e),e.z0=e.tZone;break;case 1:e.z0=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var t=e.stack.pop();switch(r.DEBUG&&console.log(e.step,"SZP1[]",t),e.zp1=t,t){case 0:e.tZone||sr(e),e.z1=e.tZone;break;case 1:e.z1=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var t=e.stack.pop();switch(r.DEBUG&&console.log(e.step,"SZP2[]",t),e.zp2=t,t){case 0:e.tZone||sr(e),e.z2=e.tZone;break;case 1:e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var t=e.stack.pop();switch(r.DEBUG&&console.log(e.step,"SZPS[]",t),e.zp0=e.zp1=e.zp2=t,t){case 0:e.tZone||sr(e),e.z0=e.z1=e.z2=e.tZone;break;case 1:e.z0=e.z1=e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){e.loop=e.stack.pop(),r.DEBUG&&console.log(e.step,"SLOOP[]",e.loop)},function(e){r.DEBUG&&console.log(e.step,"RTG[]"),e.round=Wt},function(e){r.DEBUG&&console.log(e.step,"RTHG[]"),e.round=qt},function(e){var t=e.stack.pop();r.DEBUG&&console.log(e.step,"SMD[]",t),e.minDis=t/64},function(e){r.DEBUG&&console.log(e.step,"ELSE[]"),or(e,!1)},function(e){var t=e.stack.pop();r.DEBUG&&console.log(e.step,"JMPR[]",t),e.ip+=t-1},function(e){var t=e.stack.pop();r.DEBUG&&console.log(e.step,"SCVTCI[]",t),e.cvCutIn=t/64},void 0,void 0,function(e){var t=e.stack;r.DEBUG&&console.log(e.step,"DUP[]"),t.push(t[t.length-1])},pr,function(e){r.DEBUG&&console.log(e.step,"CLEAR[]"),e.stack.length=0},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"SWAP[]"),t.push(n),t.push(a)},function(e){var t=e.stack;r.DEBUG&&console.log(e.step,"DEPTH[]"),t.push(t.length)},function(e){var t=e.stack,n=t.pop();r.DEBUG&&console.log(e.step,"CINDEX[]",n),t.push(t[t.length-n])},function(e){var t=e.stack,n=t.pop();r.DEBUG&&console.log(e.step,"MINDEX[]",n),t.push(t.splice(t.length-n,1)[0])},void 0,void 0,void 0,function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"LOOPCALL[]",n,a);var s=e.ip,o=e.prog;e.prog=e.funcs[n];for(var i=0;i<a;i++)_t(e),r.DEBUG&&console.log(++e.step,i+1<a?"next loopcall":"done loopcall",i);e.ip=s,e.prog=o},function(e){var t=e.stack.pop();r.DEBUG&&console.log(e.step,"CALL[]",t);var n=e.ip,a=e.prog;e.prog=e.funcs[t],_t(e),e.ip=n,e.prog=a,r.DEBUG&&console.log(++e.step,"returning from",t)},function(e){if("fpgm"!==e.env)throw new Error("FDEF not allowed here");var t=e.stack,n=e.prog,a=e.ip,s=t.pop(),o=a;for(r.DEBUG&&console.log(e.step,"FDEF[]",s);45!==n[++a];);e.ip=a,e.funcs[s]=n.slice(o+1,a)},void 0,dr.bind(void 0,0),dr.bind(void 0,1),fr.bind(void 0,Jt),fr.bind(void 0,Qt),gr.bind(void 0,0),gr.bind(void 0,1),mr.bind(void 0,0),mr.bind(void 0,1),vr.bind(void 0,0),vr.bind(void 0,1),function(e){for(var t=e.stack,n=e.loop,a=e.fv,s=t.pop()/64,o=e.z2;n--;){var i=t.pop(),c=o[i];r.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-n)+": ":"")+"SHPIX[]",i,s),a.setRelative(c,c,s),a.touch(c)}e.loop=1},function(e){for(var t=e.stack,n=e.rp1,a=e.rp2,s=e.loop,o=e.z0[n],i=e.z1[a],c=e.fv,l=e.dpv,u=e.z2;s--;){var h=t.pop(),p=u[h];r.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-s)+": ":"")+"IP[]",h,n,"<->",a),c.interpolate(p,o,i,l),c.touch(p)}e.loop=1},yr.bind(void 0,0),yr.bind(void 0,1),function(e){for(var t=e.stack,n=e.rp0,a=e.z0[n],s=e.loop,o=e.fv,i=e.pv,c=e.z1;s--;){var l=t.pop(),u=c[l];r.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-s)+": ":"")+"ALIGNRP[]",l),o.setRelative(u,a,0,i),o.touch(u)}e.loop=1},function(e){r.DEBUG&&console.log(e.step,"RTDG[]"),e.round=Xt},br.bind(void 0,0),br.bind(void 0,1),function(e){var t=e.prog,n=e.ip,a=e.stack,s=t[++n];r.DEBUG&&console.log(e.step,"NPUSHB[]",s);for(var o=0;o<s;o++)a.push(t[++n]);e.ip=n},function(e){var t=e.ip,n=e.prog,a=e.stack,s=n[++t];r.DEBUG&&console.log(e.step,"NPUSHW[]",s);for(var o=0;o<s;o++){var i=n[++t]<<8|n[++t];32768&i&&(i=-(1+(65535^i))),a.push(i)}e.ip=t},function(e){var t=e.stack,n=e.store;n||(n=e.store=[]);var a=t.pop(),s=t.pop();r.DEBUG&&console.log(e.step,"WS",a,s),n[s]=a},function(e){var t=e.stack,n=e.store,a=t.pop();r.DEBUG&&console.log(e.step,"RS",a);var s=n&&n[a]||0;t.push(s)},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"WCVTP",n,a),e.cvt[a]=n/64},function(e){var t=e.stack,n=t.pop();r.DEBUG&&console.log(e.step,"RCVT",n),t.push(64*e.cvt[n])},xr.bind(void 0,0),xr.bind(void 0,1),void 0,wr.bind(void 0,0),wr.bind(void 0,1),function(e){r.DEBUG&&console.log(e.step,"MPPEM[]"),e.stack.push(e.ppem)},void 0,function(e){r.DEBUG&&console.log(e.step,"FLIPON[]"),e.autoFlip=!0},void 0,void 0,function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"LT[]",n,a),t.push(a<n?1:0)},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"LTEQ[]",n,a),t.push(a<=n?1:0)},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"GT[]",n,a),t.push(a>n?1:0)},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"GTEQ[]",n,a),t.push(a>=n?1:0)},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"EQ[]",n,a),t.push(n===a?1:0)},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"NEQ[]",n,a),t.push(n!==a?1:0)},function(e){var t=e.stack,n=t.pop();r.DEBUG&&console.log(e.step,"ODD[]",n),t.push(Math.trunc(n)%2?1:0)},function(e){var t=e.stack,n=t.pop();r.DEBUG&&console.log(e.step,"EVEN[]",n),t.push(Math.trunc(n)%2?0:1)},function(e){var t=e.stack.pop();r.DEBUG&&console.log(e.step,"IF[]",t),t||(or(e,!0),r.DEBUG&&console.log(e.step,"EIF[]"))},function(e){r.DEBUG&&console.log(e.step,"EIF[]")},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"AND[]",n,a),t.push(n&&a?1:0)},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"OR[]",n,a),t.push(n||a?1:0)},function(e){var t=e.stack,n=t.pop();r.DEBUG&&console.log(e.step,"NOT[]",n),t.push(n?0:1)},Sr.bind(void 0,1),function(e){var t=e.stack.pop();r.DEBUG&&console.log(e.step,"SDB[]",t),e.deltaBase=t},function(e){var t=e.stack.pop();r.DEBUG&&console.log(e.step,"SDS[]",t),e.deltaShift=Math.pow(.5,t)},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"ADD[]",n,a),t.push(a+n)},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"SUB[]",n,a),t.push(a-n)},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"DIV[]",n,a),t.push(64*a/n)},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"MUL[]",n,a),t.push(a*n/64)},function(e){var t=e.stack,n=t.pop();r.DEBUG&&console.log(e.step,"ABS[]",n),t.push(Math.abs(n))},function(e){var t=e.stack,n=t.pop();r.DEBUG&&console.log(e.step,"NEG[]",n),t.push(-n)},function(e){var t=e.stack,n=t.pop();r.DEBUG&&console.log(e.step,"FLOOR[]",n),t.push(64*Math.floor(n/64))},function(e){var t=e.stack,n=t.pop();r.DEBUG&&console.log(e.step,"CEILING[]",n),t.push(64*Math.ceil(n/64))},Tr.bind(void 0,0),Tr.bind(void 0,1),Tr.bind(void 0,2),Tr.bind(void 0,3),void 0,void 0,void 0,void 0,function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"WCVTF[]",n,a),e.cvt[a]=n*e.ppem/e.font.unitsPerEm},Sr.bind(void 0,2),Sr.bind(void 0,3),Fr.bind(void 0,1),Fr.bind(void 0,2),Fr.bind(void 0,3),function(e){var t,n=e.stack.pop();switch(r.DEBUG&&console.log(e.step,"SROUND[]",n),e.round=Zt,192&n){case 0:t=.5;break;case 64:t=1;break;case 128:t=2;break;default:throw new Error("invalid SROUND value")}switch(e.srPeriod=t,48&n){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*t;break;case 32:e.srPhase=.5*t;break;case 48:e.srPhase=.75*t;break;default:throw new Error("invalid SROUND value")}n&=15,e.srThreshold=0===n?0:(n/8-.5)*t},function(e){var t,n=e.stack.pop();switch(r.DEBUG&&console.log(e.step,"S45ROUND[]",n),e.round=Zt,192&n){case 0:t=Math.sqrt(2)/2;break;case 64:t=Math.sqrt(2);break;case 128:t=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(e.srPeriod=t,48&n){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*t;break;case 32:e.srPhase=.5*t;break;case 48:e.srPhase=.75*t;break;default:throw new Error("invalid S45ROUND value")}n&=15,e.srThreshold=0===n?0:(n/8-.5)*t},void 0,void 0,function(e){r.DEBUG&&console.log(e.step,"ROFF[]"),e.round=jt},void 0,function(e){r.DEBUG&&console.log(e.step,"RUTG[]"),e.round=Yt},function(e){r.DEBUG&&console.log(e.step,"RDTG[]"),e.round=Kt},pr,pr,void 0,void 0,void 0,void 0,void 0,function(e){var t=e.stack.pop();r.DEBUG&&console.log(e.step,"SCANCTRL[]",t)},Ar.bind(void 0,0),Ar.bind(void 0,1),function(e){var t=e.stack,n=t.pop(),a=0;r.DEBUG&&console.log(e.step,"GETINFO[]",n),1&n&&(a=35),32&n&&(a|=4096),t.push(a)},void 0,function(e){var t=e.stack,n=t.pop(),a=t.pop(),s=t.pop();r.DEBUG&&console.log(e.step,"ROLL[]"),t.push(a),t.push(n),t.push(s)},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"MAX[]",n,a),t.push(Math.max(a,n))},function(e){var t=e.stack,n=t.pop(),a=t.pop();r.DEBUG&&console.log(e.step,"MIN[]",n,a),t.push(Math.min(a,n))},function(e){var t=e.stack.pop();r.DEBUG&&console.log(e.step,"SCANTYPE[]",t)},function(e){var t=e.stack.pop(),n=e.stack.pop();switch(r.DEBUG&&console.log(e.step,"INSTCTRL[]",t,n),t){case 1:return void(e.inhibitGridFit=!!n);case 2:return void(e.ignoreCvt=!!n);default:throw new Error("invalid INSTCTRL[] selector")}},void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,kr.bind(void 0,1),kr.bind(void 0,2),kr.bind(void 0,3),kr.bind(void 0,4),kr.bind(void 0,5),kr.bind(void 0,6),kr.bind(void 0,7),kr.bind(void 0,8),Er.bind(void 0,1),Er.bind(void 0,2),Er.bind(void 0,3),Er.bind(void 0,4),Er.bind(void 0,5),Er.bind(void 0,6),Er.bind(void 0,7),Er.bind(void 0,8),Ir.bind(void 0,0,0,0,0,0),Ir.bind(void 0,0,0,0,0,1),Ir.bind(void 0,0,0,0,0,2),Ir.bind(void 0,0,0,0,0,3),Ir.bind(void 0,0,0,0,1,0),Ir.bind(void 0,0,0,0,1,1),Ir.bind(void 0,0,0,0,1,2),Ir.bind(void 0,0,0,0,1,3),Ir.bind(void 0,0,0,1,0,0),Ir.bind(void 0,0,0,1,0,1),Ir.bind(void 0,0,0,1,0,2),Ir.bind(void 0,0,0,1,0,3),Ir.bind(void 0,0,0,1,1,0),Ir.bind(void 0,0,0,1,1,1),Ir.bind(void 0,0,0,1,1,2),Ir.bind(void 0,0,0,1,1,3),Ir.bind(void 0,0,1,0,0,0),Ir.bind(void 0,0,1,0,0,1),Ir.bind(void 0,0,1,0,0,2),Ir.bind(void 0,0,1,0,0,3),Ir.bind(void 0,0,1,0,1,0),Ir.bind(void 0,0,1,0,1,1),Ir.bind(void 0,0,1,0,1,2),Ir.bind(void 0,0,1,0,1,3),Ir.bind(void 0,0,1,1,0,0),Ir.bind(void 0,0,1,1,0,1),Ir.bind(void 0,0,1,1,0,2),Ir.bind(void 0,0,1,1,0,3),Ir.bind(void 0,0,1,1,1,0),Ir.bind(void 0,0,1,1,1,1),Ir.bind(void 0,0,1,1,1,2),Ir.bind(void 0,0,1,1,1,3),Ir.bind(void 0,1,0,0,0,0),Ir.bind(void 0,1,0,0,0,1),Ir.bind(void 0,1,0,0,0,2),Ir.bind(void 0,1,0,0,0,3),Ir.bind(void 0,1,0,0,1,0),Ir.bind(void 0,1,0,0,1,1),Ir.bind(void 0,1,0,0,1,2),Ir.bind(void 0,1,0,0,1,3),Ir.bind(void 0,1,0,1,0,0),Ir.bind(void 0,1,0,1,0,1),Ir.bind(void 0,1,0,1,0,2),Ir.bind(void 0,1,0,1,0,3),Ir.bind(void 0,1,0,1,1,0),Ir.bind(void 0,1,0,1,1,1),Ir.bind(void 0,1,0,1,1,2),Ir.bind(void 0,1,0,1,1,3),Ir.bind(void 0,1,1,0,0,0),Ir.bind(void 0,1,1,0,0,1),Ir.bind(void 0,1,1,0,0,2),Ir.bind(void 0,1,1,0,0,3),Ir.bind(void 0,1,1,0,1,0),Ir.bind(void 0,1,1,0,1,1),Ir.bind(void 0,1,1,0,1,2),Ir.bind(void 0,1,1,0,1,3),Ir.bind(void 0,1,1,1,0,0),Ir.bind(void 0,1,1,1,0,1),Ir.bind(void 0,1,1,1,0,2),Ir.bind(void 0,1,1,1,0,3),Ir.bind(void 0,1,1,1,1,0),Ir.bind(void 0,1,1,1,1,1),Ir.bind(void 0,1,1,1,1,2),Ir.bind(void 0,1,1,1,1,3)],Mr.prototype.setState=function(e,t){return this.state[e]=t,this.activeState={key:e,value:this.state[e]},this.activeState},Mr.prototype.getState=function(e){return this.state[e]||null},Ur.prototype.inboundIndex=function(e){return e>=0&&e<this.tokens.length},Ur.prototype.composeRUD=function(e){var t=this,r=e.map((function(e){return t[e[0]].apply(t,e.slice(1).concat(true))})),n=function(e){return"object"==typeof e&&e.hasOwnProperty("FAIL")};if(r.every(n))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:r.filter(n)};this.dispatch("composeRUD",[r.filter((function(e){return!n(e)}))])},Ur.prototype.replaceRange=function(e,t,r,n){t=null!==t?t:this.tokens.length;var a=r.every((function(e){return e instanceof Mr}));if(!isNaN(e)&&this.inboundIndex(e)&&a){var s=this.tokens.splice.apply(this.tokens,[e,t].concat(r));return n||this.dispatch("replaceToken",[e,t,r]),[s,r]}return{FAIL:"replaceRange: invalid tokens or startIndex."}},Ur.prototype.replaceToken=function(e,t,r){if(!isNaN(e)&&this.inboundIndex(e)&&t instanceof Mr){var n=this.tokens.splice(e,1,t);return r||this.dispatch("replaceToken",[e,t]),[n[0],t]}return{FAIL:"replaceToken: invalid token or index."}},Ur.prototype.removeRange=function(e,t,r){t=isNaN(t)?this.tokens.length:t;var n=this.tokens.splice(e,t);return r||this.dispatch("removeRange",[n,e,t]),n},Ur.prototype.removeToken=function(e,t){if(!isNaN(e)&&this.inboundIndex(e)){var r=this.tokens.splice(e,1);return t||this.dispatch("removeToken",[r,e]),r}return{FAIL:"removeToken: invalid token index."}},Ur.prototype.insertToken=function(e,t,r){return e.every((function(e){return e instanceof Mr}))?(this.tokens.splice.apply(this.tokens,[t,0].concat(e)),r||this.dispatch("insertToken",[e,t]),e):{FAIL:"insertToken: invalid token(s)."}},Ur.prototype.registerModifier=function(e,t,r){this.events.newToken.subscribe((function(n,a){var s=[n,a],o=[n,a];if(null===t||!0===t.apply(this,s)){var i=r.apply(this,o);n.setState(e,i)}})),this.registeredModifiers.push(e)},Rr.prototype.subscribe=function(e){return"function"==typeof e?this.subscribers.push(e)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},Rr.prototype.unsubscribe=function(e){this.subscribers.splice(e,1)},Or.prototype.setCurrentIndex=function(e){this.index=e,this.current=this.context[e],this.backtrack=this.context.slice(0,e),this.lookahead=this.context.slice(e+1)},Or.prototype.get=function(e){switch(!0){case 0===e:return this.current;case e<0&&Math.abs(e)<=this.backtrack.length:return this.backtrack.slice(e)[0];case e>0&&e<=this.lookahead.length:return this.lookahead[e-1];default:return null}},Ur.prototype.rangeToText=function(e){if(e instanceof Lr)return this.getRangeTokens(e).map((function(e){return e.char})).join("")},Ur.prototype.getText=function(){return this.tokens.map((function(e){return e.char})).join("")},Ur.prototype.getContext=function(e){var t=this.registeredContexts[e];return t||null},Ur.prototype.on=function(e,t){var r=this.events[e];return r?r.subscribe(t):null},Ur.prototype.dispatch=function(e,t){var r=this,n=this.events[e];n instanceof Rr&&n.subscribers.forEach((function(e){e.apply(r,t||[])}))},Ur.prototype.registerContextChecker=function(e,t,r){if(this.getContext(e))return{FAIL:"context name '"+e+"' is already registered."};if("function"!=typeof t)return{FAIL:"missing context start check."};if("function"!=typeof r)return{FAIL:"missing context end check."};var n=new Cr(e,t,r);return this.registeredContexts[e]=n,this.contextCheckers.push(n),n},Ur.prototype.getRangeTokens=function(e){var t=e.startIndex+e.endOffset;return[].concat(this.tokens.slice(e.startIndex,t))},Ur.prototype.getContextRanges=function(e){var t=this.getContext(e);return t?t.ranges:{FAIL:"context checker '"+e+"' is not registered."}},Ur.prototype.resetContextsRanges=function(){var e=this.registeredContexts;for(var t in e){if(e.hasOwnProperty(t))e[t].ranges=[]}},Ur.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var e=this.tokens.map((function(e){return e.char})),t=0;t<e.length;t++){var r=new Or(e,t);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])},Ur.prototype.setEndOffset=function(e,t){var r=new Lr(this.getContext(t).openRange.startIndex,e,t),n=this.getContext(t).ranges;return r.rangeId=t+"."+n.length,n.push(r),this.getContext(t).openRange=null,r},Ur.prototype.runContextCheck=function(e){var t=this,r=e.index;this.contextCheckers.forEach((function(n){var a=n.contextName,s=t.getContext(a).openRange;if(!s&&n.checkStart(e)&&(s=new Lr(r,null,a),t.getContext(a).openRange=s,t.dispatch("contextStart",[a,r])),s&&n.checkEnd(e)){var o=r-s.startIndex+1,i=t.setEndOffset(o,a);t.dispatch("contextEnd",[a,i])}}))},Ur.prototype.tokenize=function(e){this.tokens=[],this.resetContextsRanges();var t=Array.from(e);this.dispatch("start");for(var r=0;r<t.length;r++){var n=t[r],a=new Or(t,r);this.dispatch("next",[a]),this.runContextCheck(a);var s=new Mr(n);this.tokens.push(s),this.dispatch("newToken",[s,a])}return this.dispatch("end",[this.tokens]),this.tokens},Gr.prototype.getDefaultScriptFeaturesIndexes=function(){for(var e=this.font.tables.gsub.scripts,t=0;t<e.length;t++){var r=e[t];if("DFLT"===r.tag)return r.script.defaultLangSys.featureIndexes}return[]},Gr.prototype.getScriptFeaturesIndexes=function(e){if(!this.font.tables.gsub)return[];if(!e)return this.getDefaultScriptFeaturesIndexes();for(var t=this.font.tables.gsub.scripts,r=0;r<t.length;r++){var n=t[r];if(n.tag===e&&n.script.defaultLangSys)return n.script.defaultLangSys.featureIndexes;var a=n.langSysRecords;if(a)for(var s=0;s<a.length;s++){var o=a[s];if(o.tag===e)return o.langSys.featureIndexes}}return this.getDefaultScriptFeaturesIndexes()},Gr.prototype.mapTagsToFeatures=function(e,t){for(var r={},n=0;n<e.length;n++){var a=e[n].tag,s=e[n].feature;r[a]=s}this.features[t].tags=r},Gr.prototype.getScriptFeatures=function(e){var t=this.features[e];if(this.features.hasOwnProperty(e))return t;var r=this.getScriptFeaturesIndexes(e);if(!r)return null;var n=this.font.tables.gsub;return t=r.map((function(e){return n.features[e]})),this.features[e]=t,this.mapTagsToFeatures(t,e),t},Gr.prototype.getSubstitutionType=function(e,t){return e.lookupType.toString()+t.substFormat.toString()},Gr.prototype.getLookupMethod=function(e,t){var r=this;switch(this.getSubstitutionType(e,t)){case"11":return function(e){return zr.apply(r,[e,t])};case"12":return function(e){return jr.apply(r,[e,t])};case"63":return function(e){return Xr.apply(r,[e,t])};case"41":return function(e){return qr.apply(r,[e,t])};case"21":return function(e){return Yr.apply(r,[e,t])};default:throw new Error("lookupType: "+e.lookupType+" - substFormat: "+t.substFormat+" is not yet supported")}},Gr.prototype.lookupFeature=function(e){var t=e.contextParams,r=t.index,n=this.getFeature({tag:e.tag,script:e.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+e.tag+"' for script '"+e.script+"'.");for(var a=this.getFeatureLookups(n),s=[].concat(t.context),o=0;o<a.length;o++)for(var i=a[o],c=this.getLookupSubtables(i),l=0;l<c.length;l++){var u=c[l],h=this.getSubstitutionType(i,u),p=this.getLookupMethod(i,u),d=void 0;switch(h){case"11":(d=p(t.current))&&s.splice(r,1,new Hr({id:11,tag:e.tag,substitution:d}));break;case"12":(d=p(t.current))&&s.splice(r,1,new Hr({id:12,tag:e.tag,substitution:d}));break;case"63":d=p(t),Array.isArray(d)&&d.length&&s.splice(r,1,new Hr({id:63,tag:e.tag,substitution:d}));break;case"41":(d=p(t))&&s.splice(r,1,new Hr({id:41,tag:e.tag,substitution:d}));break;case"21":(d=p(t.current))&&s.splice(r,1,new Hr({id:21,tag:e.tag,substitution:d}))}t=new Or(s,r),Array.isArray(d)&&!d.length||(d=null)}return s.length?s:null},Gr.prototype.supports=function(e){if(!e.script)return!1;this.getScriptFeatures(e.script);var t=this.features.hasOwnProperty(e.script);if(!e.tag)return t;var r=this.features[e.script].some((function(t){return t.tag===e.tag}));return t&&r},Gr.prototype.getLookupSubtables=function(e){return e.subtables||null},Gr.prototype.getLookupByIndex=function(e){return this.font.tables.gsub.lookups[e]||null},Gr.prototype.getFeatureLookups=function(e){return e.lookupListIndexes.map(this.getLookupByIndex.bind(this))},Gr.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var t=this.features[e.script];return t?t.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};var Kr={startCheck:function(e){var t=e.current,r=e.get(-1);return null===r&&Pr(t)||!Pr(r)&&Pr(t)},endCheck:function(e){var t=e.get(1);return null===t||!Pr(t)}};var Zr={startCheck:function(e){var t=e.current,r=e.get(-1);return(Pr(t)||Br(t))&&!Pr(r)},endCheck:function(e){var t=e.get(1);switch(!0){case null===t:return!0;case!Pr(t)&&!Br(t):var r=/\s/.test(t);if(!r)return!0;if(r){var n;if(n=e.lookahead.some((function(e){return Pr(e)||Br(e)})),!n)return!0}break;default:return!1}}};var Qr={11:function(e,t,r){t[r].setState(e.tag,e.substitution)},12:function(e,t,r){t[r].setState(e.tag,e.substitution)},63:function(e,t,r){e.substitution.forEach((function(n,a){t[r+a].setState(e.tag,n)}))},41:function(e,t,r){var n=t[r];n.setState(e.tag,e.substitution.ligGlyph);for(var a=e.substitution.components.length,s=0;s<a;s++)(n=t[r+s+1]).setState("deleted",!0)}};function Jr(e,t,r){e instanceof Hr&&Qr[e.id]&&Qr[e.id](e,t,r)}function $r(e){var t=this,r="arab",n=this.featuresTags.arab,a=this.tokenizer.getRangeTokens(e);if(1!==a.length){var s=new Or(a.map((function(e){return e.getState("glyphIndex")})),0),o=new Or(a.map((function(e){return e.char})),0);a.forEach((function(e,i){if(!Br(e.char)){s.setCurrentIndex(i),o.setCurrentIndex(i);var c,l=0;switch(function(e){for(var t=[].concat(e.backtrack),r=t.length-1;r>=0;r--){var n=t[r],a=Dr(n),s=Br(n);if(!a&&!s)return!0;if(a)return!1}return!1}(o)&&(l|=1),function(e){if(Dr(e.current))return!1;for(var t=0;t<e.lookahead.length;t++)if(!Br(e.lookahead[t]))return!0;return!1}(o)&&(l|=2),l){case 1:c="fina";break;case 2:c="init";break;case 3:c="medi"}if(-1!==n.indexOf(c)){var u=t.query.lookupFeature({tag:c,script:r,contextParams:s});if(u instanceof Error)return console.info(u.message);u.forEach((function(e,t){e instanceof Hr&&(Jr(e,a,t),s.context[t]=e.substitution)}))}}}))}}function en(e,t){return new Or(e.map((function(e){return e.activeState.value})),t||0)}function tn(e){var t=this,r=this.tokenizer.getRangeTokens(e),n=en(r);n.context.forEach((function(e,a){n.setCurrentIndex(a);var s=t.query.lookupFeature({tag:"rlig",script:"arab",contextParams:n});s.length&&(s.forEach((function(e){return Jr(e,r,a)})),n=en(r))}))}var rn={startCheck:function(e){var t=e.current,r=e.get(-1);return null===r&&_r(t)||!_r(r)&&_r(t)},endCheck:function(e){var t=e.get(1);return null===t||!_r(t)}};function nn(e,t){return new Or(e.map((function(e){return e.activeState.value})),t||0)}function an(e){var t=this,r=this.tokenizer.getRangeTokens(e),n=nn(r);n.context.forEach((function(e,a){n.setCurrentIndex(a);var s=t.query.lookupFeature({tag:"liga",script:"latn",contextParams:n});s.length&&(s.forEach((function(e){return Jr(e,r,a)})),n=nn(r))}))}function sn(e){this.baseDir=e||"ltr",this.tokenizer=new Ur,this.featuresTags={}}function on(e){var t=this.contextChecks[e+"Check"];return this.tokenizer.registerContextChecker(e,t.startCheck,t.endCheck)}function cn(){return on.call(this,"latinWord"),on.call(this,"arabicWord"),on.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function ln(){var e=this;this.tokenizer.getContextRanges("arabicSentence").forEach((function(t){var r=e.tokenizer.getRangeTokens(t);e.tokenizer.replaceRange(t.startIndex,t.endOffset,r.reverse())}))}function un(){if(-1===this.tokenizer.registeredModifiers.indexOf("glyphIndex"))throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function hn(){var e=this;this.featuresTags.hasOwnProperty("arab")&&(un.call(this),this.tokenizer.getContextRanges("arabicWord").forEach((function(t){$r.call(e,t)})))}function pn(){var e=this,t="arab";this.featuresTags.hasOwnProperty(t)&&(-1!==this.featuresTags.arab.indexOf("rlig")&&(un.call(this),this.tokenizer.getContextRanges("arabicWord").forEach((function(t){tn.call(e,t)}))))}function dn(){var e=this,t="latn";this.featuresTags.hasOwnProperty(t)&&(-1!==this.featuresTags.latn.indexOf("liga")&&(un.call(this),this.tokenizer.getContextRanges("latinWord").forEach((function(t){an.call(e,t)}))))}function fn(e){(e=e||{}).tables=e.tables||{},e.empty||(Ot(e.familyName,"When creating a new Font object, familyName is required."),Ot(e.styleName,"When creating a new Font object, styleName is required."),Ot(e.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Ot(e.ascender,"When creating a new Font object, ascender is required."),Ot(e.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:e.familyName||" "},fontSubfamily:{en:e.styleName||" "},fullName:{en:e.fullName||e.familyName+" "+e.styleName},postScriptName:{en:e.postScriptName||(e.familyName+e.styleName).replace(/\s/g,"")},designer:{en:e.designer||" "},designerURL:{en:e.designerURL||" "},manufacturer:{en:e.manufacturer||" "},manufacturerURL:{en:e.manufacturerURL||" "},license:{en:e.license||" "},licenseURL:{en:e.licenseURL||" "},version:{en:e.version||"Version 0.1"},description:{en:e.description||" "},copyright:{en:e.copyright||" "},trademark:{en:e.trademark||" "}},this.unitsPerEm=e.unitsPerEm||1e3,this.ascender=e.ascender,this.descender=e.descender,this.createdTimestamp=e.createdTimestamp,this.tables=Object.assign(e.tables,{os2:Object.assign({usWeightClass:e.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:e.widthClass||this.usWidthClasses.MEDIUM,fsSelection:e.fsSelection||this.fsSelectionValues.REGULAR},e.tables.os2)})),this.supported=!0,this.glyphs=new Te.GlyphSet(this,e.glyphs||[]),this.encoding=new fe(this),this.position=new Et(this),this.substitution=new It(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){return this._hinting?this._hinting:"truetype"===this.outlinesFormat?this._hinting=new zt(this):void 0}})}function gn(e,t){var r=JSON.stringify(e),n=256;for(var a in t){var s=parseInt(a);if(s&&!(s<256)){if(JSON.stringify(t[a])===r)return s;n<=s&&(n=s+1)}}return t[n]=e,n}function mn(e,t,r){var n=gn(t.name,r);return[{name:"tag_"+e,type:"TAG",value:t.tag},{name:"minValue_"+e,type:"FIXED",value:t.minValue<<16},{name:"defaultValue_"+e,type:"FIXED",value:t.defaultValue<<16},{name:"maxValue_"+e,type:"FIXED",value:t.maxValue<<16},{name:"flags_"+e,type:"USHORT",value:0},{name:"nameID_"+e,type:"USHORT",value:n}]}function vn(e,t,r){var n={},a=new ie.Parser(e,t);return n.tag=a.parseTag(),n.minValue=a.parseFixed(),n.defaultValue=a.parseFixed(),n.maxValue=a.parseFixed(),a.skip("uShort",1),n.name=r[a.parseUShort()]||{},n}function yn(e,t,r,n){for(var a=[{name:"nameID_"+e,type:"USHORT",value:gn(t.name,n)},{name:"flags_"+e,type:"USHORT",value:0}],s=0;s<r.length;++s){var o=r[s].tag;a.push({name:"axis_"+e+" "+o,type:"FIXED",value:t.coordinates[o]<<16})}return a}function bn(e,t,r,n){var a={},s=new ie.Parser(e,t);a.name=n[s.parseUShort()]||{},s.skip("uShort",1),a.coordinates={};for(var o=0;o<r.length;++o)a.coordinates[r[o].tag]=s.parseFixed();return a}sn.prototype.setText=function(e){this.text=e},sn.prototype.contextChecks={latinWordCheck:rn,arabicWordCheck:Kr,arabicSentenceCheck:Zr},sn.prototype.registerFeatures=function(e,t){var r=this,n=t.filter((function(t){return r.query.supports({script:e,tag:t})}));this.featuresTags.hasOwnProperty(e)?this.featuresTags[e]=this.featuresTags[e].concat(n):this.featuresTags[e]=n},sn.prototype.applyFeatures=function(e,t){if(!e)throw new Error("No valid font was provided to apply features");this.query||(this.query=new Gr(e));for(var r=0;r<t.length;r++){var n=t[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}},sn.prototype.registerModifier=function(e,t,r){this.tokenizer.registerModifier(e,t,r)},sn.prototype.checkContextReady=function(e){return!!this.tokenizer.getContext(e)},sn.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(hn.call(this),pn.call(this)),this.checkContextReady("latinWord")&&dn.call(this),this.checkContextReady("arabicSentence")&&ln.call(this)},sn.prototype.processText=function(e){this.text&&this.text===e||(this.setText(e),cn.call(this),this.applyFeaturesToContexts())},sn.prototype.getBidiText=function(e){return this.processText(e),this.tokenizer.getText()},sn.prototype.getTextGlyphs=function(e){this.processText(e);for(var t=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var a=n.activeState.value;t.push(Array.isArray(a)?a[0]:a)}}return t},r.Font=fn,fn.prototype.hasChar=function(e){return null!==this.encoding.charToGlyphIndex(e)},fn.prototype.charToGlyphIndex=function(e){return this.encoding.charToGlyphIndex(e)},fn.prototype.charToGlyph=function(e){var t=this.charToGlyphIndex(e),r=this.glyphs.get(t);return r||(r=this.glyphs.get(0)),r},fn.prototype.updateFeatures=function(e){return this.defaultRenderOptions.features.map((function(t){return"latn"===t.script?{script:"latn",tags:t.tags.filter((function(t){return e[t]}))}:t}))},fn.prototype.stringToGlyphs=function(e,t){var r=this,n=new sn;n.registerModifier("glyphIndex",null,(function(e){return r.charToGlyphIndex(e.char)}));var a=t?this.updateFeatures(t.features):this.defaultRenderOptions.features;n.applyFeatures(this,a);for(var s=n.getTextGlyphs(e),o=s.length,i=new Array(o),c=this.glyphs.get(0),l=0;l<o;l+=1)i[l]=this.glyphs.get(s[l])||c;return i},fn.prototype.nameToGlyphIndex=function(e){return this.glyphNames.nameToGlyphIndex(e)},fn.prototype.nameToGlyph=function(e){var t=this.nameToGlyphIndex(e),r=this.glyphs.get(t);return r||(r=this.glyphs.get(0)),r},fn.prototype.glyphIndexToName=function(e){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(e):""},fn.prototype.getKerningValue=function(e,t){e=e.index||e,t=t.index||t;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,e,t):this.kerningPairs[e+","+t]||0},fn.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},fn.prototype.forEachGlyph=function(e,t,r,n,a,s){t=void 0!==t?t:0,r=void 0!==r?r:0,n=void 0!==n?n:72,a=Object.assign({},this.defaultRenderOptions,a);var o,i=1/this.unitsPerEm*n,c=this.stringToGlyphs(e,a);if(a.kerning){var l=a.script||this.position.getDefaultScriptName();o=this.position.getKerningTables(l,a.language)}for(var u=0;u<c.length;u+=1){var h=c[u];if(s.call(this,h,t,r,n,a),h.advanceWidth&&(t+=h.advanceWidth*i),a.kerning&&u<c.length-1)t+=(o?this.position.getKerningValue(o,h.index,c[u+1].index):this.getKerningValue(h,c[u+1]))*i;a.letterSpacing?t+=a.letterSpacing*n:a.tracking&&(t+=a.tracking/1e3*n)}return t},fn.prototype.getPath=function(e,t,r,n,a){var s=new I;return this.forEachGlyph(e,t,r,n,a,(function(e,t,r,n){var o=e.getPath(t,r,n,a,this);s.extend(o)})),s},fn.prototype.getPaths=function(e,t,r,n,a){var s=[];return this.forEachGlyph(e,t,r,n,a,(function(e,t,r,n){var o=e.getPath(t,r,n,a,this);s.push(o)})),s},fn.prototype.getAdvanceWidth=function(e,t,r){return this.forEachGlyph(e,0,0,t,r,(function(){}))},fn.prototype.draw=function(e,t,r,n,a,s){this.getPath(t,r,n,a,s).draw(e)},fn.prototype.drawPoints=function(e,t,r,n,a,s){this.forEachGlyph(t,r,n,a,s,(function(t,r,n,a){t.drawPoints(e,r,n,a)}))},fn.prototype.drawMetrics=function(e,t,r,n,a,s){this.forEachGlyph(t,r,n,a,s,(function(t,r,n,a){t.drawMetrics(e,r,n,a)}))},fn.prototype.getEnglishName=function(e){var t=this.names[e];if(t)return t.en},fn.prototype.validate=function(){var e=this;function t(t){var r=e.getEnglishName(t);r&&r.trim().length}t("fontFamily"),t("weightName"),t("manufacturer"),t("copyright"),t("version"),this.unitsPerEm},fn.prototype.toTables=function(){return St.fontToTable(this)},fn.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},fn.prototype.toArrayBuffer=function(){for(var e=this.toTables().encode(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e[n];return t},fn.prototype.download=function(t){var r=this.getEnglishName("fontFamily"),n=this.getEnglishName("fontSubfamily");t=t||r.replace(/\s/g,"")+"-"+n+".otf";var a=this.toArrayBuffer();if(void 0!==e._default.polyfill.window)if(e._default.polyfill.window.URL=e._default.polyfill.window.URL||e._default.polyfill.window.webkitURL,e._default.polyfill.window.URL){var s=new DataView(a),o=new e._default.polyfill.Blob([s],{type:"font/opentype"}),i=e._default.polyfill.document.createElement("a");i.href=e._default.polyfill.window.URL.createObjectURL(o),i.download=t;var c=e._default.polyfill.document.createEvent("MouseEvents");c.initEvent("click",!0,!1),i.dispatchEvent(c)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var l=Ye,u=function(e){for(var t=new Buffer(e.byteLength),r=new Uint8Array(e),n=0;n<t.length;++n)t[n]=r[n];return t}(a);l.writeFileSync(t,u)}},fn.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},fn.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},fn.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var xn={make:function(e,t){var r=new $.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:e.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:e.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*e.axes.length}]);r.offsetToData=r.sizeOf();for(var n=0;n<e.axes.length;n++)r.fields=r.fields.concat(mn(n,e.axes[n],t));for(var a=0;a<e.instances.length;a++)r.fields=r.fields.concat(yn(a,e.instances[a],e.axes,t));return r},parse:function(e,t,r){var n=new ie.Parser(e,t),a=n.parseULong();C.argument(65536===a,"Unsupported fvar table version.");var s=n.parseOffset16();n.skip("uShort",1);for(var o=n.parseUShort(),i=n.parseUShort(),c=n.parseUShort(),l=n.parseUShort(),u=[],h=0;h<o;h++)u.push(vn(e,t+s+h*i,r));for(var p=[],d=t+s+o*i,f=0;f<c;f++)p.push(bn(e,d+f*l,u,r));return{axes:u,instances:p}}},wn=new Array(10);wn[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{posFormat:1,coverage:this.parsePointer(se.coverage),value:this.parseValueRecord()}:2===t?{posFormat:2,coverage:this.parsePointer(se.coverage),values:this.parseValueRecordList()}:void C.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},wn[2]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();C.assert(1===t||2===t,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var r=this.parsePointer(se.coverage),n=this.parseUShort(),a=this.parseUShort();if(1===t)return{posFormat:t,coverage:r,valueFormat1:n,valueFormat2:a,pairSets:this.parseList(se.pointer(se.list((function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(n),value2:this.parseValueRecord(a)}}))))};if(2===t){var s=this.parsePointer(se.classDef),o=this.parsePointer(se.classDef),i=this.parseUShort(),c=this.parseUShort();return{posFormat:t,coverage:r,valueFormat1:n,valueFormat2:a,classDef1:s,classDef2:o,class1Count:i,class2Count:c,classRecords:this.parseList(i,se.list(c,(function(){return{value1:this.parseValueRecord(n),value2:this.parseValueRecord(a)}})))}}},wn[3]=function(){return{error:"GPOS Lookup 3 not supported"}},wn[4]=function(){return{error:"GPOS Lookup 4 not supported"}},wn[5]=function(){return{error:"GPOS Lookup 5 not supported"}},wn[6]=function(){return{error:"GPOS Lookup 6 not supported"}},wn[7]=function(){return{error:"GPOS Lookup 7 not supported"}},wn[8]=function(){return{error:"GPOS Lookup 8 not supported"}},wn[9]=function(){return{error:"GPOS Lookup 9 not supported"}};var Sn=new Array(10);var Tn={parse:function(e,t){var r=new se(e,t=t||0),n=r.parseVersion(1);return C.argument(1===n||1.1===n,"Unsupported GPOS table version "+n),1===n?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(wn)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(wn),variations:r.parseFeatureVariationsList()}},make:function(e){return new $.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new $.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new $.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new $.LookupList(e.lookups,Sn)}])}};var Fn={parse:function(e,t){var r=new ie.Parser(e,t),n=r.parseUShort();if(0===n)return function(e){var t={};e.skip("uShort");var r=e.parseUShort();C.argument(0===r,"Unsupported kern sub-table version."),e.skip("uShort",2);var n=e.parseUShort();e.skip("uShort",3);for(var a=0;a<n;a+=1){var s=e.parseUShort(),o=e.parseUShort(),i=e.parseShort();t[s+","+o]=i}return t}(r);if(1===n)return function(e){var t={};e.skip("uShort"),e.parseULong()>1&&console.warn("Only the first kern subtable is supported."),e.skip("uLong");var r=255&e.parseUShort();if(e.skip("uShort"),0===r){var n=e.parseUShort();e.skip("uShort",3);for(var a=0;a<n;a+=1){var s=e.parseUShort(),o=e.parseUShort(),i=e.parseShort();t[s+","+o]=i}}return t}(r);throw new Error("Unsupported kern table version ("+n+").")}};var An={parse:function(e,t,r,n){for(var a=new ie.Parser(e,t),s=n?a.parseUShort:a.parseULong,o=[],i=0;i<r+1;i+=1){var c=s.call(a);n&&(c*=2),o.push(c)}return o}};function kn(e,t){Ye.readFile(e,(function(e,r){if(e)return t(e.message);t(null,Ct(r))}))}function En(t,r){var n=new e._default.polyfill.XMLHttpRequest;n.open("get",t,!0),n.responseType="arraybuffer",n.onload=function(){return n.response?r(null,n.response):r("Font could not be loaded: "+n.statusText)},n.onerror=function(){r("Font could not be loaded")},n.send()}function In(e,t){for(var r=[],n=12,a=0;a<t;a+=1){var s=ie.getTag(e,n),o=ie.getULong(e,n+4),i=ie.getULong(e,n+8),c=ie.getULong(e,n+12);r.push({tag:s,checksum:o,offset:i,length:c,compression:!1}),n+=16}return r}function Mn(e,t){if("WOFF"===t.compression){var r=new Uint8Array(e.buffer,t.offset+2,t.compressedLength-2),n=new Uint8Array(t.length);if(A(r,n),n.byteLength!==t.length)throw new Error("Decompression error: "+t.tag+" decompressed length doesn't match recorded length");return{data:new DataView(n.buffer,0),offset:0}}return{data:e,offset:t.offset}}function Ln(e,t){var r,n;t=null==t?{}:t;var a,s,o,i,c,l,u,h,p,d,f,g,m=new fn({empty:!0}),v=new DataView(e,0),y=[],b=ie.getTag(v,0);if(b===String.fromCharCode(0,1,0,0)||"true"===b||"typ1"===b)m.outlinesFormat="truetype",y=In(v,a=ie.getUShort(v,4));else if("OTTO"===b)m.outlinesFormat="cff",y=In(v,a=ie.getUShort(v,4));else{if("wOFF"!==b)throw new Error("Unsupported OpenType signature "+b);var x=ie.getTag(v,4);if(x===String.fromCharCode(0,1,0,0))m.outlinesFormat="truetype";else{if("OTTO"!==x)throw new Error("Unsupported OpenType flavor "+b);m.outlinesFormat="cff"}y=function(e,t){for(var r=[],n=44,a=0;a<t;a+=1){var s=ie.getTag(e,n),o=ie.getULong(e,n+4),i=ie.getULong(e,n+8),c=ie.getULong(e,n+12),l=void 0;l=i<c&&"WOFF",r.push({tag:s,offset:o,compression:l,compressedLength:i,length:c}),n+=20}return r}(v,a=ie.getUShort(v,12))}for(var w=0;w<a;w+=1){var S=y[w],T=void 0;switch(S.tag){case"cmap":T=Mn(v,S),m.tables.cmap=le.parse(T.data,T.offset),m.encoding=new ge(m.tables.cmap);break;case"cvt ":T=Mn(v,S),g=new ie.Parser(T.data,T.offset),m.tables.cvt=g.parseShortList(S.length/2);break;case"fvar":o=S;break;case"fpgm":T=Mn(v,S),g=new ie.Parser(T.data,T.offset),m.tables.fpgm=g.parseByteList(S.length);break;case"head":T=Mn(v,S),m.tables.head=ze.parse(T.data,T.offset),m.unitsPerEm=m.tables.head.unitsPerEm,r=m.tables.head.indexToLocFormat;break;case"hhea":T=Mn(v,S),m.tables.hhea=je.parse(T.data,T.offset),m.ascender=m.tables.hhea.ascender,m.descender=m.tables.hhea.descender,m.numberOfHMetrics=m.tables.hhea.numberOfHMetrics;break;case"hmtx":u=S;break;case"ltag":T=Mn(v,S),n=Xe.parse(T.data,T.offset);break;case"maxp":T=Mn(v,S),m.tables.maxp=qe.parse(T.data,T.offset),m.numGlyphs=m.tables.maxp.numGlyphs;break;case"name":d=S;break;case"OS/2":T=Mn(v,S),m.tables.os2=lt.parse(T.data,T.offset);break;case"post":T=Mn(v,S),m.tables.post=ut.parse(T.data,T.offset),m.glyphNames=new ve(m.tables.post);break;case"prep":T=Mn(v,S),g=new ie.Parser(T.data,T.offset),m.tables.prep=g.parseByteList(S.length);break;case"glyf":i=S;break;case"loca":p=S;break;case"CFF ":s=S;break;case"kern":h=S;break;case"GPOS":c=S;break;case"GSUB":l=S;break;case"meta":f=S}}var F=Mn(v,d);if(m.tables.name=it.parse(F.data,F.offset,n),m.names=m.tables.name,i&&p){var A=0===r,k=Mn(v,p),E=An.parse(k.data,k.offset,m.numGlyphs,A),I=Mn(v,i);m.glyphs=Vt.parse(I.data,I.offset,E,m,t)}else{if(!s)throw new Error("Font doesn't contain TrueType or CFF outlines.");var M=Mn(v,s);Ve.parse(M.data,M.offset,m,t)}var L=Mn(v,u);if(We.parse(m,L.data,L.offset,m.numberOfHMetrics,m.numGlyphs,m.glyphs,t),ye(m,t),h){var C=Mn(v,h);m.kerningPairs=Fn.parse(C.data,C.offset)}else m.kerningPairs={};if(c){var O=Mn(v,c);m.tables.gpos=Tn.parse(O.data,O.offset),m.position.init()}if(l){var R=Mn(v,l);m.tables.gsub=ft.parse(R.data,R.offset)}if(o){var N=Mn(v,o);m.tables.fvar=xn.parse(N.data,N.offset,m.names)}if(f){var U=Mn(v,f);m.tables.meta=gt.parse(U.data,U.offset),m.metas=m.tables.meta}return m}function Cn(t,r,n){var a=void 0===e._default.polyfill.window?kn:En;return new Promise((function(e,s){a(t,(function(t,a){if(t){if(r)return r(t);s(t)}var o;try{o=Ln(a,n)}catch(e){if(r)return r(e,null);s(e)}if(r)return r(null,o);e(o)}))}))}function On(e,t){return Ln(Ct(Ye.readFileSync(e)),t)}r.parse=Ln,r.load=Cn,r.loadSync=On;var Rn=Object.freeze({__proto__:null,Font:fn,Glyph:xe,Path:I,BoundingBox:E,_parse:ie,parse:Ln,load:Cn,loadSync:On});r.default=Rn})),Ze=r(Ke);class Qe extends e.Loader{constructor(e){super(e),this.reversed=!1}load(t,r,n,a){const s=this,o=new e.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(e){try{r(s.parse(e))}catch(e){a?a(e):console.error(e),s.manager.itemError(t)}}),n,a)}parse(e){function t(e){const t=[];let r;e.forEach((function(e){"m"===e.type.toLowerCase()?(r=[e],t.push(r)):"z"!==e.type.toLowerCase()&&r.push(e)}));const n=[];return t.forEach((function(e){const t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};n.push(t);for(let t=e.length-1;t>0;t--){const r=e[t],a={type:r.type};void 0!==r.x2&&void 0!==r.y2?(a.x1=r.x2,a.y1=r.y2,a.x2=r.x1,a.y2=r.y1):void 0!==r.x1&&void 0!==r.y1&&(a.x1=r.x1,a.y1=r.y1),a.x=e[t-1].x,a.y=e[t-1].y,n.push(a)}})),n}return void 0===Ze?(console.warn("THREE.TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(e,r){const n=Math.round,a={},s=1e5/(72*(e.unitsPerEm||2048)),o=e.encoding.cmap.glyphIndexMap,i=Object.keys(o);for(let c=0;c<i.length;c++){const l=i[c],u=e.glyphs.glyphs[o[l]];if(void 0!==l){const e={ha:n(u.advanceWidth*s),x_min:n(u.xMin*s),x_max:n(u.xMax*s),o:""};r&&(u.path.commands=t(u.path.commands)),u.path.commands.forEach((function(t){"c"===t.type.toLowerCase()&&(t.type="b"),e.o+=t.type.toLowerCase()+" ",void 0!==t.x&&void 0!==t.y&&(e.o+=n(t.x*s)+" "+n(t.y*s)+" "),void 0!==t.x1&&void 0!==t.y1&&(e.o+=n(t.x1*s)+" "+n(t.y1*s)+" "),void 0!==t.x2&&void 0!==t.y2&&(e.o+=n(t.x2*s)+" "+n(t.y2*s)+" ")})),a[String.fromCodePoint(u.unicode)]=e}}return{glyphs:a,familyName:e.getEnglishName("fullName"),ascender:n(e.ascender*s),descender:n(e.descender*s),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(Ze.parse(e),this.reversed)}}class Je extends e.ExtrudeGeometry{constructor(t,r={}){const n=r.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new e.BufferGeometry;const a=n.generateShapes(t,r.size);r.depth=void 0!==r.height?r.height:50,void 0===r.bevelThickness&&(r.bevelThickness=10),void 0===r.bevelSize&&(r.bevelSize=8),void 0===r.bevelEnabled&&(r.bevelEnabled=!1),super(a,r),this.type="TextGeometry"}}e.Loader;class $e{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){const r=[],n=function(e,t,r){const n=Array.from(e),a=t/r.resolution,s=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*a,o=[];let i=0,c=0;for(let e=0;e<n.length;e++){const t=n[e];if("\n"===t)i=0,c-=s;else{const e=et(t,a,i,c,r);i+=e.offsetX,o.push(e.path)}}return o}(e,t,this.data);for(let e=0,t=n.length;e<t;e++)Array.prototype.push.apply(r,n[e].toShapes());return r}}function et(t,r,n,a,s){const o=s.glyphs[t]||s.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+s.familyName+".");const i=new e.ShapePath;let c,l,u,h,p,d,f,g;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let t=0,s=e.length;t<s;){switch(e[t++]){case"m":c=e[t++]*r+n,l=e[t++]*r+a,i.moveTo(c,l);break;case"l":c=e[t++]*r+n,l=e[t++]*r+a,i.lineTo(c,l);break;case"q":u=e[t++]*r+n,h=e[t++]*r+a,p=e[t++]*r+n,d=e[t++]*r+a,i.quadraticCurveTo(p,d,u,h);break;case"b":u=e[t++]*r+n,h=e[t++]*r+a,p=e[t++]*r+n,d=e[t++]*r+a,f=e[t++]*r+n,g=e[t++]*r+a,i.bezierCurveTo(p,d,f,g,u,h)}}}return{offsetX:o.ha*r,path:i}}$e.prototype.isFont=!0;class tt extends e.Loader{constructor(e){super(e),this.animateBonePositions=!0,this.animateBoneRotations=!0}load(t,r,n,a){const s=this,o=new e.FileLoader(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(t,(function(e){try{r(s.parse(e))}catch(e){a?a(e):console.error(e),s.manager.itemError(t)}}),n,a)}parse(t){function r(t,n,a){if("ENDSITE"===a.type)return;const s={time:n,position:new e.Vector3,rotation:new e.Quaternion};a.frames.push(s);const o=new e.Quaternion,i=new e.Vector3(1,0,0),c=new e.Vector3(0,1,0),l=new e.Vector3(0,0,1);for(let e=0;e<a.channels.length;e++)switch(a.channels[e]){case"Xposition":s.position.x=parseFloat(t.shift().trim());break;case"Yposition":s.position.y=parseFloat(t.shift().trim());break;case"Zposition":s.position.z=parseFloat(t.shift().trim());break;case"Xrotation":o.setFromAxisAngle(i,parseFloat(t.shift().trim())*Math.PI/180),s.rotation.multiply(o);break;case"Yrotation":o.setFromAxisAngle(c,parseFloat(t.shift().trim())*Math.PI/180),s.rotation.multiply(o);break;case"Zrotation":o.setFromAxisAngle(l,parseFloat(t.shift().trim())*Math.PI/180),s.rotation.multiply(o);break;default:console.warn("THREE.BVHLoader: Invalid channel type.")}for(let e=0;e<a.children.length;e++)r(t,n,a.children[e])}function n(t,r,s){const o={name:"",type:"",frames:[]};s.push(o);let i=r.split(/[\s]+/);"END"===i[0].toUpperCase()&&"SITE"===i[1].toUpperCase()?(o.type="ENDSITE",o.name="ENDSITE"):(o.name=i[1],o.type=i[0].toUpperCase()),"{"!==a(t)&&console.error("THREE.BVHLoader: Expected opening { after type & name"),i=a(t).split(/[\s]+/),"OFFSET"!==i[0]&&console.error("THREE.BVHLoader: Expected OFFSET but got: "+i[0]),4!==i.length&&console.error("THREE.BVHLoader: Invalid number of values for OFFSET.");const c=new e.Vector3(parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3]));if((isNaN(c.x)||isNaN(c.y)||isNaN(c.z))&&console.error("THREE.BVHLoader: Invalid values of OFFSET."),o.offset=c,"ENDSITE"!==o.type){i=a(t).split(/[\s]+/),"CHANNELS"!==i[0]&&console.error("THREE.BVHLoader: Expected CHANNELS definition.");const e=parseInt(i[1]);o.channels=i.splice(2,e),o.children=[]}for(;;){const e=a(t);if("}"===e)return o;o.children.push(n(t,e,s))}}function a(e){let t;for(;0===(t=e.shift().trim()).length;);return t}const s=this,o=function(e){"HIERARCHY"!==a(e)&&console.error("THREE.BVHLoader: HIERARCHY expected.");const t=[],s=n(e,a(e),t);"MOTION"!==a(e)&&console.error("THREE.BVHLoader: MOTION expected.");let o=a(e).split(/[\s]+/);const i=parseInt(o[1]);isNaN(i)&&console.error("THREE.BVHLoader: Failed to read number of frames."),o=a(e).split(/[\s]+/);const c=parseFloat(o[2]);isNaN(c)&&console.error("THREE.BVHLoader: Failed to read frame time.");for(let t=0;t<i;t++)o=a(e).split(/[\s]+/),r(o,t*c,s);return t}(t.split(/[\r\n]+/g)),i=[];!function t(r,n){const a=new e.Bone;if(n.push(a),a.position.add(r.offset),a.name=r.name,"ENDSITE"!==r.type)for(let e=0;e<r.children.length;e++)a.add(t(r.children[e],n));return a}(o[0],i);const c=function(t){const r=[];for(let n=0;n<t.length;n++){const a=t[n];if("ENDSITE"===a.type)continue;const o=[],i=[],c=[];for(let e=0;e<a.frames.length;e++){const t=a.frames[e];o.push(t.time),i.push(t.position.x+a.offset.x),i.push(t.position.y+a.offset.y),i.push(t.position.z+a.offset.z),c.push(t.rotation.x),c.push(t.rotation.y),c.push(t.rotation.z),c.push(t.rotation.w)}s.animateBonePositions&&r.push(new e.VectorKeyframeTrack(".bones["+a.name+"].position",o,i)),s.animateBoneRotations&&r.push(new e.QuaternionKeyframeTrack(".bones["+a.name+"].quaternion",o,c))}return new e.AnimationClip("animation",-1,r)}(o);return{skeleton:new e.Skeleton(i),clip:c}}}function rt(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}return r}var nt={},at=function(t){return e._default.polyfill.URL.createObjectURL(new e._default.polyfill.Blob([t],{type:"text/javascript"}))},st=function(e){return new Worker(e)};try{e._default.polyfill.URL.revokeObjectURL(at(""))}catch(e){at=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},st=function(e){return new Worker(e,{type:"module"})}}var ot=Uint8Array,it=Uint16Array,ct=Uint32Array,lt=new ot([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ut=new ot([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ht=new ot([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pt=function(e,t){for(var r=new it(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var a=new ct(r[30]);for(n=1;n<30;++n)for(var s=r[n];s<r[n+1];++s)a[s]=s-r[n]<<5|n;return[r,a]},dt=pt(lt,2),ft=dt[0],gt=dt[1];ft[28]=258,gt[258]=28;for(var mt=pt(ut,0),vt=mt[0],yt=mt[1],bt=new it(32768),xt=0;xt<32768;++xt){var wt=(43690&xt)>>>1|(21845&xt)<<1;wt=(61680&(wt=(52428&wt)>>>2|(13107&wt)<<2))>>>4|(3855&wt)<<4,bt[xt]=((65280&wt)>>>8|(255&wt)<<8)>>>1}var St=function(e,t,r){for(var n=e.length,a=0,s=new it(t);a<n;++a)++s[e[a]-1];var o,i=new it(t);for(a=0;a<t;++a)i[a]=i[a-1]+s[a-1]<<1;if(r){o=new it(1<<t);var c=15-t;for(a=0;a<n;++a)if(e[a])for(var l=a<<4|e[a],u=t-e[a],h=i[e[a]-1]++<<u,p=h|(1<<u)-1;h<=p;++h)o[bt[h]>>>c]=l}else for(o=new it(n),a=0;a<n;++a)e[a]&&(o[a]=bt[i[e[a]-1]++]>>>15-e[a]);return o},Tt=new ot(288);for(xt=0;xt<144;++xt)Tt[xt]=8;for(xt=144;xt<256;++xt)Tt[xt]=9;for(xt=256;xt<280;++xt)Tt[xt]=7;for(xt=280;xt<288;++xt)Tt[xt]=8;var Ft=new ot(32);for(xt=0;xt<32;++xt)Ft[xt]=5;var At=St(Tt,9,0),kt=St(Tt,9,1),Et=St(Ft,5,0),It=St(Ft,5,1),Mt=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Lt=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},Ct=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},Ot=function(e){return(e/8|0)+(7&e&&1)},Rt=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var n=new(e instanceof it?it:e instanceof ct?ct:ot)(r-t);return n.set(e.subarray(t,r)),n},Nt=function(e,t,r){var n=e.length;if(!n||r&&!r.l&&n<5)return t||new ot(0);var a=!t||r,s=!r||r.i;r||(r={}),t||(t=new ot(3*n));var o=function(e){var r=t.length;if(e>r){var n=new ot(Math.max(2*r,e));n.set(t),t=n}},i=r.f||0,c=r.p||0,l=r.b||0,u=r.l,h=r.d,p=r.m,d=r.n,f=8*n;do{if(!u){r.f=i=Lt(e,c,1);var g=Lt(e,c+1,3);if(c+=3,!g){var m=e[(E=Ot(c)+4)-4]|e[E-3]<<8,v=E+m;if(v>n){if(s)throw"unexpected EOF";break}a&&o(l+m),t.set(e.subarray(E,v),l),r.b=l+=m,r.p=c=8*v;continue}if(1==g)u=kt,h=It,p=9,d=5;else{if(2!=g)throw"invalid block type";var y=Lt(e,c,31)+257,b=Lt(e,c+10,15)+4,x=y+Lt(e,c+5,31)+1;c+=14;for(var w=new ot(x),S=new ot(19),T=0;T<b;++T)S[ht[T]]=Lt(e,c+3*T,7);c+=3*b;var F=Mt(S),A=(1<<F)-1,k=St(S,F,1);for(T=0;T<x;){var E,I=k[Lt(e,c,A)];if(c+=15&I,(E=I>>>4)<16)w[T++]=E;else{var M=0,L=0;for(16==E?(L=3+Lt(e,c,3),c+=2,M=w[T-1]):17==E?(L=3+Lt(e,c,7),c+=3):18==E&&(L=11+Lt(e,c,127),c+=7);L--;)w[T++]=M}}var C=w.subarray(0,y),O=w.subarray(y);p=Mt(C),d=Mt(O),u=St(C,p,1),h=St(O,d,1)}if(c>f){if(s)throw"unexpected EOF";break}}a&&o(l+131072);for(var R=(1<<p)-1,N=(1<<d)-1,U=c;;U=c){var P=(M=u[Ct(e,c)&R])>>>4;if((c+=15&M)>f){if(s)throw"unexpected EOF";break}if(!M)throw"invalid length/literal";if(P<256)t[l++]=P;else{if(256==P){U=c,u=null;break}var D=P-254;if(P>264){var B=lt[T=P-257];D=Lt(e,c,(1<<B)-1)+ft[T],c+=B}var _=h[Ct(e,c)&N],G=_>>>4;if(!_)throw"invalid distance";c+=15&_;O=vt[G];if(G>3){B=ut[G];O+=Ct(e,c)&(1<<B)-1,c+=B}if(c>f){if(s)throw"unexpected EOF";break}a&&o(l+131072);for(var H=l+D;l<H;l+=4)t[l]=t[l-O],t[l+1]=t[l+1-O],t[l+2]=t[l+2-O],t[l+3]=t[l+3-O];l=H}}r.l=u,r.p=U,r.b=l,u&&(i=1,r.m=p,r.d=h,r.n=d)}while(!i);return l==t.length?t:Rt(t,0,l)},Ut=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8},Pt=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16},Dt=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var a=r.length,s=r.slice();if(!a)return[jt,0];if(1==a){var o=new ot(r[0].s+1);return o[r[0].s]=1,[o,1]}r.sort((function(e,t){return e.f-t.f})),r.push({s:-1,f:25001});var i=r[0],c=r[1],l=0,u=1,h=2;for(r[0]={s:-1,f:i.f+c.f,l:i,r:c};u!=a-1;)i=r[r[l].f<r[h].f?l++:h++],c=r[l!=u&&r[l].f<r[h].f?l++:h++],r[u++]={s:-1,f:i.f+c.f,l:i,r:c};var p=s[0].s;for(n=1;n<a;++n)s[n].s>p&&(p=s[n].s);var d=new it(p+1),f=Bt(r[u-1],d,0);if(f>t){n=0;var g=0,m=f-t,v=1<<m;for(s.sort((function(e,t){return d[t.s]-d[e.s]||e.f-t.f}));n<a;++n){var y=s[n].s;if(!(d[y]>t))break;g+=v-(1<<f-d[y]),d[y]=t}for(g>>>=m;g>0;){var b=s[n].s;d[b]<t?g-=1<<t-d[b]++-1:++n}for(;n>=0&&g;--n){var x=s[n].s;d[x]==t&&(--d[x],++g)}f=t}return[new ot(d),f]},Bt=function(e,t,r){return-1==e.s?Math.max(Bt(e.l,t,r+1),Bt(e.r,t,r+1)):t[e.s]=r},_t=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new it(++t),n=0,a=e[0],s=1,o=function(e){r[n++]=e},i=1;i<=t;++i)if(e[i]==a&&i!=t)++s;else{if(!a&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(a),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(a);s=1,a=e[i]}return[r.subarray(0,n),t]},Gt=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},Ht=function(e,t,r){var n=r.length,a=Ot(t+2);e[a]=255&n,e[a+1]=n>>>8,e[a+2]=255^e[a],e[a+3]=255^e[a+1];for(var s=0;s<n;++s)e[a+s+4]=r[s];return 8*(a+4+n)},Vt=function(e,t,r,n,a,s,o,i,c,l,u){Ut(t,u++,r),++a[256];for(var h=Dt(a,15),p=h[0],d=h[1],f=Dt(s,15),g=f[0],m=f[1],v=_t(p),y=v[0],b=v[1],x=_t(g),w=x[0],S=x[1],T=new it(19),F=0;F<y.length;++F)T[31&y[F]]++;for(F=0;F<w.length;++F)T[31&w[F]]++;for(var A=Dt(T,7),k=A[0],E=A[1],I=19;I>4&&!k[ht[I-1]];--I);var M,L,C,O,R=l+5<<3,N=Gt(a,Tt)+Gt(s,Ft)+o,U=Gt(a,p)+Gt(s,g)+o+14+3*I+Gt(T,k)+(2*T[16]+3*T[17]+7*T[18]);if(R<=N&&R<=U)return Ht(t,u,e.subarray(c,c+l));if(Ut(t,u,1+(U<N)),u+=2,U<N){M=St(p,d,0),L=p,C=St(g,m,0),O=g;var P=St(k,E,0);Ut(t,u,b-257),Ut(t,u+5,S-1),Ut(t,u+10,I-4),u+=14;for(F=0;F<I;++F)Ut(t,u+3*F,k[ht[F]]);u+=3*I;for(var D=[y,w],B=0;B<2;++B){var _=D[B];for(F=0;F<_.length;++F){var G=31&_[F];Ut(t,u,P[G]),u+=k[G],G>15&&(Ut(t,u,_[F]>>>5&127),u+=_[F]>>>12)}}}else M=At,L=Tt,C=Et,O=Ft;for(F=0;F<i;++F)if(n[F]>255){G=n[F]>>>18&31;Pt(t,u,M[G+257]),u+=L[G+257],G>7&&(Ut(t,u,n[F]>>>23&31),u+=lt[G]);var H=31&n[F];Pt(t,u,C[H]),u+=O[H],H>3&&(Pt(t,u,n[F]>>>5&8191),u+=ut[H])}else Pt(t,u,M[n[F]]),u+=L[n[F]];return Pt(t,u,M[256]),u+L[256]},zt=new ct([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),jt=new ot(0),Wt=function(e,t,r,n,a,s){var o=e.length,i=new ot(n+o+5*(1+Math.ceil(o/7e3))+a),c=i.subarray(n,i.length-a),l=0;if(!t||o<8)for(var u=0;u<=o;u+=65535){var h=u+65535;h<o?l=Ht(c,l,e.subarray(u,h)):(c[u]=s,l=Ht(c,l,e.subarray(u,o)))}else{for(var p=zt[t-1],d=p>>>13,f=8191&p,g=(1<<r)-1,m=new it(32768),v=new it(g+1),y=Math.ceil(r/3),b=2*y,x=function(t){return(e[t]^e[t+1]<<y^e[t+2]<<b)&g},w=new ct(25e3),S=new it(288),T=new it(32),F=0,A=0,k=(u=0,0),E=0,I=0;u<o;++u){var M=x(u),L=32767&u,C=v[M];if(m[L]=C,v[M]=L,E<=u){var O=o-u;if((F>7e3||k>24576)&&O>423){l=Vt(e,c,0,w,S,T,A,k,I,u-I,l),k=F=A=0,I=u;for(var R=0;R<286;++R)S[R]=0;for(R=0;R<30;++R)T[R]=0}var N=2,U=0,P=f,D=L-C&32767;if(O>2&&M==x(u-D))for(var B=Math.min(d,O)-1,_=Math.min(32767,u),G=Math.min(258,O);D<=_&&--P&&L!=C;){if(e[u+N]==e[u+N-D]){for(var H=0;H<G&&e[u+H]==e[u+H-D];++H);if(H>N){if(N=H,U=D,H>B)break;var V=Math.min(D,H-2),z=0;for(R=0;R<V;++R){var j=u-D+R+32768&32767,W=j-m[j]+32768&32767;W>z&&(z=W,C=j)}}}D+=(L=C)-(C=m[L])+32768&32767}if(U){w[k++]=268435456|gt[N]<<18|yt[U];var X=31&gt[N],q=31&yt[U];A+=lt[X]+ut[q],++S[257+X],++T[q],E=u+N,++F}else w[k++]=e[u],++S[e[u]]}}l=Vt(e,c,s,w,S,T,A,k,I,u-I,l),!s&&7&l&&(l=Ht(c,l+1,jt))}return Rt(i,0,n+Ot(l)+a)},Xt=function(){for(var e=new ct(256),t=0;t<256;++t){for(var r=t,n=9;--n;)r=(1&r&&3988292384)^r>>>1;e[t]=r}return e}(),qt=function(){var e=-1;return{p:function(t){for(var r=e,n=0;n<t.length;++n)r=Xt[255&r^t[n]]^r>>>8;e=r},d:function(){return~e}}},Yt=function(){var e=1,t=0;return{p:function(r){for(var n=e,a=t,s=r.length,o=0;o!=s;){for(var i=Math.min(o+2655,s);o<i;++o)a+=n+=r[o];n=(65535&n)+15*(n>>16),a=(65535&a)+15*(a>>16)}e=n,t=a},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}},Kt=function(e,t,r,n,a){return Wt(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,r,n,!a)},Zt=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},Qt=function(e,t,r){for(var n=e(),a=e.toString(),s=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<n.length;++o){var i=n[o],c=s[o];if("function"==typeof i){t+=";"+c+"=";var l=i.toString();if(i.prototype)if(-1!=l.indexOf("[native code]")){var u=l.indexOf(" ",8)+1;t+=l.slice(u,l.indexOf("(",u))}else for(var h in t+=l,i.prototype)t+=";"+c+".prototype."+h+"="+i.prototype[h].toString();else t+=l}else r[c]=i}return[t,r]},Jt=[],$t=function(e,t,r,n){var a;if(!Jt[r]){for(var s="",o={},i=e.length-1,c=0;c<i;++c)s=(a=Qt(e[c],s,o))[0],o=a[1];Jt[r]=Qt(e[i],s,o)}var l=Zt({},Jt[r][1]);return function(e,t,r,n,a){var s=st(nt[t]||(nt[t]=at(e)));return s.onerror=function(e){return a(e.error,null)},s.onmessage=function(e){return a(null,e.data)},s.postMessage(r,n),s}(Jt[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,l,function(e){var t=[];for(var r in e)(e[r]instanceof ot||e[r]instanceof it||e[r]instanceof ct)&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t}(l),n)},er=function(){return[ot,it,ct,lt,ut,ht,ft,vt,kt,It,bt,St,Mt,Lt,Ct,Ot,Rt,Nt,Mr,or,ir]},tr=function(){return[ot,it,ct,lt,ut,ht,gt,yt,At,Tt,Et,Ft,bt,zt,jt,St,Ut,Pt,Dt,Bt,_t,Gt,Ht,Vt,Ot,Rt,Wt,Kt,Ar,or]},rr=function(){return[gr,yr,fr,qt,Xt]},nr=function(){return[mr,vr]},ar=function(){return[br,fr,Yt]},sr=function(){return[xr]},or=function(e){return postMessage(e,[e.buffer])},ir=function(e){return e&&e.size&&new ot(e.size)},cr=function(e,t,r,n,a,s){var o=$t(r,n,a,(function(e,t){o.terminate(),s(e,t)}));return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}},lr=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},ur=function(e,t,r,n,a){var s,o=$t(e,n,a,(function(e,r){e?(o.terminate(),t.ondata.call(t,e)):(r[1]&&o.terminate(),t.ondata.call(t,e,r[0],r[1]))}));o.postMessage(r),t.push=function(e,r){if(s)throw"stream finished";if(!t.ondata)throw"no stream handler";o.postMessage([e,s=r],[e.buffer])},t.terminate=function(){o.terminate()}},hr=function(e,t){return e[t]|e[t+1]<<8},pr=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},dr=function(e,t){return pr(e,t)+4294967296*pr(e,t+4)},fr=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},gr=function(e,t){var r=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&fr(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),r){e[3]=8;for(var n=0;n<=r.length;++n)e[n+10]=r.charCodeAt(n)}},mr=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],r=10;4&t&&(r+=e[10]|2+(e[11]<<8));for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[r++]);return r+(2&t)},vr=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},yr=function(e){return 10+(e.filename&&e.filename.length+1||0)},br=function(e,t){var r=t.level,n=0==r?0:r<6?1:9==r?3:2;e[0]=120,e[1]=n<<6|(n?32-2*n:1)},xr=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function wr(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var Sr=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(Kt(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),Tr=function(){return function(e,t){ur([tr,function(){return[lr,Sr]}],this,wr.call(this,e,t),(function(e){var t=new Sr(e.data);onmessage=lr(t)}),6)}}();function Fr(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return cr(e,t,[tr],(function(e){return or(Ar(e.data[0],e.data[1]))}),0,r)}function Ar(e,t){return Kt(e,t||{},0,0)}var kr=function(){function e(e){this.s={},this.p=new ot(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,r=new ot(t+e.length);r.set(this.p),r.set(e,t),this.p=r},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,r=Nt(this.p,this.o,this.s);this.ondata(Rt(r,t,this.s.b),this.d),this.o=Rt(r,this.s.b-32768),this.s.b=this.o.length,this.p=Rt(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),Er=function(){return function(e){this.ondata=e,ur([er,function(){return[lr,kr]}],this,0,(function(){var e=new kr;onmessage=lr(e)}),7)}}();function Ir(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return cr(e,t,[er],(function(e){return or(Mr(e.data[0],ir(e.data[1])))}),1,r)}function Mr(e,t){return Nt(e,t)}var Lr=function(){function e(e,t){this.c=qt(),this.l=0,this.v=1,Sr.call(this,e,t)}return e.prototype.push=function(e,t){Sr.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var r=Kt(e,this.o,this.v&&yr(this.o),t&&8,!t);this.v&&(gr(r,this.o),this.v=0),t&&(fr(r,r.length-8,this.c.d()),fr(r,r.length-4,this.l)),this.ondata(r,t)},e}(),Cr=function(){return function(e,t){ur([tr,rr,function(){return[lr,Sr,Lr]}],this,wr.call(this,e,t),(function(e){var t=new Lr(e.data);onmessage=lr(t)}),8)}}();function Or(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return cr(e,t,[tr,rr,function(){return[Rr]}],(function(e){return or(Rr(e.data[0],e.data[1]))}),2,r)}function Rr(e,t){t||(t={});var r=qt(),n=e.length;r.p(e);var a=Kt(e,t,yr(t),8),s=a.length;return gr(a,t),fr(a,s-8,r.d()),fr(a,s-4,n),a}var Nr=function(){function e(e){this.v=1,kr.call(this,e)}return e.prototype.push=function(e,t){if(kr.prototype.e.call(this,e),this.v){var r=this.p.length>3?mr(this.p):4;if(r>=this.p.length&&!t)return;this.p=this.p.subarray(r),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}kr.prototype.c.call(this,t)},e}(),Ur=function(){return function(e){this.ondata=e,ur([er,nr,function(){return[lr,kr,Nr]}],this,0,(function(){var e=new Nr;onmessage=lr(e)}),9)}}();function Pr(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return cr(e,t,[er,nr,function(){return[Dr]}],(function(e){return or(Dr(e.data[0]))}),3,r)}function Dr(e,t){return Nt(e.subarray(mr(e),-8),t||new ot(vr(e)))}var Br=function(){function e(e,t){this.c=Yt(),this.v=1,Sr.call(this,e,t)}return e.prototype.push=function(e,t){Sr.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var r=Kt(e,this.o,this.v&&2,t&&4,!t);this.v&&(br(r,this.o),this.v=0),t&&fr(r,r.length-4,this.c.d()),this.ondata(r,t)},e}(),_r=function(){return function(e,t){ur([tr,ar,function(){return[lr,Sr,Br]}],this,wr.call(this,e,t),(function(e){var t=new Br(e.data);onmessage=lr(t)}),10)}}();function Gr(e,t){t||(t={});var r=Yt();r.p(e);var n=Kt(e,t,2,4);return br(n,t),fr(n,n.length-4,r.d()),n}var Hr=function(){function e(e){this.v=1,kr.call(this,e)}return e.prototype.push=function(e,t){if(kr.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}kr.prototype.c.call(this,t)},e}(),Vr=function(){return function(e){this.ondata=e,ur([er,sr,function(){return[lr,kr,Hr]}],this,0,(function(){var e=new Hr;onmessage=lr(e)}),11)}}();function zr(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return cr(e,t,[er,sr,function(){return[jr]}],(function(e){return or(jr(e.data[0],ir(e.data[1])))}),5,r)}function jr(e,t){return Nt((xr(e),e.subarray(2,-4)),t)}var Wr=function(){function e(e){this.G=Nr,this.I=kr,this.Z=Hr,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var r=new ot(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var n=this,a=function(){n.ondata.apply(n,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(a):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(a):new this.Z(a),this.s.push(this.p,t),this.p=null}}},e}(),Xr=function(){function e(e){this.G=Ur,this.I=Er,this.Z=Vr,this.ondata=e}return e.prototype.push=function(e,t){Wr.prototype.push.call(this,e,t)},e}();var qr=function(e,t,r,n){for(var a in e){var s=e[a],o=t+a;s instanceof ot?r[o]=[s,n]:Array.isArray(s)?r[o]=[s[0],Zt(n,s[1])]:qr(s,o+"/",r,n)}},Yr="undefined"!=typeof TextEncoder&&new TextEncoder,Kr=void 0!==e._default.polyfill.TextDecoder&&new e._default.polyfill.TextDecoder,Zr=0;try{Kr.decode(jt,{stream:!0}),Zr=1}catch(e){}var Qr=function(e){for(var t="",r=0;;){var n=e[r++],a=(n>127)+(n>223)+(n>239);if(r+a>e.length)return[t,Rt(e,r-1)];a?3==a?(n=((15&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,t+=String.fromCharCode(55296|n>>10,56320|1023&n)):t+=1&a?String.fromCharCode((31&n)<<6|63&e[r++]):String.fromCharCode((15&n)<<12|(63&e[r++])<<6|63&e[r++]):t+=String.fromCharCode(n)}},Jr=function(){function t(t){this.ondata=t,Zr?this.t=new e._default.polyfill.TextDecoder:this.p=jt}return t.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var r=new ot(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length);var n=Qr(r),a=n[0],s=n[1];if(t){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(a,t)}},t}(),$r=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(en(e),this.d=t||!1)},e}();function en(e,t){if(t){for(var r=new ot(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}if(Yr)return Yr.encode(e);var a=e.length,s=new ot(e.length+(e.length>>1)),o=0,i=function(e){s[o++]=e};for(n=0;n<a;++n){if(o+5>s.length){var c=new ot(o+8+(a-n<<1));c.set(s),s=c}var l=e.charCodeAt(n);l<128||t?i(l):l<2048?(i(192|l>>6),i(128|63&l)):l>55295&&l<57344?(i(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++n))>>18),i(128|l>>12&63),i(128|l>>6&63),i(128|63&l)):(i(224|l>>12),i(128|l>>6&63),i(128|63&l))}return Rt(s,0,o)}function tn(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}if(Kr)return Kr.decode(e);var a=Qr(e),s=a[0];if(a[1].length)throw"invalid utf-8 data";return s}var rn=function(e){return 1==e?3:e<6?2:9==e?1:0},nn=function(e,t){return t+30+hr(e,t+26)+hr(e,t+28)},an=function(e,t,r){var n=hr(e,t+28),a=tn(e.subarray(t+46,t+46+n),!(2048&hr(e,t+8))),s=t+46+n,o=pr(e,t+20),i=r&&4294967295==o?sn(e,s):[o,pr(e,t+24),pr(e,t+42)],c=i[0],l=i[1],u=i[2];return[hr(e,t+10),c,l,a,s+hr(e,t+30)+hr(e,t+32),u]},sn=function(e,t){for(;1!=hr(e,t);t+=4+hr(e,t+2));return[dr(e,t+12),dr(e,t+4),dr(e,t+20)]},on=function(e){var t=0;if(e)for(var r in e){var n=e[r].length;if(n>65535)throw"extra field too long";t+=n+4}return t},cn=function(e,t,r,n,a,s,o,i){var c=n.length,l=r.extra,u=i&&i.length,h=on(l);fr(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(null==s&&8),e[t++]=a&&8,e[t++]=255&r.compression,e[t++]=r.compression>>8;var p=new Date(null==r.mtime?Date.now():r.mtime),d=p.getFullYear()-1980;if(d<0||d>119)throw"date not in range 1980-2099";if(fr(e,t,d<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>>1),t+=4,null!=s&&(fr(e,t,r.crc),fr(e,t+4,s),fr(e,t+8,r.size)),fr(e,t+12,c),fr(e,t+14,h),t+=16,null!=o&&(fr(e,t,u),fr(e,t+6,r.attrs),fr(e,t+10,o),t+=14),e.set(n,t),t+=c,h)for(var f in l){var g=l[f],m=g.length;fr(e,t,+f),fr(e,t+2,m),e.set(g,t+4),t+=4+m}return u&&(e.set(i,t),t+=u),t},ln=function(e,t,r,n,a){fr(e,t,101010256),fr(e,t+8,r),fr(e,t+10,r),fr(e,t+12,n),fr(e,t+16,a)},un=function(){function e(e){this.filename=e,this.c=qt(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),hn=function(){function e(e,t){var r=this;t||(t={}),un.call(this,e),this.d=new Sr(t,(function(e,t){r.ondata(null,e,t)})),this.compression=8,this.flag=rn(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){un.prototype.push.call(this,e,t)},e}(),pn=function(){function e(e,t){var r=this;t||(t={}),un.call(this,e),this.d=new Tr(t,(function(e,t,n){r.ondata(e,t,n)})),this.compression=8,this.flag=rn(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){un.prototype.push.call(this,e,t)},e}(),dn=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var r=en(e.filename),n=r.length,a=e.comment,s=a&&en(a),o=n!=e.filename.length||s&&a.length!=s.length,i=n+on(e.extra)+30;if(n>65535)throw"filename too long";var c=new ot(i);cn(c,0,e,r,o);var l=[c],u=function(){for(var e=0,r=l;e<r.length;e++){var n=r[e];t.ondata(null,n,!1)}l=[]},h=this.d;this.d=0;var p=this.u.length,d=Zt(e,{f:r,u:o,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),h){var e=t.u[p+1];e?e.r():t.d=1}h=1}}),f=0;e.ondata=function(r,n,a){if(r)t.ondata(r,n,a),t.terminate();else if(f+=n.length,l.push(n),a){var s=new ot(16);fr(s,0,134695760),fr(s,4,e.crc),fr(s,8,f),fr(s,12,e.size),l.push(s),d.c=f,d.b=i+f+16,d.crc=e.crc,d.size=e.size,h&&d.r(),h=1}else h&&u()},this.u.push(d)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,r=0,n=0,a=this.u;n<a.length;n++){r+=46+(c=a[n]).f.length+on(c.extra)+(c.o?c.o.length:0)}for(var s=new ot(r+22),o=0,i=this.u;o<i.length;o++){var c=i[o];cn(s,e,c,c.f,c.u,c.c,t,c.o),e+=46+c.f.length+on(c.extra)+(c.o?c.o.length:0),t+=c.b}ln(s,e,this.u.length,r,t),this.ondata(null,s,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){t[e].t()}this.d=2},e}();var fn=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),gn=function(){function e(){var e=this;this.i=new kr((function(t,r){e.ondata(null,t,r)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(r){this.ondata(r,e,t)}},e.compression=8,e}(),mn=function(){function e(e,t){var r=this;t<32e4?this.i=new kr((function(e,t){r.ondata(null,e,t)})):(this.i=new Er((function(e,t,n){r.ondata(e,t,n)})),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=Rt(e,0)),this.i.push(e,t)},e.compression=8,e}(),vn=function(){function e(e){this.onfile=e,this.k=[],this.o={0:fn},this.p=jt}return e.prototype.push=function(e,t){var r=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var n=Math.min(this.c,e.length),a=e.subarray(0,n);if(this.c-=n,this.d?this.d.push(a,!this.c):this.k[0].push(a),(e=e.subarray(n)).length)return this.push(e,t)}else{var s=0,o=0,i=void 0,c=void 0;this.p.length?e.length?((c=new ot(this.p.length+e.length)).set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var l=c.length,u=this.c,h=u&&this.d,p=function(){var e,t=pr(c,o);if(67324752==t){s=1,i=o,d.d=null,d.c=0;var n=hr(c,o+6),a=hr(c,o+8),h=2048&n,p=8&n,f=hr(c,o+26),g=hr(c,o+28);if(l>o+30+f+g){var m=[];d.k.unshift(m),s=2;var v,y=pr(c,o+18),b=pr(c,o+22),x=tn(c.subarray(o+30,o+=30+f),!h);4294967295==y?(e=p?[-2]:sn(c,o),y=e[0],b=e[1]):p&&(y=-1),o+=g,d.c=y;var w={name:x,compression:a,start:function(){if(!w.ondata)throw"no callback";if(y){var e=r.o[a];if(!e)throw"unknown compression type "+a;(v=y<0?new e(x):new e(x,y,b)).ondata=function(e,t,r){w.ondata(e,t,r)};for(var t=0,n=m;t<n.length;t++){var s=n[t];v.push(s,!1)}r.k[0]==m&&r.c?r.d=v:v.push(jt,!0)}else w.ondata(null,jt,!0)},terminate:function(){v&&v.terminate&&v.terminate()}};y>=0&&(w.size=y,w.originalSize=b),d.onfile(w)}return"break"}if(u){if(134695760==t)return i=o+=12+(-2==u&&8),s=3,d.c=0,"break";if(33639248==t)return i=o-=4,s=3,d.c=0,"break"}},d=this;o<l-4;++o){if("break"===p())break}if(this.p=jt,u<0){var f=s?c.subarray(0,i-12-(-2==u&&8)-(134695760==pr(c,i-16)&&4)):c.subarray(0,o);h?h.push(f,!!s):this.k[+(2==s)].push(f)}if(2&s)return this.push(c.subarray(o),t);this.p=c.subarray(o)}if(t){if(this.c)throw"invalid zip file";this.p=null}},e.prototype.register=function(e){this.o[e.compression]=e},e}();var yn=Object.freeze({__proto__:null,Deflate:Sr,AsyncDeflate:Tr,deflate:Fr,deflateSync:Ar,Inflate:kr,AsyncInflate:Er,inflate:Ir,inflateSync:Mr,Gzip:Lr,AsyncGzip:Cr,gzip:Or,gzipSync:Rr,Gunzip:Nr,AsyncGunzip:Ur,gunzip:Pr,gunzipSync:Dr,Zlib:Br,AsyncZlib:_r,zlib:function(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return cr(e,t,[tr,ar,function(){return[Gr]}],(function(e){return or(Gr(e.data[0],e.data[1]))}),4,r)},zlibSync:Gr,Unzlib:Hr,AsyncUnzlib:Vr,unzlib:zr,unzlibSync:jr,compress:Or,AsyncCompress:Cr,compressSync:Rr,Compress:Lr,Decompress:Wr,AsyncDecompress:Xr,decompress:function(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?Pr(e,t,r):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Ir(e,t,r):zr(e,t,r)},decompressSync:function(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?Dr(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Mr(e,t):jr(e,t)},DecodeUTF8:Jr,EncodeUTF8:$r,strToU8:en,strFromU8:tn,ZipPassThrough:un,ZipDeflate:hn,AsyncZipDeflate:pn,Zip:dn,zip:function(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";var n={};qr(e,"",n,t);var a=Object.keys(n),s=a.length,o=0,i=0,c=s,l=new Array(s),u=[],h=function(){for(var e=0;e<u.length;++e)u[e]()},p=function(){var e=new ot(i+22),t=o,n=i-o;i=0;for(var a=0;a<c;++a){var s=l[a];try{var u=s.c.length;cn(e,i,s,s.f,s.u,u);var h=30+s.f.length+on(s.extra),p=i+h;e.set(s.c,p),cn(e,o,s,s.f,s.u,u,i,s.m),o+=16+h+(s.m?s.m.length:0),i=p+u}catch(e){return r(e,null)}}ln(e,o,l.length,n,t),r(null,e)};s||p();for(var d=function(e){var t=a[e],c=n[t],d=c[0],f=c[1],g=qt(),m=d.length;g.p(d);var v=en(t),y=v.length,b=f.comment,x=b&&en(b),w=x&&x.length,S=on(f.extra),T=0==f.level?0:8,F=function(n,a){if(n)h(),r(n,null);else{var c=a.length;l[e]=Zt(f,{size:m,crc:g.d(),c:a,f:v,m:x,u:y!=t.length||x&&b.length!=w,compression:T}),o+=30+y+S+c,i+=76+2*(y+S)+(w||0)+c,--s||p()}};if(y>65535&&F("filename too long",null),T)if(m<16e4)try{F(null,Ar(d,f))}catch(e){F(e,null)}else u.push(Fr(d,f,F));else F(null,d)},f=0;f<c;++f)d(f);return h},zipSync:function(e,t){t||(t={});var r={},n=[];qr(e,"",r,t);var a=0,s=0;for(var o in r){var i=r[o],c=i[0],l=i[1],u=0==l.level?0:8,h=(T=en(o)).length,p=l.comment,d=p&&en(p),f=d&&d.length,g=on(l.extra);if(h>65535)throw"filename too long";var m=u?Ar(c,l):c,v=m.length,y=qt();y.p(c),n.push(Zt(l,{size:c.length,crc:y.d(),c:m,f:T,m:d,u:h!=o.length||d&&p.length!=f,o:a,compression:u})),a+=30+h+g+v,s+=76+2*(h+g)+(f||0)+v}for(var b=new ot(s+22),x=a,w=s-a,S=0;S<n.length;++S){var T=n[S];cn(b,T.o,T,T.f,T.u,T.c.length);var F=30+T.f.length+on(T.extra);b.set(T.c,T.o+F),cn(b,a,T,T.f,T.u,T.c.length,T.o,T.m),a+=16+F+(T.m?T.m.length:0)}return ln(b,a,n.length,w,x),b},UnzipPassThrough:fn,UnzipInflate:gn,AsyncUnzipInflate:mn,Unzip:vn,unzip:function(e,t){if("function"!=typeof t)throw"no callback";for(var r=[],n=function(){for(var e=0;e<r.length;++e)r[e]()},a={},s=e.length-22;101010256!=pr(e,s);--s)if(!s||e.length-s>65558)return void t("invalid zip file",null);var o=hr(e,s+8);o||t(null,{});var i=o,c=pr(e,s+16),l=4294967295==c;if(l){if(s=pr(e,s-12),101075792!=pr(e,s))return void t("invalid zip file",null);i=o=pr(e,s+32),c=pr(e,s+48)}for(var u=function(s){var i=an(e,c,l),u=i[0],h=i[1],p=i[2],d=i[3],f=i[4],g=i[5],m=nn(e,g);c=f;var v=function(e,r){e?(n(),t(e,null)):(a[d]=r,--o||t(null,a))};if(u)if(8==u){var y=e.subarray(m,m+h);if(h<32e4)try{v(null,Mr(y,new ot(p)))}catch(e){v(e,null)}else r.push(Ir(y,{size:p},v))}else v("unknown compression type "+u,null);else v(null,Rt(e,m,m+h))},h=0;h<i;++h)u();return n},unzipSync:function(e){for(var t={},r=e.length-22;101010256!=pr(e,r);--r)if(!r||e.length-r>65558)throw"invalid zip file";var n=hr(e,r+8);if(!n)return{};var a=pr(e,r+16),s=4294967295==a;if(s){if(r=pr(e,r-12),101075792!=pr(e,r))throw"invalid zip file";n=pr(e,r+32),a=pr(e,r+48)}for(var o=0;o<n;++o){var i=an(e,a,s),c=i[0],l=i[1],u=i[2],h=i[3],p=i[4],d=i[5],f=nn(e,d);if(a=p,c){if(8!=c)throw"unknown compression type "+c;t[h]=Mr(e.subarray(f,f+l),new ot(u))}else t[h]=Rt(e,f,f+l)}return t}});function bn(e,t,r){const n=r.length-e-1;if(t>=r[n])return n-1;if(t<=r[e])return e;let a=e,s=n,o=Math.floor((a+s)/2);for(;t<r[o]||t>=r[o+1];)t<r[o]?s=o:a=o,o=Math.floor((a+s)/2);return o}function xn(e,t){let r=1;for(let t=2;t<=e;++t)r*=t;let n=1;for(let e=2;e<=t;++e)n*=e;for(let r=2;r<=e-t;++r)n*=r;return r/n}function wn(t,r,n,a,s){const o=function(t,r,n,a,s){const o=s<t?s:t,i=[],c=bn(t,a,r),l=function(e,t,r,n,a){const s=[];for(let e=0;e<=r;++e)s[e]=0;const o=[];for(let e=0;e<=n;++e)o[e]=s.slice(0);const i=[];for(let e=0;e<=r;++e)i[e]=s.slice(0);i[0][0]=1;const c=s.slice(0),l=s.slice(0);for(let n=1;n<=r;++n){c[n]=t-a[e+1-n],l[n]=a[e+n]-t;let r=0;for(let e=0;e<n;++e){const t=l[e+1],a=c[n-e];i[n][e]=t+a;const s=i[e][n-1]/i[n][e];i[e][n]=r+t*s,r=a*s}i[n][n]=r}for(let e=0;e<=r;++e)o[0][e]=i[e][r];for(let e=0;e<=r;++e){let t=0,a=1;const c=[];for(let e=0;e<=r;++e)c[e]=s.slice(0);c[0][0]=1;for(let s=1;s<=n;++s){let n=0;const l=e-s,u=r-s;e>=s&&(c[a][0]=c[t][0]/i[u+1][l],n=c[a][0]*i[l][u]);const h=e-1<=u?s-1:r-e;for(let e=l>=-1?1:-l;e<=h;++e)c[a][e]=(c[t][e]-c[t][e-1])/i[u+1][l+e],n+=c[a][e]*i[l+e][u];e<=u&&(c[a][s]=-c[t][s-1]/i[u+1][e],n+=c[a][s]*i[e][u]),o[s][e]=n;const p=t;t=a,a=p}}let u=r;for(let e=1;e<=n;++e){for(let t=0;t<=r;++t)o[e][t]*=u;u*=r-e}return o}(c,a,t,o,r),u=[];for(let e=0;e<n.length;++e){const t=n[e].clone(),r=t.w;t.x*=r,t.y*=r,t.z*=r,u[e]=t}for(let e=0;e<=o;++e){const r=u[c-t].clone().multiplyScalar(l[e][0]);for(let n=1;n<=t;++n)r.add(u[c-t+n].clone().multiplyScalar(l[e][n]));i[e]=r}for(let t=o+1;t<=s+1;++t)i[t]=new e.Vector4(0,0,0);return i}(t,r,n,a,s);return function(t){const r=t.length,n=[],a=[];for(let s=0;s<r;++s){const r=t[s];n[s]=new e.Vector3(r.x,r.y,r.z),a[s]=r.w}const s=[];for(let e=0;e<r;++e){const t=n[e].clone();for(let r=1;r<=e;++r)t.sub(s[e-r].clone().multiplyScalar(xn(e,r)*a[r]));s[e]=t.divideScalar(a[0])}return s}(o)}class Sn extends e.Curve{constructor(t,r,n,a,s){super(),this.degree=t,this.knots=r,this.controlPoints=[],this.startKnot=a||0,this.endKnot=s||this.knots.length-1;for(let t=0;t<n.length;++t){const r=n[t];this.controlPoints[t]=new e.Vector4(r.x,r.y,r.z,r.w)}}getPoint(t,r=new e.Vector3){const n=r,a=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=function(t,r,n,a){const s=bn(t,a,r),o=function(e,t,r,n){const a=[],s=[],o=[];a[0]=1;for(let i=1;i<=r;++i){s[i]=t-n[e+1-i],o[i]=n[e+i]-t;let r=0;for(let e=0;e<i;++e){const t=o[e+1],n=s[i-e],c=a[e]/(t+n);a[e]=r+t*c,r=n*c}a[i]=r}return a}(s,a,t,r),i=new e.Vector4(0,0,0,0);for(let e=0;e<=t;++e){const r=n[s-t+e],a=o[e],c=r.w*a;i.x+=r.x*c,i.y+=r.y*c,i.z+=r.z*c,i.w+=r.w*a}return i}(this.degree,this.knots,this.controlPoints,a);return 1!==s.w&&s.divideScalar(s.w),n.set(s.x,s.y,s.z)}getTangent(t,r=new e.Vector3){const n=r,a=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),s=wn(this.degree,this.knots,this.controlPoints,a,1);return n.copy(s[1]).normalize(),n}}let Tn,Fn,An;class kn extends e.Loader{constructor(e){super(e)}load(t,r,n,a){const s=this,o=""===s.path?e.LoaderUtils.extractUrlBase(t):s.path,i=new e.FileLoader(this.manager);i.setPath(s.path),i.setResponseType("arraybuffer"),i.setRequestHeader(s.requestHeader),i.setWithCredentials(s.withCredentials),i.load(t,(function(e){try{r(s.parse(e,o))}catch(e){a?a(e):console.error(e),s.manager.itemError(t)}}),n,a)}parse(t,r){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===zn(e,0,t.length)}(t))Tn=(new Cn).parse(t);else{const e=zn(t);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let r=0;function n(t){const n=e[t-1];return e=e.slice(r+t),r++,n}for(let e=0;e<t.length;++e){if(n(1)===t[e])return!1}return!0}(e))throw new Error("THREE.FBXLoader: Unknown format.");if(Nn(e)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Nn(e));Tn=(new Ln).parse(e)}const n=new e.TextureLoader(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin);return new En(n,this.manager).parse(Tn)}}class En{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Fn=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),n=this.parseDeformers(),a=(new In).parse(n);return this.parseScene(n,a,r),An}parseConnections(){const e=new Map;if("Connections"in Tn){Tn.Connections.connections.forEach((function(t){const r=t[0],n=t[1],a=t[2];e.has(r)||e.set(r,{parents:[],children:[]});const s={ID:n,relationship:a};e.get(r).parents.push(s),e.has(n)||e.set(n,{parents:[],children:[]});const o={ID:r,relationship:a};e.get(n).children.push(o)}))}return e}parseImages(){const e={},t={};if("Video"in Tn.Objects){const r=Tn.Objects.Video;for(const n in r){const a=r[n];if(e[parseInt(n)]=a.RelativeFilename||a.Filename,"Content"in a){const e=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,s="string"==typeof a.Content&&""!==a.Content;if(e||s){const e=this.parseImage(r[n]);t[a.RelativeFilename||a.Filename]=e}}}}for(const r in e){const n=e[r];void 0!==t[n]?e[r]=t[n]:e[r]=e[r].split("\\").pop()}return e}parseImage(t){const r=t.Content,n=t.RelativeFilename||t.Filename,a=n.slice(n.lastIndexOf(".")+1).toLowerCase();let s;switch(a){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),s="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+a+'" is not supported.')}if("string"==typeof r)return"data:"+s+";base64,"+r;{const t=new Uint8Array(r);return e._default.polyfill.window.URL.createObjectURL(new e._default.polyfill.Blob([t],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in Tn.Objects){const r=Tn.Objects.Texture;for(const n in r){const a=this.parseTexture(r[n],e);t.set(parseInt(n),a)}}return t}parseTexture(t,r){const n=this.loadTexture(t,r);n.ID=t.id,n.name=t.attrName;const a=t.WrapModeU,s=t.WrapModeV,o=void 0!==a?a.value:0,i=void 0!==s?s.value:0;if(n.wrapS=0===o?e.RepeatWrapping:e.ClampToEdgeWrapping,n.wrapT=0===i?e.RepeatWrapping:e.ClampToEdgeWrapping,"Scaling"in t){const e=t.Scaling.value;n.repeat.x=e[0],n.repeat.y=e[1]}return n}loadTexture(t,r){let n;const a=this.textureLoader.path,s=Fn.get(t.id).children;let o;void 0!==s&&s.length>0&&void 0!==r[s[0].ID]&&(n=r[s[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const i=t.FileName.slice(-3).toLowerCase();if("tga"===i){const r=this.manager.getHandler(".tga");null===r?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),o=new e.Texture):(r.setPath(this.textureLoader.path),o=r.load(n))}else"psd"===i?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),o=new e.Texture):o=this.textureLoader.load(n);return this.textureLoader.setPath(a),o}parseMaterials(e){const t=new Map;if("Material"in Tn.Objects){const r=Tn.Objects.Material;for(const n in r){const a=this.parseMaterial(r[n],e);null!==a&&t.set(parseInt(n),a)}}return t}parseMaterial(t,r){const n=t.id,a=t.attrName;let s=t.ShadingModel;if("object"==typeof s&&(s=s.value),!Fn.has(n))return null;const o=this.parseParameters(t,r,n);let i;switch(s.toLowerCase()){case"phong":i=new e.MeshPhongMaterial;break;case"lambert":i=new e.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),i=new e.MeshPhongMaterial}return i.setValues(o),i.name=a,i}parseParameters(t,r,n){const a={};t.BumpFactor&&(a.bumpScale=t.BumpFactor.value),t.Diffuse?a.color=(new e.Color).fromArray(t.Diffuse.value):!t.DiffuseColor||"Color"!==t.DiffuseColor.type&&"ColorRGB"!==t.DiffuseColor.type||(a.color=(new e.Color).fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(a.displacementScale=t.DisplacementFactor.value),t.Emissive?a.emissive=(new e.Color).fromArray(t.Emissive.value):!t.EmissiveColor||"Color"!==t.EmissiveColor.type&&"ColorRGB"!==t.EmissiveColor.type||(a.emissive=(new e.Color).fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(a.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(a.opacity=parseFloat(t.Opacity.value)),a.opacity<1&&(a.transparent=!0),t.ReflectionFactor&&(a.reflectivity=t.ReflectionFactor.value),t.Shininess&&(a.shininess=t.Shininess.value),t.Specular?a.specular=(new e.Color).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(a.specular=(new e.Color).fromArray(t.SpecularColor.value));const s=this;return Fn.get(n).children.forEach((function(t){const n=t.relationship;switch(n){case"Bump":a.bumpMap=s.getTexture(r,t.ID);break;case"Maya|TEX_ao_map":a.aoMap=s.getTexture(r,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":a.map=s.getTexture(r,t.ID),void 0!==a.map&&(a.map.encoding=e.sRGBEncoding);break;case"DisplacementColor":a.displacementMap=s.getTexture(r,t.ID);break;case"EmissiveColor":a.emissiveMap=s.getTexture(r,t.ID),void 0!==a.emissiveMap&&(a.emissiveMap.encoding=e.sRGBEncoding);break;case"NormalMap":case"Maya|TEX_normal_map":a.normalMap=s.getTexture(r,t.ID);break;case"ReflectionColor":a.envMap=s.getTexture(r,t.ID),void 0!==a.envMap&&(a.envMap.mapping=e.EquirectangularReflectionMapping,a.envMap.encoding=e.sRGBEncoding);break;case"SpecularColor":a.specularMap=s.getTexture(r,t.ID),void 0!==a.specularMap&&(a.specularMap.encoding=e.sRGBEncoding);break;case"TransparentColor":case"TransparencyFactor":a.alphaMap=s.getTexture(r,t.ID),a.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),a}getTexture(e,t){return"LayeredTexture"in Tn.Objects&&t in Tn.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Fn.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Tn.Objects){const r=Tn.Objects.Deformer;for(const n in r){const a=r[n],s=Fn.get(parseInt(n));if("Skin"===a.attrType){const t=this.parseSkeleton(s,r);t.ID=n,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=s.parents[0].ID,e[n]=t}else if("BlendShape"===a.attrType){const e={id:n};e.rawTargets=this.parseMorphTargets(s,r),e.id=n,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(t,r){const n=[];return t.children.forEach((function(t){const a=r[t.ID];if("Cluster"!==a.attrType)return;const s={ID:t.ID,indices:[],weights:[],transformLink:(new e.Matrix4).fromArray(a.TransformLink.a)};"Indexes"in a&&(s.indices=a.Indexes.a,s.weights=a.Weights.a),n.push(s)})),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const r=[];for(let n=0;n<e.children.length;n++){const a=e.children[n],s=t[a.ID],o={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;o.geoID=Fn.get(parseInt(a.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,r.push(o)}return r}parseScene(t,r,n){An=new e.Group;const a=this.parseModels(t.skeletons,r,n),s=Tn.Objects.Model,o=this;a.forEach((function(e){const t=s[e.ID];o.setLookAtProperties(e,t);Fn.get(e.ID).parents.forEach((function(t){const r=a.get(t.ID);void 0!==r&&r.add(e)})),null===e.parent&&An.add(e)})),this.bindSkeleton(t.skeletons,r,a),this.createAmbientLight(),An.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=Gn(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const i=(new Mn).parse();1===An.children.length&&An.children[0].isGroup&&(An.children[0].animations=i,An=An.children[0]),An.animations=i}parseModels(t,r,n){const a=new Map,s=Tn.Objects.Model;for(const o in s){const i=parseInt(o),c=s[o],l=Fn.get(i);let u=this.buildSkeleton(l,t,i,c.attrName);if(!u){switch(c.attrType){case"Camera":u=this.createCamera(l);break;case"Light":u=this.createLight(l);break;case"Mesh":u=this.createMesh(l,r,n);break;case"NurbsCurve":u=this.createCurve(l,r);break;case"LimbNode":case"Root":u=new e.Bone;break;default:u=new e.Group}u.name=c.attrName?e.PropertyBinding.sanitizeNodeName(c.attrName):"",u.ID=i}this.getTransformData(u,c),a.set(i,u)}return a}buildSkeleton(t,r,n,a){let s=null;return t.parents.forEach((function(t){for(const o in r){const i=r[o];i.rawBones.forEach((function(r,o){if(r.ID===t.ID){const t=s;s=new e.Bone,s.matrixWorld.copy(r.transformLink),s.name=a?e.PropertyBinding.sanitizeNodeName(a):"",s.ID=n,i.bones[o]=s,null!==t&&s.add(t)}}))}})),s}createCamera(t){let r,n;if(t.children.forEach((function(e){const t=Tn.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)r=new e.Object3D;else{let t=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(t=1);let a=1;void 0!==n.NearPlane&&(a=n.NearPlane.value/1e3);let s=1e3;void 0!==n.FarPlane&&(s=n.FarPlane.value/1e3);let o=e._default.polyfill.window.innerWidth,i=e._default.polyfill.window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(o=n.AspectWidth.value,i=n.AspectHeight.value);const c=o/i;let l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(t){case 0:r=new e.PerspectiveCamera(l,c,a,s),null!==u&&r.setFocalLength(u);break;case 1:r=new e.OrthographicCamera(-o/2,o/2,i/2,-i/2,a,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+t+"."),r=new e.Object3D}}return r}createLight(t){let r,n;if(t.children.forEach((function(e){const t=Tn.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)r=new e.Object3D;else{let t;t=void 0===n.LightType?0:n.LightType.value;let a=16777215;void 0!==n.Color&&(a=(new e.Color).fromArray(n.Color.value));let s=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(s=0);let o=0;void 0!==n.FarAttenuationEnd&&(o=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const i=1;switch(t){case 0:r=new e.PointLight(a,s,o,i);break;case 1:r=new e.DirectionalLight(a,s);break;case 2:let t=Math.PI/3;void 0!==n.InnerAngle&&(t=e.MathUtils.degToRad(n.InnerAngle.value));let c=0;void 0!==n.OuterAngle&&(c=e.MathUtils.degToRad(n.OuterAngle.value),c=Math.max(c,1)),r=new e.SpotLight(a,s,o,t,c,i);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),r=new e.PointLight(a,s)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(r.castShadow=!0)}return r}createMesh(t,r,n){let a,s=null,o=null;const i=[];return t.children.forEach((function(e){r.has(e.ID)&&(s=r.get(e.ID)),n.has(e.ID)&&i.push(n.get(e.ID))})),i.length>1?o=i:i.length>0?o=i[0]:(o=new e.MeshPhongMaterial({color:13421772}),i.push(o)),"color"in s.attributes&&i.forEach((function(e){e.vertexColors=!0})),s.FBX_Deformer?(a=new e.SkinnedMesh(s,o),a.normalizeSkinWeights()):a=new e.Mesh(s,o),a}createCurve(t,r){const n=t.children.reduce((function(e,t){return r.has(t.ID)&&(e=r.get(t.ID)),e}),null),a=new e.LineBasicMaterial({color:3342591,linewidth:1});return new e.Line(n,a)}getTransformData(e,t){const r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?Hn(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(t,r){if("LookAtProperty"in r){Fn.get(t.ID).children.forEach((function(r){if("LookAtProperty"===r.relationship){const n=Tn.Objects.Model[r.ID];if("Lcl_Translation"in n){const r=n.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(r),An.add(t.target)):t.lookAt((new e.Vector3).fromArray(r))}}}))}}bindSkeleton(t,r,n){const a=this.parsePoseNodes();for(const s in t){const o=t[s];Fn.get(parseInt(o.ID)).parents.forEach((function(t){if(r.has(t.ID)){const r=t.ID;Fn.get(r).parents.forEach((function(t){if(n.has(t.ID)){n.get(t.ID).bind(new e.Skeleton(o.bones),a[t.ID])}}))}}))}}parsePoseNodes(){const t={};if("Pose"in Tn.Objects){const r=Tn.Objects.Pose;for(const n in r)if("BindPose"===r[n].attrType){const a=r[n].PoseNode;Array.isArray(a)?a.forEach((function(r){t[r.Node]=(new e.Matrix4).fromArray(r.Matrix.a)})):t[a.Node]=(new e.Matrix4).fromArray(a.Matrix.a)}}return t}createAmbientLight(){if("GlobalSettings"in Tn&&"AmbientColor"in Tn.GlobalSettings){const t=Tn.GlobalSettings.AmbientColor.value,r=t[0],n=t[1],a=t[2];if(0!==r||0!==n||0!==a){const t=new e.Color(r,n,a);An.add(new e.AmbientLight(t,1))}}}}class In{parse(e){const t=new Map;if("Geometry"in Tn.Objects){const r=Tn.Objects.Geometry;for(const n in r){const a=Fn.get(parseInt(n)),s=this.parseGeometry(a,r[n],e);t.set(parseInt(n),s)}}return t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){const n=r.skeletons,a=[],s=e.parents.map((function(e){return Tn.Objects.Model[e.ID]}));if(0===s.length)return;const o=e.children.reduce((function(e,t){return void 0!==n[t.ID]&&(e=n[t.ID]),e}),null);e.children.forEach((function(e){void 0!==r.morphTargets[e.ID]&&a.push(r.morphTargets[e.ID])}));const i=s[0],c={};"RotationOrder"in i&&(c.eulerOrder=Hn(i.RotationOrder.value)),"InheritType"in i&&(c.inheritType=parseInt(i.InheritType.value)),"GeometricTranslation"in i&&(c.translation=i.GeometricTranslation.value),"GeometricRotation"in i&&(c.rotation=i.GeometricRotation.value),"GeometricScaling"in i&&(c.scale=i.GeometricScaling.value);const l=Gn(c);return this.genGeometry(t,o,a,l)}genGeometry(t,r,n,a){const s=new e.BufferGeometry;t.attrName&&(s.name=t.attrName);const o=this.parseGeoNode(t,r),i=this.genBuffers(o),c=new e.Float32BufferAttribute(i.vertex,3);if(c.applyMatrix4(a),s.setAttribute("position",c),i.colors.length>0&&s.setAttribute("color",new e.Float32BufferAttribute(i.colors,3)),r&&(s.setAttribute("skinIndex",new e.Uint16BufferAttribute(i.weightsIndices,4)),s.setAttribute("skinWeight",new e.Float32BufferAttribute(i.vertexWeights,4)),s.FBX_Deformer=r),i.normal.length>0){const t=(new e.Matrix3).getNormalMatrix(a),r=new e.Float32BufferAttribute(i.normal,3);r.applyNormalMatrix(t),s.setAttribute("normal",r)}if(i.uvs.forEach((function(t,r){let n="uv"+(r+1).toString();0===r&&(n="uv"),s.setAttribute(n,new e.Float32BufferAttribute(i.uvs[r],2))})),o.material&&"AllSame"!==o.material.mappingType){let e=i.materialIndex[0],t=0;if(i.materialIndex.forEach((function(r,n){r!==e&&(s.addGroup(t,n-t,e),e=r,t=n)})),s.groups.length>0){const t=s.groups[s.groups.length-1],r=t.start+t.count;r!==i.materialIndex.length&&s.addGroup(r,i.materialIndex.length-r,e)}0===s.groups.length&&s.addGroup(0,i.materialIndex.length,i.materialIndex[0])}return this.addMorphTargets(s,t,n,a),s}parseGeoNode(e,t){const r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(n,a){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[a]})}))}))),r}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,n=0,a=!1,s=[],o=[],i=[],c=[],l=[],u=[];const h=this;return e.vertexIndices.forEach((function(p,d){let f,g=!1;p<0&&(p^=-1,g=!0);let m=[],v=[];if(s.push(3*p,3*p+1,3*p+2),e.color){const t=Dn(d,r,p,e.color);i.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[p]&&e.weightTable[p].forEach((function(e){v.push(e.weight),m.push(e.id)})),v.length>4){a||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),a=!0);const e=[0,0,0,0],t=[0,0,0,0];v.forEach((function(r,n){let a=r,s=m[n];t.forEach((function(t,r,n){if(a>t){n[r]=a,a=t;const o=e[r];e[r]=s,s=o}}))})),m=e,v=t}for(;v.length<4;)v.push(0),m.push(0);for(let e=0;e<4;++e)l.push(v[e]),u.push(m[e])}if(e.normal){const t=Dn(d,r,p,e.normal);o.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=Dn(d,r,p,e.material)[0]),e.uv&&e.uv.forEach((function(e,t){const n=Dn(d,r,p,e);void 0===c[t]&&(c[t]=[]),c[t].push(n[0]),c[t].push(n[1])})),n++,g&&(h.genFace(t,e,s,f,o,i,c,l,u,n),r++,n=0,s=[],o=[],i=[],c=[],l=[],u=[])})),t}genFace(e,t,r,n,a,s,o,i,c,l){for(let u=2;u<l;u++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(u-1)]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),t.skeleton&&(e.vertexWeights.push(i[0]),e.vertexWeights.push(i[1]),e.vertexWeights.push(i[2]),e.vertexWeights.push(i[3]),e.vertexWeights.push(i[4*(u-1)]),e.vertexWeights.push(i[4*(u-1)+1]),e.vertexWeights.push(i[4*(u-1)+2]),e.vertexWeights.push(i[4*(u-1)+3]),e.vertexWeights.push(i[4*u]),e.vertexWeights.push(i[4*u+1]),e.vertexWeights.push(i[4*u+2]),e.vertexWeights.push(i[4*u+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[4*(u-1)]),e.weightsIndices.push(c[4*(u-1)+1]),e.weightsIndices.push(c[4*(u-1)+2]),e.weightsIndices.push(c[4*(u-1)+3]),e.weightsIndices.push(c[4*u]),e.weightsIndices.push(c[4*u+1]),e.weightsIndices.push(c[4*u+2]),e.weightsIndices.push(c[4*u+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[3*(u-1)]),e.colors.push(s[3*(u-1)+1]),e.colors.push(s[3*(u-1)+2]),e.colors.push(s[3*u]),e.colors.push(s[3*u+1]),e.colors.push(s[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(a[0]),e.normal.push(a[1]),e.normal.push(a[2]),e.normal.push(a[3*(u-1)]),e.normal.push(a[3*(u-1)+1]),e.normal.push(a[3*(u-1)+2]),e.normal.push(a[3*u]),e.normal.push(a[3*u+1]),e.normal.push(a[3*u+2])),t.uv&&t.uv.forEach((function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(o[r][0]),e.uvs[r].push(o[r][1]),e.uvs[r].push(o[r][2*(u-1)]),e.uvs[r].push(o[r][2*(u-1)+1]),e.uvs[r].push(o[r][2*u]),e.uvs[r].push(o[r][2*u+1])}))}addMorphTargets(e,t,r,n){if(0===r.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const a=this;r.forEach((function(r){r.rawTargets.forEach((function(r){const s=Tn.Objects.Geometry[r.geoID];void 0!==s&&a.genMorphGeometry(e,t,s,n,r.name)}))}))}genMorphGeometry(t,r,n,a,s){const o=void 0!==r.PolygonVertexIndex?r.PolygonVertexIndex.a:[],i=void 0!==n.Vertices?n.Vertices.a:[],c=void 0!==n.Indexes?n.Indexes.a:[],l=3*t.attributes.position.count,u=new Float32Array(l);for(let e=0;e<c.length;e++){const t=3*c[e];u[t]=i[3*e],u[t+1]=i[3*e+1],u[t+2]=i[3*e+2]}const h={vertexIndices:o,vertexPositions:u},p=this.genBuffers(h),d=new e.Float32BufferAttribute(p.vertex,3);d.name=s||n.attrName,d.applyMatrix4(a),t.morphAttributes.position.push(d)}parseNormals(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a;let a=[];return"IndexToDirect"===r&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:a,mappingType:t,referenceType:r}}parseUVs(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a;let a=[];return"IndexToDirect"===r&&(a=e.UVIndex.a),{dataSize:2,buffer:n,indices:a,mappingType:t,referenceType:r}}parseVertexColors(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a;let a=[];return"IndexToDirect"===r&&(a=e.ColorIndex.a),{dataSize:4,buffer:n,indices:a,mappingType:t,referenceType:r}}parseMaterialIndices(e){const t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const n=e.Materials.a,a=[];for(let e=0;e<n.length;++e)a.push(e);return{dataSize:1,buffer:n,indices:a,mappingType:t,referenceType:r}}parseNurbsGeometry(t){if(void 0===Sn)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new e.BufferGeometry;const r=parseInt(t.Order);if(isNaN(r))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new e.BufferGeometry;const n=r-1,a=t.KnotVector.a,s=[],o=t.Points.a;for(let t=0,r=o.length;t<r;t+=4)s.push((new e.Vector4).fromArray(o,t));let i,c;if("Closed"===t.Form)s.push(s[0]);else if("Periodic"===t.Form){i=n,c=a.length-1-i;for(let e=0;e<n;++e)s.push(s[e])}const l=new Sn(n,a,s,i,c).getPoints(12*s.length);return(new e.BufferGeometry).setFromPoints(l)}}class Mn{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const r in t){const n=t[r],a=this.addClip(n);e.push(a)}return e}parseClips(){if(void 0===Tn.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Tn.Objects.AnimationCurveNode,t=new Map;for(const r in e){const n=e[r];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){const e={id:n.id,attr:n.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=Tn.Objects.AnimationCurve;for(const r in t){const n={id:t[r].id,times:t[r].KeyTime.a.map(Un),values:t[r].KeyValueFloat.a},a=Fn.get(n.id);if(void 0!==a){const t=a.parents[0].ID,r=a.parents[0].relationship;r.match(/X/)?e.get(t).curves.x=n:r.match(/Y/)?e.get(t).curves.y=n:r.match(/Z/)?e.get(t).curves.z=n:r.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=n)}}}parseAnimationLayers(t){const r=Tn.Objects.AnimationLayer,n=new Map;for(const a in r){const r=[],s=Fn.get(parseInt(a));if(void 0!==s){s.children.forEach((function(n,a){if(t.has(n.ID)){const s=t.get(n.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===r[a]){const t=Fn.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==t){const s=Tn.Objects.Model[t.toString()];if(void 0===s)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const o={modelName:s.attrName?e.PropertyBinding.sanitizeNodeName(s.attrName):"",ID:s.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};An.traverse((function(e){e.ID===s.id&&(o.transform=e.matrix,e.userData.transformData&&(o.eulerOrder=e.userData.transformData.eulerOrder))})),o.transform||(o.transform=new e.Matrix4),"PreRotation"in s&&(o.preRotation=s.PreRotation.value),"PostRotation"in s&&(o.postRotation=s.PostRotation.value),r[a]=o}}r[a]&&(r[a][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===r[a]){const t=Fn.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,s=Fn.get(t).parents[0].ID,o=Fn.get(s).parents[0].ID,i=Fn.get(o).parents[0].ID,c=Tn.Objects.Model[i],l={modelName:c.attrName?e.PropertyBinding.sanitizeNodeName(c.attrName):"",morphName:Tn.Objects.Deformer[t].attrName};r[a]=l}r[a][s.attr]=s}}})),n.set(parseInt(a),r)}}return n}parseAnimStacks(e){const t=Tn.Objects.AnimationStack,r={};for(const n in t){const a=Fn.get(parseInt(n)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=e.get(a[0].ID);r[n]={name:t[n].attrName,layer:s}}return r}addClip(t){let r=[];const n=this;return t.layer.forEach((function(e){r=r.concat(n.generateTracks(e))})),new e.AnimationClip(t.name,-1,r)}generateTracks(t){const r=[];let n=new e.Vector3,a=new e.Quaternion,s=new e.Vector3;if(t.transform&&t.transform.decompose(n,a,s),n=n.toArray(),a=(new e.Euler).setFromQuaternion(a,t.eulerOrder).toArray(),s=s.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){const e=this.generateVectorTrack(t.modelName,t.T.curves,n,"position");void 0!==e&&r.push(e)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){const e=this.generateRotationTrack(t.modelName,t.R.curves,a,t.preRotation,t.postRotation,t.eulerOrder);void 0!==e&&r.push(e)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){const e=this.generateVectorTrack(t.modelName,t.S.curves,s,"scale");void 0!==e&&r.push(e)}if(void 0!==t.DeformPercent){const e=this.generateMorphTrack(t);void 0!==e&&r.push(e)}return r}generateVectorTrack(t,r,n,a){const s=this.getTimesForAllAxes(r),o=this.getKeyframeTrackValues(s,r,n);return new e.VectorKeyframeTrack(t+"."+a,s,o)}generateRotationTrack(t,r,n,a,s,o){void 0!==r.x&&(this.interpolateRotations(r.x),r.x.values=r.x.values.map(e.MathUtils.degToRad)),void 0!==r.y&&(this.interpolateRotations(r.y),r.y.values=r.y.values.map(e.MathUtils.degToRad)),void 0!==r.z&&(this.interpolateRotations(r.z),r.z.values=r.z.values.map(e.MathUtils.degToRad));const i=this.getTimesForAllAxes(r),c=this.getKeyframeTrackValues(i,r,n);void 0!==a&&((a=a.map(e.MathUtils.degToRad)).push(o),a=(new e.Euler).fromArray(a),a=(new e.Quaternion).setFromEuler(a)),void 0!==s&&((s=s.map(e.MathUtils.degToRad)).push(o),s=(new e.Euler).fromArray(s),s=(new e.Quaternion).setFromEuler(s).invert());const l=new e.Quaternion,u=new e.Euler,h=[];for(let e=0;e<c.length;e+=3)u.set(c[e],c[e+1],c[e+2],o),l.setFromEuler(u),void 0!==a&&l.premultiply(a),void 0!==s&&l.multiply(s),l.toArray(h,e/3*4);return new e.QuaternionKeyframeTrack(t+".quaternion",i,h)}generateMorphTrack(t){const r=t.DeformPercent.curves.morph,n=r.values.map((function(e){return e/100})),a=An.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new e.NumberKeyframeTrack(t.modelName+".morphTargetInfluences["+a+"]",r.times,n)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,r=t[0];for(let n=1;n<t.length;n++){const a=t[n];a!==r&&(t[e]=a,r=a,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,r){const n=r,a=[];let s=-1,o=-1,i=-1;return e.forEach((function(e){if(t.x&&(s=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(i=t.z.times.indexOf(e)),-1!==s){const e=t.x.values[s];a.push(e),n[0]=e}else a.push(n[0]);if(-1!==o){const e=t.y.values[o];a.push(e),n[1]=e}else a.push(n[1]);if(-1!==i){const e=t.z.values[i];a.push(e),n[2]=e}else a.push(n[2])})),a}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const r=e.values[t-1],n=e.values[t]-r,a=Math.abs(n);if(a>=180){const s=a/180,o=n/s;let i=r+o;const c=e.times[t-1],l=(e.times[t]-c)/s;let u=c+l;const h=[],p=[];for(;u<e.times[t];)h.push(u),u+=l,p.push(i),i+=o;e.times=jn(e.times,t,h),e.values=jn(e.values,t,p)}}}}class Ln{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Rn,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,r=e.split(/[\r\n]+/);return r.forEach((function(e,n){const a=e.match(/^[\s\t]*;/),s=e.match(/^[\s\t]*$/);if(a||s)return;const o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),i=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):i?t.parseNodeProperty(e,i,r[++n]):c?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),a={name:r},s=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,a):r in o?("PoseNode"===r?o.PoseNode.push(a):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==s.id&&(o[r][s.id]=a)):"number"==typeof s.id?(o[r]={},o[r][s.id]=a):"Properties70"!==r&&(o[r]="PoseNode"===r?[a]:a),"number"==typeof s.id&&(a.id=s.id),""!==s.name&&(a.attrName=s.name),""!==s.type&&(a.attrType=s.type),this.pushStack(a)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}}parseNodeProperty(e,t,r){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===a&&(a=r.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if("Properties70"!==s.name){if("C"===n){const e=a.split(",").slice(1),t=parseInt(e[0]),r=parseInt(e[1]);let o=a.split(",").slice(3);o=o.map((function(e){return e.trim().replace(/^"/,"")})),n="connections",a=[t,r],function(e,t){for(let r=0,n=e.length,a=t.length;r<a;r++,n++)e[n]=t[r]}(a,o),void 0===s[n]&&(s[n]=[])}"Node"===n&&(s.id=a),n in s&&Array.isArray(s[n])?s[n].push(a):"a"!==n?s[n]=a:s.a=a,this.setCurrentProp(s,n),"a"===n&&","!==a.slice(-1)&&(s.a=Vn(a))}else this.parseNodeSpecialProperty(e,n,a)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Vn(t.a))}parseNodeSpecialProperty(e,t,r){const n=r.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),a=n[0],s=n[1],o=n[2],i=n[3];let c=n[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=Vn(c)}this.getPrevNode()[a]={type:s,type2:o,flag:i,value:c},this.setCurrentProp(this.getPrevNode(),a)}}class Cn{parse(e){const t=new On(e);t.skip(23);const r=t.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const n=new Rn;for(;!this.endOfContent(t);){const e=this.parseNode(t,r);null!==e&&n.add(e.name,e)}return n}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const r={},n=t>=7500?e.getUint64():e.getUint32(),a=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),o=e.getString(s);if(0===n)return null;const i=[];for(let t=0;t<a;t++)i.push(this.parseProperty(e));const c=i.length>0?i[0]:"",l=i.length>1?i[1]:"",u=i.length>2?i[2]:"";for(r.singleProperty=1===a&&e.getOffset()===n;n>e.getOffset();){const n=this.parseNode(e,t);null!==n&&this.parseSubNode(o,r,n)}return r.propertyList=i,"number"==typeof c&&(r.id=c),""!==l&&(r.attrName=l),""!==u&&(r.attrType=u),""!==o&&(r.name=o),r}parseSubNode(e,t,r){if(!0===r.singleProperty){const e=r.propertyList[0];Array.isArray(e)?(t[r.name]=r,r.a=e):t[r.name]=e}else if("Connections"===e&&"C"===r.name){const e=[];r.propertyList.forEach((function(t,r){0!==r&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===r.name){Object.keys(r).forEach((function(e){t[e]=r[e]}))}else if("Properties70"===e&&"P"===r.name){let e=r.propertyList[0],n=r.propertyList[1];const a=r.propertyList[2],s=r.propertyList[3];let o;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),o="Color"===n||"ColorRGB"===n||"Vector"===n||"Vector3D"===n||0===n.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[e]={type:n,type2:a,flag:s,value:o}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)}parseProperty(e){const t=e.getString(1);let r;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return r=e.getUint32(),e.getArrayBuffer(r);case"S":return r=e.getUint32(),e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=e.getUint32(),a=e.getUint32(),s=e.getUint32();if(0===a)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}void 0===yn&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const o=jr(new Uint8Array(e.getArrayBuffer(s))),i=new On(o.buffer);switch(t){case"b":case"c":return i.getBooleanArray(n);case"d":return i.getFloat64Array(n);case"f":return i.getFloat32Array(n);case"i":return i.getInt32Array(n);case"l":return i.getInt64Array(n)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class On{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(t){let r=[];for(let e=0;e<t;e++)r[e]=this.getUint8();const n=r.indexOf(0);return n>=0&&(r=r.slice(0,n)),e.LoaderUtils.decodeText(new Uint8Array(r))}}class Rn{add(e,t){this[e]=t}}function Nn(e){const t=e.match(/FBXVersion: (\d+)/);if(t){return parseInt(t[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Un(e){return e/46186158e3}const Pn=[];function Dn(e,t,r,n){let a;switch(n.mappingType){case"ByPolygonVertex":a=e;break;case"ByPolygon":a=t;break;case"ByVertice":a=r;break;case"AllSame":a=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(a=n.indices[a]);const s=a*n.dataSize,o=s+n.dataSize;return function(e,t,r,n){for(let a=r,s=0;a<n;a++,s++)e[s]=t[a];return e}(Pn,n.buffer,s,o)}const Bn=new e.Euler,_n=new e.Vector3;function Gn(t){const r=new e.Matrix4,n=new e.Matrix4,a=new e.Matrix4,s=new e.Matrix4,o=new e.Matrix4,i=new e.Matrix4,c=new e.Matrix4,l=new e.Matrix4,u=new e.Matrix4,h=new e.Matrix4,p=new e.Matrix4,d=new e.Matrix4,f=t.inheritType?t.inheritType:0;if(t.translation&&r.setPosition(_n.fromArray(t.translation)),t.preRotation){const r=t.preRotation.map(e.MathUtils.degToRad);r.push(t.eulerOrder),n.makeRotationFromEuler(Bn.fromArray(r))}if(t.rotation){const r=t.rotation.map(e.MathUtils.degToRad);r.push(t.eulerOrder),a.makeRotationFromEuler(Bn.fromArray(r))}if(t.postRotation){const r=t.postRotation.map(e.MathUtils.degToRad);r.push(t.eulerOrder),s.makeRotationFromEuler(Bn.fromArray(r)),s.invert()}t.scale&&o.scale(_n.fromArray(t.scale)),t.scalingOffset&&c.setPosition(_n.fromArray(t.scalingOffset)),t.scalingPivot&&i.setPosition(_n.fromArray(t.scalingPivot)),t.rotationOffset&&l.setPosition(_n.fromArray(t.rotationOffset)),t.rotationPivot&&u.setPosition(_n.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(p.copy(t.parentMatrix),h.copy(t.parentMatrixWorld));const g=n.clone().multiply(a).multiply(s),m=new e.Matrix4;m.extractRotation(h);const v=new e.Matrix4;v.copyPosition(h);const y=v.clone().invert().multiply(h),b=m.clone().invert().multiply(y),x=o,w=new e.Matrix4;if(0===f)w.copy(m).multiply(g).multiply(b).multiply(x);else if(1===f)w.copy(m).multiply(b).multiply(g).multiply(x);else{const t=(new e.Matrix4).scale((new e.Vector3).setFromMatrixScale(p)).clone().invert(),r=b.clone().multiply(t);w.copy(m).multiply(g).multiply(r).multiply(x)}const S=u.clone().invert(),T=i.clone().invert();let F=r.clone().multiply(l).multiply(u).multiply(n).multiply(a).multiply(s).multiply(S).multiply(c).multiply(i).multiply(o).multiply(T);const A=(new e.Matrix4).copyPosition(F),k=h.clone().multiply(A);return d.copyPosition(k),F=d.clone().multiply(w),F.premultiply(h.invert()),F}function Hn(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function Vn(e){return e.split(",").map((function(e){return parseFloat(e)}))}function zn(t,r,n){return void 0===r&&(r=0),void 0===n&&(n=t.byteLength),e.LoaderUtils.decodeText(new Uint8Array(t,r,n))}function jn(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}function Wn(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}return r}function Xn(e){this.IFF=e}function qn(e){this.IFF=e}function Yn(){this.debugger=new Zn}function Kn(e){this.dv=new DataView(e),this.offset=0}function Zn(){this.active=!1,this.depth=0,this.formList=[]}function Qn(e){return e%2}function Jn(e){return e.length+1+(Qn(e.length+1)?1:0)}let $n;Xn.prototype={constructor:Xn,parseBlock:function(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();var e=this.IFF.reader.getIDTag(),t=this.IFF.reader.getUint32();switch(t>this.IFF.reader.dv.byteLength-this.IFF.reader.offset&&(this.IFF.reader.offset-=4,t=this.IFF.reader.getUint16()),this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=t,e){case"FORM":this.IFF.parseForm(t);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"AUVO":case"STCK":case"PROC":case"VALU":case"FUNC":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NVSK":case"NCRD":case"WRPW":case"WRPH":case"NMOD":case"NPRW":case"NPLA":case"NODS":case"VERS":case"ENUM":case"TAG ":case"OPAC":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"GLOW":case"GVAL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"LINE":case"ALPH":case"VCOL":case"ENAB":case"TMAP":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"SURF":this.IFF.parseSurfaceLwo2(t);break;case"CLIP":this.IFF.parseClipLwo2(t);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":4===t?this.IFF.currentNode[e]=this.IFF.reader.getInt32():this.IFF.reader.skip(t);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(t);break;case"PNTS":this.IFF.parsePoints(t);break;case"VMAP":this.IFF.parseVertexMapping(t);break;case"AUVU":case"AUVN":this.IFF.reader.skip(t-1),this.IFF.reader.getVariableLengthIndex();break;case"POLS":this.IFF.parsePolygonList(t);break;case"TAGS":this.IFF.parseTagStrings(t);break;case"PTAG":this.IFF.parsePolygonTagMapping(t);break;case"VMAD":this.IFF.parseVertexMapping(t,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":var r=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=r;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":4===t?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(t);break;case"SMAN":var n=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(n<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.reader.skip(2);break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(t);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;case"BLOK":break;default:this.IFF.parseUnknownCHUNK(e,t)}"FORM"!=e&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=e,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}},qn.prototype={constructor:qn,parseBlock:function(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();var e=this.IFF.reader.getIDTag(),t=this.IFF.reader.getUint32();switch(this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=t,e){case"FORM":this.IFF.parseForm(t);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"STCK":case"VALU":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NCRD":case"NMOD":case"NSEL":case"NPRW":case"NPLA":case"VERS":case"ENUM":case"TAG ":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"GLOW":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":4===t?this.IFF.currentNode[e]=this.IFF.reader.getInt32():this.IFF.reader.skip(t);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(t);break;case"PNTS":this.IFF.parsePoints(t);break;case"VMAP":this.IFF.parseVertexMapping(t);break;case"POLS":this.IFF.parsePolygonList(t);break;case"TAGS":this.IFF.parseTagStrings(t);break;case"PTAG":this.IFF.parsePolygonTagMapping(t);break;case"VMAD":this.IFF.parseVertexMapping(t,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":var r=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=r;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":4===t?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(t);break;case"SMAN":var n=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(n<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.currentSurface.attributes.imageMapIndex=this.IFF.reader.getUint32();break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(t);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;default:this.IFF.parseUnknownCHUNK(e,t)}"FORM"!=e&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=e,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}},Yn.prototype={constructor:Yn,parse:function(e){if(this.reader=new Kn(e),this.tree={materials:{},layers:[],tags:[],textures:[]},this.currentLayer=this.tree,this.currentForm=this.tree,this.parseTopForm(),void 0!==this.tree.format){if("LWO2"===this.tree.format)for(this.parser=new Xn(this);!this.reader.endOfFile();)this.parser.parseBlock();else if("LWO3"===this.tree.format)for(this.parser=new qn(this);!this.reader.endOfFile();)this.parser.parseBlock();return this.debugger.offset=this.reader.offset,this.debugger.closeForms(),this.tree}},parseTopForm(){if(this.debugger.offset=this.reader.offset,"FORM"===this.reader.getIDTag()){var e=this.reader.getUint32();this.debugger.dataOffset=this.reader.offset,this.debugger.length=e;var t=this.reader.getIDTag();("LWO2"===t||"LWO3"===t)&&(this.tree.format=t),this.debugger.node=0,this.debugger.nodeID=t,this.debugger.log()}else console.warn("LWOLoader: Top-level FORM missing.")},parseForm(e){var t=this.reader.getIDTag();switch(t){case"ISEQ":case"ANIM":case"STCC":case"VPVL":case"VPRM":case"NROT":case"WRPW":case"WRPH":case"FUNC":case"FALL":case"OPAC":case"GRAD":case"ENVS":case"VMOP":case"VMBG":case"OMAX":case"STEX":case"CKBG":case"CKEY":case"VMLA":case"VMLB":this.debugger.skipped=!0,this.skipForm(e);break;case"META":case"NNDS":case"NODS":case"NDTA":case"ADAT":case"AOVS":case"BLOK":case"IBGC":case"IOPC":case"IIMG":case"TXTR":this.debugger.length=4,this.debugger.skipped=!0;break;case"IFAL":case"ISCL":case"IPOS":case"IROT":case"IBMP":case"IUTD":case"IVTD":this.parseTextureNodeAttribute(t);break;case"ENVL":this.parseEnvelope(e);break;case"CLIP":"LWO2"===this.tree.format?this.parseForm(e):this.parseClip(e);break;case"STIL":this.parseImage();break;case"XREF":this.reader.skip(8),this.currentForm.referenceTexture={index:this.reader.getUint32(),refName:this.reader.getString()};break;case"IMST":this.parseImageStateForm(e);break;case"SURF":this.parseSurfaceForm(e);break;case"VALU":this.parseValueForm(e);break;case"NTAG":this.parseSubNode(e);break;case"ATTR":case"SATR":this.setupForm("attributes",e);break;case"NCON":this.parseConnections(e);break;case"SSHA":this.parentForm=this.currentForm,this.currentForm=this.currentSurface,this.setupForm("surfaceShader",e);break;case"SSHD":this.setupForm("surfaceShaderData",e);break;case"ENTR":this.parseEntryForm(e);break;case"IMAP":this.parseImageMap(e);break;case"TAMP":this.parseXVAL("amplitude",e);break;case"TMAP":this.setupForm("textureMap",e);break;case"CNTR":this.parseXVAL3("center",e);break;case"SIZE":this.parseXVAL3("scale",e);break;case"ROTA":this.parseXVAL3("rotation",e);break;default:this.parseUnknownForm(t,e)}this.debugger.node=0,this.debugger.nodeID=t,this.debugger.log()},setupForm(e,t){this.currentForm||(this.currentForm=this.currentNode),this.currentFormEnd=this.reader.offset+t,this.parentForm=this.currentForm,this.currentForm[e]?(console.warn("LWOLoader: form already exists on parent: ",e,this.currentForm),this.currentForm=this.currentForm[e]):(this.currentForm[e]={},this.currentForm=this.currentForm[e])},skipForm(e){this.reader.skip(e-4)},parseUnknownForm(t,r){var n,a,s;console.warn("LWOLoader: unknown FORM encountered: "+t,r),n=this.reader.dv.buffer,a=this.reader.offset,s=r-4,console.log(e.LoaderUtils.decodeText(new Uint8Array(n,a,s))),this.reader.skip(r-4)},parseSurfaceForm(e){this.reader.skip(8);var t=this.reader.getString(),r={attributes:{},connections:{},name:t,inputName:t,nodes:{},source:this.reader.getString()};this.tree.materials[t]=r,this.currentSurface=r,this.parentForm=this.tree.materials,this.currentForm=r,this.currentFormEnd=this.reader.offset+e},parseSurfaceLwo2(e){var t=this.reader.getString(),r={attributes:{},connections:{},name:t,nodes:{},source:this.reader.getString()};this.tree.materials[t]=r,this.currentSurface=r,this.parentForm=this.tree.materials,this.currentForm=r,this.currentFormEnd=this.reader.offset+e},parseSubNode(e){this.reader.skip(8);var t={name:this.reader.getString()};this.currentForm=t,this.currentNode=t,this.currentFormEnd=this.reader.offset+e},parseConnections(e){this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.currentForm=this.currentSurface.connections},parseEntryForm(e){this.reader.skip(8);var t=this.reader.getString();this.currentForm=this.currentNode.attributes,this.setupForm(t,e)},parseValueForm(){this.reader.skip(8);var e=this.reader.getString();"double"===e?this.currentForm.value=this.reader.getUint64():"int"===e?this.currentForm.value=this.reader.getUint32():"vparam"===e?(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64()):"vparam3"===e&&(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64Array(3))},parseImageStateForm(){this.reader.skip(8),this.currentForm.mipMapLevel=this.reader.getFloat32()},parseImageMap(e){this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.currentForm.maps||(this.currentForm.maps=[]);var t={};this.currentForm.maps.push(t),this.currentForm=t,this.reader.skip(10)},parseTextureNodeAttribute(e){switch(this.reader.skip(28),this.reader.skip(20),e){case"ISCL":this.currentNode.scale=this.reader.getFloat32Array(3);break;case"IPOS":this.currentNode.position=this.reader.getFloat32Array(3);break;case"IROT":this.currentNode.rotation=this.reader.getFloat32Array(3);break;case"IFAL":this.currentNode.falloff=this.reader.getFloat32Array(3);break;case"IBMP":this.currentNode.amplitude=this.reader.getFloat32();break;case"IUTD":this.currentNode.uTiles=this.reader.getFloat32();break;case"IVTD":this.currentNode.vTiles=this.reader.getFloat32()}this.reader.skip(2)},parseEnvelope(e){this.reader.skip(e-4)},parseClip(e){if("FORM"===this.reader.getIDTag())return this.reader.skip(16),void(this.currentNode.fileName=this.reader.getString());this.reader.setOffset(this.reader.offset-4),this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.reader.skip(8);var t={index:this.reader.getUint32()};this.tree.textures.push(t),this.currentForm=t},parseClipLwo2(e){for(var t={index:this.reader.getUint32(),fileName:""};;){var r=this.reader.getIDTag(),n=this.reader.getUint16();if("STIL"===r){t.fileName=this.reader.getString();break}if(n>=e)break}this.tree.textures.push(t),this.currentForm=t},parseImage(){this.reader.skip(8),this.currentForm.fileName=this.reader.getString()},parseXVAL(e,t){var r=this.reader.offset+t-4;this.reader.skip(8),this.currentForm[e]=this.reader.getFloat32(),this.reader.setOffset(r)},parseXVAL3(e,t){var r=this.reader.offset+t-4;this.reader.skip(8),this.currentForm[e]={x:this.reader.getFloat32(),y:this.reader.getFloat32(),z:this.reader.getFloat32()},this.reader.setOffset(r)},parseObjectTag(){this.tree.objectTags||(this.tree.objectTags={}),this.tree.objectTags[this.reader.getIDTag()]={tagString:this.reader.getString()}},parseLayer(e){var t={number:this.reader.getUint16(),flags:this.reader.getUint16(),pivot:this.reader.getFloat32Array(3),name:this.reader.getString()};this.tree.layers.push(t),this.currentLayer=t;var r=16+Jn(this.currentLayer.name);this.currentLayer.parent=r<e?this.reader.getUint16():-1},parsePoints(e){this.currentPoints=[];for(var t=0;t<e/4;t+=3)this.currentPoints.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32())},parseVertexMapping(e,t){var r=this.reader.offset+e,n=this.reader.getString();if(this.reader.offset!==r){this.reader.setOffset(this.reader.offset-Jn(n));var a=this.reader.getIDTag();this.reader.getUint16();var s=this.reader.getString(),o=e-6-Jn(s);switch(a){case"TXUV":this.parseUVMapping(s,r,t);break;case"MORF":case"SPOT":this.parseMorphTargets(s,r,a);break;case"APSL":case"NORM":case"WGHT":case"MNVW":case"PICK":case"RGB ":case"RGBA":this.reader.skip(o);break;default:console.warn("LWOLoader: unknown vertex map type: "+a),this.reader.skip(o)}}else this.currentForm.UVChannel=n},parseUVMapping(e,t,r){for(var n=[],a=[],s=[];this.reader.offset<t;)n.push(this.reader.getVariableLengthIndex()),r&&a.push(this.reader.getVariableLengthIndex()),s.push(this.reader.getFloat32(),this.reader.getFloat32());r?(this.currentLayer.discontinuousUVs||(this.currentLayer.discontinuousUVs={}),this.currentLayer.discontinuousUVs[e]={uvIndices:n,polyIndices:a,uvs:s}):(this.currentLayer.uvs||(this.currentLayer.uvs={}),this.currentLayer.uvs[e]={uvIndices:n,uvs:s})},parseMorphTargets(e,t,r){var n=[],a=[];for(r="MORF"===r?"relative":"absolute";this.reader.offset<t;)n.push(this.reader.getVariableLengthIndex()),a.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32());this.currentLayer.morphTargets||(this.currentLayer.morphTargets={}),this.currentLayer.morphTargets[e]={indices:n,points:a,type:r}},parsePolygonList(e){for(var t=this.reader.offset+e,r=this.reader.getIDTag(),n=[],a=[];this.reader.offset<t;){var s=this.reader.getUint16();s&=1023,a.push(s);for(var o=0;o<s;o++)n.push(this.reader.getVariableLengthIndex())}var i={type:r,vertexIndices:n,polygonDimensions:a,points:this.currentPoints};1===a[0]?i.type="points":2===a[0]&&(i.type="lines"),this.currentLayer.geometry=i},parseTagStrings(e){this.tree.tags=this.reader.getStringArray(e)},parsePolygonTagMapping(e){var t=this.reader.offset+e;"SURF"===this.reader.getIDTag()?this.parseMaterialIndices(t):this.reader.skip(e-4)},parseMaterialIndices(e){for(this.currentLayer.geometry.materialIndices=[];this.reader.offset<e;){var t=this.reader.getVariableLengthIndex(),r=this.reader.getUint16();this.currentLayer.geometry.materialIndices.push(t,r)}},parseUnknownCHUNK(e,t){console.warn("LWOLoader: unknown chunk type: "+e+" length: "+t);var r=this.reader.getString(t);this.currentForm[e]=r}},Kn.prototype={constructor:Kn,size:function(){return this.dv.buffer.byteLength},setOffset(e){e>0&&e<this.dv.buffer.byteLength?this.offset=e:console.error("LWOLoader: invalid buffer offset")},endOfFile:function(){return this.offset>=this.size()},skip:function(e){this.offset+=e},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getUint16:function(){var e=this.dv.getUint16(this.offset);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,!1);return this.offset+=4,e},getUint32:function(){var e=this.dv.getUint32(this.offset,!1);return this.offset+=4,e},getUint64:function(){return 4294967296*this.getUint32()+this.getUint32()},getFloat32:function(){var e=this.dv.getFloat32(this.offset,!1);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getVariableLengthIndex(){var e=this.getUint8();return 255===e?65536*this.getUint8()+256*this.getUint8()+this.getUint8():256*e+this.getUint8()},getIDTag(){return this.getString(4)},getString:function(t){if(0!==t){var r=[];if(t)for(var n=0;n<t;n++)r[n]=this.getUint8();else{for(var a,s=0;0!==a;)0!==(a=this.getUint8())&&r.push(a),s++;Qn(s+1)||this.getUint8()}return e.LoaderUtils.decodeText(new Uint8Array(r))}},getStringArray:function(e){var t=this.getString(e);return(t=t.split("\0")).filter(Boolean)}},Zn.prototype={constructor:Zn,enable:function(){this.active=!0},log:function(){if(this.active){var e;switch(this.node){case 0:e="FORM";break;case 1:e="CHK";break;case 2:e="S-CHK"}console.log("| ".repeat(this.depth)+e,this.nodeID,`( ${this.offset} ) -> ( ${this.dataOffset+this.length} )`,0==this.node?" {":"",this.skipped?"SKIPPED":"",0==this.node&&this.skipped?"}":""),0!=this.node||this.skipped||(this.depth+=1,this.formList.push(this.dataOffset+this.length)),this.skipped=!1}},closeForms:function(){if(this.active)for(var e=this.formList.length-1;e>=0;e--)this.offset>=this.formList[e]&&(this.depth-=1,console.log("| ".repeat(this.depth)+"}"),this.formList.splice(-1,1))}};class ea extends e.Loader{constructor(e,t={}){super(e),this.resourcePath=void 0!==t.resourcePath?t.resourcePath:""}load(t,r,n,a){const s=this,o=""===s.path?function(e,t){const r=e.indexOf(t);return-1===r?"./":e.substr(0,r)}(t,"Objects"):s.path,i=t.split(o).pop().split(".")[0],c=new e.FileLoader(this.manager);c.setPath(s.path),c.setResponseType("arraybuffer"),c.load(t,(function(e){try{r(s.parse(e,o,i))}catch(e){a?a(e):console.error(e),s.manager.itemError(t)}}),n,a)}parse(t,r,n){$n=(new Yn).parse(t);const a=new e.TextureLoader(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin);return new ta(a).parse(n)}}class ta{constructor(e){this.textureLoader=e}parse(e){return this.materials=new ra(this.textureLoader).parse(),this.defaultLayerName=e,this.meshes=this.parseLayers(),{materials:this.materials,meshes:this.meshes}}parseLayers(){const e=[],t=[],r=new na,n=this;return $n.layers.forEach((function(a){const s=r.parse(a.geometry,a),o=n.parseMesh(s,a);e[a.number]=o,-1===a.parent?t.push(o):e[a.parent].add(o)})),this.applyPivots(t),t}parseMesh(t,r){let n;const a=this.getMaterials(t.userData.matNames,r.geometry.type);return this.duplicateUVs(t,a),n="points"===r.geometry.type?new e.Points(t,a):"lines"===r.geometry.type?new e.LineSegments(t,a):new e.Mesh(t,a),r.name?n.name=r.name:n.name=this.defaultLayerName+"_layer_"+r.number,n.userData.pivot=r.pivot,n}applyPivots(e){e.forEach((function(e){e.traverse((function(e){const t=e.userData.pivot;if(e.position.x+=t[0],e.position.y+=t[1],e.position.z+=t[2],e.parent){const t=e.parent.userData.pivot;e.position.x-=t[0],e.position.y-=t[1],e.position.z-=t[2]}}))}))}getMaterials(t,r){const n=[],a=this;t.forEach((function(e,t){n[t]=a.getMaterialByName(e)})),"points"!==r&&"lines"!==r||n.forEach((function(t,a){const s={color:t.color};"points"===r?(s.size=.1,s.map=t.map,n[a]=new e.PointsMaterial(s)):"lines"===r&&(n[a]=new e.LineBasicMaterial(s))}));const s=n.filter(Boolean);return 1===s.length?s[0]:n}getMaterialByName(e){return this.materials.filter((function(t){return t.name===e}))[0]}duplicateUVs(t,r){let n=!1;Array.isArray(r)?r.forEach((function(e){e.aoMap&&(n=!0)})):r.aoMap&&(n=!0),n&&t.setAttribute("uv2",new e.BufferAttribute(t.attributes.uv.array,2))}}class ra{constructor(e){this.textureLoader=e}parse(){const e=[];this.textures={};for(const t in $n.materials)"LWO3"===$n.format?e.push(this.parseMaterial($n.materials[t],t,$n.textures)):"LWO2"===$n.format&&e.push(this.parseMaterialLwo2($n.materials[t],t,$n.textures));return e}parseMaterial(e,t,r){let n={name:t,side:this.getSide(e.attributes),flatShading:this.getSmooth(e.attributes)};const a=this.parseConnections(e.connections,e.nodes),s=this.parseTextureNodes(a.maps);this.parseAttributeImageMaps(a.attributes,r,s,e.maps);const o=this.parseAttributes(a.attributes,s);this.parseEnvMap(a,s,o),n=Object.assign(s,n),n=Object.assign(n,o);return new(this.getMaterialType(a.attributes))(n)}parseMaterialLwo2(t,r){let n={name:r,side:this.getSide(t.attributes),flatShading:this.getSmooth(t.attributes)};const a=this.parseAttributes(t.attributes,{});return n=Object.assign(n,a),new e.MeshPhongMaterial(n)}getSide(t){if(!t.side)return e.BackSide;switch(t.side){case 0:case 1:return e.BackSide;case 2:return e.FrontSide;case 3:return e.DoubleSide}}getSmooth(e){return!e.smooth||!e.smooth}parseConnections(e,t){const r={maps:{}},n=e.inputName,a=e.inputNodeName,s=e.nodeName,o=this;return n.forEach((function(e,n){if("Material"===e){const e=o.getNodeByRefName(a[n],t);r.attributes=e.attributes,r.envMap=e.fileName,r.name=a[n]}})),s.forEach((function(e,s){e===r.name&&(r.maps[n[s]]=o.getNodeByRefName(a[s],t))})),r}getNodeByRefName(e,t){for(const r in t)if(t[r].refName===e)return t[r]}parseTextureNodes(t){const r={};for(const n in t){const a=t[n],s=a.fileName;if(!s)return;const o=this.loadTexture(s);switch(void 0!==a.widthWrappingMode&&(o.wrapS=this.getWrappingType(a.widthWrappingMode)),void 0!==a.heightWrappingMode&&(o.wrapT=this.getWrappingType(a.heightWrappingMode)),n){case"Color":r.map=o;break;case"Roughness":r.roughnessMap=o,r.roughness=.5;break;case"Specular":r.specularMap=o,r.specular=16777215;break;case"Luminous":r.emissiveMap=o,r.emissive=8421504;break;case"Luminous Color":r.emissive=8421504;break;case"Metallic":r.metalnessMap=o,r.metalness=.5;break;case"Transparency":case"Alpha":r.alphaMap=o,r.transparent=!0;break;case"Normal":r.normalMap=o,void 0!==a.amplitude&&(r.normalScale=new e.Vector2(a.amplitude,a.amplitude));break;case"Bump":r.bumpMap=o}}return r.roughnessMap&&r.specularMap&&delete r.specularMap,r}parseAttributeImageMaps(e,t,r){for(const n in e){const a=e[n];if(a.maps){const e=a.maps[0],s=this.getTexturePathByIndex(e.imageIndex,t);if(!s)return;const o=this.loadTexture(s);switch(void 0!==e.wrap&&(o.wrapS=this.getWrappingType(e.wrap.w)),void 0!==e.wrap&&(o.wrapT=this.getWrappingType(e.wrap.h)),n){case"Color":r.map=o;break;case"Diffuse":r.aoMap=o;break;case"Roughness":r.roughnessMap=o,r.roughness=1;break;case"Specular":r.specularMap=o,r.specular=16777215;break;case"Luminosity":r.emissiveMap=o,r.emissive=8421504;break;case"Metallic":r.metalnessMap=o,r.metalness=1;break;case"Transparency":case"Alpha":r.alphaMap=o,r.transparent=!0;break;case"Normal":r.normalMap=o;break;case"Bump":r.bumpMap=o}}}}parseAttributes(t,r){const n={};return t.Color&&!r.map?n.color=(new e.Color).fromArray(t.Color.value):n.color=new e.Color,t.Transparency&&0!==t.Transparency.value&&(n.opacity=1-t.Transparency.value,n.transparent=!0),t["Bump Height"]&&(n.bumpScale=.1*t["Bump Height"].value),t["Refraction Index"]&&(n.refractionRatio=1/t["Refraction Index"].value),this.parsePhysicalAttributes(n,t,r),this.parseStandardAttributes(n,t,r),this.parsePhongAttributes(n,t,r),n}parsePhysicalAttributes(e,t){t.Clearcoat&&t.Clearcoat.value>0&&(e.clearcoat=t.Clearcoat.value,t["Clearcoat Gloss"]&&(e.clearcoatRoughness=.5*(1-t["Clearcoat Gloss"].value)))}parseStandardAttributes(t,r,n){r.Luminous&&(t.emissiveIntensity=r.Luminous.value,r["Luminous Color"]&&!n.emissive?t.emissive=(new e.Color).fromArray(r["Luminous Color"].value):t.emissive=new e.Color(8421504)),r.Roughness&&!n.roughnessMap&&(t.roughness=r.Roughness.value),r.Metallic&&!n.metalnessMap&&(t.metalness=r.Metallic.value)}parsePhongAttributes(t,r,n){r.Diffuse&&t.color.multiplyScalar(r.Diffuse.value),r.Reflection&&(t.reflectivity=r.Reflection.value,t.combine=e.AddOperation),r.Luminosity&&(t.emissiveIntensity=r.Luminosity.value,n.emissiveMap||n.map?t.emissive=new e.Color(8421504):t.emissive=t.color),r.Roughness||!r.Specular||n.specularMap||(r["Color Highlight"]?t.specular=(new e.Color).setScalar(r.Specular.value).lerp(t.color.clone().multiplyScalar(r.Specular.value),r["Color Highlight"].value):t.specular=(new e.Color).setScalar(r.Specular.value)),t.specular&&r.Glossiness&&(t.shininess=7+Math.pow(2,12*r.Glossiness.value+2))}parseEnvMap(t,r,n){if(t.envMap){const a=this.loadTexture(t.envMap);n.transparent&&n.opacity<.999?(a.mapping=e.EquirectangularRefractionMapping,void 0!==n.reflectivity&&(delete n.reflectivity,delete n.combine),void 0!==n.metalness&&delete n.metalness):a.mapping=e.EquirectangularReflectionMapping,r.envMap=a}}getTexturePathByIndex(e){let t="";return $n.textures?($n.textures.forEach((function(r){r.index===e&&(t=r.fileName)})),t):t}loadTexture(e){if(!e)return null;return this.textureLoader.load(e,void 0,void 0,(function(){console.warn("LWOLoader: non-standard resource hierarchy. Use `resourcePath` parameter to specify root content directory.")}))}getWrappingType(t){switch(t){case 0:return console.warn('LWOLoader: "Reset" texture wrapping type is not supported in three.js'),e.ClampToEdgeWrapping;case 1:return e.RepeatWrapping;case 2:return e.MirroredRepeatWrapping;case 3:return e.ClampToEdgeWrapping}}getMaterialType(t){return t.Clearcoat&&t.Clearcoat.value>0?e.MeshPhysicalMaterial:t.Roughness?e.MeshStandardMaterial:e.MeshPhongMaterial}}class na{parse(t,r){const n=new e.BufferGeometry;n.setAttribute("position",new e.Float32BufferAttribute(t.points,3));const a=this.splitIndices(t.vertexIndices,t.polygonDimensions);return n.setIndex(a),this.parseGroups(n,t),n.computeVertexNormals(),this.parseUVs(n,r,a),this.parseMorphTargets(n,r,a),n.translate(-r.pivot[0],-r.pivot[1],-r.pivot[2]),n}splitIndices(e,t){const r=[];let n=0;return t.forEach((function(t){if(t<4)for(let a=0;a<t;a++)r.push(e[n+a]);else if(4===t)r.push(e[n],e[n+1],e[n+2],e[n],e[n+2],e[n+3]);else if(t>4){for(let a=1;a<t-1;a++)r.push(e[n],e[n+a],e[n+a+1]);console.warn("LWOLoader: polygons with greater than 4 sides are not supported")}n+=t})),r}parseGroups(e,t){const r=$n.tags,n=[];let a=3;"lines"===t.type&&(a=2),"points"===t.type&&(a=1);const s=this.splitMaterialIndices(t.polygonDimensions,t.materialIndices);let o=0;const i={};let c,l,u=0,h=0;for(let t=0;t<s.length;t+=2){if(l=s[t+1],0===t&&(n[o]=r[l]),void 0===c&&(c=l),l!==c){let t;i[r[c]]?t=i[r[c]]:(t=o,i[r[c]]=o,n[o]=r[c],o++),e.addGroup(u,h,t),u+=h,c=l,h=0}h+=a}if(e.groups.length>0){let t;i[r[l]]?t=i[r[l]]:(t=o,i[r[l]]=o,n[o]=r[l]),e.addGroup(u,h,t)}e.userData.matNames=n}splitMaterialIndices(e,t){const r=[];return e.forEach((function(e,n){if(e<=3)r.push(t[2*n],t[2*n+1]);else if(4===e)r.push(t[2*n],t[2*n+1],t[2*n],t[2*n+1]);else for(let a=0;a<e-2;a++)r.push(t[2*n],t[2*n+1])})),r}parseUVs(t,r){const n=Array.from(Array(2*t.attributes.position.count),(function(){return 0}));for(const e in r.uvs){const t=r.uvs[e].uvs;r.uvs[e].uvIndices.forEach((function(e,r){n[2*e]=t[2*r],n[2*e+1]=t[2*r+1]}))}t.setAttribute("uv",new e.Float32BufferAttribute(n,2))}parseMorphTargets(t,r){let n=0;for(const a in r.morphTargets){const s=t.attributes.position.array.slice();t.morphAttributes.position||(t.morphAttributes.position=[]);const o=r.morphTargets[a].points,i=r.morphTargets[a].indices,c=r.morphTargets[a].type;i.forEach((function(e,t){"relative"===c?(s[3*e]+=o[3*t],s[3*e+1]+=o[3*t+1],s[3*e+2]+=o[3*t+2]):(s[3*e]=o[3*t],s[3*e+1]=o[3*t+1],s[3*e+2]=o[3*t+2])})),t.morphAttributes.position[n]=new e.Float32BufferAttribute(s,3),t.morphAttributes.position[n].name=a,n++}t.morphTargetsRelative=!1}}class aa extends e.Loader{constructor(e){super(e)}load(t,r,n,a){const s=this,o=""===this.path?e.LoaderUtils.extractUrlBase(t):this.path,i=new e.FileLoader(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,(function(e){try{r(s.parse(e,o))}catch(e){a?a(e):console.error(e),s.manager.itemError(t)}}),n,a)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const r=e.split("\n");let n={};const a=/\s+/,s={};for(let e=0;e<r.length;e++){let t=r[e];if(t=t.trim(),0===t.length||"#"===t.charAt(0))continue;const o=t.indexOf(" ");let i=o>=0?t.substring(0,o):t;i=i.toLowerCase();let c=o>=0?t.substring(o+1):"";if(c=c.trim(),"newmtl"===i)n={name:c},s[c]=n;else if("ka"===i||"kd"===i||"ks"===i||"ke"===i){const e=c.split(a,3);n[i]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else n[i]=c}const o=new sa(this.resourcePath||t,this.materialOptions);return o.setCrossOrigin(this.crossOrigin),o.setManager(this.manager),o.setMaterials(s),o}}class sa{constructor(t="",r={}){this.baseUrl=t,this.options=r,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:e.FrontSide,this.wrap=void 0!==this.options.wrap?this.options.wrap:e.RepeatWrapping}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const r in e){const n=e[r],a={};t[r]=a;for(const e in n){let t=!0,r=n[e];const s=e.toLowerCase();switch(s){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(r=[r[0]/255,r[1]/255,r[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===r[0]&&0===r[1]&&0===r[2]&&(t=!1)}t&&(a[s]=r)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]}createMaterial_(t){const r=this,n=this.materialsInfo[t],a={name:t,side:this.side};function s(e,t){if(a[e])return;const n=r.getTextureParams(t,a),s=r.loadTexture(function(e,t){return"string"!=typeof t||""===t?"":/^https?:\/\//i.test(t)?t:e+t}(r.baseUrl,n.url));s.repeat.copy(n.scale),s.offset.copy(n.offset),s.wrapS=r.wrap,s.wrapT=r.wrap,a[e]=s}for(const t in n){const r=n[t];let o;if(""!==r)switch(t.toLowerCase()){case"kd":a.color=(new e.Color).fromArray(r);break;case"ks":a.specular=(new e.Color).fromArray(r);break;case"ke":a.emissive=(new e.Color).fromArray(r);break;case"map_kd":s("map",r);break;case"map_ks":s("specularMap",r);break;case"map_ke":s("emissiveMap",r);break;case"norm":s("normalMap",r);break;case"map_bump":case"bump":s("bumpMap",r);break;case"map_d":s("alphaMap",r),a.transparent=!0;break;case"ns":a.shininess=parseFloat(r);break;case"d":o=parseFloat(r),o<1&&(a.opacity=o,a.transparent=!0);break;case"tr":o=parseFloat(r),this.options&&this.options.invertTrProperty&&(o=1-o),o>0&&(a.opacity=1-o,a.transparent=!0)}}return this.materials[t]=new e.MeshPhongMaterial(a),this.materials[t]}getTextureParams(t,r){const n={scale:new e.Vector2(1,1),offset:new e.Vector2(0,0)},a=t.split(/\s+/);let s;return s=a.indexOf("-bm"),s>=0&&(r.bumpScale=parseFloat(a[s+1]),a.splice(s,2)),s=a.indexOf("-s"),s>=0&&(n.scale.set(parseFloat(a[s+1]),parseFloat(a[s+2])),a.splice(s,4)),s=a.indexOf("-o"),s>=0&&(n.offset.set(parseFloat(a[s+1]),parseFloat(a[s+2])),a.splice(s,4)),n.url=a.join(" ").trim(),n}loadTexture(t,r,n,a,s){const o=void 0!==this.manager?this.manager:e.DefaultLoadingManager;let i=o.getHandler(t);null===i&&(i=new e.TextureLoader(o)),i.setCrossOrigin&&i.setCrossOrigin(this.crossOrigin);const c=i.load(t,n,a,s);return void 0!==r&&(c.mapping=r),c}}class oa extends e.CompressedTextureLoader{constructor(e){super(e)}parse(t,r){const n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function a(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function s(e,t,r,n){const a=r*n*4,s=new Uint8Array(e,t,a),o=new Uint8Array(a);let i=0,c=0;for(let e=0;e<n;e++)for(let e=0;e<r;e++){const e=s[c];c++;const t=s[c];c++;const r=s[c];c++;const n=s[c];c++,o[i]=r,i++,o[i]=t,i++,o[i]=e,i++,o[i]=n,i++}return o}const o=a("DXT1"),i=a("DXT3"),c=a("DXT5"),l=a("ETC1"),u=new Int32Array(t,0,31);if(542327876!==u[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),n;if(4&!u[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),n;let h;const p=u[21];let d=!1;switch(p){case o:h=8,n.format=e.RGB_S3TC_DXT1_Format;break;case i:h=16,n.format=e.RGBA_S3TC_DXT3_Format;break;case c:h=16,n.format=e.RGBA_S3TC_DXT5_Format;break;case l:h=8,n.format=e.RGB_ETC1_Format;break;default:if(!(32===u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(f=p,String.fromCharCode(255&f,f>>8&255,f>>16&255,f>>24&255))),n;d=!0,h=64,n.format=e.RGBAFormat}var f;n.mipmapCount=1,131072&u[2]&&!1!==r&&(n.mipmapCount=Math.max(1,u[7]));const g=u[28];if(n.isCubemap=!!(512&g),n.isCubemap&&(!(1024&g)||!(2048&g)||!(4096&g)||!(8192&g)||!(16384&g)||!(32768&g)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),n;n.width=u[4],n.height=u[3];let m=u[1]+4;const v=n.isCubemap?6:1;for(let e=0;e<v;e++){let e=n.width,r=n.height;for(let a=0;a<n.mipmapCount;a++){let a,o;d?(a=s(t,m,e,r),o=a.length):(o=Math.max(4,e)/4*Math.max(4,r)/4*h,a=new Uint8Array(t,m,o));const i={data:a,width:e,height:r};n.mipmaps.push(i),m+=o,e=Math.max(e>>1,1),r=Math.max(r>>1,1)}}return n}}const ia=/^[og]\s*(.+)?/,ca=/^mtllib /,la=/^usemtl /,ua=/^usemap /,ha=new e.Vector3,pa=new e.Vector3,da=new e.Vector3,fa=new e.Vector3,ga=new e.Vector3;function ma(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){const r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);const n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){const t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let e=this.materials.length-1;e>=0;e--)this.materials[e].groupCount<=0&&this.materials.splice(e,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){const e=r.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){const r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){const r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){const n=this.vertices,a=this.object.geometry.vertices;a.push(n[e+0],n[e+1],n[e+2]),a.push(n[t+0],n[t+1],n[t+2]),a.push(n[r+0],n[r+1],n[r+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){const n=this.normals,a=this.object.geometry.normals;a.push(n[e+0],n[e+1],n[e+2]),a.push(n[t+0],n[t+1],n[t+2]),a.push(n[r+0],n[r+1],n[r+2])},addFaceNormal:function(e,t,r){const n=this.vertices,a=this.object.geometry.normals;ha.fromArray(n,e),pa.fromArray(n,t),da.fromArray(n,r),ga.subVectors(da,pa),fa.subVectors(ha,pa),ga.cross(fa),ga.normalize(),a.push(ga.x,ga.y,ga.z),a.push(ga.x,ga.y,ga.z),a.push(ga.x,ga.y,ga.z)},addColor:function(e,t,r){const n=this.colors,a=this.object.geometry.colors;void 0!==n[e]&&a.push(n[e+0],n[e+1],n[e+2]),void 0!==n[t]&&a.push(n[t+0],n[t+1],n[t+2]),void 0!==n[r]&&a.push(n[r+0],n[r+1],n[r+2])},addUV:function(e,t,r){const n=this.uvs,a=this.object.geometry.uvs;a.push(n[e+0],n[e+1]),a.push(n[t+0],n[t+1]),a.push(n[r+0],n[r+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,n,a,s,o,i,c){const l=this.vertices.length;let u=this.parseVertexIndex(e,l),h=this.parseVertexIndex(t,l),p=this.parseVertexIndex(r,l);if(this.addVertex(u,h,p),this.addColor(u,h,p),void 0!==o&&""!==o){const e=this.normals.length;u=this.parseNormalIndex(o,e),h=this.parseNormalIndex(i,e),p=this.parseNormalIndex(c,e),this.addNormal(u,h,p)}else this.addFaceNormal(u,h,p);if(void 0!==n&&""!==n){const e=this.uvs.length;u=this.parseUVIndex(n,e),h=this.parseUVIndex(a,e),p=this.parseUVIndex(s,e),this.addUV(u,h,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let r=0,n=e.length;r<n;r++){const n=this.parseVertexIndex(e[r],t);this.addVertexPoint(n),this.addColor(n)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const r=this.vertices.length,n=this.uvs.length;for(let t=0,n=e.length;t<n;t++)this.addVertexLine(this.parseVertexIndex(e[t],r));for(let e=0,r=t.length;e<r;e++)this.addUVLine(this.parseUVIndex(t[e],n))}};return e.startObject("",!1),e}class va extends e.Loader{constructor(e){super(e),this.materials=null}load(t,r,n,a){const s=this,o=new e.FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(e){try{r(s.parse(e))}catch(e){a?a(e):console.error(e),s.manager.itemError(t)}}),n,a)}setMaterials(e){return this.materials=e,this}parse(t){const r=new ma;-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n")),-1!==t.indexOf("\\\n")&&(t=t.replace(/\\\n/g,""));const n=t.split("\n");let a="",s="",o=0,i=[];const c="function"==typeof"".trimLeft;for(let e=0,t=n.length;e<t;e++)if(a=n[e],a=c?a.trimLeft():a.trim(),o=a.length,0!==o&&(s=a.charAt(0),"#"!==s))if("v"===s){const e=a.split(/\s+/);switch(e[0]){case"v":r.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?r.colors.push(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6])):r.colors.push(void 0,void 0,void 0);break;case"vn":r.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":r.uvs.push(parseFloat(e[1]),parseFloat(e[2]))}}else if("f"===s){const e=a.substr(1).trim().split(/\s+/),t=[];for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.length>0){const e=n.split("/");t.push(e)}}const n=t[0];for(let e=1,a=t.length-1;e<a;e++){const a=t[e],s=t[e+1];r.addFace(n[0],a[0],s[0],n[1],a[1],s[1],n[2],a[2],s[2])}}else if("l"===s){const e=a.substring(1).trim().split(" ");let t=[];const n=[];if(-1===a.indexOf("/"))t=e;else for(let r=0,a=e.length;r<a;r++){const a=e[r].split("/");""!==a[0]&&t.push(a[0]),""!==a[1]&&n.push(a[1])}r.addLineGeometry(t,n)}else if("p"===s){const e=a.substr(1).trim().split(" ");r.addPointGeometry(e)}else if(null!==(i=ia.exec(a))){const e=(" "+i[0].substr(1).trim()).substr(1);r.startObject(e)}else if(la.test(a))r.object.startMaterial(a.substring(7).trim(),r.materialLibraries);else if(ca.test(a))r.materialLibraries.push(a.substring(7).trim());else if(ua.test(a))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===s){if(i=a.split(" "),i.length>1){const e=i[1].trim().toLowerCase();r.object.smooth="0"!==e&&"off"!==e}else r.object.smooth=!0;const e=r.object.currentMaterial();e&&(e.smooth=r.object.smooth)}else{if("\0"===a)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+a+'"')}r.finalize();const l=new e.Group;l.materialLibraries=[].concat(r.materialLibraries);if(!0===!(1===r.objects.length&&0===r.objects[0].geometry.vertices.length))for(let t=0,n=r.objects.length;t<n;t++){const n=r.objects[t],a=n.geometry,s=n.materials,o="Line"===a.type,i="Points"===a.type;let c=!1;if(0===a.vertices.length)continue;const u=new e.BufferGeometry;u.setAttribute("position",new e.Float32BufferAttribute(a.vertices,3)),a.normals.length>0&&u.setAttribute("normal",new e.Float32BufferAttribute(a.normals,3)),a.colors.length>0&&(c=!0,u.setAttribute("color",new e.Float32BufferAttribute(a.colors,3))),!0===a.hasUVIndices&&u.setAttribute("uv",new e.Float32BufferAttribute(a.uvs,2));const h=[];for(let t=0,n=s.length;t<n;t++){const n=s[t],a=n.name+"_"+n.smooth+"_"+c;let l=r.materials[a];if(null!==this.materials)if(l=this.materials.create(n.name),!o||!l||l instanceof e.LineBasicMaterial){if(i&&l&&!(l instanceof e.PointsMaterial)){const t=new e.PointsMaterial({size:10,sizeAttenuation:!1});e.Material.prototype.copy.call(t,l),t.color.copy(l.color),t.map=l.map,l=t}}else{const t=new e.LineBasicMaterial;e.Material.prototype.copy.call(t,l),t.color.copy(l.color),l=t}void 0===l&&(l=o?new e.LineBasicMaterial:i?new e.PointsMaterial({size:1,sizeAttenuation:!1}):new e.MeshPhongMaterial,l.name=n.name,l.flatShading=!n.smooth,l.vertexColors=c,r.materials[a]=l),h.push(l)}let p;if(h.length>1){for(let e=0,t=s.length;e<t;e++){const t=s[e];u.addGroup(t.groupStart,t.groupCount,e)}p=o?new e.LineSegments(u,h):i?new e.Points(u,h):new e.Mesh(u,h)}else p=o?new e.LineSegments(u,h[0]):i?new e.Points(u,h[0]):new e.Mesh(u,h[0]);p.name=n.name,l.add(p)}else if(r.vertices.length>0){const t=new e.PointsMaterial({size:1,sizeAttenuation:!1}),n=new e.BufferGeometry;n.setAttribute("position",new e.Float32BufferAttribute(r.vertices,3)),r.colors.length>0&&void 0!==r.colors[0]&&(n.setAttribute("color",new e.Float32BufferAttribute(r.colors,3)),t.vertexColors=!0);const a=new e.Points(n,t);l.add(a)}return l}}class ya extends e.DataTextureLoader{constructor(t){super(t),this.type=e.HalfFloatType}parse(t){const r=65536,n=14,a=65537,s=16384,o=Math.pow(2.7182818,2.2);var i=new DataView(new ArrayBuffer(8));function c(e){if(0===e)return[e,0];i.setFloat64(0,e);var t=i.getUint32(0)>>>20&2047;0===t&&(i.setFloat64(0,e*Math.pow(2,64)),t=(i.getUint32(0)>>>20&2047)-64);var r=t-1022,n=function(e,t){for(var r=Math.min(3,Math.ceil(Math.abs(t)/1023)),n=e,a=0;a<r;a++)n*=Math.pow(2,Math.floor((t+a)/r));return n}(e,-r);return[n,r]}const l={l:0,c:0,lc:0};function u(e,t,r,n,a){for(;r<e;)t=t<<8|H(n,a),r+=8;r-=e,l.l=t>>r&(1<<e)-1,l.c=t,l.lc=r}const h=new Array(59);function p(e,t,r,n,s,o,i){for(var c=r,p=0,d=0;s<=o;s++){if(c.value-r.value>n)return!1;u(6,p,d,e,c);var f=l.l;if(p=l.c,d=l.lc,i[s]=f,63==f){if(c.value-r.value>n)throw"Something wrong with hufUnpackEncTable";u(8,p,d,e,c);var g=l.l+6;if(p=l.c,d=l.lc,s+g>o+1)throw"Something wrong with hufUnpackEncTable";for(;g--;)i[s++]=0;s--}else if(f>=59){if(s+(g=f-59+2)>o+1)throw"Something wrong with hufUnpackEncTable";for(;g--;)i[s++]=0;s--}}!function(e){for(var t=0;t<=58;++t)h[t]=0;for(t=0;t<a;++t)h[e[t]]+=1;var r=0;for(t=58;t>0;--t){var n=r+h[t]>>1;h[t]=r,r=n}for(t=0;t<a;++t){var s=e[t];s>0&&(e[t]=s|h[s]++<<6)}}(i)}function d(e){return 63&e}function f(e){return e>>6}const g={c:0,lc:0};function m(e,t,r,n){e=e<<8|H(r,n),t+=8,g.c=e,g.lc=t}const v={c:0,lc:0};function y(e,t,r,n,a,s,o,i,c,l){if(e==t){n<8&&(m(r,n,a,o),r=g.c,n=g.lc);var u=r>>(n-=8);u=new Uint8Array([u])[0];if(c.value+u>l)return!1;for(var h=i[c.value-1];u-- >0;)i[c.value++]=h}else{if(!(c.value<l))return!1;i[c.value++]=e}v.c=r,v.lc=n}function b(e){return 65535&e}function x(e){var t=b(e);return t>32767?t-65536:t}const w={a:0,b:0};function S(e,t){var r=x(e),n=x(t),a=r+(1&n)+(n>>1),s=a,o=a-n;w.a=s,w.b=o}function T(e,t){var r=b(e),n=b(t),a=r-(n>>1)&65535,s=n+a-32768&65535;w.a=s,w.b=a}function F(e,t,r,n,a,s,o){for(var i,c=o<16384,l=r>a?a:r,u=1;u<=l;)u<<=1;for(i=u>>=1,u>>=1;u>=1;){for(var h,p,d,f,g=0,m=g+s*(a-i),v=s*u,y=s*i,b=n*u,x=n*i;g<=m;g+=y){for(var F=g,A=g+n*(r-i);F<=A;F+=x){var k=F+b,E=(I=F+v)+b;c?(S(e[F+t],e[I+t]),h=w.a,d=w.b,S(e[k+t],e[E+t]),p=w.a,f=w.b,S(h,p),e[F+t]=w.a,e[k+t]=w.b,S(d,f),e[I+t]=w.a,e[E+t]=w.b):(T(e[F+t],e[I+t]),h=w.a,d=w.b,T(e[k+t],e[E+t]),p=w.a,f=w.b,T(h,p),e[F+t]=w.a,e[k+t]=w.b,T(d,f),e[I+t]=w.a,e[E+t]=w.b)}if(r&u){var I=F+v;c?S(e[F+t],e[I+t]):T(e[F+t],e[I+t]),h=w.a,e[I+t]=w.b,e[F+t]=h}}if(a&u)for(F=g,A=g+n*(r-i);F<=A;F+=x){k=F+b;c?S(e[F+t],e[k+t]):T(e[F+t],e[k+t]),h=w.a,e[k+t]=w.b,e[F+t]=h}i=u,u>>=1}return g}function A(e,t,r,o,i,c){var l=r.value,u=G(t,r),h=G(t,r);r.value+=4;var b=G(t,r);if(r.value+=4,u<0||u>=a||h<0||h>=a)throw"Something wrong with HUF_ENCSIZE";var x=new Array(a),w=new Array(s);if(function(e){for(var t=0;t<s;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(w),p(e,0,r,o-(r.value-l),u,h,x),b>8*(o-(r.value-l)))throw"Something wrong with hufUncompress";!function(e,t,r,a){for(;t<=r;t++){var s=f(e[t]),o=d(e[t]);if(s>>o)throw"Invalid table entry";if(o>n){if((u=a[s>>o-n]).len)throw"Invalid table entry";if(u.lit++,u.p){var i=u.p;u.p=new Array(u.lit);for(var c=0;c<u.lit-1;++c)u.p[c]=i[c]}else u.p=new Array(1);u.p[u.lit-1]=t}else if(o){var l=0;for(c=1<<n-o;c>0;c--){var u;if((u=a[(s<<n-o)+l]).len||u.p)throw"Invalid table entry";u.len=o,u.lit=t,l++}}}}(x,u,h,w),function(e,t,r,a,s,o,i,c,l,u){for(var h=0,p=0,b=c,x=Math.trunc(s.value+(o+7)/8);s.value<x;)for(m(h,p,r,s),h=g.c,p=g.lc;p>=n;)if((F=t[h>>p-n&16383]).len)p-=F.len,y(F.lit,i,h,p,r,0,s,l,u,b),h=v.c,p=v.lc;else{if(!F.p)throw"hufDecode issues";var w;for(w=0;w<F.lit;w++){for(var S=d(e[F.p[w]]);p<S&&s.value<x;)m(h,p,r,s),h=g.c,p=g.lc;if(p>=S&&f(e[F.p[w]])==(h>>p-S&(1<<S)-1)){p-=S,y(F.p[w],i,h,p,r,0,s,l,u,b),h=v.c,p=v.lc;break}}if(w==F.lit)throw"hufDecode issues"}var T=8-o&7;for(h>>=T,p-=T;p>0;){var F;if(!(F=t[h<<n-p&16383]).len)throw"hufDecode issues";p-=F.len,y(F.lit,i,h,p,r,0,s,l,u,b),h=v.c,p=v.lc}}(x,w,e,0,r,b,h,c,i,{value:0})}function k(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function E(e,t){for(var r=0,n=Math.floor((e.length+1)/2),a=0,s=e.length-1;!(a>s||(t[a++]=e[r++],a>s));)t[a++]=e[n++]}function I(e){for(var t=e.byteLength,r=new Array,n=0,a=new DataView(e);t>0;){var s=a.getInt8(n++);if(s<0){t-=(i=-s)+1;for(var o=0;o<i;o++)r.push(a.getUint8(n++))}else{var i=s;t-=2;var c=a.getUint8(n++);for(o=0;o<i+1;o++)r.push(c)}}return r}function M(e,t,r){for(var n,a=1;a<64;)65280==(n=t[e.value])?a=64:n>>8==255?a+=255&n:(r[a]=n,a++),e.value++}function L(e,t){t[0]=W(e[0]),t[1]=W(e[1]),t[2]=W(e[5]),t[3]=W(e[6]),t[4]=W(e[14]),t[5]=W(e[15]),t[6]=W(e[27]),t[7]=W(e[28]),t[8]=W(e[2]),t[9]=W(e[4]),t[10]=W(e[7]),t[11]=W(e[13]),t[12]=W(e[16]),t[13]=W(e[26]),t[14]=W(e[29]),t[15]=W(e[42]),t[16]=W(e[3]),t[17]=W(e[8]),t[18]=W(e[12]),t[19]=W(e[17]),t[20]=W(e[25]),t[21]=W(e[30]),t[22]=W(e[41]),t[23]=W(e[43]),t[24]=W(e[9]),t[25]=W(e[11]),t[26]=W(e[18]),t[27]=W(e[24]),t[28]=W(e[31]),t[29]=W(e[40]),t[30]=W(e[44]),t[31]=W(e[53]),t[32]=W(e[10]),t[33]=W(e[19]),t[34]=W(e[23]),t[35]=W(e[32]),t[36]=W(e[39]),t[37]=W(e[45]),t[38]=W(e[52]),t[39]=W(e[54]),t[40]=W(e[20]),t[41]=W(e[22]),t[42]=W(e[33]),t[43]=W(e[38]),t[44]=W(e[46]),t[45]=W(e[51]),t[46]=W(e[55]),t[47]=W(e[60]),t[48]=W(e[21]),t[49]=W(e[34]),t[50]=W(e[37]),t[51]=W(e[47]),t[52]=W(e[50]),t[53]=W(e[56]),t[54]=W(e[59]),t[55]=W(e[61]),t[56]=W(e[35]),t[57]=W(e[36]),t[58]=W(e[48]),t[59]=W(e[49]),t[60]=W(e[57]),t[61]=W(e[58]),t[62]=W(e[62]),t[63]=W(e[63])}function C(e){const t=.5*Math.cos(.7853975),r=.5*Math.cos(3.14159/16),n=.5*Math.cos(3.14159/8),a=.5*Math.cos(3*3.14159/16),s=.5*Math.cos(.981746875),o=.5*Math.cos(3*3.14159/8),i=.5*Math.cos(1.374445625);for(var c=new Array(4),l=new Array(4),u=new Array(4),h=new Array(4),p=0;p<8;++p){var d=8*p;c[0]=n*e[d+2],c[1]=o*e[d+2],c[2]=n*e[d+6],c[3]=o*e[d+6],l[0]=r*e[d+1]+a*e[d+3]+s*e[d+5]+i*e[d+7],l[1]=a*e[d+1]-i*e[d+3]-r*e[d+5]-s*e[d+7],l[2]=s*e[d+1]-r*e[d+3]+i*e[d+5]+a*e[d+7],l[3]=i*e[d+1]-s*e[d+3]+a*e[d+5]-r*e[d+7],u[0]=t*(e[d+0]+e[d+4]),u[3]=t*(e[d+0]-e[d+4]),u[1]=c[0]+c[3],u[2]=c[1]-c[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[d+0]=h[0]+l[0],e[d+1]=h[1]+l[1],e[d+2]=h[2]+l[2],e[d+3]=h[3]+l[3],e[d+4]=h[3]-l[3],e[d+5]=h[2]-l[2],e[d+6]=h[1]-l[1],e[d+7]=h[0]-l[0]}for(var f=0;f<8;++f)c[0]=n*e[16+f],c[1]=o*e[16+f],c[2]=n*e[48+f],c[3]=o*e[48+f],l[0]=r*e[8+f]+a*e[24+f]+s*e[40+f]+i*e[56+f],l[1]=a*e[8+f]-i*e[24+f]-r*e[40+f]-s*e[56+f],l[2]=s*e[8+f]-r*e[24+f]+i*e[40+f]+a*e[56+f],l[3]=i*e[8+f]-s*e[24+f]+a*e[40+f]-r*e[56+f],u[0]=t*(e[f]+e[32+f]),u[3]=t*(e[f]-e[32+f]),u[1]=c[0]+c[3],u[2]=c[1]-c[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[0+f]=h[0]+l[0],e[8+f]=h[1]+l[1],e[16+f]=h[2]+l[2],e[24+f]=h[3]+l[3],e[32+f]=h[3]-l[3],e[40+f]=h[2]-l[2],e[48+f]=h[1]-l[1],e[56+f]=h[0]-l[0]}function O(e){for(var t=0;t<64;++t){var r=e[0][t],n=e[1][t],a=e[2][t];e[0][t]=r+1.5747*a,e[1][t]=r-.1873*n-.4682*a,e[2][t]=r+1.8556*n}}function R(t,r,n){for(var a=0;a<64;++a)r[n+a]=e.DataUtils.toHalfFloat(N(t[a]))}function N(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(o,Math.abs(e)-1)}function U(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===yn&&console.error("THREE.EXRLoader: External library fflate.min.js required.");var r=jr(t),n=new Uint8Array(r.length);return k(r),E(r,n),new DataView(n.buffer)}function P(e){var t=e.viewer,r={value:e.offset.value},n=new Uint8Array(e.width*e.lines*(Z.channels.length*e.type*2)),a={version:z(t,r),unknownUncompressedSize:z(t,r),unknownCompressedSize:z(t,r),acCompressedSize:z(t,r),dcCompressedSize:z(t,r),rleCompressedSize:z(t,r),rleUncompressedSize:z(t,r),rleRawSize:z(t,r),totalAcUncompressedCount:z(t,r),totalDcUncompressedCount:z(t,r),acCompression:z(t,r)};if(a.version<2)throw"EXRLoader.parse: "+Z.compression+" version "+a.version+" is unsupported";for(var s=new Array,o=X(t,r)-2;o>0;){var i=D(t.buffer,r),c=V(t,r),l=c>>2&3,u=new Int8Array([(c>>4)-1])[0],h=V(t,r);s.push({name:i,index:u,type:h,compression:l}),o-=i.length+3}for(var p=Z.channels,d=new Array(e.channels),f=0;f<e.channels;++f){var g=d[f]={},m=p[f];g.name=m.name,g.compression=0,g.decoded=!1,g.type=m.pixelType,g.pLinear=m.pLinear,g.width=e.width,g.height=e.lines}for(var v={idx:new Array(3)},y=0;y<e.channels;++y)for(g=d[y],f=0;f<s.length;++f){var b=s[f];g.name==b.name&&(g.compression=b.compression,b.index>=0&&(v.idx[b.index]=y),g.offset=y)}if(a.acCompressedSize>0)switch(a.acCompression){case 0:var x=new Uint16Array(a.totalAcUncompressedCount);A(e.array,t,r,a.acCompressedSize,x,a.totalAcUncompressedCount);break;case 1:var w=jr(e.array.slice(r.value,r.value+a.totalAcUncompressedCount));x=new Uint16Array(w.buffer);r.value+=a.totalAcUncompressedCount}if(a.dcCompressedSize>0){var S={array:e.array,offset:r,size:a.dcCompressedSize},T=new Uint16Array(U(S).buffer);r.value+=a.dcCompressedSize}if(a.rleRawSize>0){var F=I((w=jr(e.array.slice(r.value,r.value+a.rleCompressedSize))).buffer);r.value+=a.rleCompressedSize}var k=0,E=new Array(d.length);for(f=0;f<E.length;++f)E[f]=new Array;for(var N=0;N<e.lines;++N)for(var P=0;P<d.length;++P)E[P].push(k),k+=d[P].width*e.type*2;!function(e,t,r,n,a,s){var o=new DataView(s.buffer),i=r[e.idx[0]].width,c=r[e.idx[0]].height,l=Math.floor(i/8),u=Math.ceil(i/8),h=Math.ceil(c/8),p=i-8*(u-1),d=c-8*(h-1),f={value:0},g=new Array(3),m=new Array(3),v=new Array(3),y=new Array(3),b=new Array(3);for(let r=0;r<3;++r)b[r]=t[e.idx[r]],g[r]=r<1?0:g[r-1]+u*h,m[r]=new Float32Array(64),v[r]=new Uint16Array(64),y[r]=new Uint16Array(64*u);for(let t=0;t<h;++t){var x=8;t==h-1&&(x=d);var w=8;for(let e=0;e<u;++e){e==u-1&&(w=p);for(let e=0;e<3;++e)v[e].fill(0),v[e][0]=a[g[e]++],M(f,n,v[e]),L(v[e],m[e]),C(m[e]);O(m);for(let t=0;t<3;++t)R(m[t],y[t],64*e)}let s=0;for(let n=0;n<3;++n){const a=r[e.idx[n]].type;for(let e=8*t;e<8*t+x;++e){s=b[n][e];for(let t=0;t<l;++t){const r=64*t+8*(7&e);o.setUint16(s+0*a,y[n][r+0],!0),o.setUint16(s+2*a,y[n][r+1],!0),o.setUint16(s+4*a,y[n][r+2],!0),o.setUint16(s+6*a,y[n][r+3],!0),o.setUint16(s+8*a,y[n][r+4],!0),o.setUint16(s+10*a,y[n][r+5],!0),o.setUint16(s+12*a,y[n][r+6],!0),o.setUint16(s+14*a,y[n][r+7],!0),s+=16*a}}if(l!=u)for(let e=8*t;e<8*t+x;++e){const t=b[n][e]+8*l*2*a,r=64*l+8*(7&e);for(let e=0;e<w;++e)o.setUint16(t+2*e*a,y[n][r+e],!0)}}}for(var S=new Uint16Array(i),T=(o=new DataView(s.buffer),0);T<3;++T){r[e.idx[T]].decoded=!0;var F=r[e.idx[T]].type;if(2==r[T].type)for(var A=0;A<c;++A){const e=b[T][A];for(var k=0;k<i;++k)S[k]=o.getUint16(e+2*k*F,!0);for(k=0;k<i;++k)o.setFloat32(e+2*k*F,W(S[k]),!0)}}}(v,E,d,x,T,n);for(f=0;f<d.length;++f){if(!(g=d[f]).decoded){if(2!==g.compression)throw"EXRLoader.parse: unsupported channel compression";var B=0,_=0;for(N=0;N<e.lines;++N){for(var G=E[f][B],H=0;H<g.width;++H){for(var j=0;j<2*g.type;++j)n[G++]=F[_+j*g.width*g.height];_++}B++}}}return new DataView(n.buffer)}function D(t,r){for(var n=new Uint8Array(t),a=0;0!=n[r.value+a];)a+=1;var s=(new e._default.polyfill.TextDecoder).decode(n.slice(r.value,r.value+a));return r.value=r.value+a+1,s}function B(e,t){var r=e.getUint32(0,!0);return t.value=t.value+8,r}function _(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function G(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function H(e,t){var r=e[t.value];return t.value=t.value+1,r}function V(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}function z(e,t){var r=Number(e.getBigInt64(t.value,!0));return t.value+=8,r}function j(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function W(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function X(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function q(t,r,n,a,s){return"string"===a||"stringvector"===a||"iccProfile"===a?function(t,r,n){var a=(new e._default.polyfill.TextDecoder).decode(new Uint8Array(t).slice(r.value,r.value+n));return r.value=r.value+n,a}(r,n,s):"chlist"===a?function(e,t,r,n){for(var a=r.value,s=[];r.value<a+n-1;){var o=D(t,r),i=_(e,r),c=V(e,r);r.value+=3;var l=_(e,r),u=_(e,r);s.push({name:o,pixelType:i,pLinear:c,xSampling:l,ySampling:u})}return r.value+=1,s}(t,r,n,s):"chromaticities"===a?function(e,t){return{redX:j(e,t),redY:j(e,t),greenX:j(e,t),greenY:j(e,t),blueX:j(e,t),blueY:j(e,t),whiteX:j(e,t),whiteY:j(e,t)}}(t,n):"compression"===a?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][V(e,t)]}(t,n):"box2i"===a?function(e,t){return{xMin:G(e,t),yMin:G(e,t),xMax:G(e,t),yMax:G(e,t)}}(t,n):"lineOrder"===a?function(e,t){return["INCREASING_Y"][V(e,t)]}(t,n):"float"===a?j(t,n):"v2f"===a?function(e,t){return[j(e,t),j(e,t)]}(t,n):"v3f"===a?function(e,t){return[j(e,t),j(e,t),j(e,t)]}(t,n):"int"===a?_(t,n):"rational"===a?function(e,t){return[_(e,t),G(e,t)]}(t,n):"timecode"===a?function(e,t){return[G(e,t),G(e,t)]}(t,n):"preview"===a?(n.value+=s,"skipped"):void(n.value+=s)}var Y=new DataView(t),K=new Uint8Array(t),Z={};Y.getUint32(0,!0),Y.getUint8(4,!0),Y.getUint8(5,!0);for(var Q={value:8},J=!0;J;){var $=D(t,Q);if(0==$)J=!1;else{var ee=D(t,Q),te=q(Y,t,Q,ee,G(Y,Q));void 0===te?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${ee}'.`):Z[$]=te}}var re,ne,ae,se,oe=Z.dataWindow.yMax+1;switch(Z.compression){case"NO_COMPRESSION":ne=1,re=function(e){return new DataView(e.array.buffer,e.offset.value,e.size)};break;case"RLE_COMPRESSION":ne=1,re=function(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),r=new Uint8Array(I(t)),n=new Uint8Array(r.length);return k(r),E(r,n),new DataView(n.buffer)};break;case"ZIPS_COMPRESSION":ne=1,re=U;break;case"ZIP_COMPRESSION":ne=16,re=U;break;case"PIZ_COMPRESSION":ne=32,re=function(e){for(var t=e.viewer,n={value:e.offset.value},a=e.width*ne*(Z.channels.length*e.type),s=new Uint16Array(a),o=new Uint8Array(8192),i=0,c=new Array(e.channels),l=0;l<e.channels;l++)c[l]={},c[l].start=i,c[l].end=c[l].start,c[l].nx=e.width,c[l].ny=e.lines,c[l].size=e.type,i+=c[l].nx*c[l].ny*c[l].size;var u=X(t,n),h=X(t,n);if(h>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(u<=h)for(l=0;l<h-u+1;l++)o[l+u]=V(t,n);var p=new Uint16Array(r),d=function(e,t){for(var n=0,a=0;a<r;++a)(0==a||e[a>>3]&1<<(7&a))&&(t[n++]=a);for(var s=n-1;n<r;)t[n++]=0;return s}(o,p),f=G(t,n);for(A(e.array,t,n,f,s,i),l=0;l<e.channels;++l)for(var g=c[l],m=0;m<c[l].size;++m)F(s,g.start+m,g.nx,g.size,g.ny,g.nx*g.size,d);!function(e,t,r){for(var n=0;n<r;++n)t[n]=e[t[n]]}(p,s,i);for(var v=0,y=new Uint8Array(s.buffer.byteLength),b=0;b<e.lines;b++)for(var x=0;x<e.channels;x++){var w=(g=c[x]).nx*g.size,S=new Uint8Array(s.buffer,2*g.end,2*w);y.set(S,v),v+=2*w,g.end+=w}return new DataView(y.buffer)};break;case"PXR24_COMPRESSION":ne=16,re=function(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===yn&&console.error("THREE.EXRLoader: External library fflate.min.js required.");var r=jr(t);const n=e.lines*e.channels*e.width,a=1==e.type?new Uint16Array(n):new Uint32Array(n);let s=0,o=0;const i=new Array(4);for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){let t=0;switch(e.type){case 1:i[0]=s,i[1]=i[0]+e.width,s=i[1]+e.width;for(let n=0;n<e.width;++n)t+=r[i[0]++]<<8|r[i[1]++],a[o]=t,o++;break;case 2:i[0]=s,i[1]=i[0]+e.width,i[2]=i[1]+e.width,s=i[2]+e.width;for(let n=0;n<e.width;++n)t+=r[i[0]++]<<24|r[i[1]++]<<16|r[i[2]++]<<8,a[o]=t,o++}}return new DataView(a.buffer)};break;case"DWAA_COMPRESSION":ne=32,re=P;break;case"DWAB_COMPRESSION":ne=256,re=P;break;default:throw"EXRLoader.parse: "+Z.compression+" is unsupported"}var ie=Z.channels[0].pixelType;if(1===ie)switch(this.type){case e.UnsignedByteType:case e.FloatType:se=function(e,t){return W(X(e,t))},ae=2;break;case e.HalfFloatType:se=X,ae=2}else{if(2!==ie)throw"EXRLoader.parse: unsupported pixelType "+ie+" for "+Z.compression+".";switch(this.type){case e.UnsignedByteType:case e.FloatType:se=j,ae=4;break;case e.HalfFloatType:se=function(t,r){return e.DataUtils.toHalfFloat(j(t,r))},ae=4}}for(var ce=oe/ne,le=0;le<ce;le++)B(Y,Q);var ue=Z.dataWindow.xMax-Z.dataWindow.xMin+1,he=Z.dataWindow.yMax-Z.dataWindow.yMin+1,pe=ue*he*4;switch(this.type){case e.UnsignedByteType:case e.FloatType:var de=new Float32Array(pe);Z.channels.length<4&&de.fill(1,0,pe);break;case e.HalfFloatType:de=new Uint16Array(pe);Z.channels.length<4&&de.fill(15360,0,pe);break;default:console.error("THREE.EXRLoader: unsupported type: ",this.type)}for(var fe,ge,me={R:0,G:1,B:2,A:3},ve={size:0,width:ue,lines:ne,offset:Q,array:K,viewer:Y,type:ie,channels:Z.channels.length},ye={value:0},be=0;be<he/ne;be++){fe=G(Y,Q),pe=G(Y,Q),ve.lines=fe+ne>he?he-fe:ne,ve.offset=Q,ve.size=pe,ge=re(ve),Q.value+=pe;for(var xe=0;xe<ne;xe++){var we=xe+be*ne;if(we>=he)break;for(var Se=0;Se<Z.channels.length;Se++)for(var Te=me[Z.channels[Se].name],Fe=0;Fe<ue;Fe++){var Ae=xe*(Z.channels.length*ue)+Se*ue+Fe;ye.value=Ae*ae;var ke=se(ge,ye);de[4*ue*(he-1-we)+4*Fe+Te]=ke}}}if(this.type===e.UnsignedByteType){let e,t;const r=de.length,n=new Uint8Array(r);for(let r=0;r<he;++r)for(let a=0;a<ue;++a){t=r*ue*4+4*a;const s=de[t],o=de[t+1],i=de[t+2];if(e=s>o?s:o,e=i>e?i:e,e<1e-32)n[t]=n[t+1]=n[t+2]=n[t+3]=0;else{const r=c(e);e=256*r[0]/e,n[t]=s*e,n[t+1]=o*e,n[t+2]=i*e,n[t+3]=r[1]+128}}de=n}const Ee=this.type===e.UnsignedByteType?e.RGBEFormat:e.RGBAFormat;return{header:Z,width:ue,height:he,data:de,format:Ee,type:this.type}}setDataType(e){return this.type=e,this}load(t,r,n,a){return super.load(t,(function(t,n){switch(t.type){case e.UnsignedByteType:t.encoding=e.RGBEEncoding,t.minFilter=e.NearestFilter,t.magFilter=e.NearestFilter,t.generateMipmaps=!1,t.flipY=!1;break;case e.FloatType:case e.HalfFloatType:t.encoding=e.LinearEncoding,t.minFilter=e.LinearFilter,t.magFilter=e.LinearFilter,t.generateMipmaps=!1,t.flipY=!1}r&&r(t,n)}),n,a)}}class ba extends e.Loader{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(t,r,n,a){const s=this,o=new e.FileLoader(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(t,(function(e){try{r(s.parse(e))}catch(e){a?a(e):console.error(e),s.manager.itemError(t)}}),n,a)}parse(t){const r=this;function n(e,t,r,n,s,o,i,c){if(0==t||0==r)return void e.lineTo(c.x,c.y);n=n*Math.PI/180,t=Math.abs(t),r=Math.abs(r);const l=(i.x-c.x)/2,u=(i.y-c.y)/2,h=Math.cos(n)*l+Math.sin(n)*u,p=-Math.sin(n)*l+Math.cos(n)*u;let d=t*t,f=r*r;const g=h*h,m=p*p,v=g/d+m/f;if(v>1){const e=Math.sqrt(v);d=(t*=e)*t,f=(r*=e)*r}const y=d*m+f*g,b=(d*f-y)/y;let x=Math.sqrt(Math.max(0,b));s===o&&(x=-x);const w=x*t*p/r,S=-x*r*h/t,T=Math.cos(n)*w-Math.sin(n)*S+(i.x+c.x)/2,F=Math.sin(n)*w+Math.cos(n)*S+(i.y+c.y)/2,A=a(1,0,(h-w)/t,(p-S)/r),k=a((h-w)/t,(p-S)/r,(-h-w)/t,(-p-S)/r)%(2*Math.PI);e.currentPath.absellipse(T,F,t,r,A,A+k,0===o,n)}function a(e,t,r,n){const a=e*r+t*n,s=Math.sqrt(e*e+t*t)*Math.sqrt(r*r+n*n);let o=Math.acos(Math.max(-1,Math.min(1,a/s)));return e*n-t*r<0&&(o=-o),o}function s(e,t){t=Object.assign({},t);let r={};if(e.hasAttribute("class")){const t=e.getAttribute("class").split(/\s/).filter(Boolean).map((e=>e.trim()));for(let e=0;e<t.length;e++)r=Object.assign(r,f["."+t[e]])}function n(n,a,s){void 0===s&&(s=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(n)&&(t[a]=s(e.getAttribute(n))),r[n]&&(t[a]=s(r[n])),e.style&&""!==e.style[n]&&(t[a]=s(e.style[n]))}function a(e){return Math.max(0,Math.min(1,u(e)))}function s(e){return Math.max(0,u(e))}return e.hasAttribute("id")&&(r=Object.assign(r,f["#"+e.getAttribute("id")])),n("fill","fill"),n("fill-opacity","fillOpacity",a),n("fill-rule","fillRule"),n("opacity","opacity",a),n("stroke","stroke"),n("stroke-opacity","strokeOpacity",a),n("stroke-width","strokeWidth",s),n("stroke-linejoin","strokeLineJoin"),n("stroke-linecap","strokeLineCap"),n("stroke-miterlimit","strokeMiterLimit",s),n("visibility","visibility"),t}function o(e,t){return e-(t-e)}function i(e,t,r){if("string"!=typeof e)throw new TypeError("Invalid input: "+typeof e);const n={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};let a=0,s=!0,o="",i="";const c=[];function l(e,t,r){const n=new SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw n.partial=r,n}function u(){""!==o&&(""===i?c.push(Number(o)):c.push(Number(o)*Math.pow(10,Number(i)))),o="",i=""}let h;const p=e.length;for(let d=0;d<p;d++)if(h=e[d],Array.isArray(t)&&t.includes(c.length%r)&&n.FLAGS.test(h))a=1,o=h,u();else{if(0===a){if(n.WHITESPACE.test(h))continue;if(n.DIGIT.test(h)||n.SIGN.test(h)){a=1,o=h;continue}if(n.POINT.test(h)){a=2,o=h;continue}n.COMMA.test(h)&&(s&&l(h,d,c),s=!0)}if(1===a){if(n.DIGIT.test(h)){o+=h;continue}if(n.POINT.test(h)){o+=h,a=2;continue}if(n.EXP.test(h)){a=3;continue}n.SIGN.test(h)&&1===o.length&&n.SIGN.test(o[0])&&l(h,d,c)}if(2===a){if(n.DIGIT.test(h)){o+=h;continue}if(n.EXP.test(h)){a=3;continue}n.POINT.test(h)&&"."===o[o.length-1]&&l(h,d,c)}if(3===a){if(n.DIGIT.test(h)){i+=h;continue}if(n.SIGN.test(h)){if(""===i){i+=h;continue}1===i.length&&n.SIGN.test(i)&&l(h,d,c)}}n.WHITESPACE.test(h)?(u(),a=0,s=!1):n.COMMA.test(h)?(u(),a=0,s=!0):n.SIGN.test(h)?(u(),a=1,o=h):n.POINT.test(h)?(u(),a=2,o=h):l(h,d,c)}return u(),c}const c=["mm","cm","in","pt","pc","px"],l={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function u(e){let t,n="px";if("string"==typeof e||e instanceof String)for(let t=0,r=c.length;t<r;t++){const r=c[t];if(e.endsWith(r)){n=r,e=e.substring(0,e.length-r.length);break}}return"px"===n&&"px"!==r.defaultUnit?t=l.in[r.defaultUnit]/r.defaultDPI:(t=l[n][r.defaultUnit],t<0&&(t=l[n].in*r.defaultDPI)),t*parseFloat(e)}function h(e){const t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function p(e){const t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}const d=[],f={},g=[],m=new e.Matrix3,v=new e.Matrix3,y=new e.Matrix3,b=new e.Matrix3,x=new e.Vector2,w=new e.Vector3,S=new e.Matrix3,T=(new e._default.polyfill.DOMParser).parseFromString(t,"image/svg+xml");!function t(r,a){if(1!==r.nodeType)return;const c=function(t){if(!(t.hasAttribute("transform")||"use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))))return null;const r=function(t){const r=new e.Matrix3,n=m;if("use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))){const e=u(t.getAttribute("x")),n=u(t.getAttribute("y"));r.translate(e,n)}if(t.hasAttribute("transform")){const e=t.getAttribute("transform").split(")");for(let t=e.length-1;t>=0;t--){const a=e[t].trim();if(""===a)continue;const s=a.indexOf("("),o=a.length;if(s>0&&s<o){const e=a.substr(0,s),t=i(a.substr(s+1,o-s-1));switch(n.identity(),e){case"translate":if(t.length>=1){const e=t[0];let r=e;t.length>=2&&(r=t[1]),n.translate(e,r)}break;case"rotate":if(t.length>=1){let e=0,r=0,a=0;e=-t[0]*Math.PI/180,t.length>=3&&(r=t[1],a=t[2]),v.identity().translate(-r,-a),y.identity().rotate(e),b.multiplyMatrices(y,v),v.identity().translate(r,a),n.multiplyMatrices(v,b)}break;case"scale":if(t.length>=1){const e=t[0];let r=e;t.length>=2&&(r=t[1]),n.scale(e,r)}break;case"skewX":1===t.length&&n.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&n.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&n.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}r.premultiply(n)}}return r}(t);g.length>0&&r.premultiply(g[g.length-1]);return S.copy(r),g.push(r),r}(r);let l=!0,T=null;switch(r.nodeName){case"svg":break;case"style":!function(e){if(!e.sheet||!e.sheet.cssRules||!e.sheet.cssRules.length)return;for(let t=0;t<e.sheet.cssRules.length;t++){const r=e.sheet.cssRules[t];if(1!==r.type)continue;const n=r.selectorText.split(/,/gm).filter(Boolean).map((e=>e.trim()));for(let e=0;e<n.length;e++)f[n[e]]=Object.assign(f[n[e]]||{},r.style)}}(r);break;case"g":a=s(r,a);break;case"path":a=s(r,a),r.hasAttribute("d")&&(T=function(t){const r=new e.ShapePath,a=new e.Vector2,s=new e.Vector2,c=new e.Vector2;let l=!0,u=!1;const h=t.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi);for(let e=0,t=h.length;e<t;e++){const t=h[e],p=t.charAt(0),d=t.substr(1).trim();let f;switch(!0===l&&(u=!0,l=!1),p){case"M":f=i(d);for(let e=0,t=f.length;e<t;e+=2)a.x=f[e+0],a.y=f[e+1],s.x=a.x,s.y=a.y,0===e?r.moveTo(a.x,a.y):r.lineTo(a.x,a.y),0===e&&!0===u&&c.copy(a);break;case"H":f=i(d);for(let e=0,t=f.length;e<t;e++)a.x=f[e],s.x=a.x,s.y=a.y,r.lineTo(a.x,a.y),0===e&&!0===u&&c.copy(a);break;case"V":f=i(d);for(let e=0,t=f.length;e<t;e++)a.y=f[e],s.x=a.x,s.y=a.y,r.lineTo(a.x,a.y),0===e&&!0===u&&c.copy(a);break;case"L":f=i(d);for(let e=0,t=f.length;e<t;e+=2)a.x=f[e+0],a.y=f[e+1],s.x=a.x,s.y=a.y,r.lineTo(a.x,a.y),0===e&&!0===u&&c.copy(a);break;case"C":f=i(d);for(let e=0,t=f.length;e<t;e+=6)r.bezierCurveTo(f[e+0],f[e+1],f[e+2],f[e+3],f[e+4],f[e+5]),s.x=f[e+2],s.y=f[e+3],a.x=f[e+4],a.y=f[e+5],0===e&&!0===u&&c.copy(a);break;case"S":f=i(d);for(let e=0,t=f.length;e<t;e+=4)r.bezierCurveTo(o(a.x,s.x),o(a.y,s.y),f[e+0],f[e+1],f[e+2],f[e+3]),s.x=f[e+0],s.y=f[e+1],a.x=f[e+2],a.y=f[e+3],0===e&&!0===u&&c.copy(a);break;case"Q":f=i(d);for(let e=0,t=f.length;e<t;e+=4)r.quadraticCurveTo(f[e+0],f[e+1],f[e+2],f[e+3]),s.x=f[e+0],s.y=f[e+1],a.x=f[e+2],a.y=f[e+3],0===e&&!0===u&&c.copy(a);break;case"T":f=i(d);for(let e=0,t=f.length;e<t;e+=2){const t=o(a.x,s.x),n=o(a.y,s.y);r.quadraticCurveTo(t,n,f[e+0],f[e+1]),s.x=t,s.y=n,a.x=f[e+0],a.y=f[e+1],0===e&&!0===u&&c.copy(a)}break;case"A":f=i(d,[3,4],7);for(let e=0,t=f.length;e<t;e+=7){if(f[e+5]==a.x&&f[e+6]==a.y)continue;const t=a.clone();a.x=f[e+5],a.y=f[e+6],s.x=a.x,s.y=a.y,n(r,f[e],f[e+1],f[e+2],f[e+3],f[e+4],t,a),0===e&&!0===u&&c.copy(a)}break;case"m":f=i(d);for(let e=0,t=f.length;e<t;e+=2)a.x+=f[e+0],a.y+=f[e+1],s.x=a.x,s.y=a.y,0===e?r.moveTo(a.x,a.y):r.lineTo(a.x,a.y),0===e&&!0===u&&c.copy(a);break;case"h":f=i(d);for(let e=0,t=f.length;e<t;e++)a.x+=f[e],s.x=a.x,s.y=a.y,r.lineTo(a.x,a.y),0===e&&!0===u&&c.copy(a);break;case"v":f=i(d);for(let e=0,t=f.length;e<t;e++)a.y+=f[e],s.x=a.x,s.y=a.y,r.lineTo(a.x,a.y),0===e&&!0===u&&c.copy(a);break;case"l":f=i(d);for(let e=0,t=f.length;e<t;e+=2)a.x+=f[e+0],a.y+=f[e+1],s.x=a.x,s.y=a.y,r.lineTo(a.x,a.y),0===e&&!0===u&&c.copy(a);break;case"c":f=i(d);for(let e=0,t=f.length;e<t;e+=6)r.bezierCurveTo(a.x+f[e+0],a.y+f[e+1],a.x+f[e+2],a.y+f[e+3],a.x+f[e+4],a.y+f[e+5]),s.x=a.x+f[e+2],s.y=a.y+f[e+3],a.x+=f[e+4],a.y+=f[e+5],0===e&&!0===u&&c.copy(a);break;case"s":f=i(d);for(let e=0,t=f.length;e<t;e+=4)r.bezierCurveTo(o(a.x,s.x),o(a.y,s.y),a.x+f[e+0],a.y+f[e+1],a.x+f[e+2],a.y+f[e+3]),s.x=a.x+f[e+0],s.y=a.y+f[e+1],a.x+=f[e+2],a.y+=f[e+3],0===e&&!0===u&&c.copy(a);break;case"q":f=i(d);for(let e=0,t=f.length;e<t;e+=4)r.quadraticCurveTo(a.x+f[e+0],a.y+f[e+1],a.x+f[e+2],a.y+f[e+3]),s.x=a.x+f[e+0],s.y=a.y+f[e+1],a.x+=f[e+2],a.y+=f[e+3],0===e&&!0===u&&c.copy(a);break;case"t":f=i(d);for(let e=0,t=f.length;e<t;e+=2){const t=o(a.x,s.x),n=o(a.y,s.y);r.quadraticCurveTo(t,n,a.x+f[e+0],a.y+f[e+1]),s.x=t,s.y=n,a.x=a.x+f[e+0],a.y=a.y+f[e+1],0===e&&!0===u&&c.copy(a)}break;case"a":f=i(d,[3,4],7);for(let e=0,t=f.length;e<t;e+=7){if(0==f[e+5]&&0==f[e+6])continue;const t=a.clone();a.x+=f[e+5],a.y+=f[e+6],s.x=a.x,s.y=a.y,n(r,f[e],f[e+1],f[e+2],f[e+3],f[e+4],t,a),0===e&&!0===u&&c.copy(a)}break;case"Z":case"z":r.currentPath.autoClose=!0,r.currentPath.curves.length>0&&(a.copy(c),r.currentPath.currentPoint.copy(a),l=!0);break;default:console.warn(t)}u=!1}return r}(r));break;case"rect":a=s(r,a),T=function(t){const r=u(t.getAttribute("x")||0),n=u(t.getAttribute("y")||0),a=u(t.getAttribute("rx")||t.getAttribute("ry")||0),s=u(t.getAttribute("ry")||t.getAttribute("rx")||0),o=u(t.getAttribute("width")),i=u(t.getAttribute("height")),c=.448084975506,l=new e.ShapePath;l.moveTo(r+a,n),l.lineTo(r+o-a,n),(0!==a||0!==s)&&l.bezierCurveTo(r+o-a*c,n,r+o,n+s*c,r+o,n+s);l.lineTo(r+o,n+i-s),(0!==a||0!==s)&&l.bezierCurveTo(r+o,n+i-s*c,r+o-a*c,n+i,r+o-a,n+i);l.lineTo(r+a,n+i),(0!==a||0!==s)&&l.bezierCurveTo(r+a*c,n+i,r,n+i-s*c,r,n+i-s);l.lineTo(r,n+s),(0!==a||0!==s)&&l.bezierCurveTo(r,n+s*c,r+a*c,n,r+a,n);return l}(r);break;case"polygon":a=s(r,a),T=function(t){function r(e,t,r){const n=u(t),o=u(r);0===s?a.moveTo(n,o):a.lineTo(n,o),s++}const n=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,a=new e.ShapePath;let s=0;return t.getAttribute("points").replace(n,r),a.currentPath.autoClose=!0,a}(r);break;case"polyline":a=s(r,a),T=function(t){function r(e,t,r){const n=u(t),o=u(r);0===s?a.moveTo(n,o):a.lineTo(n,o),s++}const n=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,a=new e.ShapePath;let s=0;return t.getAttribute("points").replace(n,r),a.currentPath.autoClose=!1,a}(r);break;case"circle":a=s(r,a),T=function(t){const r=u(t.getAttribute("cx")||0),n=u(t.getAttribute("cy")||0),a=u(t.getAttribute("r")||0),s=new e.Path;s.absarc(r,n,a,0,2*Math.PI);const o=new e.ShapePath;return o.subPaths.push(s),o}(r);break;case"ellipse":a=s(r,a),T=function(t){const r=u(t.getAttribute("cx")||0),n=u(t.getAttribute("cy")||0),a=u(t.getAttribute("rx")||0),s=u(t.getAttribute("ry")||0),o=new e.Path;o.absellipse(r,n,a,s,0,2*Math.PI);const i=new e.ShapePath;return i.subPaths.push(o),i}(r);break;case"line":a=s(r,a),T=function(t){const r=u(t.getAttribute("x1")||0),n=u(t.getAttribute("y1")||0),a=u(t.getAttribute("x2")||0),s=u(t.getAttribute("y2")||0),o=new e.ShapePath;return o.moveTo(r,n),o.lineTo(a,s),o.currentPath.autoClose=!1,o}(r);break;case"defs":l=!1;break;case"use":a=s(r,a);const c=r.href.baseVal.substring(1),h=r.viewportElement.getElementById(c);h?t(h,a):console.warn("SVGLoader: 'use node' references non-existent node id: "+c)}if(T&&(void 0!==a.fill&&"none"!==a.fill&&T.color.setStyle(a.fill),function(e,t){function r(e){w.set(e.x,e.y,1).applyMatrix3(t),e.set(w.x,w.y)}const n=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),a=e.subPaths;for(let e=0,s=a.length;e<s;e++){const s=a[e].curves;for(let e=0;e<s.length;e++){const a=s[e];a.isLineCurve?(r(a.v1),r(a.v2)):a.isCubicBezierCurve?(r(a.v0),r(a.v1),r(a.v2),r(a.v3)):a.isQuadraticBezierCurve?(r(a.v0),r(a.v1),r(a.v2)):a.isEllipseCurve&&(n&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),x.set(a.aX,a.aY),r(x),a.aX=x.x,a.aY=x.y,a.xRadius*=h(t),a.yRadius*=p(t))}}}(T,S),d.push(T),T.userData={node:r,style:a}),l){const e=r.childNodes;for(let r=0;r<e.length;r++)t(e[r],a)}c&&(g.pop(),g.length>0?S.copy(g[g.length-1]):S.identity())}(T.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});return{paths:d,xml:T.documentElement}}static createShapes(t){const r=999999999,n=0,a=1,s=2,o=3,i=4,c=5,l=6,u={loc:n,t:0};function h(e,t,r,a){const o=e.x,i=t.x,c=r.x,l=a.x,h=e.y,d=t.y,f=r.y,g=a.y,m=(l-c)*(h-f)-(g-f)*(o-c),v=(g-f)*(i-o)-(l-c)*(d-h),y=m/v,b=((i-o)*(h-f)-(d-h)*(o-c))/v;if(0===v&&0!==m||y<=0||y>=1||b<0||b>1)return null;if(0===m&&0===v){for(let c=0;c<2;c++){if(p(0===c?r:a,e,t),u.loc==n){const e=0===c?r:a;return{x:e.x,y:e.y,t:u.t}}if(u.loc==s){return{x:+(o+u.t*(i-o)).toPrecision(10),y:+(h+u.t*(d-h)).toPrecision(10),t:u.t}}}return null}for(let s=0;s<2;s++)if(p(0===s?r:a,e,t),u.loc==n){const e=0===s?r:a;return{x:e.x,y:e.y,t:u.t}}return{x:+(o+y*(i-o)).toPrecision(10),y:+(h+y*(d-h)).toPrecision(10),t:y}}function p(e,t,r){const h=r.x-t.x,p=r.y-t.y,d=e.x-t.x,f=e.y-t.y,g=h*f-d*p;if(e.x===t.x&&e.y===t.y)return u.loc=n,void(u.t=0);if(e.x===r.x&&e.y===r.y)return u.loc=a,void(u.t=1);if(g<-Number.EPSILON)return void(u.loc=o);if(g>Number.EPSILON)return void(u.loc=i);if(h*d<0||p*f<0)return void(u.loc=c);if(Math.sqrt(h*h+p*p)<Math.sqrt(d*d+f*f))return void(u.loc=l);let m;m=0!==h?d/h:f/p,u.loc=s,u.t=m}function d(t,r,n){const a=new e.Vector2;r.getCenter(a);const s=[];return n.forEach((r=>{if(r.boundingBox.containsPoint(a)){const n=function(t,r){const n=[],a=[];for(let s=1;s<t.length;s++){const o=t[s-1],i=t[s];for(let t=1;t<r.length;t++){const s=h(o,i,r[t-1],r[t]);null!==s&&void 0===n.find((e=>e.t<=s.t+Number.EPSILON&&e.t>=s.t-Number.EPSILON))&&(n.push(s),a.push(new e.Vector2(s.x,s.y)))}}return a}(t,r.points);n.forEach((e=>{s.push({identifier:r.identifier,isCW:r.isCW,point:e})}))}})),s.sort(((e,t)=>e.point.x-t.point.x)),s}let f=0,g=r,m=-999999999,v=t.subPaths.map((t=>{const n=t.getPoints();let a=-999999999,s=r,o=-999999999,i=r;for(let e=0;e<n.length;e++){const t=n[e];t.y>a&&(a=t.y),t.y<s&&(s=t.y),t.x>o&&(o=t.x),t.x<i&&(i=t.x)}return m<=o&&(m=o+1),g>=i&&(g=i-1),{points:n,isCW:e.ShapeUtils.isClockWise(n),identifier:f++,boundingBox:new e.Box2(new e.Vector2(i,s),new e.Vector2(o,a))}}));v=v.filter((e=>e.points.length>1));const y=v.map((r=>function(t,r,n,a,s){null!=s&&""!==s||(s="nonzero");const o=new e.Vector2;t.boundingBox.getCenter(o);const i=d([new e.Vector2(n,o.y),new e.Vector2(a,o.y)],t.boundingBox,r);i.sort(((e,t)=>e.point.x-t.point.x));const c=[],l=[];i.forEach((e=>{e.identifier===t.identifier?c.push(e):l.push(e)}));const u=c[0].point.x,h=[];let p=0;for(;p<l.length&&l[p].point.x<u;)h.length>0&&h[h.length-1]===l[p].identifier?h.pop():h.push(l[p].identifier),p++;if(h.push(t.identifier),"evenodd"===s){const e=h.length%2==0,r=h[h.length-2];return{identifier:t.identifier,isHole:e,for:r}}if("nonzero"===s){let e=!0,n=null,a=null;for(let t=0;t<h.length;t++){const s=h[t];e?(a=r[s].isCW,e=!1,n=s):a!==r[s].isCW&&(a=r[s].isCW,e=!0)}return{identifier:t.identifier,isHole:e,for:n}}console.warn('fill-rule: "'+s+'" is currently not implemented.')}(r,v,g,m,t.userData.style.fillRule))),b=[];return v.forEach((t=>{if(!y[t.identifier].isHole){const r=new e.Shape(t.points);y.filter((e=>e.isHole&&e.for===t.identifier)).forEach((t=>{const n=v[t.identifier];r.holes.push(new e.Path(n.points))})),b.push(r)}})),b}static getStrokeStyle(e,t,r,n,a){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:a=void 0!==a?a:4}}static pointsToStroke(t,r,n,a){const s=[],o=[],i=[];if(0===ba.pointsToStrokeWithBuffers(t,r,n,a,s,o,i))return null;const c=new e.BufferGeometry;return c.setAttribute("position",new e.Float32BufferAttribute(s,3)),c.setAttribute("normal",new e.Float32BufferAttribute(o,3)),c.setAttribute("uv",new e.Float32BufferAttribute(i,2)),c}static pointsToStrokeWithBuffers(t,r,n,a,s,o,i,c){const l=new e.Vector2,u=new e.Vector2,h=new e.Vector2,p=new e.Vector2,d=new e.Vector2,f=new e.Vector2,g=new e.Vector2,m=new e.Vector2,v=new e.Vector2,y=new e.Vector2,b=new e.Vector2,x=new e.Vector2,w=new e.Vector2,S=new e.Vector2,T=new e.Vector2,F=new e.Vector2,A=new e.Vector2;n=void 0!==n?n:12,a=void 0!==a?a:.001,c=void 0!==c?c:0,t=function(e){let t=!1;for(let r=1,n=e.length-1;r<n;r++)if(e[r].distanceTo(e[r+1])<a){t=!0;break}if(!t)return e;const r=[];r.push(e[0]);for(let t=1,n=e.length-1;t<n;t++)e[t].distanceTo(e[t+1])>=a&&r.push(e[t]);return r.push(e[e.length-1]),r}(t);const k=t.length;if(k<2)return 0;const E=t[0].equals(t[k-1]);let I,M,L=t[0];const C=r.strokeWidth/2,O=1/(k-1);let R,N,U,P,D=0,B=!1,_=0,G=3*c,H=2*c;V(t[0],t[1],l).multiplyScalar(C),m.copy(t[0]).sub(l),v.copy(t[0]).add(l),y.copy(m),b.copy(v);for(let e=1;e<k;e++){I=t[e],M=e===k-1?E?t[1]:void 0:t[e+1];const n=l;if(V(L,I,n),h.copy(n).multiplyScalar(C),x.copy(I).sub(h),w.copy(I).add(h),R=D+O,N=!1,void 0!==M){V(I,M,u),h.copy(u).multiplyScalar(C),S.copy(I).sub(h),T.copy(I).add(h),U=!0,h.subVectors(M,L),n.dot(h)<0&&(U=!1),1===e&&(B=U),h.subVectors(M,I),h.normalize();const t=Math.abs(n.dot(h));if(0!==t){const e=C/t;h.multiplyScalar(-e),p.subVectors(I,L),d.copy(p).setLength(e).add(h),F.copy(d).negate();const n=d.length(),a=p.length();p.divideScalar(a),f.subVectors(M,I);const s=f.length();switch(f.divideScalar(s),p.dot(F)<a&&f.dot(F)<s&&(N=!0),A.copy(d).add(I),F.add(I),P=!1,N?U?(T.copy(F),w.copy(F)):(S.copy(F),x.copy(F)):W(),r.strokeLineJoin){case"bevel":X(U,N,R);break;case"round":q(U,N),U?j(I,x,S,R,0):j(I,T,w,R,1);break;default:const e=C*r.strokeMiterLimit/n;if(e<1){if("miter-clip"!==r.strokeLineJoin){X(U,N,R);break}q(U,N),U?(f.subVectors(A,x).multiplyScalar(e).add(x),g.subVectors(A,S).multiplyScalar(e).add(S),z(x,R,0),z(f,R,0),z(I,R,.5),z(I,R,.5),z(f,R,0),z(g,R,0),z(I,R,.5),z(g,R,0),z(S,R,0)):(f.subVectors(A,w).multiplyScalar(e).add(w),g.subVectors(A,T).multiplyScalar(e).add(T),z(w,R,1),z(f,R,1),z(I,R,.5),z(I,R,.5),z(f,R,1),z(g,R,1),z(I,R,.5),z(g,R,1),z(T,R,1))}else N?(U?(z(v,D,1),z(m,D,0),z(A,R,0),z(v,D,1),z(A,R,0),z(F,R,1)):(z(v,D,1),z(m,D,0),z(A,R,1),z(m,D,0),z(F,R,0),z(A,R,1)),U?S.copy(A):T.copy(A)):U?(z(x,R,0),z(A,R,0),z(I,R,.5),z(I,R,.5),z(A,R,0),z(S,R,0)):(z(w,R,1),z(A,R,1),z(I,R,.5),z(I,R,.5),z(A,R,1),z(T,R,1)),P=!0}}else W()}else W();E||e!==k-1||Y(t[0],y,b,U,!0,D),D=R,L=I,m.copy(S),v.copy(T)}if(E){if(N&&s){let e=A,t=F;B!==U&&(e=F,t=A),U?(P||B)&&(t.toArray(s,0),t.toArray(s,9),P&&e.toArray(s,3)):!P&&B||(t.toArray(s,3),t.toArray(s,9),P&&e.toArray(s,0))}}else Y(I,x,w,U,!1,R);return _;function V(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function z(e,t,r){s&&(s[G]=e.x,s[G+1]=e.y,s[G+2]=0,o&&(o[G]=0,o[G+1]=0,o[G+2]=1),G+=3,i&&(i[H]=t,i[H+1]=r,H+=2)),_+=3}function j(e,t,r,a,s){l.copy(t).sub(e).normalize(),u.copy(r).sub(e).normalize();let o=Math.PI;const i=l.dot(u);Math.abs(i)<1&&(o=Math.abs(Math.acos(i))),o/=n,h.copy(t);for(let t=0,r=n-1;t<r;t++)p.copy(h).rotateAround(e,o),z(h,a,s),z(p,a,s),z(e,a,.5),h.copy(p);z(p,a,s),z(r,a,s),z(e,a,.5)}function W(){z(v,D,1),z(m,D,0),z(x,R,0),z(v,D,1),z(x,R,1),z(w,R,0)}function X(e,t,r){t?e?(z(v,D,1),z(m,D,0),z(x,R,0),z(v,D,1),z(x,R,0),z(F,R,1),z(x,r,0),z(S,r,0),z(F,r,.5)):(z(v,D,1),z(m,D,0),z(w,R,1),z(m,D,0),z(F,R,0),z(w,R,1),z(w,r,1),z(T,r,0),z(F,r,.5)):e?(z(x,r,0),z(S,r,0),z(I,r,.5)):(z(w,r,1),z(T,r,0),z(I,r,.5))}function q(e,t){t&&(e?(z(v,D,1),z(m,D,0),z(x,R,0),z(v,D,1),z(x,R,0),z(F,R,1),z(x,D,0),z(I,R,.5),z(F,R,1),z(I,R,.5),z(S,D,0),z(F,R,1)):(z(v,D,1),z(m,D,0),z(w,R,1),z(m,D,0),z(F,R,0),z(w,R,1),z(w,D,1),z(F,R,0),z(I,R,.5),z(I,R,.5),z(F,R,0),z(T,D,1)))}function Y(e,t,n,a,o,i){switch(r.strokeLineCap){case"round":o?j(e,n,t,i,.5):j(e,t,n,i,.5);break;case"square":if(o)l.subVectors(t,e),u.set(l.y,-l.x),h.addVectors(l,u).add(e),p.subVectors(u,l).add(e),a?(h.toArray(s,3),p.toArray(s,0),p.toArray(s,9)):(h.toArray(s,3),h.toArray(s,9),p.toArray(s,0));else{l.subVectors(n,e),u.set(l.y,-l.x),h.addVectors(l,u).add(e),p.subVectors(u,l).add(e);const t=s.length;a?(h.toArray(s,t-3),p.toArray(s,t-6),p.toArray(s,t-12)):(h.toArray(s,t-6),p.toArray(s,t-3),p.toArray(s,t-12))}}}}}class xa extends e.DataTextureLoader{constructor(t){super(t),this.type=e.HalfFloatType}parse(t){const r=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},n=function(e,t,r){t=t||1024;let n=e.pos,a=-1,s=0,o="",i=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));for(;0>(a=i.indexOf("\n"))&&s<t&&n<e.byteLength;)o+=i,s+=i.length,n+=128,i+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return-1<a&&(!1!==r&&(e.pos+=s+a+1),o+i.slice(0,a))},a=function(e,t,r,n){const a=e[t+3],s=Math.pow(2,a-128)/255;r[n+0]=e[t+0]*s,r[n+1]=e[t+1]*s,r[n+2]=e[t+2]*s},s=function(t,r,n,a){const s=t[r+3],o=Math.pow(2,s-128)/255;n[a+0]=e.DataUtils.toHalfFloat(Math.min(t[r+0]*o,65504)),n[a+1]=e.DataUtils.toHalfFloat(Math.min(t[r+1]*o,65504)),n[a+2]=e.DataUtils.toHalfFloat(Math.min(t[r+2]*o,65504))},o=new Uint8Array(t);o.pos=0;const i=function(e){const t=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,i={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let c,l;if(e.pos>=e.byteLength||!(c=n(e)))return r(1,"no header found");if(!(l=c.match(/^#\?(\S+)/)))return r(3,"bad initial token");for(i.valid|=1,i.programtype=l[1],i.string+=c+"\n";c=n(e),!1!==c;)if(i.string+=c+"\n","#"!==c.charAt(0)){if((l=c.match(t))&&(i.gamma=parseFloat(l[1],10)),(l=c.match(a))&&(i.exposure=parseFloat(l[1],10)),(l=c.match(s))&&(i.valid|=2,i.format=l[1]),(l=c.match(o))&&(i.valid|=4,i.height=parseInt(l[1],10),i.width=parseInt(l[2],10)),2&i.valid&&4&i.valid)break}else i.comments+=c+"\n";return 2&i.valid?4&i.valid?i:r(3,"missing image size specifier"):r(3,"missing format specifier")}(o);if(-1!==i){const t=i.width,n=i.height,c=function(e,t,n){const a=t;if(a<8||a>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(a!==(e[2]<<8|e[3]))return r(3,"wrong scanline width");const s=new Uint8Array(4*t*n);if(!s.length)return r(4,"unable to allocate buffer space");let o=0,i=0;const c=4*a,l=new Uint8Array(4),u=new Uint8Array(c);let h=n;for(;h>0&&i<e.byteLength;){if(i+4>e.byteLength)return r(1);if(l[0]=e[i++],l[1]=e[i++],l[2]=e[i++],l[3]=e[i++],2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=a)return r(3,"bad rgbe scanline format");let t,n=0;for(;n<c&&i<e.byteLength;){t=e[i++];const a=t>128;if(a&&(t-=128),0===t||n+t>c)return r(3,"bad scanline data");if(a){const r=e[i++];for(let e=0;e<t;e++)u[n++]=r}else u.set(e.subarray(i,i+t),n),n+=t,i+=t}const p=a;for(let e=0;e<p;e++){let t=0;s[o]=u[e+t],t+=a,s[o+1]=u[e+t],t+=a,s[o+2]=u[e+t],t+=a,s[o+3]=u[e+t],o+=4}h--}return s}(o.subarray(o.pos),t,n);if(-1!==c){let r,o,l,u;switch(this.type){case e.UnsignedByteType:r=c,o=e.RGBEFormat,l=e.UnsignedByteType;break;case e.FloatType:u=c.length/4;const t=new Float32Array(3*u);for(let e=0;e<u;e++)a(c,4*e,t,3*e);r=t,o=e.RGBFormat,l=e.FloatType;break;case e.HalfFloatType:u=c.length/4;const n=new Uint16Array(3*u);for(let e=0;e<u;e++)s(c,4*e,n,3*e);r=n,o=e.RGBFormat,l=e.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:t,height:n,data:r,header:i.string,gamma:i.gamma,exposure:i.exposure,format:o,type:l}}}return null}setDataType(e){return this.type=e,this}load(t,r,n,a){return super.load(t,(function(t,n){switch(t.type){case e.UnsignedByteType:t.encoding=e.RGBEEncoding,t.minFilter=e.NearestFilter,t.magFilter=e.NearestFilter,t.generateMipmaps=!1,t.flipY=!0;break;case e.FloatType:case e.HalfFloatType:t.encoding=e.LinearEncoding,t.minFilter=e.LinearFilter,t.magFilter=e.LinearFilter,t.generateMipmaps=!1,t.flipY=!0}r&&r(t,n)}),n,a)}}const wa="https://techbrood.com/threejs";function Sa(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}return r}class Ta extends e.Loader{constructor(e){super(e)}load(t,r,n,a){const s=this,o=""===s.path?e.LoaderUtils.extractUrlBase(t):s.path,i=new e.FileLoader(s.manager);i.setPath(s.path),i.setRequestHeader(s.requestHeader),i.setWithCredentials(s.withCredentials),i.load(t,(function(e){try{r(s.parse(e,o))}catch(e){a?a(e):console.error(e),s.manager.itemError(t)}}),n,a)}parse(t,r){function n(e,t){const r=[],n=e.childNodes;for(let e=0,a=n.length;e<a;e++){const a=n[e];a.nodeName===t&&r.push(a)}return r}function a(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),r=new Array(t.length);for(let e=0,n=t.length;e<n;e++)r[e]=t[e];return r}function s(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),r=new Array(t.length);for(let e=0,n=t.length;e<n;e++)r[e]=parseFloat(t[e]);return r}function o(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),r=new Array(t.length);for(let e=0,n=t.length;e<n;e++)r[e]=parseInt(t[e]);return r}function i(e){return e.substring(1)}function c(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function u(e){return void 0!==e?e.textContent:"Y_UP"}function h(e,t,r,a){const s=n(e,t)[0];if(void 0!==s){const e=n(s,r);for(let t=0;t<e.length;t++)a(e[t])}}function p(e,t){for(const r in e){e[r].build=t(e[r])}}function d(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function f(e){const t={inputs:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType&&"input"===n.nodeName){const e=i(n.getAttribute("source")),r=n.getAttribute("semantic");t.inputs[r]=e}}return t}function g(e){const t={};let r=e.getAttribute("target").split("/");const n=r.shift();let a=r.shift();const s=-1!==a.indexOf("("),o=-1!==a.indexOf(".");if(o)r=a.split("."),a=r.shift(),t.member=r.shift();else if(s){const e=a.split("(");a=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=n,t.sid=a,t.arraySyntax=s,t.memberSyntax=o,t.sampler=i(e.getAttribute("source")),t}function m(e){const t=[],r=e.channels,n=e.samplers,a=e.sources;for(const e in r)if(r.hasOwnProperty(e)){const s=r[e],o=n[s.sampler],i=o.inputs.INPUT,c=o.inputs.OUTPUT;S(y(s,a[i],a[c]),t)}return t}function v(e){return d(Ze.animations[e],m)}function y(e,t,r){const n=Ze.nodes[e.id],a=Pe(n.id),s=n.transforms[e.sid],o=n.matrix.clone().transpose();let i,c,l,u,h,p;const d={};switch(s){case"matrix":for(l=0,u=t.array.length;l<u;l++)if(i=t.array[l],c=l*r.stride,void 0===d[i]&&(d[i]={}),!0===e.arraySyntax){const t=r.array[c],n=e.indices[0]+4*e.indices[1];d[i][n]=t}else for(h=0,p=r.stride;h<p;h++)d[i][h]=r.array[c+h];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',s)}const f=function(e,t){const r=[];for(const t in e)r.push({time:parseFloat(t),value:e[t]});r.sort(n);for(let e=0;e<16;e++)T(r,e,t.elements[e]);return r;function n(e,t){return e.time-t.time}}(d,o);return{name:a.uuid,keyframes:f}}const b=new e.Vector3,x=new e.Vector3,w=new e.Quaternion;function S(t,r){const n=t.keyframes,a=t.name,s=[],o=[],i=[],c=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],r=t.time,a=t.value;Ae.fromArray(a).transpose(),Ae.decompose(b,w,x),s.push(r),o.push(b.x,b.y,b.z),i.push(w.x,w.y,w.z,w.w),c.push(x.x,x.y,x.z)}return o.length>0&&r.push(new e.VectorKeyframeTrack(a+".position",s,o)),i.length>0&&r.push(new e.QuaternionKeyframeTrack(a+".quaternion",s,i)),c.length>0&&r.push(new e.VectorKeyframeTrack(a+".scale",s,c)),r}function T(e,t,r){let n,a,s,o=!0;for(a=0,s=e.length;a<s;a++)n=e[a],void 0===n.value[t]?n.value[t]=null:o=!1;if(!0===o)for(a=0,s=e.length;a<s;a++)n=e[a],n.value[t]=r;else!function(e,t){let r,n;for(let a=0,s=e.length;a<s;a++){const s=e[a];if(null===s.value[t]){if(r=F(e,a,t),n=A(e,a,t),null===r){s.value[t]=n.value[t];continue}if(null===n){s.value[t]=r.value[t];continue}k(s,r,n,t)}}}(e,t)}function F(e,t,r){for(;t>=0;){const n=e[t];if(null!==n.value[r])return n;t--}return null}function A(e,t,r){for(;t<e.length;){const n=e[t];if(null!==n.value[r])return n;t++}return null}function k(e,t,r,n){r.time-t.time!=0?e.value[n]=(e.time-t.time)*(r.value[n]-t.value[n])/(r.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function E(t){const r=[],n=t.name,a=t.end-t.start||-1,s=t.animations;for(let e=0,t=s.length;e<t;e++){const t=v(s[e]);for(let e=0,n=t.length;e<n;e++)r.push(t[e])}return new e.AnimationClip(n,a,r)}function I(e){return d(Ze.clips[e],E)}function M(e){const t={sources:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=s(n.textContent);break;case"source":const e=n.getAttribute("id");t.sources[e]=se(n);break;case"joints":t.joints=L(n);break;case"vertex_weights":t.vertexWeights=C(n)}}return t}function L(e){const t={inputs:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType&&"input"===n.nodeName){const e=n.getAttribute("semantic"),r=i(n.getAttribute("source"));t.inputs[e]=r}}return t}function C(e){const t={inputs:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":const e=n.getAttribute("semantic"),r=i(n.getAttribute("source")),a=parseInt(n.getAttribute("offset"));t.inputs[e]={id:r,offset:a};break;case"vcount":t.vcount=o(n.textContent);break;case"v":t.v=o(n.textContent)}}return t}function O(t){const r={id:t.id},n=Ze.geometries[r.id];return void 0!==t.skin&&(r.skin=function(t){const r=4,n={joints:[],indices:{array:[],stride:r},weights:{array:[],stride:r}},a=t.sources,s=t.vertexWeights,o=s.vcount,i=s.v,c=s.inputs.JOINT.offset,l=s.inputs.WEIGHT.offset,u=t.sources[t.joints.inputs.JOINT],h=t.sources[t.joints.inputs.INV_BIND_MATRIX],p=a[s.inputs.WEIGHT.id].array;let d,f,g,m=0;for(d=0,g=o.length;d<g;d++){const e=o[d],t=[];for(f=0;f<e;f++){const e=i[m+c],r=p[i[m+l]];t.push({index:e,weight:r}),m+=2}for(t.sort(v),f=0;f<r;f++){const e=t[f];void 0!==e?(n.indices.array.push(e.index),n.weights.array.push(e.weight)):(n.indices.array.push(0),n.weights.array.push(0))}}t.bindShapeMatrix?n.bindMatrix=(new e.Matrix4).fromArray(t.bindShapeMatrix).transpose():n.bindMatrix=(new e.Matrix4).identity();for(d=0,g=u.array.length;d<g;d++){const t=u.array[d],r=(new e.Matrix4).fromArray(h.array,d*h.stride).transpose();n.joints.push({name:t,boneInverse:r})}return n;function v(e,t){return t.weight-e.weight}}(t.skin),n.sources.skinIndices=r.skin.indices,n.sources.skinWeights=r.skin.weights),r}function R(e){return void 0!==e.build?e.build:e.init_from}function N(e){const t=Ze.images[e];return void 0!==t?d(t,R):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function U(e){const t={surfaces:{},samplers:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"newparam":P(n,t);break;case"technique":t.technique=_(n);break;case"extra":t.extra=W(n)}}return t}function P(e,t){const r=e.getAttribute("sid");for(let n=0,a=e.childNodes.length;n<a;n++){const a=e.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"surface":t.surfaces[r]=D(a);break;case"sampler2D":t.samplers[r]=B(a)}}}function D(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType&&"init_from"===n.nodeName)t.init_from=n.textContent}return t}function B(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType&&"source"===n.nodeName)t.source=n.textContent}return t}function _(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=n.nodeName,t.parameters=G(n)}}return t}function G(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[n.nodeName]=H(n);break;case"transparent":t[n.nodeName]={opaque:n.getAttribute("opaque"),data:H(n)}}}return t}function H(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"color":t[n.nodeName]=s(n.textContent);break;case"float":t[n.nodeName]=parseFloat(n.textContent);break;case"texture":t[n.nodeName]={id:n.getAttribute("texture"),extra:V(n)}}}return t}function V(e){const t={technique:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType&&"extra"===n.nodeName)z(n,t)}return t}function z(e,t){for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType&&"technique"===n.nodeName)j(n,t)}}function j(e,t){for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=1:"FALSE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=0:t.technique[n.nodeName]=parseInt(n.textContent)}}}function W(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType&&"technique"===n.nodeName)t.technique=X(n)}return t}function X(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType&&"double_sided"===n.nodeName)t[n.nodeName]=parseInt(n.textContent)}return t}function q(e){return e}function Y(t){const r=(n=t.url,d(Ze.effects[n],q));var n;const a=r.profile.technique,s=r.profile.extra;let o;switch(a.type){case"phong":case"blinn":o=new e.MeshPhongMaterial;break;case"lambert":o=new e.MeshLambertMaterial;break;default:o=new e.MeshBasicMaterial}function i(t){const n=r.profile.samplers[t.id];let a=null;if(void 0!==n){a=N(r.profile.surfaces[n.source].init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),a=N(t.id);if(null!==a){const r=function(e){let t,r=e.slice(2+(e.lastIndexOf(".")-1>>>0));r=r.toLowerCase(),t="tga"===r?Xe:je;return t}(a);if(void 0!==r){const n=r.load(a),s=t.extra;if(void 0!==s&&void 0!==s.technique&&!1===c(s.technique)){const t=s.technique;n.wrapS=t.wrapU?e.RepeatWrapping:e.ClampToEdgeWrapping,n.wrapT=t.wrapV?e.RepeatWrapping:e.ClampToEdgeWrapping,n.offset.set(t.offsetU||0,t.offsetV||0),n.repeat.set(t.repeatU||1,t.repeatV||1)}else n.wrapS=e.RepeatWrapping,n.wrapT=e.RepeatWrapping;return n}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",a),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",t.id),null}o.name=t.name||"";const l=a.parameters;for(const e in l){const t=l[e];switch(e){case"diffuse":t.color&&o.color.fromArray(t.color),t.texture&&(o.map=i(t.texture));break;case"specular":t.color&&o.specular&&o.specular.fromArray(t.color),t.texture&&(o.specularMap=i(t.texture));break;case"bump":t.texture&&(o.normalMap=i(t.texture));break;case"ambient":t.texture&&(o.lightMap=i(t.texture));break;case"shininess":t.float&&o.shininess&&(o.shininess=t.float);break;case"emission":t.color&&o.emissive&&o.emissive.fromArray(t.color),t.texture&&(o.emissiveMap=i(t.texture))}}let u=l.transparent,h=l.transparency;if(void 0===h&&u&&(h={float:1}),void 0===u&&h&&(u={opaque:"A_ONE",data:{color:[1,1,1,1]}}),u&&h)if(u.data.texture)o.transparent=!0;else{const e=u.data.color;switch(u.opaque){case"A_ONE":o.opacity=e[3]*h.float;break;case"RGB_ZERO":o.opacity=1-e[0]*h.float;break;case"A_ZERO":o.opacity=1-e[3]*h.float;break;case"RGB_ONE":o.opacity=e[0]*h.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',u.opaque)}o.opacity<1&&(o.transparent=!0)}return void 0!==s&&void 0!==s.technique&&1===s.technique.double_sided&&(o.side=e.DoubleSide),o}function K(e){return d(Ze.materials[e],Y)}function Z(e){for(let t=0;t<e.childNodes.length;t++){const r=e.childNodes[t];if("technique_common"===r.nodeName)return Q(r)}return{}}function Q(e){const t={};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=J(n)}}return t}function J(e){const t={};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function $(t){let r;switch(t.optics.technique){case"perspective":r=new e.PerspectiveCamera(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":let n=t.optics.parameters.ymag,a=t.optics.parameters.xmag;const s=t.optics.parameters.aspect_ratio;a=void 0===a?n*s:a,n=void 0===n?a/s:n,a*=.5,n*=.5,r=new e.OrthographicCamera(-a,a,n,-n,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:r=new e.PerspectiveCamera}return r.name=t.name||"",r}function ee(e){const t=Ze.cameras[e];return void 0!==t?d(t,$):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function te(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=n.nodeName,t.parameters=re(n)}}return t}function re(t){const r={};for(let n=0,a=t.childNodes.length;n<a;n++){const a=t.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"color":const t=s(a.textContent);r.color=(new e.Color).fromArray(t);break;case"falloff_angle":r.falloffAngle=parseFloat(a.textContent);break;case"quadratic_attenuation":const n=parseFloat(a.textContent);r.distance=n?Math.sqrt(1/n):0}}return r}function ne(t){let r;switch(t.technique){case"directional":r=new e.DirectionalLight;break;case"point":r=new e.PointLight;break;case"spot":r=new e.SpotLight;break;case"ambient":r=new e.AmbientLight}return t.parameters.color&&r.color.copy(t.parameters.color),t.parameters.distance&&(r.distance=t.parameters.distance),r}function ae(e){const t=Ze.lights[e];return void 0!==t?d(t,ne):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function se(e){const t={array:[],stride:3};for(let r=0;r<e.childNodes.length;r++){const o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=s(o.textContent);break;case"Name_array":t.array=a(o.textContent);break;case"technique_common":const e=n(o,"accessor")[0];void 0!==e&&(t.stride=parseInt(e.getAttribute("stride")))}}return t}function oe(e){const t={};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];1===n.nodeType&&(t[n.getAttribute("semantic")]=i(n.getAttribute("source")))}return t}function ie(e){const t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":const e=i(n.getAttribute("source")),r=n.getAttribute("semantic"),a=parseInt(n.getAttribute("offset")),s=parseInt(n.getAttribute("set")),c=s>0?r+s:r;t.inputs[c]={id:e,offset:a},t.stride=Math.max(t.stride,a+1),"TEXCOORD"===r&&(t.hasUV=!0);break;case"vcount":t.vcount=o(n.textContent);break;case"p":t.p=o(n.textContent)}}return t}function ce(e){let t=0;for(let r=0,n=e.length;r<n;r++){!0===e[r].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){const t={},r=e.sources,n=e.vertices,a=e.primitives;if(0===a.length)return{};const s=function(e){const t={};for(let r=0;r<e.length;r++){const n=e[r];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(a);for(const e in s){const a=s[e];ce(a),t[e]=ue(a,r,n)}return t}function ue(t,r,n){const a={},s={array:[],stride:0},o={array:[],stride:0},i={array:[],stride:0},c={array:[],stride:0},l={array:[],stride:0},u=[],h=4,p=[],d=4,f=new e.BufferGeometry,g=[];let m=0;for(let e=0;e<t.length;e++){const a=t[e],h=a.inputs;let d=0;switch(a.type){case"lines":case"linestrips":d=2*a.count;break;case"triangles":d=3*a.count;break;case"polylist":for(let e=0;e<a.count;e++){const t=a.vcount[e];switch(t){case 3:d+=3;break;case 4:d+=6;break;default:d+=3*(t-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",a.type)}f.addGroup(m,d,e),m+=d,a.material&&g.push(a.material);for(const e in h){const d=h[e];switch(e){case"VERTEX":for(const e in n){const h=n[e];switch(e){case"POSITION":const n=s.array.length;if(he(a,r[h],d.offset,s.array),s.stride=r[h].stride,r.skinWeights&&r.skinIndices&&(he(a,r.skinIndices,d.offset,u),he(a,r.skinWeights,d.offset,p)),!1===a.hasUV&&!0===t.uvsNeedsFix){const e=(s.array.length-n)/s.stride;for(let t=0;t<e;t++)i.array.push(0,0)}break;case"NORMAL":he(a,r[h],d.offset,o.array),o.stride=r[h].stride;break;case"COLOR":he(a,r[h],d.offset,l.array),l.stride=r[h].stride;break;case"TEXCOORD":he(a,r[h],d.offset,i.array),i.stride=r[h].stride;break;case"TEXCOORD1":he(a,r[h],d.offset,c.array),i.stride=r[h].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',e)}}break;case"NORMAL":he(a,r[d.id],d.offset,o.array),o.stride=r[d.id].stride;break;case"COLOR":he(a,r[d.id],d.offset,l.array),l.stride=r[d.id].stride;break;case"TEXCOORD":he(a,r[d.id],d.offset,i.array),i.stride=r[d.id].stride;break;case"TEXCOORD1":he(a,r[d.id],d.offset,c.array),c.stride=r[d.id].stride}}}return s.array.length>0&&f.setAttribute("position",new e.Float32BufferAttribute(s.array,s.stride)),o.array.length>0&&f.setAttribute("normal",new e.Float32BufferAttribute(o.array,o.stride)),l.array.length>0&&f.setAttribute("color",new e.Float32BufferAttribute(l.array,l.stride)),i.array.length>0&&f.setAttribute("uv",new e.Float32BufferAttribute(i.array,i.stride)),c.array.length>0&&f.setAttribute("uv2",new e.Float32BufferAttribute(c.array,c.stride)),u.length>0&&f.setAttribute("skinIndex",new e.Float32BufferAttribute(u,h)),p.length>0&&f.setAttribute("skinWeight",new e.Float32BufferAttribute(p,d)),a.data=f,a.type=t[0].type,a.materialKeys=g,a}function he(e,t,r,n){const a=e.p,s=e.stride,o=e.vcount;function i(e){let t=a[e+r]*l;const s=t+l;for(;t<s;t++)n.push(c[t])}const c=t.array,l=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,r=o.length;t<r;t++){const r=o[t];if(4===r){const t=e+1*s,r=e+2*s,n=e+3*s;i(e+0*s),i(t),i(n),i(t),i(r),i(n)}else if(3===r){const t=e+1*s,r=e+2*s;i(e+0*s),i(t),i(r)}else if(r>4)for(let t=1,n=r-2;t<=n;t++){const r=e+s*t,n=e+s*(t+1);i(e+0*s),i(r),i(n)}e+=s*r}}else for(let e=0,t=a.length;e<t;e+=s)i(e)}function pe(e){return d(Ze.geometries[e],le)}function de(e){return void 0!==e.build?e.build:e}function fe(e,t){for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=ge(n);break;case"link":t.links.push(ve(n))}}}function ge(e){let t;for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=me(n)}}return t}function me(t){const r={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new e.Vector3,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let e=0;e<t.childNodes.length;e++){const n=t.childNodes[e];if(1===n.nodeType)switch(n.nodeName){case"axis":const e=s(n.textContent);r.axis.fromArray(e);break;case"limits":const t=n.getElementsByTagName("max")[0],a=n.getElementsByTagName("min")[0];r.limits.max=parseFloat(t.textContent),r.limits.min=parseFloat(a.textContent)}}return r.limits.min>=r.limits.max&&(r.static=!0),r.middlePosition=(r.limits.min+r.limits.max)/2,r}function ve(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(ye(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(be(n))}}return t}function ye(e){const t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(ve(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(be(n))}}return t}function be(t){const r={type:t.nodeName},n=s(t.textContent);switch(r.type){case"matrix":r.obj=new e.Matrix4,r.obj.fromArray(n).transpose();break;case"translate":r.obj=new e.Vector3,r.obj.fromArray(n);break;case"rotate":r.obj=new e.Vector3,r.obj.fromArray(n),r.angle=e.MathUtils.degToRad(n[3])}return r}function xe(e,t){for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType&&"technique_common"===n.nodeName)we(n,t)}}function we(e,t){for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=s(n.textContent);break;case"mass":t.mass=s(n.textContent)[0]}}}function Se(e){const t={target:e.getAttribute("target").split("/").pop()};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType&&"axis"===n.nodeName){const e=n.getElementsByTagName("param")[0];t.axis=e.textContent;const r=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=r.substr(0,r.length-1)}}return t}function Te(e){return void 0!==e.build?e.build:e}function Fe(t){const r=[],n=Ge.querySelector('[id="'+t.id+'"]');for(let t=0;t<n.childNodes.length;t++){const a=n.childNodes[t];if(1!==a.nodeType)continue;let o,i;switch(a.nodeName){case"matrix":o=s(a.textContent);const t=(new e.Matrix4).fromArray(o).transpose();r.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:t});break;case"translate":case"scale":o=s(a.textContent),i=(new e.Vector3).fromArray(o),r.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:i});break;case"rotate":o=s(a.textContent),i=(new e.Vector3).fromArray(o);const n=e.MathUtils.degToRad(o[3]);r.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:i,angle:n})}}return r}const Ae=new e.Matrix4,ke=new e.Vector3;function Ee(t){const r={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new e.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let n=0;n<t.childNodes.length;n++){const a=t.childNodes[n];if(1!==a.nodeType)continue;let o;switch(a.nodeName){case"node":r.nodes.push(a.getAttribute("id")),Ee(a);break;case"instance_camera":r.instanceCameras.push(i(a.getAttribute("url")));break;case"instance_controller":r.instanceControllers.push(Ie(a));break;case"instance_light":r.instanceLights.push(i(a.getAttribute("url")));break;case"instance_geometry":r.instanceGeometries.push(Ie(a));break;case"instance_node":r.instanceNodes.push(i(a.getAttribute("url")));break;case"matrix":o=s(a.textContent),r.matrix.multiply(Ae.fromArray(o).transpose()),r.transforms[a.getAttribute("sid")]=a.nodeName;break;case"translate":o=s(a.textContent),ke.fromArray(o),r.matrix.multiply(Ae.makeTranslation(ke.x,ke.y,ke.z)),r.transforms[a.getAttribute("sid")]=a.nodeName;break;case"rotate":o=s(a.textContent);const t=e.MathUtils.degToRad(o[3]);r.matrix.multiply(Ae.makeRotationAxis(ke.fromArray(o),t)),r.transforms[a.getAttribute("sid")]=a.nodeName;break;case"scale":o=s(a.textContent),r.matrix.scale(ke.fromArray(o)),r.transforms[a.getAttribute("sid")]=a.nodeName;break;case"extra":break;default:console.log(a)}}return Ue(r.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",r.id):Ze.nodes[r.id]=r,r}function Ie(e){const t={id:i(e.getAttribute("url")),materials:{},skeletons:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];switch(n.nodeName){case"bind_material":const e=n.getElementsByTagName("instance_material");for(let r=0;r<e.length;r++){const n=e[r],a=n.getAttribute("symbol"),s=n.getAttribute("target");t.materials[a]=i(s)}break;case"skeleton":t.skeletons.push(i(n.textContent))}}return t}function Me(t,r){const n=[],a=[];let s,o,i;for(s=0;s<t.length;s++){const e=t[s];let a;if(Ue(e))a=Pe(e),Le(a,r,n);else if(c=e,void 0!==Ze.visualScenes[c]){const t=Ze.visualScenes[e].children;for(let e=0;e<t.length;e++){const a=t[e];if("JOINT"===a.type){Le(Pe(a.id),r,n)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",e)}var c;for(s=0;s<r.length;s++)for(o=0;o<n.length;o++)if(i=n[o],i.bone.name===r[s].name){a[s]=i,i.processed=!0;break}for(s=0;s<n.length;s++)i=n[s],!1===i.processed&&(a.push(i),i.processed=!0);const l=[],u=[];for(s=0;s<a.length;s++)i=a[s],l.push(i.bone),u.push(i.boneInverse);return new e.Skeleton(l,u)}function Le(t,r,n){t.traverse((function(t){if(!0===t.isBone){let a;for(let e=0;e<r.length;e++){const n=r[e];if(n.name===t.name){a=n.boneInverse;break}}void 0===a&&(a=new e.Matrix4),n.push({bone:t,boneInverse:a,processed:!1})}}))}function Ce(t){const r=[],n=t.matrix,a=t.nodes,s=t.type,o=t.instanceCameras,i=t.instanceControllers,c=t.instanceLights,l=t.instanceGeometries,u=t.instanceNodes;for(let e=0,t=a.length;e<t;e++)r.push(Pe(a[e]));for(let e=0,t=o.length;e<t;e++){const t=ee(o[e]);null!==t&&r.push(t.clone())}for(let e=0,t=i.length;e<t;e++){const t=i[e],n=(h=t.id,d(Ze.controllers[h],O)),a=Ne(pe(n.id),t.materials),s=Me(t.skeletons,n.skin.joints);for(let e=0,t=a.length;e<t;e++){const t=a[e];t.isSkinnedMesh&&(t.bind(s,n.skin.bindMatrix),t.normalizeSkinWeights()),r.push(t)}}var h;for(let e=0,t=c.length;e<t;e++){const t=ae(c[e]);null!==t&&r.push(t.clone())}for(let e=0,t=l.length;e<t;e++){const t=l[e],n=Ne(pe(t.id),t.materials);for(let e=0,t=n.length;e<t;e++)r.push(n[e])}for(let e=0,t=u.length;e<t;e++)r.push(Pe(u[e]).clone());let p;if(0===a.length&&1===r.length)p=r[0];else{p="JOINT"===s?new e.Bone:new e.Group;for(let e=0;e<r.length;e++)p.add(r[e])}return p.name="JOINT"===s?t.sid:t.name,p.matrix.copy(n),p.matrix.decompose(p.position,p.quaternion,p.scale),p}const Oe=new e.MeshBasicMaterial({color:16711935});function Re(e,t){const r=[];for(let n=0,a=e.length;n<a;n++){const a=t[e[n]];void 0===a?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),r.push(Oe)):r.push(K(a))}return r}function Ne(t,r){const n=[];for(const a in t){const s=t[a],o=Re(s.materialKeys,r);0===o.length&&("lines"===a||"linestrips"===a?o.push(new e.LineBasicMaterial):o.push(new e.MeshPhongMaterial));const i=void 0!==s.data.attributes.skinIndex,c=1===o.length?o[0]:o;let l;switch(a){case"lines":l=new e.LineSegments(s.data,c);break;case"linestrips":l=new e.Line(s.data,c);break;case"triangles":case"polylist":l=i?new e.SkinnedMesh(s.data,c):new e.Mesh(s.data,c)}n.push(l)}return n}function Ue(e){return void 0!==Ze.nodes[e]}function Pe(e){return d(Ze.nodes[e],Ce)}function De(t){const r=new e.Group;r.name=t.name;const n=t.children;for(let e=0;e<n.length;e++){const t=n[e];r.add(Pe(t.id))}return r}function Be(e){return d(Ze.visualScenes[e],De)}if(0===t.length)return{scene:new e.Scene};const _e=(new e._default.polyfill.DOMParser).parseFromString(t,"application/xml"),Ge=n(_e,"COLLADA")[0],He=_e.getElementsByTagName("parsererror")[0];if(void 0!==He){const e=n(He,"div")[0];let t;return t=e?e.textContent:function(e){let t="";const r=[e];for(;r.length;){const e=r.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",r.push.apply(r,e.childNodes))}return t.trim()}(He),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",t),null}const Ve=Ge.getAttribute("version");console.log("THREE.ColladaLoader: File version",Ve);const ze=function(e){return{unit:l(n(e,"unit")[0]),upAxis:u(n(e,"up_axis")[0])}}(n(Ge,"asset")[0]),je=new e.TextureLoader(this.manager);let Xe;je.setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin),We&&(Xe=new We(this.manager),Xe.setPath(this.resourcePath||r));const qe=[];let Ye={},Ke=0;const Ze={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};h(Ge,"library_animations","animation",(function t(r){const n={sources:{},samplers:{},channels:{}};let a=!1;for(let e=0,s=r.childNodes.length;e<s;e++){const s=r.childNodes[e];if(1!==s.nodeType)continue;let o;switch(s.nodeName){case"source":o=s.getAttribute("id"),n.sources[o]=se(s);break;case"sampler":o=s.getAttribute("id"),n.samplers[o]=f(s);break;case"channel":o=s.getAttribute("target"),n.channels[o]=g(s);break;case"animation":t(s),a=!0;break;default:console.log(s)}}!1===a&&(Ze.animations[r.getAttribute("id")||e.MathUtils.generateUUID()]=n)})),h(Ge,"library_animation_clips","animation_clip",(function(e){const t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType&&"instance_animation"===n.nodeName)t.animations.push(i(n.getAttribute("url")))}Ze.clips[e.getAttribute("id")]=t})),h(Ge,"library_controllers","controller",(function(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"skin":t.id=i(n.getAttribute("source")),t.skin=M(n);break;case"morph":t.id=i(n.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Ze.controllers[e.getAttribute("id")]=t})),h(Ge,"library_images","image",(function(e){const t={init_from:n(e,"init_from")[0].textContent};Ze.images[e.getAttribute("id")]=t})),h(Ge,"library_effects","effect",(function(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType&&"profile_COMMON"===n.nodeName)t.profile=U(n)}Ze.effects[e.getAttribute("id")]=t})),h(Ge,"library_materials","material",(function(e){const t={name:e.getAttribute("name")};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType&&"instance_effect"===n.nodeName)t.url=i(n.getAttribute("url"))}Ze.materials[e.getAttribute("id")]=t})),h(Ge,"library_cameras","camera",(function(e){const t={name:e.getAttribute("name")};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType&&"optics"===n.nodeName)t.optics=Z(n)}Ze.cameras[e.getAttribute("id")]=t})),h(Ge,"library_lights","light",(function(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType&&"technique_common"===n.nodeName)t=te(n)}Ze.lights[e.getAttribute("id")]=t})),h(Ge,"library_geometries","geometry",(function(e){const t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=n(e,"mesh")[0];if(void 0!==r){for(let e=0;e<r.childNodes.length;e++){const n=r.childNodes[e];if(1!==n.nodeType)continue;const a=n.getAttribute("id");switch(n.nodeName){case"source":t.sources[a]=se(n);break;case"vertices":t.vertices=oe(n);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",n.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ie(n));break;default:console.log(n)}}Ze.geometries[e.getAttribute("id")]=t}})),h(Ge,"library_nodes","node",Ee),h(Ge,"library_visual_scenes","visual_scene",(function(e){const t={name:e.getAttribute("name"),children:[]};!function(e){const t=e.getElementsByTagName("node");for(let e=0;e<t.length;e++){const r=t[e];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+Ke++)}}(e);const r=n(e,"node");for(let e=0;e<r.length;e++)t.children.push(Ee(r[e]));Ze.visualScenes[e.getAttribute("id")]=t})),h(Ge,"library_kinematics_models","kinematics_model",(function(e){const t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType&&"technique_common"===n.nodeName)fe(n,t)}Ze.kinematicsModels[e.getAttribute("id")]=t})),h(Ge,"library_physics_models","physics_model",(function(e){const t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType&&"rigid_body"===n.nodeName)t.rigidBodies[n.getAttribute("name")]={},xe(n,t.rigidBodies[n.getAttribute("name")])}Ze.physicsModels[e.getAttribute("id")]=t})),h(Ge,"scene","instance_kinematics_scene",(function(e){const t={bindJointAxis:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType&&"bind_joint_axis"===n.nodeName)t.bindJointAxis.push(Se(n))}Ze.kinematicsScenes[i(e.getAttribute("url"))]=t})),p(Ze.animations,m),p(Ze.clips,E),p(Ze.controllers,O),p(Ze.images,R),p(Ze.effects,q),p(Ze.materials,Y),p(Ze.cameras,$),p(Ze.lights,ne),p(Ze.geometries,le),p(Ze.visualScenes,De),function(){const t=Ze.clips;if(!0===c(t)){if(!1===c(Ze.animations)){const t=[];for(const e in Ze.animations){const r=v(e);for(let e=0,n=r.length;e<n;e++)t.push(r[e])}qe.push(new e.AnimationClip("default",-1,t))}}else for(const e in t)qe.push(I(e))}(),function(){const t=Object.keys(Ze.kinematicsModels)[0],r=Object.keys(Ze.kinematicsScenes)[0],n=Object.keys(Ze.visualScenes)[0];if(void 0===t||void 0===r)return;const a=(s=t,d(Ze.kinematicsModels[s],de));var s;const o=function(e){return d(Ze.kinematicsScenes[e],Te)}(r),i=Be(n),c=o.bindJointAxis,l={};for(let e=0,t=c.length;e<t;e++){const t=c[e],r=Ge.querySelector('[sid="'+t.target+'"]');if(r){const e=r.parentElement;u(t.jointIndex,e)}}function u(e,t){const r=t.getAttribute("name"),n=a.joints[e];i.traverse((function(a){a.name===r&&(l[e]={object:a,transforms:Fe(t),joint:n,position:n.zeroPosition})}))}const h=new e.Matrix4;Ye={joints:a&&a.joints,getJointValue:function(e){const t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(t,r){const n=l[t];if(n){const a=n.joint;if(r>a.limits.max||r<a.limits.min)console.warn("THREE.ColladaLoader: Joint "+t+" value "+r+" outside of limits (min: "+a.limits.min+", max: "+a.limits.max+").");else if(a.static)console.warn("THREE.ColladaLoader: Joint "+t+" is static.");else{const s=n.object,o=a.axis,i=n.transforms;Ae.identity();for(let n=0;n<i.length;n++){const s=i[n];if(s.sid&&-1!==s.sid.indexOf(t))switch(a.type){case"revolute":Ae.multiply(h.makeRotationAxis(o,e.MathUtils.degToRad(r)));break;case"prismatic":Ae.multiply(h.makeTranslation(o.x*r,o.y*r,o.z*r));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+a.type)}else switch(s.type){case"matrix":Ae.multiply(s.obj);break;case"translate":Ae.multiply(h.makeTranslation(s.obj.x,s.obj.y,s.obj.z));break;case"scale":Ae.scale(s.obj);break;case"rotate":Ae.multiply(h.makeRotationAxis(s.obj,s.angle))}}s.matrix.copy(Ae),s.matrix.decompose(s.position,s.quaternion,s.scale),l[t].position=r}}else console.log("THREE.ColladaLoader: "+t+" does not exist.")}}}();const Qe=function(e){return Be(i(n(e,"instance_visual_scene")[0].getAttribute("url")))}(n(Ge,"scene")[0]);return Qe.animations=qe,"Z_UP"===ze.upAxis&&Qe.quaternion.setFromEuler(new e.Euler(-Math.PI/2,0,0)),Qe.scale.multiplyScalar(ze.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),qe},kinematics:Ye,library:Ze,scene:Qe}}}class Fa extends e.Loader{constructor(e){super(e)}load(t,r,n,a){const s=this,o=new e.FileLoader(s.manager);o.setPath(s.path),o.setResponseType("arraybuffer"),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(t,(function(e){try{r(s.parse(e))}catch(e){a?a(e):console.error(e),s.manager.itemError(t)}}),n,a)}parse(t){function r(e,t){const r=e.length,n=new Float32Array(r+t.length);return n.set(e),n.set(t,r),n}var n=e.LoaderUtils.decodeText(new Uint8Array(t,0,250)).split("\n");return-1!==n[0].indexOf("xml")?function(t){function n(e){var t,r,n,a,s,o,i="undefined"!=typeof Uint8Array?Uint8Array:Array,c=[],l=[],u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=u.length;for(t=0;t<h;t++)c[t]=u[t];for(t=0;t<h;++t)l[u.charCodeAt(t)]=t;if(l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63,(h=e.length)%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o=new i(3*h/4-(s="="===e[h-2]?2:"="===e[h-1]?1:0)),n=s>0?h-4:h;var p=0;for(t=0,r=0;t<n;t+=4,r+=3)a=l[e.charCodeAt(t)]<<18|l[e.charCodeAt(t+1)]<<12|l[e.charCodeAt(t+2)]<<6|l[e.charCodeAt(t+3)],o[p++]=(16711680&a)>>16,o[p++]=(65280&a)>>8,o[p++]=255&a;return 2===s?(a=l[e.charCodeAt(t)]<<2|l[e.charCodeAt(t+1)]>>4,o[p++]=255&a):1===s&&(a=l[e.charCodeAt(t)]<<10|l[e.charCodeAt(t+1)]<<4|l[e.charCodeAt(t+2)]>>2,o[p++]=a>>8&255,o[p++]=255&a),o}function a(e,t){var a,s,i,c,l=0;if("UInt64"===o.attributes.header_type?l=8:"UInt32"===o.attributes.header_type&&(l=4),"binary"===e.attributes.format&&t){var u,h,p,d,f,g;if("Float32"===e.attributes.type)var m=new Float32Array;else"Int64"===e.attributes.type&&(m=new Int32Array);h=(u=n(e["#text"]))[0];for(var v=1;v<l-1;v++)h|=u[v]<<v*l;for(d=(h+3)*l,g=d+=d%3>0?3-d%3:0,(f=[]).push(g),p=3*l,v=0;v<h;v++){for(var y=u[v*l+p],b=1;b<l-1;b++)y|=u[v*l+p+b]<<8*b;g+=y,f.push(g)}for(v=0;v<f.length-1;v++)x=jr(u.slice(f[v],f[v+1])).buffer,"Float32"===e.attributes.type?m=r(m,x=new Float32Array(x)):"Int64"===e.attributes.type&&(s=x=new Int32Array(x),i=void 0,c=void 0,i=(a=m).length,(c=new Int32Array(i+s.length)).set(a),c.set(s,i),m=c);delete e["#text"],"Int64"===e.attributes.type&&"binary"===e.attributes.format&&(m=m.filter((function(e,t){if(t%2!=1)return!0})))}else{if("binary"!==e.attributes.format||t)if(e["#text"])var x=e["#text"].split(/\s+/).filter((function(e){if(""!==e)return e}));else x=new Int32Array(0).buffer;else x=(x=n(e["#text"])).slice(l).buffer;delete e["#text"],"Float32"===e.attributes.type?m=new Float32Array(x):"Int32"===e.attributes.type?m=new Int32Array(x):"Int64"===e.attributes.type&&(m=new Int32Array(x),"binary"===e.attributes.format&&(m=m.filter((function(e,t){if(t%2!=1)return!0}))))}return m}var s=null;if(e._default.polyfill.window.DOMParser)try{s=(new e._default.polyfill.DOMParser).parseFromString(t,"text/xml")}catch(e){s=null}else{if(!e._default.polyfill.window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if((s=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!s.loadXML())throw new Error(s.parseError.reason+s.parseError.srcText)}catch(e){s=null}}var o=function e(t){var r={};if(1===t.nodeType){if(t.attributes&&t.attributes.length>0){r.attributes={};for(var n=0;n<t.attributes.length;n++){var a=t.attributes.item(n);r.attributes[a.nodeName]=a.nodeValue.trim()}}}else 3===t.nodeType&&(r=t.nodeValue.trim());if(t.hasChildNodes())for(var s=0;s<t.childNodes.length;s++){var o=t.childNodes.item(s),i=o.nodeName;if(void 0===r[i])""!==(l=e(o))&&(r[i]=l);else{if(void 0===r[i].push){var c=r[i];r[i]=[c]}var l;""!==(l=e(o))&&r[i].push(l)}}return r}(s.documentElement),i=[],c=[],l=[];if(o.PolyData){for(var u=o.PolyData.Piece,h=o.attributes.hasOwnProperty("compressor"),p=["PointData","Points","Strips","Polys"],d=0,f=p.length;d<f;){var g=u[p[d]];if(g&&g.DataArray){if("[object Array]"===Object.prototype.toString.call(g.DataArray))var m=g.DataArray;else m=[g.DataArray];for(var v=0,y=m.length;v<y;)"#text"in m[v]&&m[v]["#text"].length>0&&(m[v].text=a(m[v],h)),v++;switch(p[d]){case"PointData":var b=parseInt(u.attributes.NumberOfPoints),x=g.attributes.Normals;if(b>0)for(var w=0,S=m.length;w<S;w++)if(x===m[w].attributes.Name){var T=m[w].attributes.NumberOfComponents;(c=new Float32Array(b*T)).set(m[w].text,0)}break;case"Points":(b=parseInt(u.attributes.NumberOfPoints))>0&&(T=g.DataArray.attributes.NumberOfComponents,(i=new Float32Array(b*T)).set(g.DataArray.text,0));break;case"Strips":var F=parseInt(u.attributes.NumberOfStrips);if(F>0){var A=new Int32Array(g.DataArray[0].text.length),k=new Int32Array(g.DataArray[1].text.length);A.set(g.DataArray[0].text,0),k.set(g.DataArray[1].text,0);var E=F+A.length;l=new Uint32Array(3*E-9*F);var I=0;for(w=0,S=F;w<S;w++){for(var M=[],L=0,C=k[w],O=0;L<C-O;L++)M.push(A[L]),w>0&&(O=k[w-1]);var R=0;for(C=k[w],O=0;R<C-O-2;R++)R%2?(l[I++]=M[R],l[I++]=M[R+2],l[I++]=M[R+1]):(l[I++]=M[R],l[I++]=M[R+1],l[I++]=M[R+2]),w>0&&(O=k[w-1])}}break;case"Polys":var N=parseInt(u.attributes.NumberOfPolys);if(N>0){A=new Int32Array(g.DataArray[0].text.length),k=new Int32Array(g.DataArray[1].text.length),A.set(g.DataArray[0].text,0),k.set(g.DataArray[1].text,0),E=N+A.length,l=new Uint32Array(3*E-9*N),I=0;var U=0;for(w=0,S=N,O=0;w<S;){var P=[];for(L=0,C=k[w];L<C-O;)P.push(A[U++]),L++;for(R=1;R<C-O-1;)l[I++]=P[0],l[I++]=P[R],l[I++]=P[R+1],R++;O=k[++w-1]}}}}d++}var D=new e.BufferGeometry;return D.setIndex(new e.BufferAttribute(l,1)),D.setAttribute("position",new e.BufferAttribute(i,3)),c.length===i.length&&D.setAttribute("normal",new e.BufferAttribute(c,3)),D}throw new Error("Unsupported DATASET type")}(e.LoaderUtils.decodeText(t)):n[2].includes("ASCII")?function(t){var r,n=[],a=[],s=[],o=[],i=/^[^\d.\s-]+/,c=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,l=/^(\d+)\s+([\s\d]*)/,u=/^POINTS /,h=/^POLYGONS /,p=/^TRIANGLE_STRIPS /,d=/^POINT_DATA[ ]+(\d+)/,f=/^CELL_DATA[ ]+(\d+)/,g=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,m=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,v=!1,y=!1,b=!1,x=!1,w=!1,S=!1,T=!1,F=t.split("\n");for(var A in F){var k=F[A].trim();if(0===k.indexOf("DATASET")){var E=k.split(" ")[1];if("POLYDATA"!==E)throw new Error("Unsupported DATASET type: "+E)}else if(v)for(;null!==(r=c.exec(k))&&null===i.exec(k);){var I=parseFloat(r[1]),M=parseFloat(r[2]),L=parseFloat(r[3]);a.push(I,M,L)}else if(y){if(null!==(r=l.exec(k))){var C=parseInt(r[1]),O=r[2].split(/\s+/);if(C>=3)for(var R=parseInt(O[0]),N=1,U=0;U<C-2;++U)P=parseInt(O[N]),D=parseInt(O[N+1]),n.push(R,P,D),N++}}else if(b){if(null!==(r=l.exec(k))){var P,D;if(C=parseInt(r[1]),O=r[2].split(/\s+/),C>=3)for(U=0;U<C-2;U++)U%2==1?(R=parseInt(O[U]),P=parseInt(O[U+2]),D=parseInt(O[U+1]),n.push(R,P,D)):(R=parseInt(O[U]),P=parseInt(O[U+1]),D=parseInt(O[U+2]),n.push(R,P,D))}}else if(x||w)if(S)for(;null!==(r=c.exec(k))&&null===i.exec(k);){var B=parseFloat(r[1]),_=parseFloat(r[2]),G=parseFloat(r[3]);s.push(B,_,G)}else if(T)for(;null!==(r=c.exec(k))&&null===i.exec(k);){var H=parseFloat(r[1]),V=parseFloat(r[2]),z=parseFloat(r[3]);o.push(H,V,z)}null!==h.exec(k)?(y=!0,v=!1,b=!1):null!==u.exec(k)?(y=!1,v=!0,b=!1):null!==p.exec(k)?(y=!1,v=!1,b=!0):null!==d.exec(k)?(x=!0,v=!1,y=!1,b=!1):null!==f.exec(k)?(w=!0,v=!1,y=!1,b=!1):null!==g.exec(k)?(S=!0,T=!1,v=!1,y=!1,b=!1):null!==m.exec(k)&&(T=!0,S=!1,v=!1,y=!1,b=!1)}var j=new e.BufferGeometry;if(j.setIndex(n),j.setAttribute("position",new e.Float32BufferAttribute(a,3)),o.length===a.length&&j.setAttribute("normal",new e.Float32BufferAttribute(o,3)),s.length!==n.length)s.length===a.length&&j.setAttribute("color",new e.Float32BufferAttribute(s,3));else{var W=(j=j.toNonIndexed()).attributes.position.count/3;if(s.length===3*W){var X=[];for(A=0;A<W;A++)B=s[3*A+0],_=s[3*A+1],G=s[3*A+2],X.push(B,_,G),X.push(B,_,G),X.push(B,_,G);j.setAttribute("color",new e.Float32BufferAttribute(X,3))}}return j}(e.LoaderUtils.decodeText(t)):function(t){var r,n,a,s,o,i,c,l=new Uint8Array(t),u=new DataView(t),h=[],p=[],d=[],f=0;function g(e,t){for(var r=t,n=e[r],a=[];10!==n;)a.push(String.fromCharCode(n)),n=e[++r];return{start:t,end:r,next:r+1,parsedString:a.join("")}}for(;;){if(0===(c=(i=g(l,f)).parsedString).indexOf("DATASET")){var m=c.split(" ")[1];if("POLYDATA"!==m)throw new Error("Unsupported DATASET type: "+m)}else if(0===c.indexOf("POINTS")){for(r=4*(s=parseInt(c.split(" ")[1],10))*3,h=new Float32Array(3*s),n=i.next,a=0;a<s;a++)h[3*a]=u.getFloat32(n,!1),h[3*a+1]=u.getFloat32(n+4,!1),h[3*a+2]=u.getFloat32(n+8,!1),n+=12;i.next=i.next+r+1}else if(0===c.indexOf("TRIANGLE_STRIPS")){var v=parseInt(c.split(" ")[1],10);r=4*(S=parseInt(c.split(" ")[2],10)),d=new Uint32Array(3*S-9*v);var y=0;for(n=i.next,a=0;a<v;a++){var b=u.getInt32(n,!1),x=[];for(n+=4,o=0;o<b;o++)x.push(u.getInt32(n,!1)),n+=4;for(var w=0;w<b-2;w++)w%2?(d[y++]=x[w],d[y++]=x[w+2],d[y++]=x[w+1]):(d[y++]=x[w],d[y++]=x[w+1],d[y++]=x[w+2])}i.next=i.next+r+1}else if(0===c.indexOf("POLYGONS")){var S;for(v=parseInt(c.split(" ")[1],10),r=4*(S=parseInt(c.split(" ")[2],10)),d=new Uint32Array(3*S-9*v),y=0,n=i.next,a=0;a<v;a++){for(b=u.getInt32(n,!1),x=[],n+=4,o=0;o<b;o++)x.push(u.getInt32(n,!1)),n+=4;for(w=1;w<b-1;w++)d[y++]=x[0],d[y++]=x[w],d[y++]=x[w+1]}i.next=i.next+r+1}else if(0===c.indexOf("POINT_DATA")){for(s=parseInt(c.split(" ")[1],10),i=g(l,i.next),r=4*s*3,p=new Float32Array(3*s),n=i.next,a=0;a<s;a++)p[3*a]=u.getFloat32(n,!1),p[3*a+1]=u.getFloat32(n+4,!1),p[3*a+2]=u.getFloat32(n+8,!1),n+=12;i.next=i.next+r}if((f=i.next)>=l.byteLength)break}var T=new e.BufferGeometry;return T.setIndex(new e.BufferAttribute(d,1)),T.setAttribute("position",new e.BufferAttribute(h,3)),p.length===h.length&&T.setAttribute("normal",new e.BufferAttribute(p,3)),T}(t)}}function Aa(e,t){return null!=e?e:t()}class ka{__init(){this.currFrame=0}constructor(e,t,r,n,a=24,s=!0){this.tiles=e,this.totalFrame=t,this.row=r,this.col=n,ka.prototype.__init.call(this),this.playing=!0,this.currFrame=0,this.frameGap=1e3/a,e.forEach((e=>{e.repeat.set(1/this.col,1/this.row),s&&(e.encoding=3001)})),this.updateOffset()}stop(){this.playing=!1}play(){this.playing=!0,this.startTime=Date.now(),this.startFrame=this.currFrame}get texture(){return this.tiles[this.currTile]}animate(){if(!this.playing||1===this.totalFrame)return;const e=Date.now();this.startTime=Aa(this.startTime,(()=>e)),this.startFrame=Aa(this.startFrame,(()=>this.currFrame));const t=this.startFrame+~~((e-this.startTime)/this.frameGap);this.currFrame=t%this.totalFrame,t>this.currFrame&&(this.startTime=e,this.startFrame=this.currFrame),this.updateOffset()}updateOffset(){this.currTile=~~(this.currFrame/(this.col*this.row)),this.currTileOffset=this.currFrame%(this.col*this.row);const e=this.tiles[this.currTile],t=1/this.row,r=this.currTileOffset%this.col,n=~~(this.currTileOffset/this.col);e&&(e.offset.x=r/this.col,e.offset.y=1-n/this.row-t)}dispose(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.mesh,"optionalAccess",e=>e.material,"access",e=>e.dispose,"call",e=>e()]),this.tiles.forEach((e=>e.dispose())),this.tiles.length=0,this.mesh=null}}const Ea={url:["https://s3.ax1x.com/2021/02/26/yx0ObV.png","https://s3.ax1x.com/2021/02/26/yx0LD0.png","https://s3.ax1x.com/2021/02/26/yx0Hvn.png"],x:0,y:0,z:-15,w:10,h:10,col:2,row:2,total:10,fps:16};var Ia=n(e.three_module),Ma=a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.toEnvMap=void 0,t.toEnvMap=function(e,t=!0){return t&&(e.format=Ia.RGBEFormat,e.encoding=Ia.RGBEEncoding),e.generateMipmaps=!1,e.magFilter=Ia.NearestFilter,e.minFilter=Ia.NearestFilter,e.type=Ia.UnsignedByteType,e.mapping=Ia.CubeUVReflectionMapping,e.name="PMREM.cubeUv",e}}));const La=new e.Vector3(0,0,1),Ca=new e.Euler,Oa=new e.Quaternion,Ra=new e.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),Na={type:"change"};class Ua extends e.EventDispatcher{constructor(t){super(),!1===e._default.polyfill.window.isSecureContext&&console.error("THREE.DeviceOrientationControls: DeviceOrientationEvent is only available in secure contexts (https)");const r=this,n=new e.Quaternion;this.object=t,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;const a=function(e){r.deviceOrientation=e},s=function(){r.screenOrientation=e._default.polyfill.window.orientation||0};this.connect=function(){s(),void 0!==e._default.polyfill.window.DeviceOrientationEvent&&"function"==typeof e._default.polyfill.window.DeviceOrientationEvent.requestPermission?e._default.polyfill.window.DeviceOrientationEvent.requestPermission().then((function(t){"granted"==t&&(e._default.polyfill.window.addEventListener("orientationchange",s),e._default.polyfill.window.addEventListener("deviceorientation",a))})).catch((function(e){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)})):(e._default.polyfill.window.addEventListener("orientationchange",s),e._default.polyfill.window.addEventListener("deviceorientation",a)),r.enabled=!0},this.disconnect=function(){e._default.polyfill.window.removeEventListener("orientationchange",s),e._default.polyfill.window.removeEventListener("deviceorientation",a),r.enabled=!1},this.update=function(){if(!1===r.enabled)return;const t=r.deviceOrientation;if(t){const a=t.alpha?e.MathUtils.degToRad(t.alpha)+r.alphaOffset:0,s=t.beta?e.MathUtils.degToRad(t.beta):0,o=t.gamma?e.MathUtils.degToRad(t.gamma):0,i=r.screenOrientation?e.MathUtils.degToRad(r.screenOrientation):0;!function(e,t,r,n,a){Ca.set(r,t,-n,"YXZ"),e.setFromEuler(Ca),e.multiply(Ra),e.multiply(Oa.setFromAxisAngle(La,-a))}(r.object.quaternion,a,s,o,i),8*(1-n.dot(r.object.quaternion))>1e-6&&(n.copy(r.object.quaternion),r.dispatchEvent(Na))}},this.dispose=function(){r.disconnect()},this.connect()}}var Pa=function e(t,r,n,a){if(Array.isArray(t)){for(var s=e(new Float64Array(t),r,n,a),o=0;o<t.length;o++)t[o]=s[o];return t}if(!r||!n)throw Error("Bad dimensions");a||(a=t.length/(r*n));for(var i=n>>1,c=r*a,l=new(0,t.constructor)(r*a),u=0;u<i;++u){var h=u*c,p=(n-u-1)*c;l.set(t.subarray(h,h+c)),t.copyWithin(h,p,p+c),t.set(l,p)}return t},Da=Object.defineProperty({default:Pa},"__esModule",{value:!0}),Ba=a((function(e,r){var n=t&&t.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.screenshot=void 0;const a=n(Da);r.screenshot=function(e,t,r,n){const{width:s,height:o}=e.domElement,i=new n(s,o),c=new Uint8Array(s*o*4);return i.texture.encoding=e.outputEncoding,e.setRenderTarget(i),e.render(t,r),e.readRenderTargetPixels(i,0,0,s,o,c),e.setRenderTarget(null),i.dispose(),(0,a.default)(c,s,o,4),[c,s,o]}}));exports.DemoBVHLoader=class extends ze{async init(){const{scene:t,camera:r}=this.deps,n=new tt;r.position.set(0,200,300);const a=await n.loadAsync(Ve+"/models/bvh/pirouette.bvh"),s=new e.SkeletonHelper(a.skeleton.bones[0]);s.skeleton=a.skeleton;const o=new e.Group;o.add(a.skeleton.bones[0]),this.add(s),this.add(o),t.background=new e.Color(15658734),this.add(new e.GridHelper(400,10)),this.mixer=new e.AnimationMixer(s),this.mixer.clipAction(a.clip).setEffectiveWeight(1).play(),this.addControl(),this.orbitControl.minDistance=300,this.orbitControl.maxDistance=700}update(){rt([this,"access",e=>e.mixer,"optionalAccess",e=>e.update,"call",e=>e(this.deps.clock.getDelta())]),rt([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset(),this.mixer.stopAllAction(),this.mixer=null}},exports.DemoColladaLoader=class extends ze{async init(){const{camera:t}=this.deps;t.position.set(8,10,8),t.lookAt(0,3,0);const r=new Ta,n=await r.loadAsync(Ve+"/models/collada/elf/elf.dae");this.add(n.scene);const a=new e.AmbientLight(13421772,.4);this.add(a);const s=new e.DirectionalLight(16777215,.8);s.position.set(1,1,0).normalize(),this.add(s),this.addControl()}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoDeviceOrientationControls=class extends ze{async init(){const{camera:t,textureLoader:r}=this.deps;this.control=new Ua(t);const n=new e.SphereGeometry(500,60,40);n.scale(-1,1,1);const a=new e.MeshBasicMaterial({map:await r.loadAsync("https://s3.ax1x.com/2021/02/26/yx0quq.jpg")}),s=new e.BoxGeometry(100,100,100,4,4,4),o=new e.MeshBasicMaterial({color:16711935,wireframe:!0});this.add(new e.Mesh(n,a)),this.add(new e.Mesh(s,o))}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.control,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset(),this.control.disconnect(),this.control.dispose(),this.control=null}},exports.DemoEXRLoader=class extends ze{async init(){const{renderer:t}=this.deps,r=(new ya).setDataType(e.FloatType),n=await r.loadAsync(Ve+"/textures/memorial.exr"),a=new e.MeshBasicMaterial({map:n}),s=new e.PlaneGeometry(4.5*n.image.width/n.image.height,4.5);this.add(new e.Mesh(s,a)),this.lastToneMapping=t.toneMapping,this.lastToneMappingExposure=t.toneMappingExposure,t.toneMapping=e.ReinhardToneMapping,t.toneMappingExposure=2}update(){}dispose(){this.deps.renderer.toneMapping=this.lastToneMapping,this.deps.renderer.toneMappingExposure=this.lastToneMappingExposure,this.reset()}},exports.DemoFBXLoader=class extends ze{async init(){const{camera:t,scene:r}=this.deps;t.position.set(100,200,300),r.background=new e.Color(10526880),r.fog=new e.Fog(10526880,200,1e3);const n=new e.HemisphereLight(16777215,4473924);n.position.set(0,200,0),this.add(n);const a=new e.DirectionalLight(16777215);a.position.set(0,200,100),a.castShadow=!0,a.shadow.camera.top=180,a.shadow.camera.bottom=-100,a.shadow.camera.left=-120,a.shadow.camera.right=120,this.add(a);const s=new e.Mesh(new e.PlaneGeometry(2e3,2e3),new e.MeshPhongMaterial({color:10066329,depthWrite:!1}));s.rotation.x=-Math.PI/2,s.receiveShadow=!0,this.add(s);const o=new e.GridHelper(2e3,20,0,0);o.material.opacity=.2,o.material.transparent=!0,this.add(o);const i=new kn,c=await i.loadAsync(Ve+"/models/fbx/Samba Dancing.fbx"),l=new e.AnimationMixer(c);l.clipAction(c.animations[0]).play(),c.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),this.add(c),this.addControl(),this.orbitControl.target.set(0,100,0),this.orbitControl.update(),this.mixer=l}update(){Wn([this,"access",e=>e.mixer,"optionalAccess",e=>e.update,"call",e=>e(this.deps.clock.getDelta())]),Wn([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset(),this.mixer.stopAllAction(),this.mixer=null}},exports.DemoGLTFLoader=class extends ze{async init(){const t=await this.deps.gltfLoader.loadAsync("https://dtmall-tel.alicdn.com/edgeComputingConfig/upload_models/1591673169101/RobotExpressive.glb");t.scene.position.z=2.5,t.scene.position.y=-2,this.add(new e.DirectionalLight(16777215,1)),this.add(new e.AmbientLight(16777215,1)),this.add(t.scene),this.deps.camera.position.z=10;const r=["Idle","Walking","Running","Dance","Death","Sitting","Standing"],n=["Jump","Yes","No","Wave","Punch","ThumbsUp"];this.mixer=new e.AnimationMixer(t.scene);const a={};for(let s=0;s<t.animations.length;s++){const o=t.animations[s],i=this.mixer.clipAction(o);a[o.name]=i,(n.indexOf(o.name)>=0||r.indexOf(o.name)>=4)&&(i.clampWhenFinished=!0,i.loop=e.LoopOnce)}a.Walking.play(),this.addControl()}update(){Sa([this,"access",e=>e.mixer,"optionalAccess",e=>e.update,"call",e=>e(this.deps.clock.getDelta())]),Sa([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.mixer.stopAllAction(),this.mixer=null,this.reset()}},exports.DemoHDRPrefilterTexture=class extends ze{async init(){const{scene:t,camera:r}=this.deps,n=await this.deps.textureLoader.loadAsync("https://cdn.static.oppenlab.com/weblf/test/hdr-prefilter.png");Ma.toEnvMap(n);const a=new e.PlaneGeometry(3,3),s=new e.MeshBasicMaterial({map:n}),o=new e.Mesh(a,s);this.add(o),t.background=n,r.position.z=1,this.addControl()}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoLWOLoader=class extends ze{async init(){const{scene:t,renderer:r,camera:n}=this.deps;n.position.set(-.7,14.6,43.2),t.background=new e.Color(10526880);const a=new e.AmbientLight(11184810,1.75);this.add(a);const s=new e.DirectionalLight(16777215,1);s.position.set(0,200,100),s.castShadow=!0,s.shadow.camera.top=180,s.shadow.camera.bottom=-100,s.shadow.camera.left=-120,s.shadow.camera.right=120,this.add(s);const o=new e.DirectionalLight(16777215,.7);o.position.set(-100,200,-100),this.add(o);const i=new e.DirectionalLight(16777215,.4);i.position.set(100,-200,100),this.add(i);const c=new e.DirectionalLight(16777215,1);c.position.set(-100,-100,100),this.add(c);const l=new e.GridHelper(200,20,0,0);l.material.opacity=.3,l.material.transparent=!0,this.add(l);const u=new ea,h=await u.loadAsync(Ve+"/models/lwo/Objects/LWO3/Demo.lwo"),p=h.meshes[0];p.position.set(-2,12,0);const d=h.meshes[1];d.position.set(2,12,0);const f=h.meshes[2];f.position.set(0,10.5,-1),this.add(p),this.add(f),this.add(d),r.shadowMap.enabled=!0,r.physicallyCorrectLights=!0,r.gammaFactor=1.18,this.addControl(),this.orbitControl.target.set(1.33,10,-6.7)}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoMTLLoader=class extends ze{async init(){const{camera:t,renderer:r}=this.deps,n=new e.LoadingManager;n.addHandler(/\.dds$/i,new oa);const a=new aa(n),s=new va(n),o=await a.loadAsync(Ve+"/models/obj/male02/male02.mtl");o.preload();const i=await s.setMaterials(o).loadAsync(Ve+"/models/obj/male02/male02.obj");i.position.y=-95,this.addControl(),this.add(new e.AmbientLight(13421772,.4)),this.addCamera(new e.PointLight(16777215,.8)),this.add(i),this.add(t),i.position.y=-95,t.position.z=200,r.outputEncoding=e.LinearEncoding}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoMemoryTest=class extends ze{async init(){this.reset(!1);const t=await this.deps.gltfLoader.loadAsync(Ve+"/models/gltf/Soldier.glb");this.add(new e.DirectionalLight(16777215,1)),this.add(new e.AmbientLight(16777215,1)),this.add(t.scene),this.timer=setTimeout((()=>this.init()),300)}update(){}dispose(){this.reset(),clearTimeout(this.timer)}},exports.DemoMeshOpt=class extends ze{async init(){const{gltfLoader:t,camera:r,scene:n}=this.deps;je.MeshoptDecoder.setWasmPath("/decoder_base.wasm"),t.setMeshoptDecoder(je.MeshoptDecoder);const a=Date.now(),s=await t.loadAsync("https://cdn.static.oppenlab.com/weblf/test/pirate.glb");console.log(Date.now()-a);const o=new e.PointLight(16777215,.8);o.position.set(3,3,0),this.add(new e.AmbientLight(13421772,.3)),this.add(s.scene),this.add(r),this.addCamera(o),s.scene.position.y=-1,n.position.z=0,r.position.y=1,r.position.z=3,n.background=new e.Color(3148324),this.addControl()}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoMeshQuantization=class extends ze{async init(){const{camera:t,gltfLoader:r,scene:n}=this.deps,a=Date.now();je.MeshoptDecoder.setWasmPath("/decoder_base.wasm"),r.setMeshoptDecoder(je.MeshoptDecoder);const s=await r.loadAsync("https://cdn.static.oppenlab.com/weblf/test/PrimaryIonDrive-EXT_MESH_QUANTIZATION.glb"),o=Date.now();console.log("load glb time",o-a),this.add(s.scene),this.add(new e.DirectionalLight(16777215,1)),this.add(new e.AmbientLight(16777215,1)),t.position.z=3,n.position.z=0,this.addControl()}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoOBJLoader=class extends ze{async init(){const{textureLoader:t,camera:r,renderer:n}=this.deps,a=await t.loadAsync(Ve+"/textures/UV_Grid_Sm.jpg"),s=new va,o=await s.loadAsync(Ve+"/models/obj/male02/male02.obj");this.add(new e.AmbientLight(13421772,.4)),this.addCamera(new e.PointLight(16777215,.8)),this.add(o),this.add(r),o.traverse((function(e){e.isMesh&&(e.material.map=a)})),o.position.y=-95,r.position.z=200,n.outputEncoding=e.LinearEncoding,this.addControl()}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoPDBLoader=class extends ze{async init(){const{camera:t,scene:r,renderer:n}=this.deps;t.position.z=100,r.position.z=0,r.background=new e.Color(328965),n.outputEncoding=e.LinearEncoding,this.addControl(),this.obj=new e.Group,this.obj.scale.set(.1,.1,.1),this.add(this.obj);const a=new e.DirectionalLight(16777215,.8);a.position.set(1,1,1);const s=new e.DirectionalLight(16777215,.5);s.position.set(-1,-1,1),this.add(a),this.add(s);const o=new Xe,i=await o.loadAsync(Ve+"/models/molecules/caffeine.pdb");this.loadMolecule(i)}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}loadMolecule(t){var r=t.geometryAtoms,n=t.geometryBonds,a=t.json,s=new e.Vector3,o=new e.BoxGeometry(1,1,1),i=new e.IcosahedronGeometry(1,2);r.computeBoundingBox(),r.boundingBox.getCenter(s).negate(),r.translate(s.x,s.y,s.z),n.translate(s.x,s.y,s.z);for(var c=r.getAttribute("position"),l=r.getAttribute("color"),u=new e.Vector3,h=new e.Color,p=0;p<c.count;p++){u.x=c.getX(p),u.y=c.getY(p),u.z=c.getZ(p),h.r=l.getX(p),h.g=l.getY(p),h.b=l.getZ(p);var d=new e.MeshPhongMaterial({color:h});(m=new e.Mesh(i,d)).position.copy(u),m.position.multiplyScalar(75),m.scale.multiplyScalar(25),this.obj.add(m),a.atoms[p]}c=n.getAttribute("position");var f=new e.Vector3,g=new e.Vector3;for(p=0;p<c.count;p+=2){var m;f.x=c.getX(p),f.y=c.getY(p),f.z=c.getZ(p),g.x=c.getX(p+1),g.y=c.getY(p+1),g.z=c.getZ(p+1),f.multiplyScalar(75),g.multiplyScalar(75),(m=new e.Mesh(o,new e.MeshPhongMaterial({color:16777215}))).position.copy(f),m.position.lerp(g,.5),m.scale.set(5,5,f.distanceTo(g)),m.lookAt(g),this.obj.add(m)}}},exports.DemoRGBELoader=class extends ze{async init(){const{renderer:t,gltfLoader:r,scene:n,camera:a}=this.deps,s=await r.loadAsync(wa+"/examples/models/gltf/MetalRoughSpheres/glTF/MetalRoughSpheres.gltf");s.scene.rotation.copy(new e.Euler(0,0,0)),t.physicallyCorrectLights=!0;const o=new xa,i=new e.PMREMGenerator(t);i.compileEquirectangularShader();const c=Date.now(),l=await o.setDataType(e.UnsignedByteType).loadAsync(wa+"/examples/textures/equirectangular/venice_sunset_2k.hdr"),u=Date.now(),h=i.fromEquirectangular(l).texture;console.log("time cost",Date.now()-u,u-c),l.dispose(),i.dispose(),n.background=h,s.scene.traverse((function(e){e.material&&(e.material.isMeshStandardMaterial||e.material.isShaderMaterial&&void 0!==e.material.envMap)&&(e.material.envMap=h,e.material.envMapIntensity=1.5),(e.isMesh||e.isLight)&&(e.castShadow=!0)}));const p=new e.DirectionalLight(14540253,4);p.position.set(0,0,1).normalize();const d=new e.SpotLight(16777215,1);d.position.set(5,10,5),d.angle=.5,d.penumbra=.75,d.intensity=100,d.decay=2,a.position.set(2,1,15),this.add(s.scene),this.add(p),this.add(new e.AmbientLight(2236962)),this.add(d),this.addControl()}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoSTLLoader=class extends ze{async init(){const{camera:t,renderer:r,scene:n}=this.deps;t.position.set(3,.15,3),r.setClearColor(16777215),n.position.z=0,n.background=new e.Color(7496795),n.fog=new e.Fog(7496795,2,15),r.shadowMap.enabled=!0;const a=new e.Mesh(new e.PlaneGeometry(40,40),new e.MeshPhongMaterial({color:10066329,specular:1052688}));a.rotation.x=-Math.PI/2,a.position.y=-.5,a.receiveShadow=!0,this.add(a),this.add(new e.AmbientLight(4473924)),this.addShadowedLight(1,1,1,16777215,1.35),this.addShadowedLight(.5,1,-1,16755200,1),this.addControl(),this.loadModels()}addShadowedLight(t,r,n,a,s){const o=new e.DirectionalLight(a,s);o.position.set(t,r,n),this.add(o),o.castShadow=!0;o.shadow.camera.left=-1,o.shadow.camera.right=1,o.shadow.camera.top=1,o.shadow.camera.bottom=-1,o.shadow.camera.near=1,o.shadow.camera.far=4,o.shadow.bias=-.002}loadModels(){const t=new qe;t.load(Ve+"/models/stl/ascii/slotted_disk.stl",(t=>{const r=new e.MeshPhongMaterial({color:16733491,specular:1118481,shininess:200}),n=new e.Mesh(t,r);n.position.set(0,-.25,.6),n.rotation.set(0,-Math.PI/2,0),n.scale.set(.5,.5,.5),n.castShadow=!0,n.receiveShadow=!0,this.add(n)}));const r=new e.MeshPhongMaterial({color:11184810,specular:1118481,shininess:200});t.load(Ve+"/models/stl/binary/pr2_head_pan.stl",(t=>{const n=new e.Mesh(t,r);n.position.set(0,-.37,-.6),n.rotation.set(-Math.PI/2,0,0),n.scale.set(2,2,2),n.castShadow=!0,n.receiveShadow=!0,this.add(n)})),t.load("./models/stl/binary/pr2_head_tilt.stl",(t=>{const n=new e.Mesh(t,r);n.position.set(.136,-.37,-.6),n.rotation.set(-Math.PI/2,.3,0),n.scale.set(2,2,2),n.castShadow=!0,n.receiveShadow=!0,this.add(n)})),t.load(Ve+"/models/stl/binary/colored.stl",(t=>{let n=r;t.hasColors&&(n=new e.MeshPhongMaterial({opacity:t.alpha,vertexColors:!0}));const a=new e.Mesh(t,n);a.position.set(.5,.2,0),a.rotation.set(-Math.PI/2,Math.PI/2,0),a.scale.set(.3,.3,.3),a.castShadow=!0,a.receiveShadow=!0,this.add(a)}))}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()]),this.deps.camera.lookAt(new e.Vector3(0,-.25,0))}dispose(){this.reset()}},exports.DemoSVGLoader=class extends ze{async init(){const{camera:t,renderer:r}=this.deps,n=new ba,a=await n.loadAsync("https://techbrood.com/threejs/examples/models/svg/tiger.svg"),s=new e.GridHelper(160,10);s.rotation.x=Math.PI/2,this.add(s),this.add(this.initSVG(a)),this.addControl(),t.position.set(0,0,200),r.outputEncoding=e.LinearEncoding}initSVG(t){const r=!1,n=!1,{paths:a}=t;var s=new e.Group;s.scale.multiplyScalar(.25),s.position.x=-70,s.position.y=70,s.scale.y*=-1;for(var o=0;o<a.length;o++){var i=a[o],c=i.userData.style.fill;if(void 0!==c&&"none"!==c)for(var l=new e.MeshBasicMaterial({color:(new e.Color).setStyle(c),opacity:i.userData.style.fillOpacity,transparent:i.userData.style.fillOpacity<1,side:e.DoubleSide,depthWrite:!1,wireframe:r}),u=i.toShapes(!0),h=0;h<u.length;h++){var p=u[h],d=new e.ShapeGeometry(p),f=new e.Mesh(d,l);s.add(f)}var g=i.userData.style.stroke;if(void 0!==g&&"none"!==g){l=new e.MeshBasicMaterial({color:(new e.Color).setStyle(g),opacity:i.userData.style.strokeOpacity,transparent:i.userData.style.strokeOpacity<1,side:e.DoubleSide,depthWrite:!1,wireframe:n}),h=0;for(var m=i.subPaths.length;h<m;h++){var v=i.subPaths[h];if(d=ba.pointsToStroke(v.getPoints(),i.userData.style)){f=new e.Mesh(d,l);s.add(f)}}}}return s}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoTGALoader=class extends ze{async init(){const{camera:t,renderer:r}=this.deps,n=new We,[a,s]=await Promise.all([n.loadAsync(Ve+"/textures/crate_grey8.tga"),n.loadAsync(Ve+"/textures/crate_color8.tga")]);t.position.set(0,50,250);const o=new e.BoxGeometry(50,50,50),i=new e.MeshPhongMaterial({color:16777215,map:a}),c=new e.Mesh(o,i);c.position.x=-50;const l=new e.MeshPhongMaterial({color:16777215,map:s}),u=new e.Mesh(o,l);u.position.x=50;const h=new e.DirectionalLight(16777215,1);h.position.set(1,1,1),this.add(c),this.add(u),this.add(h),this.add(new e.AmbientLight(16777215,.4)),this.addControl(),r.outputEncoding=e.LinearEncoding}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoTTFLoader=class extends ze{async init(){const{camera:t,scene:r,renderer:n}=this.deps;t.position.set(0,400,700),r.background=new e.Color(0),r.fog=new e.Fog(0,250,1400);const a=new e.DirectionalLight(16777215,.125);a.position.set(0,0,1).normalize(),this.add(a);const s=new e.PointLight(16777215,1.5);s.position.set(0,100,90),s.color.setHSL(Math.random(),1,.5),this.add(s);const o=new e.MeshPhongMaterial({color:16777215,flatShading:!0}),i=new e.Group;i.position.y=100,this.add(i);const c=new Qe,l=await c.loadAsync(Ve+"/fonts/ttf/kenpixel.ttf");console.log(l),this.createText(new $e(l),i,o);const u=new e.Mesh(new e.PlaneGeometry(1e4,1e4),new e.MeshBasicMaterial({color:16777215,opacity:.5,transparent:!0}));u.position.y=100,u.rotation.x=-Math.PI/2,n.outputEncoding=e.LinearEncoding,this.add(u),this.addControl()}createText(t,r,n){const a=new Je("three.js",{font:t,size:70,height:20,curveSegments:4,bevelThickness:2,bevelSize:1.5,bevelEnabled:!0});a.computeBoundingBox(),a.computeVertexNormals();const s=-.5*(a.boundingBox.max.x-a.boundingBox.min.x),o=new e.Mesh(a,n);o.position.x=s,o.position.y=30,o.position.z=0,o.rotation.x=0,o.rotation.y=2*Math.PI,r.add(o);{const t=new e.Mesh(a,n);t.position.x=s,t.position.y=-30,t.position.z=20,t.rotation.x=Math.PI,t.rotation.y=2*Math.PI,r.add(t)}}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoThreeSpritePlayer=class extends ze{async init(){const{textureLoader:t}=this.deps,r=await Promise.all(Ea.url.map((e=>t.loadAsync(e)))),n=new ka(r,Ea.total,Ea.row,Ea.col,Ea.fps,!0),a=new e.PlaneGeometry(Ea.w,Ea.h),s=new e.MeshBasicMaterial({map:n.texture,transparent:!1}),o=new e.Mesh(a,s),i=new e.BoxGeometry,c=new e.Mesh(i,s);c.position.y=-1.2,o.position.z=-8,o.position.y=4,this.add(o),this.add(c),this.mesh=o,this.player=n}update(){this.player.animate(),this.mesh.material.map=this.player.texture}dispose(){this.reset(),this.player.dispose(),this.player=null,this.mesh=null}},exports.DemoVSMShadow=class extends ze{async init(){console.log("VSMShadowMapthree r131");const{camera:t,renderer:r,scene:n}=this.deps;t.position.set(0,10,30),n.fog=new e.Fog(13421772,50,100);const a=new e.SpotLight(8947848);a.name="Spot Light",a.angle=Math.PI/5,a.penumbra=.3,a.position.set(8,10,5),a.castShadow=!0,a.shadow.camera.near=8,a.shadow.camera.far=200,a.shadow.mapSize.width=256,a.shadow.mapSize.height=256,a.shadow.bias=-.002,a.shadow.radius=4;const s=new e.DirectionalLight(16777215,1);s.name="Dir. Light",s.position.set(3,12,17),s.castShadow=!0,s.shadow.camera.near=.1,s.shadow.camera.far=500,s.shadow.camera.right=17,s.shadow.camera.left=-17,s.shadow.camera.top=17,s.shadow.camera.bottom=-17,s.shadow.mapSize.width=512,s.shadow.mapSize.height=512,s.shadow.radius=4,s.shadow.bias=-5e-4;const o=new e.Group;o.add(s),this.addControl(),this.add(new e.AmbientLight(4473924)),this.add(o),this.add(a),this.add(s),this.dirLight=s,this.dirGroup=o;let i=new e.MeshPhongMaterial({color:10066329,shininess:0,specular:2236962});{const t=new e.TorusKnotGeometry(25,8,75,20),r=new e.Mesh(t,i);r.scale.multiplyScalar(1/18),r.position.y=3,r.castShadow=!0,r.receiveShadow=!0,this.add(r),this.torusKnot=r}{const t=new e.CylinderGeometry(.75,.75,7,32),r=new e.Mesh(t,i);r.position.set(10,3.5,10),r.castShadow=!0,r.receiveShadow=!0;const n=r.clone();n.position.set(10,3.5,-10);const a=r.clone();a.position.set(-10,3.5,10);const s=r.clone();s.position.set(-10,3.5,-10),this.add(r),this.add(n),this.add(a),this.add(s)}{const t=new e.PlaneGeometry(200,200);i=new e.MeshPhongMaterial({color:10066329,shininess:0,specular:1118481});const r=new e.Mesh(t,i);r.rotation.x=-Math.PI/2,r.scale.multiplyScalar(3),r.castShadow=!0,r.receiveShadow=!0,this.add(r)}r.shadowMap.enabled=!0,r.shadowMap.type=e.VSMShadowMap,r.setClearColor(13421772,1),this.orbitControl.target.set(0,2,0)}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()]);const e=this.deps.clock.getDelta(),t=this.deps.clock.getElapsedTime();this.torusKnot.rotation.x+=.25*e,this.torusKnot.rotation.y+=2*e,this.torusKnot.rotation.z+=1*e,this.dirGroup.rotation.y+=.7*e,this.dirLight.position.z=17+5*Math.sin(.001*t)}dispose(){this.reset(),this.dirLight=null,this.dirGroup=null,this.torusKnot=null}},exports.DemoVTKLoader=class extends ze{async init(){const t=new e.MeshLambertMaterial({color:1193046,side:e.DoubleSide}),r=new Fa,n=await r.loadAsync(Ve+"models/vtk/bunny.vtk");n.center(),n.computeVertexNormals();const a=new e.Mesh(n,t);console.log(n),this.add(new e.DirectionalLight(16777215,1)),this.add(new e.AmbientLight(16777215,1)),this.add(a),this.deps.camera.position.z=.5,this.deps.scene.position.z=0,this.addControl()}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const a=e[n],s=e[n+1];if(n+=2,("optionalAccess"===a||"optionalCall"===a)&&null==r)return;"access"===a||"optionalAccess"===a?(t=r,r=s(r)):"call"!==a&&"optionalCall"!==a||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.GLTFLoader=D,exports.screenshot_1=Ba,exports.wechat=P;
